/*!
 * Intelephense Licence
 * 
 * Copyright (c) 2019 - present Ben Robert Mewburn <ben@mewburn.id.au>
 * 
 * By installing this software you agree to be bound by the provisions 
 * of this agreement.
 * 
 * Ben Robert Mewburn (hereafter referred to as the Licensor) grants you 
 * a personal, non-transferable, non-exclusive licence to use the Intelephense 
 * software (hereafter referred to as the Software) on your devices in accordance 
 * with the terms of this agreement.
 * 
 * The Software, copyright, and other intellectual property rights of whatever 
 * nature in the Software, including any modifications made thereto are and shall 
 * remain the property of the Licensor.
 * 
 * You may use the Software as a standalone PHP language server with any 
 * Language Server Protocol capable IDE or text editor.
 * 
 * You are NOT permitted to:
 * 
 * * Edit, alter, modify, adapt, translate or otherwise change the whole or any 
 *   part of the Software. 
 * * Decompile, disassemble or reverse engineer the Software or attempt to do 
 *   any such things.
 * * Reproduce, copy, distribute, resell or otherwise use the whole or any part 
 *   of the Software for any commercial purpose.
 * * Disable, modify or hide notifications sent by the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * LICENSOR, AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR 
 * OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING 
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS 
 * IN THE SOFTWARE.
 * 
 */!function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=24)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(12);var r,s;t.Event=class{constructor(){this._subscribed=[]}subscribe(e){this._subscribed.push(e);let t=this._subscribed.length-1,n=this._subscribed;return()=>{n.splice(t,1)}}trigger(e){let t;for(let n=0;n<this._subscribed.length;++n)(t=this._subscribed[n])(e)}},function(e){e.create=function(e,t){return{uriHash:e,range:t}}}(t.PackedLocation||(t.PackedLocation={}));class o{constructor(e){this._spine=e.slice(0)}get spine(){return this._spine.slice(0)}get node(){return this._spine[this._spine.length-1]}traverse(e){return e.beforeTraverse&&e.beforeTraverse(this.node,this._spine.slice(0,-1)),this.visitNode(this.node,e,this._spine.slice(0,-1)),e}filter(e,t){let n=new a(e,t);return this.traverse(n),n.array}toArray(){let e=new d;return this.traverse(e),e.array}count(){let e=new l;return this.traverse(e),e.count}depth(){return this._spine.length-1}up(e){let t=Math.min(this._spine.length-1,e);return this._spine=this._spine.slice(0,this._spine.length-t),this.node}root(){return this._spine=[this._spine[0]],this.node}find(e){let t=new c(e);if(this.traverse(t),t.found)return this._spine=t.found,this.node}child(e){let t=this.node;if(t&&t.children)for(let n=0;n<t.children.length;++n)if(e(t.children[n]))return this._spine.push(t.children[n]),this.node}hasChild(e){let t=this.node,n=!1;if(!t.children)return n;for(let i=0,r=t.children.length;i<r&&!n;++i)n=e(t.children[i]);return n}nthChild(e){let t=this.node;if(!(!t||!t.children||e<0||e>t.children.length-1))return this._spine.push(t.children[e]),this.node}lastChild(){let e=this.node;if(e&&e.children&&!(e.children.length<1))return this._spine.push(e.children[e.children.length-1]),this.node}childCount(){let e=this.node;return e&&e.children?e.children.length:0}prevSibling(){if(this._spine.length<2)return null;let e=this._spine[this._spine.length-2],t=e.children.indexOf(this.node);return t>0?(this._spine.pop(),this._spine.push(e.children[t-1]),this.node):null}nextSibling(){if(this._spine.length<2)return null;let e=this._spine[this._spine.length-2],t=e.children.indexOf(this.node);return t<e.children.length-1?(this._spine.pop(),this._spine.push(e.children[t+1]),this.node):null}ancestor(e){for(let t=this._spine.length-2;t>=0;--t)if(e(this._spine[t]))return this._spine=this._spine.slice(0,t+1),this.node}hasAncestor(e){for(let t=this._spine.length-2;t>=0;--t)if(e(this._spine[t]))return!0;return!1}parent(){if(this._spine.length>1)return this._spine.pop(),this.node}hasParent(e){return this._spine.length>1&&e(this.node)}clone(){return new o(this._spine)}visitNode(e,t,n){let i=!0;if(t.preorder&&(i=t.preorder(e,n)),e.children&&i){n.push(e);for(let i=0,r=e.children.length;i<r;++i)this.visitNode(e.children[i],t,n);n.pop()}t.postorder&&t.postorder(e,n)}}t.TreeTraverser=o;class a{constructor(e,t){this.predicate=e,this.shouldDescendFn=t,this.predicate=e,this._array=[]}get array(){return this._array}preorder(e,t){return this.predicate(e)&&this._array.push(e),!this.shouldDescendFn||this.shouldDescendFn(e)}}class c{constructor(e){this.predicate=e,this.haltTraverse=!1}get found(){return this._found}preorder(e,t){return!this.haltTraverse&&(!this.predicate(e)||(this._found=t.slice(0),this._found.push(e),this.haltTraverse=!0,!1))}}t.Debounce=class{constructor(e,t){this.handler=e,this.wait=t,this.clear=(()=>{clearTimeout(this._timer),this._timer=void 0,this._eventArgsArray=[]}),this._eventArgsArray=[]}handle(e){this.clear(),this._eventArgsArray.push(e),this._timer=setTimeout(()=>{this.handler(this._eventArgsArray),this.clear()},this.wait)}flush(e){if(!this._timer)return e;const t=this._eventArgsArray;return this.clear(),this.handler(t)}};class d{constructor(){this._array=[]}get array(){return this._array}preorder(e,t){return this._array.push(e),!0}}t.ToArrayVisitor=d;class l{constructor(){this._count=0}get count(){return this._count}preorder(e,t){return++this._count,!0}}t.CountVisitor=l;class u{constructor(e){this._sortedArray=e}set sortedArray(e){this._sortedArray=e}find(e){let t=this.search(e);return t.isExactMatch?this._sortedArray[t.rank]:null}rank(e){return this.search(e).rank}range(e,t){let n=this.rank(e);return this._sortedArray.slice(n,this.search(t,n).rank)}search(e,t){let n,i=t||0,r=this._sortedArray.length-1,s=0,o=0;for(;;){if(i>r){n={rank:i,isExactMatch:!1};break}if(s=Math.floor((i+r)/2),(o=e(this._sortedArray[s]))<0)i=s+1;else{if(!(o>0)){n={rank:s,isExactMatch:!0};break}r=s-1}}return n}}t.BinarySearch=u,function(e){e.itemsAsDefinitionTableLocationArray=function(e){let t=[];for(let n of e.items.entries())if(Array.isArray(n[1]))for(let e=0,i=n[1].length;e<i;++e)t.push({fqsenHash:n[0],data:n[1][e]});else t.push({fqsenHash:n[0],data:n[1]});return t}}(r=t.NameIndexNode||(t.NameIndexNode={}));t.NameIndex=class{constructor(){this._nodeArray=[],this._binarySearch=new u(this._nodeArray),this._collator=new Intl.Collator("en")}get nodes(){return this._nodeArray}set nodes(e){this._nodeArray=e,this._binarySearch=new u(this._nodeArray)}add(e,t){const n=this._nodeFind(e);if(n){let e=n.items.get(t.fqsenHash);e?Array.isArray(e)?e.push(t.data):n.items.set(t.fqsenHash,[e,t.data]):n.items.set(t.fqsenHash,t.data)}else this._insertNode({key:e,items:new Map([[t.fqsenHash,t.data]])})}remove(e,t){let n;const r=this._nodeIndex(e);if(r<0)return;const s=i.DefinitionTableLocationPackedData.uriId(t.data);let o=(n=this._nodeArray[r]).items.get(t.fqsenHash);if(Array.isArray(o)&&1!==o.length){let e,t=-1;for(let n=0,r=o.length;n<r&&t<0;++n)e=o[n],i.DefinitionTableLocationPackedData.uriId(e)===s&&(t=n);o.splice(t,1)}else n.items.delete(t.fqsenHash);n.items.size<1&&this._nodeArray.splice(r,1)}match(e){const t=this._nodeMatch(e.toLowerCase()),n=[];for(let e=0,i=t.length;e<i;++e)Array.prototype.push.apply(n,r.itemsAsDefinitionTableLocationArray(t[e]));return n}find(e){const t=this._nodeFind(e.toLowerCase());return t?r.itemsAsDefinitionTableLocationArray(t):[]}getState(){return this._nodeArray}restoreState(e){this._nodeArray=e,this._binarySearch=new u(this._nodeArray)}_nodeMatch(e){const t=this._collator;return this._binarySearch.range(n=>t.compare(n.key,e),t=>t.key.slice(0,e.length)===e?-1:1)}_nodeFind(e){let t=this._nodeIndex(e);return t<0?void 0:this._nodeArray[t]}_nodeIndex(e){const t=this._collator;let n=this._binarySearch.search(n=>t.compare(n.key,e));return n.isExactMatch?n.rank:-1}_insertNode(e){const t=this._collator;let n=this._binarySearch.rank(n=>t.compare(n.key,e.key));this._nodeArray.splice(n,0,e)}};t.SortedList=class{constructor(e,t){this.compareFn=e,this._items=t||[],this._search=new u(this._items)}get length(){return this._items.length}get items(){return this._items}add(e){let t=this._createCompareClosure(e,this.compareFn),n=this._search.search(t);if(n.isExactMatch)throw new Error(`Duplicate key ${JSON.stringify(e)}`);this._items.splice(n.rank,0,e)}remove(e){let t=this._search.search(e);if(t.isExactMatch)return this._items.splice(t.rank,1).shift()}find(e){return this._search.find(e)}_createCompareClosure(e,t){return n=>t(n,e)}};t.LeastRecentlyUsedCache=class{constructor(e){this.maxItems=e,this._map={},this._order=[]}has(e){return void 0!==this._map[e]}add(e,t){if(this.has(e))return this._map[e]=t,void this._use(e);let n=void 0;return this._order.length>=this.maxItems&&(n=this._removeLeastRecentlyUsed()),this._map[e]=t,this._order.unshift(e),n}remove(e){const t=this._map[e];if(void 0===t)return;delete this._map[e];const n=this._order.indexOf(e);return this._order.splice(n,1),t}get(e){const t=this._map[e];if(void 0!==t)return this._use(e),t}_removeLeastRecentlyUsed(){const e=this._order.pop(),t=this._map[e];return delete this._map[e],t}_use(e){const t=this._order.indexOf(e);t<0||(this._order.splice(t,1),this._order.unshift(e))}},function(e){function t(e,t){return(1048575&e)<<11|2047&t}function n(e){return e>>>11}function i(e){return 2047&e}e.pack=t,e.incrementCharacter=function(e){let r=i(e)+1;return t(n(e),r)},e.line=n,e.character=i,e.fromLspPosition=function(e){return t(e.line,e.character)},e.toLspPosition=function(e){return{line:n(e),character:i(e)}},e.compare=function(e,t){return e-t}}(s=t.PackedPosition||(t.PackedPosition={})),function(e){e.create=function(e,t,n,i){return{start:s.pack(e,t),end:s.pack(n,i)}},e.toLspRange=function(e){return{start:s.toLspPosition(e.start),end:s.toLspPosition(e.end)}},e.fromLspRange=function(e){return{start:s.fromLspPosition(e.start),end:s.fromLspPosition(e.end)}},e.isInRange=function(e,t){return!(!e||!t)&&t>=e.start&&t<=e.end}}(t.PackedRange||(t.PackedRange={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(9),r=n(2),s=n(3),o=n(8);var a,c,d;!function(e){e.create=function(e,t){return{declared:e,documentedOrInferred:t}}}(a=t.DefinitionType||(t.DefinitionType={})),function(e){function t(e){if(!e)return!1;switch(e.kind){case 64:case 8:case 1:case 2:case 4:return!0;default:return!1}}e.isNamespacedSymbolKind=t,e.isLocallyScopedDefinitionKind=function(e){switch(e){case 32:case 2048:case 16:case 1024:case 128:case 256:return!0;default:return!1}},e.toLspSymbolKind=function(e){switch(e.kind){case 1:return s.SymbolKind.Class;case 8:case 1024:return s.SymbolKind.Constant;case 64:return s.SymbolKind.Function;case 2:return s.SymbolKind.Interface;case 32:return s.SymbolKind.Method;case 2048:return s.SymbolKind.Constructor;case 512:return s.SymbolKind.Namespace;case 16:return s.SymbolKind.Property;case 4:return s.SymbolKind.Module;case 256:case 128:return s.SymbolKind.Variable;case 4096:return s.SymbolKind.File;default:throw new Error("Invalid argument")}},e.toLspCompletionItemKind=function(e){switch(e.kind){case 1:return s.CompletionItemKind.Class;case 8:case 1024:return s.CompletionItemKind.Constant;case 64:return s.CompletionItemKind.Function;case 2:return s.CompletionItemKind.Interface;case 32:return s.CompletionItemKind.Method;case 2048:return s.CompletionItemKind.Constructor;case 512:return s.CompletionItemKind.Module;case 16:return s.CompletionItemKind.Property;case 4:return s.CompletionItemKind.Module;case 256:case 128:return s.CompletionItemKind.Variable;case 4096:return s.CompletionItemKind.File;default:throw new Error("Invalid argument")}},e.shortName=function(e){if(!e)return"";switch(e.kind){case 1:case 2:case 4:case 8:case 64:{if(!e.name)return"";const t=e.name.lastIndexOf("\\")+1;return e.name.slice(t)}default:return e.name}},e.namespace=function(e){if(t(e)){if(!e.name)return"";const t=e.name.lastIndexOf("\\");return t<0?"":e.name.slice(0,t)}return""}}(c=t.PhpSymbol||(t.PhpSymbol={})),function(e){const t=1432,n=79;function s(e){return(6247&e.kind)>0}function d(e,t){if(!e)return"";if(e.scope){const n=d(t.get(e.scope),t);return f(e.name,n||"",e.kind)}return f(e.name,"",e.kind)}function l(e){switch(e){case 4:case 2:case 1:return 2;case 64:return 3;case 8:return 4;case 512:return 1;default:return 0}}function u(e,t,n){return i.hash32(f(e,t,n),l(n))}function h(e,t,n){if(!e)return 0;switch(n){case 32:case 2048:return i.hash32(("::"+e).toLowerCase(),t);case 1024:return i.hash32("##"+e,t);case 16:case 128:return i.hash32("::"+e,t);case 1:case 4:case 2:case 64:return i.hash32(e.toLowerCase(),l(n));case 256:return t?i.hash32("::"+e,t):i.hash32(e);default:return i.hash32(e,l(n))}}function f(e,t,n){if(!e)return"";switch(n){case 32:case 2048:return(t+"::"+e).toLowerCase();case 1024:return t.toLowerCase()+"##"+e;case 16:return t.toLowerCase()+"::"+e;case 128:return t+"::"+e;case 1:case 4:case 2:case 64:return e.toLowerCase();case 256:return t?t+"::"+e:e;default:return e}}e.createAlias=function(e,t){if(!(e.kind&n))return e.name;const r=e.name.split("\\"),s=r[r.length-1];if(1===r.length)return"Global"+i.ucFirst(s);let o=!0,a="",c="",d="";for(let e=0,n=r.length-1;e<n&&o;++e)d=(a+=i.ucFirst(r[e]))+i.ucFirst(s),(o=void 0!==t.findUseSymbolByName(d))||(c=d);return c},e.type=function(e){if(e.type)return r.TypeString.isEqual(e.type.declared,["array"])&&e.type.documentedOrInferred&&r.TypeString.isArray(e.type.documentedOrInferred)?r.TypeString.merge(e.type.declared,e.type.documentedOrInferred):e.type.declared||e.type.documentedOrInferred},e.setDeclaredType=function(e,t){e&&t&&(e.type?e.type.declared=t:e.type=a.create(t,void 0))},e.setDocumentedType=function(e,t){e&&t&&(e.type?e.type.documentedOrInferred=t:e.type=a.create(void 0,t))},e.children=function(e){return e&&e.children?e.children:[]},e.isEqual=function(e,t){return e===t||e.kind===t.kind&&void e.kind},e.isUseVariable=function(e){return e&&256===e.kind&&(4096&e.modifiers)>0},e.isParameter=function(e){return e&&128===e.kind},e.isRequiredParameter=function(e){return e&&128===e.kind&&!(8390656&e.modifiers)},e.isFunction=function(e){return e&&64===e.kind},e.isConstant=function(e){return e&&8===e.kind},e.isClassLike=function(e){return e&&(7&e.kind)>0},e.isInterface=function(e){return e&&2===e.kind},e.hasModifiers=function(e,t){return e&&(e.modifiers&t)>0},e.isScope=s,e.isAbsoluteScope=function(e){return s(e)&&(64!==e.kind||!(4096&e.modifiers))},e.shortName=function(e){if(!e)return e;let t=e.lastIndexOf("\\")+1;return e.slice(t)},e.fqsenFromDefinition=d,e.fqsenHashFromDefinition=function(e,t){return i.hash32(d(e,t),l(e.kind))},e.fqsenHash=u,e.fqsenHashFromScopeHash=h,e.fqsen=f,e.namespace=function(e){if(!e)return"";let t=e.lastIndexOf("\\");return t<0?"":e.slice(0,t)},e.create=function(e,t,n,i){const r={kind:e,name:t||"",uriId:n,modifiers:0,fqsenHash:0};return!c.isLocallyScopedDefinitionKind(e)||!i||4608&i.kind||256===e&&o.PHP.isPredefinedVariable(t)?r.fqsenHash=u(t,"",e):(r.fqsenHash=h(t,i.fqsenHash,e),i.children||(i.children=[]),r.fqsenHash&&i.children.indexOf(r.fqsenHash)<0&&i.children.push(r.fqsenHash),r.scope=i.fqsenHash),r},e.findAssociated=function(e,t){if(e.associated)return e.associated.find(t)},e.filterAssociated=function(e,t){return e.associated?e.associated.filter(t):[]},e.isAssociated=function(e,t){if(!e||!e.associated)return!1;let n=t.toLowerCase();return i.find(e.associated,e=>n===e.name.toLowerCase())},e.isCaseSensitive=function(e){return(e&t)>0}}(d=t.Definition||(t.Definition={}));t.DefinitionCollection=class{constructor(){this._symbols=[],this._map={}}get length(){return this._symbols.length}has(e){let t=e.name;return d.isCaseSensitive(e.kind)||(t=t.toLowerCase()),(this._map[t]&e.kind)===e.kind}add(e){let t=e.name;d.isCaseSensitive(e.kind)||(t=t.toLowerCase()),void 0===this._map[t]?this._map[t]=e.kind:this._map[t]|=e.kind,this._symbols.push(e)}addMany(e){for(let t=0,n=e.length;t<n;++t)this.add(e[t])}toArray(){return this._symbols.slice(0)}};t.UniqueDefinitionSet=class{constructor(){this._map={},this._definitions=[]}add(e){this.has(e)||(this._definitions.push(e),this._map[e.name]|=e.kind)}has(e){return(this._map[e.name]&e.kind)===e.kind}toArray(){return this._definitions.slice(0)}},function(e){e.create=function(e,t,n){return{kind:e,name:t,uriId:n,modifiers:0}}}(t.Reference||(t.Reference={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(8),r=n(1),s=n(0);!function(e){const t=/\$this|[\\a-zA-Z_\x80-\uffff][\\a-zA-Z0-9_\x80-\uffff]*/g,n=/^(?:\$this|static)\b/g,o=/\b(?:int|string|bool|float|iterable|true|false|null|void|object|resource|mixed|numeric|boolean|integer)\b/gi;function a(e){if(!e)return;let t,n=[];for(let i=0;i<e.length;++i)")[]"===(t=e[i]).slice(-3)?Array.prototype.push.apply(n,p(t.slice(1,-3))):"[]"===t.slice(-2)?n.push(t.slice(0,-2)):"array"!==t&&"mixed"!==t||n.push("mixed");return n.length>0?f(n):void 0}function c(e){return e?e.join("|"):""}function d(e,t,n){const i=e.toLowerCase();switch(i){case"integer":return"int";case"true":case"false":case"boolean":return"bool";default:return i}}function l(e){if(!e)return!1;for(let t=0,n=e.length;t<n;++t)if("[]"===e[t].slice(-2)||"array"===e[t])return!0;return!1}function u(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;if(e.length<t.length){const n=e;e=t,t=n}for(let n=0;n<e.length;++n)for(let i=0;i<t.length;++i)if(e[n].toLowerCase()===t[i].toLowerCase())return!0;return!1}function h(e,t){if(!e||!t)return;const n=new Set(t.map(e=>e.toLowerCase())),i=[];let r;for(let t=0;t<e.length;++t)r=e[t],n.has(r.toLowerCase())||i.push(r);return i}function f(e){const t=new Set,n=[];let i,r;for(let s=0;s<e.length;++s)r=(i=e[s]).toLowerCase(),t.has(r)||(t.add(r),n.push(i));return n}function p(e){let t,n=0,i=0,r=[],s="",o=-1;for(;n<e.length;){switch(t=e[n]){case"|":0===i&&(s=e.slice(o+1,n),o=n,s&&r.push(s));break;case"(":++i;break;case")":--i}++n}return(s=e.slice(o+1))&&r.push(s),r}e.NULL_TYPE_STRING=["null"],e.BOOLEAN_TYPE_STRING=["bool"],e.STRING_TYPE_STRING=["string"],e.INT_TYPE_STRING=["int"],e.VOID_TYPE_STRING=["void"],e.NUMERIC_TYPE_STRING=["int","float"],e.FLOAT_TYPE_STRING=["float"],e.MIXED_TYPE_STRING=["mixed"],e.STATIC_TYPE_STRING=["static"],e.ARRAY_TYPE_STRING=["array"],e.OBJECT_TYPE_STRING=["object"],e.CALLABLE_TYPE_STRING=["callable"],e.CLOSURE_TYPE_STRING=["Closure"],e.ITERABLE_TYPE_STRING=["iterable"],e.GENERATOR_TYPE_STRING=["Generator"],e.MIXED_OR_NULL_TYPE_STRING=["mixed","null"],e.STRING_OR_INT_TYPE_STRING=["string","int"],e.THIS_TYPE_STRING=["$this"],e.STATIC_OR_THIS_TYPE_STRING=["$this","static"],e.atomicClassLikeTypes=function(e){if(!e)return;let t,n=[];for(let r=0;r<e.length;++r)(t=e[r])&&"]"!==t[e.length-1]&&!i.PHP.isReservedNameOrRelativeName(t)&&"$this"!==t&&n.push(t);return n.length>0?f(n):void 0},e.toReferences=function(e,t,n,o){const a=/\$this|[\\a-zA-Z_\x80-\uffff][\\a-zA-Z0-9_\x80-\uffff]*/g;let d;const l=c(e),u=[];let h,f,p;for(;null!==(d=a.exec(l));)h=d[0],f=d.index,i.PHP.isReservedNameOrRelativeName(h.toLowerCase())||"$this"===h||((p=r.Reference.create(1,o.resolveNotFullyQualified(h),n.uriId)).unresolvedName=h,p.type=[p.name],p.range={start:s.PackedPosition.fromLspPosition(n.offsetToPosition(f+t)),end:s.PackedPosition.fromLspPosition(n.offsetToPosition(t+f+h.length))},u.push(p));return u},e.toArray=function(e){return e||[]},e.arrayDereference=a,e.arrayReference=function(e){if(!e||!e.length)return["mixed[]"];let t;return[t=e.length>1?"("+e.join("|")+")[]":e[0]+"[]"]},e.merge=function(e,t){if(e||t){if(e===t||!t)return e;if(!e)return t;if(e=e.slice(0),Array.prototype.push.apply(e,t),!(e.length<1))return f(e)}},e.toString=c,e.fromString=function(e){return e?p(e.replace(o,d)):void 0},e.mergeMany=function(e){let t=[];for(let n=0;n<e.length;++n)e[n]&&Array.prototype.push.apply(t,e[n]);if(!(t.length<1))return f(t)},e.nameResolve=function(e,n){if(!e)return;const r=(e,t,r)=>i.PHP.isReservedName(e)?e:"\\"===e[0]?"self"===(e=e.slice(1))?n.className:"parent"===e?n.baseClassName:e:n.resolveNotFullyQualified(e);return e.map(e=>e.replace(t,r))},e.resolveThisOrStatic=function(e,t){if(!e)return;const i=c(t);if(!i)return e;const r=(e,t,n)=>i,s=e.map(e=>e.replace(n,r));return t.length>1?p(c(s)):s},e.isArray=l,e.isEqual=u,e.toTypeDeclarationString=function(t,n,s){let o=!1;(2048&n.modifiers)>0&&!u(t,e.ARRAY_TYPE_STRING)&&l(t)&&(t=a(t)),(32768&n.modifiers)>0&&(o=!0,t=h(t,e.NULL_TYPE_STRING));let d=c(t);return s?d=r.Definition.shortName(d):i.PHP.isReservedName(d.toLowerCase())||(d="\\"+d),o&&(d="?"+d),d},e.subtractType=h,e.isStrictlyEqual=function(e,t){if(!e&&!t||e&&t&&!e.length&&!t.length)return!0;if(!e||!t||e.length!==t.length)return!1;const n=new Set(e.map(e=>e.toLowerCase()));return t.reduce((e,t)=>e&&n.has(t.toLowerCase()),!0)}}(t.TypeString||(t.TypeString={}))},function(e,t){e.exports=require("vscode-languageserver-types")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class i{constructor(){this._documents=new Map}getIndexedDocumentUris(){return r.uris()}getIndexedDocumentIdentifiers(){return r.documentIdentifiers()}getCounter(){return r.getCounter()}isKnown(e){return r.has(e)}add(e){r.add(e.uri,e.flags||0),this._documents.set(e.uri,e)}remove(e){const t=this._documents.get(e);return t&&this._documents.delete(e),t}forget(e){this.remove(e),r.remove(e)}find(e){return this._documents.get(e)}restore(e,t){r.restore(e,t)}clear(){r.clear(),this._documents=new Map}}var r;t.DocumentStore=i,function(e){e.uri=function(e){return r.uri(e)},e.id=function(e){return r.id(e)},e.flags=function(e){return r.flags(e)}}(i=t.DocumentStore||(t.DocumentStore={})),function(e){Math.pow(2,22);var t=new Map,n=new Map,i=1;e.getCounter=function(){return i},e.restore=function(e,r){t=new Map,n=new Map,i=e;for(let e of r)t.set(e.uri,e),n.set(e.id,e)},e.add=function(e,r){if(t.has(e))return t.get(e).id;const s={uri:e,id:i,flags:r};return t.set(e,s),n.set(i,s),++i,t.get(e).id},e.remove=function(e){const i=t.get(e);i&&(t.delete(e),n.delete(i.id))},e.has=function(e){return t.has(e)},e.id=function(e){const n=t.get(e);return n?n.id:void 0},e.uri=function(e){const t=n.get(e);return t?t.uri:void 0},e.flags=function(e){const n=t.get(e);return n?n.flags:void 0},e.uris=function*(){for(let e of t.values())yield e.uri},e.documentIdentifiers=function(){return t.values()},e.clear=function(){t=new Map,n=new Map,i=1}}(r=t.UriMap||(t.UriMap={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0),r=n(3),s=n(7),o=n(4),a=n(8),c=n(9),d=n(2),l=n(13);t.ParseTree=class{constructor(e,t){this.root=e,this.doc=t}get id(){return this.doc.id}get uri(){return this.doc.uri}find(e){return new i.TreeTraverser([this.root]).find(e)}traverse(e){return this.getTraverser().traverse(e)}getTraverser(){return new p([this.root],this.getNodeUtils(),this.nodeDefinitionMap,this.nodeReferenceMap,this.nodeDocBlockMap,this.nodeDocBlockReferenceMap,this.nodeMagicDefinitionMap)}findReferenceAtPosition(e){const t=this.doc.positionToOffset(e),n=this.getTraverser();n.seek(t);const r=i.PackedPosition.fromLspPosition(e);let s=n.reference();if(s||(n.seek(t-1),s=n.reference()),s)return Array.isArray(s)?(s=s.find(e=>e.range&&r>=e.range.start&&r<=e.range.end))?{reference:s,traverser:n}:void 0:{reference:s,traverser:n}}getNodeUtils(){return new h(this.doc)}documentLanguageRanges(){const e=new f(this.getNodeUtils());return this.traverse(e),e.ranges}};class u{constructor(){this.value=0}offset(e){if(!e)return 0;let t=-e.length,n=e;for(;n&&n!==this.last;)t+=n.length,n=n.previous;return this.last=e,n?this.value+=n.length+t:this.value=t}markOffset(e,t){this.last=e,this.value=t}}class h{constructor(e){this.doc=e,this.tokenOffsetCache=new u}get uriId(){return this.doc.id}get uri(){return this.doc.uri}nodePackedRange(e){const t=this.nodeRange(e);return t?i.PackedRange.fromLspRange(t):void 0}getPackedRange(e,t){return{start:i.PackedPosition.fromLspPosition(this.doc.offsetToPosition(e)),end:i.PackedPosition.fromLspPosition(this.doc.offsetToPosition(e+t))}}nodeLocation(e){const t=this.nodeRange(e);return t?r.Location.create(this.doc.uri,t):void 0}getLocation(e,t){const n=this.getRange(e,t);return n?r.Location.create(this.doc.uri,n):void 0}getRange(e,t){return{start:this.doc.offsetToPosition(e),end:this.doc.offsetToPosition(e+t)}}nodeRange(e){const t=this.nodeOffset(e);if(!(t<0))return{start:this.doc.offsetToPosition(t),end:this.doc.offsetToPosition(t+e.length)}}nodeRangeFromSpine(e){const t=h.nodeOffsetFromSpine(e);return{start:this.offsetToPosition(t),end:this.offsetToPosition(t+e[e.length-1].length)}}textSlice(e,t){return this.doc.text.slice(e,t)}nodeText(e){const t=this.nodeOffset(e);return t<0?"":this.doc.text.slice(t,t+e.length)}nodeTextFromSpine(e){const t=h.nodeOffsetFromSpine(e);return t<0?"":this.doc.text.slice(t,t+e[e.length-1].length)}rangeText(e){return this.doc.text.slice(this.positionToOffset(e.start),this.positionToOffset(e.end))}createSymbolName(e,t){let n=[t,this.uri,e.length.toString(),Math.random().toString()].join("#");return`#${t}#${(c.hash32(n)>>>0).toString(16)}`}positionToOffset(e){return this.doc.positionToOffset(e)}offsetToPosition(e){return this.doc.offsetToPosition(e)}nodeOffset(e){const t=h.firstToken(e);return t?this.tokenOffsetCache.offset(t):-1}clone(){return new h(this.doc)}markOffset(e,t){const n=h.firstToken(e);n&&this.tokenOffsetCache.markOffset(n,t)}getLeadingTrivia(e){let t=h.firstToken(e);if(!t)return[];let n=this.nodeOffset(t);return this.getTokenLeadingTrivia(t,n)}getTokenLeadingTrivia(e,t){let n;const i=[];for(;(e=e.previous)&&h.isTrivia(e);)t-=e.length,n=this.doc.text.slice(t,t+e.length),i.unshift({token:e,offset:t,range:r.Range.create(this.offsetToPosition(t),this.offsetToPosition(t+e.length)),text:n});return i}getLeadingTriviaFromSpine(e){let t=h.nodeOffsetFromSpine(e),n=h.firstToken(e[e.length-1]);return n?this.getTokenLeadingTrivia(n,t):[]}leadingDocumentComment(e){let t=h.firstToken(e);if(!t)return;let n=this.nodeOffset(t);for(;(t=t.previous)&&h.isTrivia(t);)n-=t.length;return 159===t.kind?{token:t,offset:n-=t.length,range:r.Range.create(this.offsetToPosition(n),this.offsetToPosition(n+t.length)),text:this.doc.text.slice(n,n+t.length)}:void 0}getDefinitionNodeIdentifierRange(e,t){let n;switch((t=t.slice(0)).push(e),e.kind){case 1028:case 1098:case 1161:case 1081:t.push(e.children[0]),n=e.children[0].children.find(e=>82===e.kind);break;case 1108:t.push(e.children[0]),n=e.children[0].children.find(e=>1090===e.kind);break;case 1133:case 1043:case 1026:n=e.children[0];break;case 1124:n=e.children.find(e=>83===e.kind);break;case 1080:t.push(e.children[2]),n=e.children[2].children[0];break;default:n=t.pop()}if(n&&1061!==n.kind)return t.push(n),this.nodeRangeFromSpine(t)}}t.NodeUtils=h,function(e){function t(e){return e.kind>159}function n(e){if(!e)return;if(s.isToken(e))return e;let t;for(let i=0,r=e.children.length;i<r;++i)if(t=n(e.children[i]))return t}function i(e){if(!e)return!1;switch(e.kind){case 1148:case 1028:case 1161:case 1098:case 1002:case 1004:case 1108:case 1081:return!0;default:return!1}}e.previousNonTriviaToken=function(e){let i=n(e);if(i){for(;(i=i.previous)&&t(i););return i}},e.leadingTriviaLength=function(e){let i=n(e),r=0;if(!i)return r;for(;(i=i.previous)&&t(i);)r+=i.length;return r},e.isTrivia=t,e.childIndex=function(e,t){if(!e||!e.children)return-1;for(let n=0,i=e.children.length;n<i;++n)if(e.children[n]===t)return n;return-1},e.nodeOffsetFromSpine=function(t){let n,i,r=-1,s=0;for(;++r<t.length;)n=r-1>-1?t[r-1]:void 0,i=t[r],s+=e.childOffsetRelativeToParent(n,i);return s},e.childOffsetRelativeToParent=function(t,n){let i,r=0;if(!t||!t.children)return r+=e.leadingTriviaLength(n);let s=!1;for(let o=0,a=t.children.length;o<a&&(i=t.children[o],!s&&i.length&&(s=!0),o>0&&s&&i.length&&(r+=e.leadingTriviaLength(i)),i!==n);++o)r+=i.length;return r},e.firstToken=n,e.lastToken=function e(t){if(!t)return;if(s.isToken(t))return t;let n;for(let i=t.children.length-1;i>=0;--i)if(n=e(t.children[i]))return n},e.isTokenOfKind=function(e,t){return e&&t.indexOf(e.kind)>-1},e.isPhraseOfKind=function(e,t){return e&&t.indexOf(e.kind)>-1},e.findChild=function(e,t){if(!e||!e.children)return;let n;for(let i=0,r=e.children.length;i<r;++i)if(t(n=e.children[i]))return n},e.filterChildren=function(e,t){let n,i=[];if(!e||!e.children)return i;for(let r=0,s=e.children.length;r<s;++r)t(n=e.children[r])&&i.push(n);return i},e.isNamePhrase=function(e){if(!e)return!1;switch(e.kind){case 1136:case 1139:case 1079:return!0;default:return!1}},e.isReferenceNode=function(e){if(!e)return!1;switch(e.kind){case 1116:case 1152:case 1106:case 1146:case 1090:case 1140:case 83:case 82:case 77:return!0;default:return!1}},e.isTypeDefinitionNode=function(e){if(!e)return!1;switch(e.kind){case 1028:case 1161:case 1098:case 1002:return!0;default:return!1}},e.isScopeNode=i,e.isDefinitionNode=function(e){if(!e)return!1;switch(e.kind){case 1115:case 1117:case 1120:case 1043:case 1026:case 1133:case 1124:case 1152:case 1080:case 83:return!0;default:return i(e)}},e.isLoopPhrase=function(e){if(!e)return!1;switch(e.kind){case 1073:case 1078:case 1175:case 1050:return!0;default:return!1}},e.isMemberDeclaration=function(e){if(!e)return!1;switch(e.kind){case 1025:case 1132:case 1108:return!0;default:return!1}},e.hasAnonymousFunctionUseVariable=function(e,t,n){if(1004!==e.kind)return!1;let i=new p([e],t.getNodeUtils(),t.nodeDefinitionMap,t.nodeReferenceMap,t.nodeDocBlockMap,t.nodeDocBlockReferenceMap,t.nodeMagicDefinitionMap);return i.nthChild(0),!!i.child(e=>1006===e.kind)&&void 0!==i.find(e=>83===e.kind&&t.nodeReferenceMap.has(e)&&t.nodeReferenceMap.get(e).name===n)}}(h=t.NodeUtils||(t.NodeUtils={}));class f{constructor(e){this.nodeUtils=e,this._ranges=[]}get ranges(){return this._phpOpenPosition&&this._lastToken&&(this._ranges.push({range:r.Range.create(this._phpOpenPosition,this.nodeUtils.nodeRange(this._lastToken).end),languageId:a.PHP.LANGUAGE_ID}),this._phpOpenPosition=void 0),this._ranges}preorder(e,t){switch(e.kind){case 80:this._ranges.push({range:this.nodeUtils.nodeRange(e)});break;case 156:case 157:this._phpOpenPosition=this.nodeUtils.nodeRange(e).start;break;case 158:{let t=this.nodeUtils.nodeRange(e);this._ranges.push({range:r.Range.create(this._phpOpenPosition||t.start,t.end),languageId:a.PHP.LANGUAGE_ID}),this._phpOpenPosition=void 0}}return void 0!==e.kind&&(this._lastToken=e),!0}}class p extends i.TreeTraverser{constructor(e,t,n,i,r,s,o){super(e.slice(0)),this.nodeUtils=t,this.nodeDefinitionMap=n,this.nodeReferenceMap=i,this.nodeDocBlockMap=r,this.nodeDocBlockReferenceMap=s,this.nodeDocBlockDefinitionMap=o}get text(){return this.nodeUtils.nodeTextFromSpine(this._spine)}get range(){return this.nodeUtils.nodeRangeFromSpine(this._spine)}get leadingTrivia(){const e=h.nodeOffsetFromSpine(this._spine.slice(0));return this.nodeUtils.markOffset(this.node,e),this.nodeUtils.getLeadingTrivia(this.node)}get offset(){return h.nodeOffsetFromSpine(this._spine.slice(0))}hasEmbeddedLanguage(){return void 0!==this.clone().find(e=>80===e.kind)}seek(e){if(e<0)return;const t=new k(e,this.nodeUtils);return new p([this._spine[0]],this.nodeUtils.clone()).traverse(t),t.found?(this._spine=t.found,this.node):void 0}seekRange(e,t){const n=new g(e,t);if(new p([this._spine[0]],this.nodeUtils.clone()).traverse(n),n.spine)return this._spine=n.spine,this.node}getDefinitions(e,t){const n=new S(this.nodeDefinitionMap,this.nodeDocBlockDefinitionMap,this.nodeUtils.clone(),e,t);return this.traverse(n).symbols}references(e,t){const n=new T(this.nodeReferenceMap,this.nodeDocBlockReferenceMap,this.nodeUtils.clone(),e,t);return this.traverse(n).references}get thisName(){const e=this.thisDefinition;if(e)return e.name;if(!this.nodeReferenceMap||!this.nodeDocBlockReferenceMap)return"";const t=new p([this._spine[0]],this.nodeUtils.clone(),this.nodeDefinitionMap,this.nodeReferenceMap,this.nodeDocBlockMap,this.nodeDocBlockReferenceMap,this.nodeDocBlockDefinitionMap);const n=new S(this.nodeReferenceMap,this.nodeDocBlockReferenceMap,this.nodeUtils.clone(),e=>256===e.kind&&"$this"===e.name,e=>!1),i=t.traverse(n).symbols.shift();return i&&d.TypeString.toArray(d.TypeString.atomicClassLikeTypes(i.type)).shift()||""}get thisDefinition(){if(!this.nodeDefinitionMap)return;let e=this.clone().ancestor(h.isTypeDefinitionNode);return e&&this.nodeDefinitionMap.has(e)?this.nodeDefinitionMap.get(e):void 0}get definition(){let e,t,n=this._spine.length;if(this.nodeDefinitionMap){for(;--n>0&&!e;)t=this._spine[n],h.isDefinitionNode(t)&&this.nodeDefinitionMap.has(t)&&(e=this.nodeDefinitionMap.get(t));return e}}getNameResolver(){if(!this.nodeDefinitionMap)throw new Error("Invalid Operation");const e=new y(this.nodeDefinitionMap,this.offset,new m),t=this.clone();return t.root(),t.traverse(e).nameResolver}reference(){let e,t,n=this._spine.length;if(159===this.node.kind){if(!this.nodeDocBlockReferenceMap)return;return this.nodeDocBlockReferenceMap.get(this.node)}if(this.nodeReferenceMap){for(;--n>0&&!e;)t=this._spine[n],h.isReferenceNode(t)&&this.nodeReferenceMap.has(t)&&(e=Object.assign({},this.nodeReferenceMap.get(t),{range:i.PackedRange.fromLspRange(this.nodeUtils.nodeRangeFromSpine(this._spine.slice(0,n+1)))}),this._spine=this._spine.slice(0,n+1));return e}}clone(){return new p(this._spine.slice(0),this.nodeUtils.clone(),this.nodeDefinitionMap,this.nodeReferenceMap,this.nodeDocBlockMap,this.nodeDocBlockReferenceMap,this.nodeDocBlockDefinitionMap)}firstChildAfterOffset(e){const t=this.node;if(s.isToken(t))return;const n=t.children;let i,r,o;for(let t=0,s=n.length;t<s;++t)if(o=n[t],r?i+=r.length+h.leadingTriviaLength(o):i=h.nodeOffsetFromSpine(this._spine.slice(0)),r=o,i>e)return this._spine.push(o),this.node}prevToken(){const e=this._spine.slice(0);let t,n,i;for(;e.length>1;)if(t=e.pop(),!((i=(n=e[e.length-1]).children.indexOf(t)-1)<0)&&(e.push(n.children[i]),this._lastToken(e)))return this._spine=e,this.node}_lastToken(e){let t=e[e.length-1];if(s.isToken(t))return e;for(let n=t.children.length-1;n>=0;--n){if(e.push(t.children[n]),this._lastToken(e))return e;e.pop()}}get isDeclarationName(){let e=this.clone(),t=e.node,n=e.parent();return!(!t||!n)&&((82===t.kind||83===t.kind)&&this._isDeclarationPhrase(n)||1090===n.kind&&this._isDeclarationPhrase(e.parent()))}scope(e){let t;e&&(t=(t=>(t.nthChild(0),!!t.child(e=>1006===e.kind)&&void 0!==t.find(t=>83===t.kind&&this.nodeUtils.nodeText(t)===e))));let n=h.isScopeNode(this.node)?this.node:this.ancestor(h.isScopeNode);for(;n&&1004===n.kind&&t&&t(this.clone());)n=this.ancestor(h.isScopeNode);return this.node}_isDeclarationPhrase(e){if(!e)return!1;switch(e.kind){case 1030:case 1163:case 1100:case 1133:case 1043:case 1124:case 1083:case 1110:case 1026:return!0;default:return!1}}}t.ParseTreeTraverser=p;class m{constructor(){this._offset=-1,this.lastTriviaLength=-1}get offset(){return this.lastTriviaLength>0?this._offset+this.lastTriviaLength:this._offset}beforeTraverse(e,t){this._offset=h.nodeOffsetFromSpine([...t,e])}preorder(e,t){return this.lastNode=e,this.lastTriviaLength<0&&(this.lastTriviaLength=h.leadingTriviaLength(e)),!0}postorder(e,t){this.lastNode!==e||!e.length&&1!==e.kind||(this._offset+=this.lastTriviaLength+e.length,this.lastTriviaLength=-1)}}t.OffsetVisitor=m;class g{constructor(e,t){this.start=e,this.end=t,this.offsetVisitor=new m}get spine(){return this._spine}beforeTraverse(e,t){this.offsetVisitor.beforeTraverse(e,t)}preorder(e,t){this.offsetVisitor.preorder(e,t);let n=this.offsetVisitor.offset,i=n+e.length;return this.start>=n&&this.end<=i&&(this._spine=t.slice(0),this._spine.push(e),!0)}postorder(e,t){this.offsetVisitor.postorder(e,t)}}class k{constructor(e,t){this.offset=e,this.haltTraverse=!1,this.offsetVisitor=new m}get found(){return this._found}beforeTraverse(e,t){this.offsetVisitor.beforeTraverse(e,t)}preorder(e,t){this.offsetVisitor.preorder(e,t);let n=this.offsetVisitor.offset,i=n+e.length;return!this.haltTraverse&&(this.offset>=n&&this.offset<i?!s.isToken(e)||(this._found=t.slice(0),this._found.push(e),this.haltTraverse=!0,!1):this.offset<n?(this._found=t.slice(0),this.haltTraverse=!0,!1):!(this.offset>=i))}postorder(e,t){this.offsetVisitor.postorder(e,t)}}class S{constructor(e,t,n,i,r){this.nodeSymbolMap=e,this.nodeDocBlockSymbolMap=t,this.nodeUtils=n,this.filter=i,this.shouldDescend=r,this._symbols=[]}get symbols(){return this._symbols}beforeTraverse(e,t){this._firstNode=e;const n=new p([...t,e],this.nodeUtils);if(n.prevSibling(),159===n.node.kind){let e=this.nodeDocBlockSymbolMap.get(n.node)||[];this.filter&&(e=e.filter(this.filter)),Array.prototype.push.apply(this._symbols,e)}}preorder(e,t){if(h.isScopeNode(e))return this._firstNode===e||(!this.shouldDescend||this.shouldDescend(e));if(159===e.kind){const n=t[t.length-1],i=n.children.indexOf(e)+1,r=i<n.children.length?n.children[i]:void 0;if(!r||!h.isScopeNode(r)||this.shouldDescend(r)){let t=this.nodeDocBlockSymbolMap.get(e)||[];this.filter&&(t=t.filter(this.filter)),Array.prototype.push.apply(this._symbols,t)}}else if(this.nodeSymbolMap.has(e)){let n=this.nodeSymbolMap.get(e);!n||this.filter&&!this.filter(n)||(n.range||(n=Object.assign({},n,{range:i.PackedRange.fromLspRange(this.nodeUtils.nodeRangeFromSpine([...t,e]))})),this._symbols.push(n))}return!0}}t.SymbolsVisitor=S;class T{constructor(e,t,n,i,r){this.nodeReferenceMap=e,this.nodePhpDocReferenceMap=t,this.nodeUtils=n,this.filter=i,this.shouldDescend=r,this._references=[]}get references(){return this._references}beforeTraverse(e,t){this._firstNode=e;const n=new p([...t,e],this.nodeUtils);if(n.prevSibling(),159===n.node.kind){let e=this.nodePhpDocReferenceMap.get(n.node)||[];this.filter&&(e=e.filter(this.filter)),Array.prototype.push.apply(this._references,e)}}preorder(e,t){if(h.isScopeNode(e))return this._firstNode===e||(!this.shouldDescend||this.shouldDescend(e));if(159===e.kind){const n=t[t.length-1],i=n.children.indexOf(e)+1,r=i<n.children.length?n.children[i]:void 0;if(!r||!h.isScopeNode(r)||!this.shouldDescend||this.shouldDescend(r)){let t=this.nodePhpDocReferenceMap.get(e)||[];this.filter&&(t=t.filter(this.filter)),Array.prototype.push.apply(this._references,t)}}else if(h.isReferenceNode(e)){const n=this.nodeReferenceMap.get(e);if(n&&(!this.filter||this.filter(n))){const r=Object.assign({},n,{range:i.PackedRange.fromLspRange(this.nodeUtils.nodeRangeFromSpine([...t,e]))});this._references.push(r)}}return!0}}t.ReferencesVisitor=T;t.ParseTreeStore=class{constructor(){this._parseTrees=new Map}parseTrees(){return this._parseTrees.values()}find(e){return"number"==typeof e&&(e=o.UriMap.uri(e)),this._parseTrees.get(e)}add(e){return this._parseTrees.set(e.uri,e),e}remove(e){const t=this._parseTrees.get(e);return this._parseTrees.delete(e),t}clear(){this._parseTrees=new Map}};class y{constructor(e,t,n){this.nodeDefinitionMap=e,this.stopAtOffset=t,this.offsetVisitor=n,this._halt=!1,this._nameResolver=new l.NameResolver}get nameResolver(){return this._nameResolver}beforeTraverse(e,t){this.offsetVisitor.beforeTraverse(e,t)}preorder(e,t){let n;if(this.offsetVisitor.preorder(e,t),this.offsetVisitor.offset>this.stopAtOffset||this._halt)return this._halt=!0,!1;switch(e.kind){case 1153:if(this.stopAtOffset>=this.offsetVisitor.offset+e.length&&1115!==t[t.length-1].kind)return!1;break;case 1115:(n=this.nodeDefinitionMap.get(e))&&(this._nameResolver.namespaceName=n.name);break;case 1028:case 1002:if(n=this.nodeDefinitionMap.get(e)){const e=n.associated?n.associated.find(e=>1===e.kind):void 0;this._nameResolver.pushClass(n.name,e?e.name:"")}break;case 1117:case 1120:(n=this.nodeDefinitionMap.get(e))&&this._nameResolver.rules.push(l.UseRule.fromDefinition(n))}return!0}postorder(e,t){if(this.offsetVisitor.postorder(e,t),!this._halt)switch(e.kind){case 1028:case 1002:this._nameResolver.popClass()}}}t.CreateNameResolverVisitor=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),r=n(2),s=n(4);class o{constructor(){this.isComplex=!0}get kind(){return this.definition.kind}set kind(e){}get name(){return this.definition.name}set name(e){}get modifiers(){return this.definition.modifiers}set modifiers(e){}get fqsenHash(){return this.definition.fqsenHash}set fqsenHash(e){}get uriId(){return this.definition.uriId}set uriId(e){}get range(){return this.definition.range}set range(e){}get type(){return this.definition.type}set type(e){}get children(){return this.definition.children||[]}set children(e){}get value(){return this.definition.value}set value(e){}get scope(){return this.definition.scope}set scope(e){}get associated(){return this.definition.associated}set associated(e){}static isComplexDefinition(e){return!0===e.isComplex}}t.ComplexDefinition=o;class a extends o{constructor(e){super(),this._definitions=e}get definition(){return this._definitions[0]}get definitions(){return this._definitions.slice(0)}}t.NameClashDefinition=a;class c extends o{constructor(e,t){super(),this.local=e,this.external=t}get definition(){return this.local}get kind(){return this.external?this.external.kind:1===this.local.kind?512:this.local.kind}static create(e,t){let n=e.kind;1===n&&(n|=518);let i=t.find(e.associated[0].name,e=>(e.kind&n)>0);return i.length>1&&(i=i.filter(e=>512!==e.kind)),i.length>1?new c(e,new a(i)):i.length<1?new c(e,void 0):new c(e,i[0])}}var d;t.UseDefinition=c,function(e){e.fromDefinition=function(e,t){return p.fromDefinition(t.table(s.DocumentStore.uri(e.uriId)).definitionScope(e),t).findMember(e.name,e.kind)},e.getMemberKey=function(e){switch(e.kind){case 32:case 2048:return e.name.toLowerCase();case 1024:return"#"+e.name;case 16:return e.name;default:throw new Error("Invalid Argument")}}}(d=t.MemberDefinition||(t.MemberDefinition={}));class l extends o{constructor(e,t,n,i,r){super(),this.method=e,this.traitMethod=t,this.baseMethod=n,this.interfaceMethod=i,this.table=r}get definition(){let e=this.method||this.traitMethod||this.interfaceMethod||this.baseMethod;return l.isMethodDefinition(e)?e.definition:e}get definitions(){const e=[];return this.method&&e.push(this.method),[this.traitMethod,this.baseMethod,this.interfaceMethod].forEach(t=>{t&&Array.prototype.push.apply(e,t.definitions)}),Array.from(new Set(e))}get modifiers(){if(void 0!==this.method&&void 0!==this.traitMethod){if((16384&this.method.modifiers)>0){const e=7,t=this.traitMethod.modifiers&e;return this.method.modifiers|this.traitMethod.modifiers^t}if((8192&this.method.modifiers)>0)return this.method.modifiers|this.traitMethod.modifiers}return this.definition.modifiers}get parameters(){let e;return this.method&&(e=this.table.definitionChildren(this.method).filter(i.Definition.isParameter).map(e=>new f([e]))),this.traitMethod&&(e=this.mergeParams(e,this.traitMethod)),this.baseMethod&&(e=this.mergeParams(e,this.baseMethod)),this.interfaceMethod&&(e=this.mergeParams(e,this.interfaceMethod)),e}mergeParams(e,t){let n=t.parameters;if(!e)return n;for(let t=0,i=n.length;t<i;++t)e[t]?e[t].addParameter(n[t]):e[t]=new f([n[t]]);return e}get type(){let e=[this.method,this.traitMethod,this.baseMethod,this.interfaceMethod].find(e=>void 0!==e&&void 0!==e.type);return e?e.type:void 0}static isMethodDefinition(e){return 32===e.kind&&!0===e.isComplex}static fromDefinition(e,t){return p.fromDefinition(t.table(s.DocumentStore.uri(e.uriId)).definitionScope(e),t).findMember(e.name,e.kind)}}t.MethodDefinition=l;t.ParametersBuilder=class{constructor(e){this.table=e}addMethods(e,t,n,r){let s,o,a,c=[e,t,r,n],d=void 0;for(this.isTraitAdaptation(e)&&c.shift();!d&&c.length>0;)d=c.shift();if(!d||!d.children||d.children.length<1)return[];for(s=l.isMethodDefinition(d)?d.parameters.map(e=>new f([e])):this.table.definitionChildren(d).filter(i.Definition.isParameter).map(e=>new f([e]));c.length>0;)if((a=c.shift())&&a.children){o=a.parameters;for(let e=0;e<o.length&&e<s.length;++e)s[e].addParameter(o[e])}return s}isTraitAdaptation(e){return e&&(24576&e.modifiers)>0}};class u extends o{constructor(e,t,n){super(),this.property=e,this.traitProperty=t,this.baseClassProperty=n}get definition(){let e=this.property||this.traitProperty||this.baseClassProperty;return u.isProperty(e)?e.definition:e}get definitions(){const e=[];return this.property&&e.push(this.property),[this.traitProperty,this.baseClassProperty].forEach(t=>{t&&Array.prototype.push.apply(e,t.definitions)}),Array.from(new Set(e))}get type(){let e=[this.property,this.traitProperty,this.baseClassProperty].find(e=>e&&void 0!==e.type);return e?e.type:void 0}static isProperty(e){return 16===e.kind&&o.isComplexDefinition(e)}}t.PropertyDefinition=u;class h extends o{constructor(e,t,n){super(),this.classConstant=e,this.interfaceConstant=t,this.baseClassConstant=n}get definition(){let e=this.classConstant||this.interfaceConstant||this.baseClassConstant;return h.isClassConstant(e)?e.definition:e}get definitions(){const e=[];return this.classConstant&&e.push(this.classConstant),[this.interfaceConstant,this.baseClassConstant].forEach(t=>{t&&Array.prototype.push.apply(e,t.definitions)}),Array.from(new Set(e))}get type(){let e=[this.classConstant,this.interfaceConstant,this.baseClassConstant].find(e=>e&&null==e.type);return e?e.type:void 0}static isClassConstant(e){return 1024===e.kind&&o.isComplexDefinition(e)}}t.ClassConstantDefinition=h;class f extends o{constructor(e){super(),this._definitions=e}get definition(){let e=this._definitions[0];return f.isParameter(e)?e.definition:e}get definitions(){return this._definitions.slice(0)}get type(){const e=this._definitions.find(e=>void 0!==e.type);return e?e.type:void 0}addParameter(e){this._definitions.push(e)}static isParameter(e){return 128===e.kind&&!0===e.isComplex}}t.ParameterDefinition=f;t.TypeFactory=class{constructor(e){this.definitionStore=e,this.map=new Map}fromName(e,t){const n=e.toLowerCase();if(this.map.has(n))return this.map.get(n);const i=p.fromName(e,this.definitionStore,t);return i&&this.map.set(n,i),i}fromDefinition(e){const t=this.getKey(e);if(this.map.has(t))return this.map.get(t);const n=p.fromDefinition(e,this.definitionStore);return n&&this.map.set(t,n),n}getKey(e){return e.uriId.toString()+"_"+e.name.toLowerCase()}};class p extends o{constructor(e,t,n,i,r){super(),this.definition=e,this.baseClass=t,this.traits=n,this.interfaces=i,this.table=r}isAssociated(e){const t=e.toLowerCase();return this.definition.associated&&void 0!==this.definition.associated.find(e=>e.name.toLowerCase()===t)||this.baseClass&&this.baseClass.isAssociated(e)||this.interfaces.reduce((t,n)=>t||n.isAssociated(e),!1)||this.traits.reduce((t,n)=>t||n.isAssociated(e),!1)}*getMembers(){const e=this.table.definitionChildren(this.definition);let t;const n=new Set;for(let i of e)t=d.getMemberKey(i),n.has(t)||(n.add(t),yield this.findMember(i.name,i.kind));for(let e of this.traits)for(let i of e.getMembers())t=d.getMemberKey(i),n.has(t)||(n.add(t),yield i);if(this.baseClass)for(let e of this.baseClass.getMembers())t=d.getMemberKey(e),n.has(t)||4&e.kind||(n.add(t),yield e);for(let e of this.interfaces)for(let i of e.getMembers())t=d.getMemberKey(i),n.has(t)||(n.add(t),yield i)}findMember(e,t){const n=i.Definition.fqsenHashFromScopeHash(e,this.definition.fqsenHash,t),s=this.table.get(n);let o,a,c,d;if(s&&32===t&&(8192&s.modifiers)>0&&s.associated&&s.associated.length>0&&this.traits.length){const n=s.associated[0],i=r.TypeString.toString(n.scope).toLowerCase(),a=this.traits.find(e=>e.name.toLowerCase()===i);a&&(o=a.findMember(e,t))}else if(s&&32===t&&(16384&s.modifiers)>0&&s.associated&&s.associated.length>0&&this.traits.length){const e=s.associated[0],n=r.TypeString.toArray(e.scope).map(e=>e.toLowerCase()),i=1===n.length?n[0]:void 0;let a;for(let n=0;n<this.traits.length&&!o;++n)a=this.traits[n],i&&a.name.toLowerCase()!==i||(o=a.findMember(e.name,t))}else if(this.traits.length>0){let n;for(let i=0;i<this.traits.length&&!o;++i)o=(n=this.traits[i]).findMember(e,t)}this.baseClass&&(a=this.baseClass.findMember(e,t))&&(4&a.modifiers)>0&&(a=void 0);for(let n=0;n<this.interfaces.length&&!c;++n)c=(d=this.interfaces[n]).findMember(e,t);if(s||o||a||c)switch(t){case 32:case 2048:return new l(s,o,a,c,this.table);case 16:return new u(s,o,a);case 1024:return new h(s,c,a);default:return}}static overridableMethodsFilterFn(e){return 32===e.kind&&l.isMethodDefinition(e)&&null==e.method&&void 0!==e.baseMethod}static unimplementedMethodFilterFn(e){return 32===e.kind&&l.isMethodDefinition(e)&&void 0===e.method&&(void 0!==e.baseMethod&&(16&e.baseMethod.modifiers)>0||void 0===e.baseMethod&&void 0!==e.interfaceMethod)}static fromDefinition(e,t,n){if(!e)return;const i=e.associated||[],r=[],s=[];let o,a,c;n||(n=new Set);for(let e=0;e<i.length;++e)1===(a=i[e]).kind?o=p.fromName(a.name,t,1,n):4===a.kind?(c=p.fromName(a.name,t,4,n))&&r.push(c):2===a.kind&&(c=p.fromName(a.name,t,2,n))&&s.push(c);return new p(e,o,r,s,t.table(e.uriId))}static fromName(e,t,n,i){if(!e)return;i||(i=new Set),n||(n=7);let r=t.find(e,e=>(e.kind&n)>0&&!i.has(e));return r.forEach(e=>{i.add(e)}),r.length?1===r.length?p.fromDefinition(r[0],t,i):new m(r.map(e=>p.fromDefinition(e,t,i))):void 0}}t.TypeDefinition=p;class m extends o{constructor(e){super(),this._types=e}get definition(){return this._types[0].definition}get definitions(){return this._types.map(e=>e.definition)}get baseClass(){const e=this._types.find(e=>void 0!==e.baseClass);return e?e.baseClass:void 0}get traits(){return this.mergeTypeDefinitions(this._types,e=>e.traits)}get interfaces(){return this.mergeTypeDefinitions(this._types,e=>e.interfaces)}*getMembers(){const e=new Set;let t;for(let n of this._types)for(let i of n.getMembers())t=d.getMemberKey(i),e.has(t)||(e.add(t),yield i)}isAssociated(e){return this._types.reduce((t,n)=>t||n.isAssociated(e),!1)}findMember(e,t){let n;for(let i of this._types)if(n=i.findMember(e,t))return n}mergeTypeDefinitions(e,t){const n=this._types.reduce((e,n)=>(Array.prototype.push.apply(e,t(n)),e),[]),i=new Map(n.map(e=>[e.name,e]));return Array.from(i.values())}}t.NameClashTypeDefinition=m},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(15);t.Lexer=i.Lexer,t.tokenKindToString=i.tokenKindToString,t.isKeyword=i.isKeyword;var r=n(29);t.Parser=r.Parser,function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(16)),t.isToken=function(e){return e&&void 0===e.children},t.isPhrase=function(e){return e&&void 0!==e.children}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){const t={int:"int",string:"string",bool:"bool",float:"float",iterable:"iterable",true:"true",false:"false",null:"null",void:"void",object:"object",array:"array",callable:"callable",resource:"resource",mixed:"mixed",numeric:"numeric"},n={$GLOBALS:"$GLOBALS",$_SERVER:"$_SERVER",$_GET:"$_GET",$_POST:"$_POST",$_FILES:"$_FILES",$_REQUEST:"$_REQUEST",$_SESSION:"$_SESSION",$_ENV:"$_ENV",$_COOKIE:"$_COOKIE",$php_errormsg:"$php_errormsg",$HTTP_RAW_POST_DATA:"$HTTP_RAW_POST_DATA",$http_response_header:"$http_response_header",$argc:"$argc",$argv:"$argv",$this:"$this"},i={$GLOBALS:"array",$_SERVER:"array",$_GET:"array",$_POST:"array",$_FILES:"array",$_REQUEST:"array",$_SESSION:"array",$_ENV:"array",$_COOKIE:"array",$php_errormsg:"string",$HTTP_RAW_POST_DATA:"string",$http_response_header:"array",$argc:"int",$argv:"array"};function r(e){return void 0!==t[e]}function s(e){return"self"===e||"parent"===e||"static"===e}e.LANGUAGE_ID="php",e.isPredefinedVariable=function(e){return void 0!==n[e]},e.getPredefinedVariableType=function(e){return i[e]},e.isReservedName=r,e.isRelativeName=s,e.isReservedNameOrRelativeName=function(e){return r(e)||s(e)}}(t.PHP||(t.PHP={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(3);function r(e,t){return e&&t&&e.character===t.character&&e.line===t.line}t.popMany=function(e,t){let n=[];for(;t--;)n.push(e.pop());return n.reverse()},t.top=function(e){return e.length?e[e.length-1]:null},t.isString=function(e){return"string"==typeof e||e instanceof String},t.isInRange=function(e,t){let n=t.start,i=t.end;return e.line<n.line||e.line===n.line&&e.character<n.character?-1:e.line>i.line||e.line===i.line&&e.character>i.character?1:0},t.positionEquality=r,t.rangeEquality=function(e,t){return e&&t&&r(e.start,t.start)&&r(e.end,t.end)},t.acronym=function(e){if(!e)return"";let t,n=e.toLowerCase(),i=0,r=e.length,s="_"!==n[0]&&"$"!==n[0]?n[0]:"";for(;i<r;)("$"===(t=e[i])||"_"===t)&&i+1<r&&"_"!==e[i+1]?s+=n[++i]:i>0&&t!==n[i]&&e[i-1]===n[i-1]&&(s+=n[i]),++i;return s},t.contSubstringMatch=function(e,t){let n=0,i=0,r=0,s=e.length;for(;r<s&&(i=t.indexOf(e[r],i))>-1;)n+=1/(i-r+1),++i,++r;return r===s?n/s:-1},t.ciStringContains=function(e,t){return!e||t.toLowerCase().indexOf(e.toLowerCase())>-1},t.ciStringMatch=function(e,t){return e.toLowerCase()===t.toLowerCase()},t.hash32=function(e,t){if(!e)return 0;let n,i=t||0;for(let t=0,r=e.length;t<r;++t)i=(i<<5)-i+(n=e.charCodeAt(t)),i|=0;return i},t.filter=function(e,t){let n,i=[];if(!e)return i;for(let r=0,s=e.length;r<s;++r)t(n=e[r])&&i.push(n);return i},t.find=function(e,t){if(!e)return;let n;for(let i=0,r=e.length;i<r;++i)if(t(n=e[i]))return n},t.cloneRange=function(e){return i.Range.create(e.start.line,e.start.character,e.end.line,e.end.character)};t.Iterator=class{constructor(e,t){this.items=e,this.filter=t,this.i=-1}next(){for(;++this.i<this.items.length&&this.filter&&!this.filter(this.items[this.i]););return this.i<this.items.length?this.items[this.i]:void 0}},t.ucFirst=function(e){return e?e[0].toUpperCase()+e.slice(1):""},t.lcFirst=function(e){return e?e[0].toLowerCase()+e.slice(1):""},t.arrayDifference=function(e,t){const n=new Set(t);return e.filter(e=>!n.has(e))},t.setUnion=function(e,t){if(e===t)return e;const n=new Set(e);for(let e of t.values())n.add(e);return n};const s=/^\s+$/;t.isWhitespace=function(e){return null!==e.match(s)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.error=function(t){e.writer&&t&&e.writer.error(t)},e.warn=function(t){e.writer&&t&&e.writer.warn(t)},e.info=function(t){e.writer&&t&&e.writer.info(t)}}(t.Log||(t.Log={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0),r=n(4);!function(e){e.fromDefinition=function(e){let t=0;return(65536&e.modifiers)>0&&(t|=1),(131072&e.modifiers)>0&&(t|=2),t}}(t.DocumentFlagFactory||(t.DocumentFlagFactory={}));class s{constructor(e,t,n=0,i){this._uri=e,this._text=t,this.version=n,this.text=t,this._flags=i||0}get uri(){return this._uri}get id(){return r.UriMap.id(this._uri)}get text(){return this._text}get flags(){return this._flags}set text(e){this._text=e,this._lineOffsets=this._textLineOffsets(e,0),this._search=new i.BinarySearch(this._lineOffsets)}get lineOffsets(){return this._lineOffsets.slice(0)}textToLeftOfOffset(e,t){const n=Math.max(e-t,0);return this._text.slice(n,e)}lineText(e){const t=this.offsetLine(e);return this._text.slice(this._lineOffsets[t],e)}wordToLeftOfOffset(e,t){const n=this.offsetLine(e);let i=this._text.slice(this._lineOffsets[n],e).match(t||s.WORD_REGEX);return i?i[0]:""}applyChanges(e){let t;for(let n=0,i=e.length;n<i;++n)(t=e[n]).range?this.applyChange(t.range.start,t.range.end,t.text):this.text=t.text}applyChange(e,t,n){let i=this.positionToOffset(e),r=this.positionToOffset(t);this._text=this._text.slice(0,i)+n+this._text.slice(r);let s=this._lineOffsets.slice(0,e.line+1),o=n.length-(r-i);Array.prototype.push.apply(s,this._textLineOffsets(n,i).slice(1));let a=this._lineOffsets.slice(t.line+1);for(let e=0,t=a.length;e<t;++e)s.push(a[e]+o);this._lineOffsets=s,this._search.sortedArray=this._lineOffsets}textToRightOfOffset(e,t){return this._text.substr(e,t)}offsetToPosition(e){const t=this.offsetLine(e);return{line:t,character:e-this._lineOffsets[t]}}positionToOffset(e){const t=this.lineOffset(e.line)+e.character;return Math.max(0,Math.min(t,this._text.length))}lineOffset(e){return e<=0||this._lineOffsets.length<1?0:e>this._lineOffsets.length-1?this._lineOffsets[this._lineOffsets.length-1]:this._lineOffsets[e]}offsetLine(e){let t=this._search.search(t=>t-e);return t.isExactMatch?t.rank:Math.max(t.rank-1,0)}_textLineOffsets(e,t){let n=0;const i=e.length;let r=!0;const s=[];let o;for(;n<i;)o=e[n],r&&(s.push(n+t),r=!1),"\r"!==o?("\n"===o&&(r=!0),++n):(++n<i&&"\n"===e[n]&&++n,r=!0);return r&&s.push(n+t),s}}s.WORD_REGEX=/(?:\$|[a-zA-Z_\x80-\uffff])[\\a-zA-Z0-9_\x80-\uffff]*$/,t.Document=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),r=n(0),s=n(2),o=n(4),a=n(6);class c{constructor(e,t){this.id=e,this.map=t}get uri(){return o.DocumentStore.uri(this.id)}get definitions(){return this.map.values()}definitionScope(e){return e.scope?this.get(e.scope):void 0}definitionChildren(e){if(!e.children)return[];let t,n=[];for(let i=0,r=e.children.length;i<r;++i)(t=this.get(e.children[i]))&&n.push(t);return n}get(e){return this.map.get(e)}has(e){return this.map.has(e)}add(e){this.map.set(e.fqsenHash,e)}getState(){return{id:this.id,definitionMapEntries:Array.from(this.map.entries())}}static fromState(e){return new c(e.id,new Map(e.definitionMapEntries))}}t.DefinitionTable=c;var d,l;t.DefinitionStore=class{constructor(){this.definitionTableMap=new Map,this._nameIndex=new r.NameIndex}table(e){return"string"==typeof e&&(e=o.UriMap.id(e)),this.definitionTableMap.get(e)}get tables(){return this.definitionTableMap.values()}add(e){this.remove(e.uri);const t=e.id;let n,r,s;this.definitionTableMap.set(t,e);for(let t of e.definitions)if(this.shouldIndexDefinition(t)){n=l.fromDefinition(t),s=i.Definition.shortName(t.name).toLowerCase();for(let e=0,t=n.length;e<t;++e)r=n[e],this._nameIndex.add(s.slice(d.offset(r.data)),r);s!==t.name&&this._nameIndex.add(t.name.toLowerCase(),l.create(t.uriId,t.fqsenHash,0,l.isDefinitionImportant(t)))}return e}remove(e){const t=o.UriMap.id(e),n=this.definitionTableMap.get(t);if(!n)return;let r,s,a;for(let e of n.definitions)if(this.shouldIndexDefinition(e)){r=l.fromDefinition(e),a=i.Definition.shortName(e.name).toLowerCase();for(let e=0,t=r.length;e<t;++e)s=r[e],this._nameIndex.remove(a.slice(d.offset(s.data)),s);a!==e.name&&this._nameIndex.remove(e.name.toLowerCase(),l.create(e.uriId,e.fqsenHash,0,l.isDefinitionImportant(e)))}return this.definitionTableMap.delete(t),n}getDefinitionChildren(e){const t=this.table(e.uriId);return t?t.definitionChildren(e):[]}getDefinitionScope(e){const t=this.table(e.uriId);if(t)return t.definitionScope(e)}clear(){this.definitionTableMap=new Map,this._nameIndex=new r.NameIndex}getNameIndexNodes(){return this._nameIndex.nodes}setNameIndexNodes(e){this._nameIndex.nodes=e}getState(){return{definitionTableMapEntries:Array.from(this.definitionTableMap.entries()),nameIndexNodes:this._nameIndex.getState()}}restore(e){if(!e.definitionTableMapEntries||!e.nameIndexNodes)throw new Error("Invalid Argument");this.definitionTableMap=new Map(e.definitionTableMapEntries),this._nameIndex.restoreState(e.nameIndexNodes)}findByUriIdAndFqsenHash(e,t){const n=this.table(e);if(n)return n.get(t)}find(e,t){if(!e)return[];let n,i,r=e.toLowerCase(),s=this._nameIndex.find(e),o=new Set;for(let a=0,c=s.length;a<c;++a)i=s[a],n=this.definitionTableMap.get(d.uriId(i.data)).get(i.fqsenHash),t&&!t(n)||!((264&n.kind)>0&&n.name===e)&&(264&n.kind||n.name.toLowerCase()!==r)||o.add(n);return Array.from(o)}*match(e,t){if(!e)return;const n=this._nameIndex.match(e).sort(this.matchSortFn),i=new Set;let r,s;for(let e=0,o=n.length;e<o;++e)s=n[e],r=this.definitionTableMap.get(d.uriId(s.data)).get(s.fqsenHash),t&&!t(r)||i.has(r)||(i.add(r),yield r)}matchSortFn(e,t){const n=d.offset(e.data)-d.offset(t.data);if(0!==n)return n;const i=d.isImportant(e.data)?1:0;return(d.isImportant(t.data)?1:0)-i}shouldIndexDefinition(e){return!(4224&e.kind||4096&e.modifiers||256===e.kind&&e.scope||!(e.name.length>0))}findByReference(e){if(!e)return[];let t,n,i;switch(e.kind){case 1:case 2:case 4:n=(e=>(7&e.kind)>0),t=this.find(e.name,n);break;case 64:case 8:n=(t=>t.kind===e.kind),(t=this.find(e.name,n)).length<1&&e.unresolvedName&&(t=this.find(e.unresolvedName,n));break;case 32:t=this.findMembers(e.scope,e.name,e.kind);break;case 16:{let n="$"===e.name.slice(0,1)?e.name:"$"+e.name;t=this.findMembers(e.scope,n,e.kind);break}case 1024:t=this.findMembers(e.scope,e.name,e.kind);break;case 256:case 128:if(t=[],i=this.table(e.uriId))for(let n of i.definitions){const s=i.definitionScope(n);128!==n.kind&&256!==n.kind||4198400&n.modifiers||n.name!==e.name||s&&!r.PackedRange.isInRange(s.range,e.range.start)||(t=[n])}Array.prototype.push.apply(t,this.find(e.name,e=>256===e.kind&&(4194304&e.modifiers)>0));break;case 2048:t=this.findMembers(s.TypeString.fromString(e.name),"__construct",e.kind)}return t||[]}findMembers(e,t,n){let i,r,o=s.TypeString.toArray(s.TypeString.atomicClassLikeTypes(e)),c=[];for(let e=0;e<o.length;++e)(i=a.TypeDefinition.fromName(o[e],this))&&(r=i.findMember(t,n))&&c.push(r);return c}},function(e){const t=255,n=4194303,i=1<<30;e.offset=function(e){return e>>22&t},e.uriId=function(e){return e&n},e.isImportant=function(e){return(e&i)===i},e.pack=function(e,r,s){return e&n|(r&t)<<22|(s?i:0)}}(d=t.DefinitionTableLocationPackedData||(t.DefinitionTableLocationPackedData={})),function(e){function t(e,t,n,i){return{fqsenHash:t,data:d.pack(e,n,i)}}function n(e){return!(196608&e.modifiers)}function r(e){if(!e.name)return[];if(512===e.kind)return[];let t,n=i.Definition.shortName(e.name),r=n.toLowerCase(),s=[0],o=0,a=n.length;for(;o<a;)("$"===(t=n[o])||"_"===t)&&o+1<a&&"_"!==n[o+1]?(++o,s.push(o)):o>0&&t!==r[o]&&n[o-1]===r[o-1]&&s.push(o),++o;return s}e.create=t,e.fromDefinition=function(e){const i=[],s=r(e),o=n(e);for(let n=0,r=s.length;n<r;++n)i.push(t(e.uriId,e.fqsenHash,s[n],o));return i},e.isDefinitionImportant=n,e.nameOffsets=r}(l=t.DefinitionTableLocation||(t.DefinitionTableLocation={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(8);!function(e){e.fromDefinition=function(e){return{kind:e.kind,name:e.name,fqn:e.associated&&e.associated.length>0?e.associated[0].name:""}}}(t.UseRule||(t.UseRule={}));t.NameResolver=class{constructor(){this.namespaceName="",this.rules=[],this._classStack=[]}get className(){return this._classStack.length?this._classStack[this._classStack.length-1].className:""}get baseClassName(){return this._classStack.length?this._classStack[this._classStack.length-1].baseClassName:""}pushClass(e,t){this._classStack.push({className:e,baseClassName:t})}popClass(){this._classStack.pop()}resolveRelative(e){return this.concatNamespaceName(this.namespaceName,e)}resolveNotFullyQualified(e,t,n){if(!e)return"";let r=e.toLowerCase();if(i.PHP.isReservedName(r))return r;switch(r){case"self":return this.className;case"static":case"$this":return n?this.className:r;case"parent":return this.baseClassName}let s=e.indexOf("\\");return 0===s?e.slice(1):s<0?this._resolveUnqualified(e,t||1):this._resolveQualified(e,s)}concatNamespaceName(e,t){return t&&e?e+"\\"+t:t}match(e,t){const n=e.indexOf("\\"),i=n>-1?e.slice(0,n):e;return this.matchUnqualified(i,t)}matchUnqualified(e,t){let n;2566&t&&(t=1),8!==t&&(e=e.toLowerCase());for(let i=0,r=this.rules.length;i<r;++i)if((n=this.rules[i]).name&&n.kind===t&&(8===t&&e===n.name||8!==t&&e===n.name.toLowerCase()))return n}_resolveQualified(e,t){const n=this.matchUnqualified(e.slice(0,t),1);return n?n.fqn+e.slice(t):this.resolveRelative(e)}_resolveUnqualified(e,t){const n=this.matchUnqualified(e,t);return n?n.fqn:this.resolveRelative(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.info=function(t){e.connection&&e.connection.console.info(t)},e.warn=function(t){e.connection&&e.connection.console.warn(t)},e.error=function(t){e.connection&&e.connection.console.error(t)}}(t.Log||(t.Log={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){var t;function n(e){let t=e.charCodeAt(0);return t>64&&t<91||t>96&&t<123||95===t||t>127}function i(e){let t=e.charCodeAt(0);return t>47&&t<58||t>64&&t<91||t>96&&t<123||95===t||t>127}function r(e){return" "===e||"\n"===e||"\r"===e||"\t"===e}function s(e){let t=e.position,r=e.input.length,s=e.position+1;if(!(s>=r)){if("{"===e.input[s])return e.position+=2,e.modeStack.push(9),{kind:130,length:2,previous:e.previousToken};if(n(e.input[s])){for(;++s<r&&i(e.input[s]););if(s<r&&"["===e.input[s])return e.modeStack.push(8),e.position=s,{kind:83,length:e.position-t,previous:e.previousToken};if(s<r&&"-"===e.input[s]){let i=s+1;if(i<r&&">"===e.input[i]&&++i<r&&n(e.input[i]))return e.modeStack.push(2),e.position=s,{kind:83,length:e.position-t,previous:e.previousToken}}return e.position=s,{kind:83,length:e.position-t,previous:e.previousToken}}}}function o(e,t){++e.position;let i,r=e.position,s=e.input.length;for(;r<s;){switch(i=e.input[r++]){case'"':return e.position=r,{kind:77,length:e.position-t,previous:e.previousToken};case"$":if(r<s&&(n(e.input[r])||"{"===e.input[r]))break;continue;case"{":if(r<s&&"$"===e.input[r])break;continue;case"\\":r<s&&++r;default:continue}--r;break}return e.doubleQuoteScannedLength=r,e.modeStack.pop(),e.modeStack.push(3),{kind:96,length:e.position-t,previous:e.previousToken}}function a(e,t){let n,i=e.input.length;for(++e.position;e.position<i;){if(n=e.input[e.position],++e.position,"'"===n)return{kind:77,length:e.position-t,previous:e.previousToken};"\\"===n&&e.position<i&&++e.position}return{kind:79,length:e.position-t,previous:e.previousToken}}e.setInput=function(e,n,i,r){t={position:r>0?r:0,input:e,modeStack:i||[0],doubleQuoteScannedLength:-1,heredocLabel:null,heredocEndNewLineLength:0,heredocEndIndent:0,previousToken:void 0,nodeProblemMap:n}},e.lex=function e(){if(t.position>=t.input.length)return t.previousToken={kind:1,length:0,previous:t.previousToken};let c;switch(t.modeStack[t.modeStack.length-1]){case 0:c=function(e){let t=e.input.length,n=e.input[e.position],i=e.position;if("<"===n&&e.position+1<t&&"?"===e.input[e.position+1]){let n=156;"<?php"===e.input.substr(e.position,5).toLowerCase()&&e.position+5<t&&r(e.input[e.position+5])?"\r"===e.input[e.position+5]&&e.position+6<t&&"\n"===e.input[e.position+6]?e.position+=7:e.position+=6:e.position+2<t&&"="===e.input[e.position+2]?(n=157,e.position+=3):e.position+=2;let s={kind:n,length:e.position-i,previous:e.previousToken};return e.modeStack.pop(),e.modeStack.push(1),s}for(;++e.position<t&&!("<"===(n=e.input[e.position])&&e.position+1<t&&"?"===e.input[e.position+1]););return{kind:80,length:e.position-i,previous:e.previousToken}}(t);break;case 1:c=function(e){let t=e.input[e.position],s=e.position,c=e.input.length;switch(t){case" ":case"\t":case"\n":case"\r":for(;++e.position<c&&r(e.input[e.position]););return{kind:163,length:e.position-s,previous:e.previousToken};case"-":return function(e){if(e.position,++e.position<e.input.length)switch(e.input[e.position]){case">":return++e.position,e.modeStack.push(2),{kind:114,length:2,previous:e.previousToken};case"-":return++e.position,{kind:128,length:2,previous:e.previousToken};case"=":return++e.position,{kind:143,length:2,previous:e.previousToken}}return{kind:142,length:1,previous:e.previousToken}}(e);case":":return++e.position<c&&":"===e.input[e.position]?(++e.position,{kind:132,length:2,previous:e.previousToken}):{kind:86,length:1,previous:e.previousToken};case".":return function(e){let t=e.position;if(++e.position<e.input.length){let n=e.input[e.position];if("="===n)return++e.position,{kind:126,length:2,previous:e.previousToken};if("."===n&&e.position+1<e.input.length&&"."===e.input[e.position+1])return e.position+=2,{kind:133,length:3,previous:e.previousToken};if(n>="0"&&n<="9")return h(e,t,!0)}return{kind:125,length:1,previous:e.previousToken}}(e);case"=":return function(e){if(e.position,++e.position<e.input.length)switch(e.input[e.position]){case"=":return++e.position<e.input.length&&"="===e.input[e.position]?(++e.position,{kind:137,length:3,previous:e.previousToken}):{kind:135,length:2,previous:e.previousToken};case">":return++e.position,{kind:131,length:2,previous:e.previousToken}}return{kind:84,length:1,previous:e.previousToken}}(e);case"+":return function(e){if(e.position,++e.position<e.input.length)switch(e.input[e.position]){case"=":return++e.position,{kind:111,length:2,previous:e.previousToken};case"+":return++e.position,{kind:134,length:2,previous:e.previousToken}}return{kind:110,length:1,previous:e.previousToken}}(e);case"!":return function(e){return e.position,++e.position<e.input.length&&"="===e.input[e.position]?++e.position<e.input.length&&"="===e.input[e.position]?(++e.position,{kind:139,length:3,previous:e.previousToken}):{kind:138,length:2,previous:e.previousToken}:{kind:88,length:1,previous:e.previousToken}}(e);case"<":return function(e){let t=e.position;if(++e.position<e.input.length)switch(e.input[e.position]){case">":return++e.position,{kind:138,length:2,previous:e.previousToken};case"<":if(++e.position,e.position<e.input.length){if("="===e.input[e.position])return++e.position,{kind:106,length:3,previous:e.previousToken};if("<"===e.input[e.position]){e.position-=2;let n=d(e,t);if(n)return n;e.position+=2}}return{kind:105,length:2,previous:e.previousToken};case"=":return++e.position,e.position<e.input.length&&">"===e.input[e.position]?(++e.position,{kind:141,length:3,previous:e.previousToken}):{kind:140,length:2,previous:e.previousToken}}return{kind:98,length:1,previous:e.previousToken}}(e);case">":return function(e){if(e.position,++e.position<e.input.length)switch(e.input[e.position]){case">":return++e.position,e.position<e.input.length&&"="===e.input[e.position]?(++e.position,{kind:108,length:3,previous:e.previousToken}):{kind:107,length:2,previous:e.previousToken};case"=":return++e.position,{kind:136,length:2,previous:e.previousToken}}return{kind:99,length:1,previous:e.previousToken}}(e);case"*":return function(e){if(e.position,++e.position<e.input.length)switch(e.input[e.position]){case"*":return++e.position,e.position<e.input.length&&"="===e.input[e.position]?(++e.position,{kind:113,length:3,previous:e.previousToken}):{kind:112,length:2,previous:e.previousToken};case"=":return++e.position,{kind:145,length:2,previous:e.previousToken}}return{kind:100,length:1,previous:e.previousToken}}(e);case"/":return function(e){let t=e.position;if(++e.position,e.position<e.input.length)switch(e.input[e.position]){case"=":return++e.position,{kind:129,length:2,previous:e.previousToken};case"*":return++e.position,function(e){let t=161,n=e.position-2,i=e.input.length;for(e.position<i&&"*"===e.input[e.position]&&e.position+1<i&&"/"!==e.input[e.position+1]&&(++e.position,t=162);e.position<i;){if("*"===e.input[e.position]&&e.position+1<i&&"/"===e.input[e.position+1]){e.position+=2;break}++e.position}return{kind:t,length:e.position-n,previous:e.previousToken}}(e);case"/":return++e.position,f(e,t)}return{kind:90,length:1,previous:e.previousToken}}(e);case"%":return++e.position<c&&"="===e.input[e.position]?(++e.position,{kind:144,length:2,previous:e.previousToken}):{kind:91,length:1,previous:e.previousToken};case"&":return function(e){if(e.position,++e.position,e.position<e.input.length)switch(e.input[e.position]){case"=":return++e.position,{kind:103,length:2,previous:e.previousToken};case"&":return++e.position,{kind:101,length:2,previous:e.previousToken}}return{kind:102,length:1,previous:e.previousToken}}(e);case"|":return function(e){if(e.position,++e.position,e.position<e.input.length)switch(e.input[e.position]){case"=":return++e.position,{kind:109,length:2,previous:e.previousToken};case"|":return++e.position,{kind:123,length:2,previous:e.previousToken}}return{kind:122,length:1,previous:e.previousToken}}(e);case"^":return++e.position<c&&"="===e.input[e.position]?(++e.position,{kind:104,length:2,previous:e.previousToken}):{kind:124,length:1,previous:e.previousToken};case";":return++e.position,{kind:87,length:1,previous:e.previousToken};case",":return++e.position,{kind:92,length:1,previous:e.previousToken};case"[":return++e.position,{kind:116,length:1,previous:e.previousToken};case"]":return++e.position,{kind:119,length:1,previous:e.previousToken};case"(":return function(e){let t=e.position,n=t,i=e.input.length;for(++n;n<i&&(" "===e.input[n]||"\t"===e.input[n]);)++n;let r=n;for(;n<i&&(e.input[n]>="A"&&e.input<="Z"||e.input[n]>="a"&&e.input<="z");)++n;let s=n;for(;n<i&&(" "===e.input[n]||"\t"===e.input[n]);)++n;if(n<i&&")"===e.input[n]){let i=e.input.slice(r,s).toLowerCase(),o=0;switch(i){case"int":case"integer":o=151;break;case"real":case"float":case"double":o=152;break;case"string":case"binary":o=149;break;case"array":o=155;break;case"object":o=150;break;case"bool":case"boolean":o=147;break;case"unset":o=148}if(o>0)return e.position=n+1,{kind:o,length:e.position-t,previous:e.previousToken}}return++e.position,{kind:117,length:1,previous:e.previousToken}}(e);case")":return++e.position,{kind:120,length:1,previous:e.previousToken};case"~":return++e.position,{kind:85,length:1,previous:e.previousToken};case"?":return function(e){let t=e.input.length,n=e.position;if(++e.position,e.position<t){if("?"===e.input[e.position])return++e.position,{kind:121,length:2,previous:e.previousToken};if(">"===e.input[e.position])return++e.position,e.modeStack.pop(),e.modeStack.push(0),{kind:158,length:e.position-n,previous:e.previousToken}}return{kind:95,length:1,previous:e.previousToken}}(e);case"@":return++e.position,{kind:93,length:1,previous:e.previousToken};case"$":return function(e){let t=e.position,r=e.position,s=e.input.length;if(++r<s&&n(e.input[r])){for(;++r<s&&i(e.input[r]););return e.position=r,{kind:83,length:e.position-t,previous:e.previousToken}}return++e.position,{kind:89,length:1,previous:e.previousToken}}(e);case"#":return++e.position,f(e,s);case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":return function(e){let t=e.position,n=e.input.length,i=e.position;if("0"===e.input[e.position]&&++i<n){if("b"===e.input[i]&&++i<n&&("0"===e.input[i]||"1"===e.input[i])){for(;++i<n&&("0"===e.input[i]||"1"===e.input[i]););return e.position=i,{kind:81,length:e.position-t,previous:e.previousToken}}if(i=e.position+1,"x"===e.input[i]&&++i<n&&u(e.input[i])){for(;++i<n&&u(e.input[i]););return e.position=i,{kind:81,length:e.position-t,previous:e.previousToken}}}for(;++e.position<n&&e.input[e.position]>="0"&&e.input[e.position]<="9";);return"."===e.input[e.position]?(++e.position,h(e,t,!0)):"e"===e.input[e.position]||"E"===e.input[e.position]?h(e,t,!1):{kind:81,length:e.position-t,previous:e.previousToken}}(e);case"{":return++e.position,e.modeStack.push(1),{kind:115,length:1,previous:e.previousToken};case"}":return++e.position,e.modeStack.length>1&&e.modeStack.pop(),{kind:118,length:1,previous:e.previousToken};case"`":return++e.position,e.modeStack.pop(),e.modeStack.push(7),{kind:94,length:1,previous:e.previousToken};case"\\":return++e.position,{kind:146,length:1,previous:e.previousToken};case"'":return a(e,s);case'"':return o(e,s);case"b":return function(e){let t,n=e.position;if(++e.position,e.position<e.input.length)switch(e.input[e.position]){case"'":return a(e,n);case'"':return o(e,n);case"<":if(t=d(e,n))return t;default:return--e.position,l(e)}return--e.position,l(e)}(e);default:return n(t)?l(e):(++e.position,{kind:0,length:1,previous:e.previousToken})}}(t);break;case 2:c=function(e){let t=e.position,s=e.input[e.position],o=e.input.length;switch(s){case" ":case"\t":case"\n":case"\r":for(;++e.position<o&&r(e.input[e.position]););return{kind:163,length:e.position-t,previous:e.previousToken};default:if(n(s)){for(;++e.position<o&&i(e.input[e.position]););return e.modeStack.pop(),{kind:82,length:e.position-t,previous:e.previousToken}}return"-"===s&&e.position+1<o&&">"===e.input[e.position+1]?(e.position+=2,{kind:114,length:2,previous:e.previousToken}):(e.modeStack.pop(),null)}}(t);break;case 3:c=function(e){let t,i=e.input.length,r=e.input[e.position];switch(e.position,r){case"$":if(t=s(e))return t;break;case"{":if(e.position+1<i&&"$"===e.input[e.position+1])return e.modeStack.push(1),++e.position,{kind:127,length:1,previous:e.previousToken};break;case'"':return e.modeStack.pop(),e.modeStack.push(1),++e.position,{kind:96,length:1,previous:e.previousToken}}return function(e){let t=e.position;if(e.doubleQuoteScannedLength>0)e.position=e.doubleQuoteScannedLength,e.doubleQuoteScannedLength=-1;else{let t,i=e.position,r=e.input.length;for(++i,"\\"===e.input[e.position]&&i+1<r&&++i;i<r;){switch(t=e.input[i++]){case'"':break;case"$":if(i<r&&(n(e.input[i])||"{"==e.input[i]))break;continue;case"{":if(i<r&&"$"===e.input[i])break;continue;case"\\":i<r&&++i;default:continue}--i;break}e.position=i}return{kind:79,length:e.position-t,previous:e.previousToken}}(e)}(t);break;case 4:c=function(e){let t,i=e.position,r=i,s=e.input.length;for(;r<s;){switch(t=e.input[r++]){case"\r":r<s&&"\n"===e.input[r]&&++r;case"\n":{let t=r;for(;t<s&&(" "===e.input[t]||"\t"===e.input[t]);)++t;if(e.heredocEndIndent=t-r,t<s&&e.heredocLabel===e.input.substr(t,e.heredocLabel.length)){if(t+e.heredocLabel.length<s&&n(e.input[t+e.heredocLabel.length]))continue;"\r"===e.input[r-2]&&"\n"===e.input[r-1]?(r-=2,e.heredocEndNewLineLength=2):(--r,e.heredocEndNewLineLength=1),e.modeStack.pop(),e.modeStack.push(6);break}}default:continue}break}return e.position=r,{kind:79,length:e.position-i,previous:e.previousToken}}(t);break;case 5:c=function(e){let t,i=e.input.length,r=e.input[e.position];switch(e.position,r){case"$":if(t=s(e))return t;break;case"{":if(e.position+1<i&&"$"===e.input[e.position+1])return e.modeStack.push(1),++e.position,{kind:127,length:1,previous:e.previousToken}}return function(e){let t,i=e.position,r=i,s=e.input.length;for(;r<s;){switch(t=e.input[r++]){case"\r":r<s&&"\n"===e.input[r]&&++r;case"\n":{let t=r;for(;t<s&&(" "===e.input[t]||"\t"===e.input[t]);)++t;if(e.heredocEndIndent=t-r,t<s&&e.heredocLabel===e.input.substr(t,e.heredocLabel.length)){if(t+e.heredocLabel.length<s&&n(e.input[t+e.heredocLabel.length]))continue;"\r"===e.input[r-2]&&"\n"===e.input[r-1]?(r-=2,e.heredocEndNewLineLength=2):(--r,e.heredocEndNewLineLength=1),e.position=r,e.modeStack.pop(),e.modeStack.push(6);let o=e.position-i;return o>0?{kind:79,length:e.position-i,previous:e.previousToken}:void 0}}continue;case"$":if(r<s&&(n(e.input[r])||"{"===e.input[r]))break;continue;case"{":if(r<s&&"$"===e.input[r])break;continue;case"\\":r<s&&"\n"!==e.input[r]&&"\r"!==e.input[r]&&++r;default:continue}--r;break}return e.position=r,{kind:79,length:e.position-i,previous:e.previousToken}}(e)}(t);break;case 6:c=function(e){let t=e.position;return e.position+=e.heredocEndNewLineLength+e.heredocEndIndent+e.heredocLabel.length,e.heredocLabel=null,e.heredocEndIndent=0,e.heredocEndNewLineLength=0,e.modeStack.pop(),e.modeStack.push(1),{kind:154,length:e.position-t,previous:e.previousToken}}(t);break;case 7:c=function(e){let t,i=e.input.length,r=e.input[e.position];switch(e.position,r){case"$":if(t=s(e))return t;break;case"{":if(e.position+1<i&&"$"===e.input[e.position+1])return e.modeStack.push(1),++e.position,{kind:127,length:1,previous:e.previousToken};break;case"`":return e.modeStack.pop(),e.modeStack.push(1),++e.position,{kind:94,length:1,previous:e.previousToken}}return function(e){let t,i=e.position,r=i,s=e.input.length;for("\\"===e.input[i]&&i<s&&++i;i<s;){switch(t=e.input[i++]){case"`":break;case"$":if(i<s&&(n(e.input[i])||"{"===e.input[i]))break;continue;case"{":if(i<s&&"$"===e.input[i])break;continue;case"\\":i<s&&++i;default:continue}--i;break}return e.position=i,{kind:79,length:e.position-r,previous:e.previousToken}}(e)}(t);break;case 8:c=function(e){let t=e.position,r=e.input[e.position],s=e.input.length;switch(e.input[e.position]){case"$":if(e.position+1<s&&n(e.input[e.position+1])){for(++e.position;++e.position<s&&i(e.input[e.position]););return{kind:83,length:e.position-t,previous:e.previousToken}}break;case"[":return++e.position,{kind:116,length:1,previous:e.previousToken};case"]":return e.modeStack.pop(),++e.position,{kind:119,length:1,previous:e.previousToken};case"-":return++e.position,{kind:142,length:1,previous:e.previousToken};default:if(r>="0"&&r<="9")return function(e){let t=e.position,n=e.input[e.position],i=e.input.length;if("0"===n){let n=e.position+1;if(n<i&&"b"===e.input[n]&&++n<i&&("1"===e.input[n]||"0"===e.input[n])){for(;++n<i&&("1"===e.input[n]||"0"===e.input[n]););return e.position=n,{kind:81,length:e.position-t,previous:e.previousToken}}if(n<i&&"x"===e.input[n]&&++n<i&&u(e.input[n])){for(;++n<i&&u(e.input[n]););return e.position=n,{kind:81,length:e.position-t,previous:e.previousToken}}}for(;++e.position<i&&e.input[e.position]>="0"&&e.input[e.position]<="9";);return{kind:81,length:e.position-t,previous:e.previousToken}}(e);if(n(r)){for(;++e.position<s&&i(e.input[e.position]););return{kind:82,length:e.position-t,previous:e.previousToken}}}return e.modeStack.pop(),++e.position,{kind:0,length:1,previous:e.previousToken}}(t);break;case 9:c=function(e){let t=e.position,r=e.input.length;if(n(e.input[e.position])){let n=e.position;for(;++n<r&&i(e.input[n]););if(n<r&&("["===e.input[n]||"}"===e.input[n]))return e.modeStack.pop(),e.modeStack.push(1),e.position=n,{kind:83,length:e.position-t,previous:e.previousToken}}return e.modeStack.pop(),void e.modeStack.push(1)}(t);break;default:throw new Error("Unknown LexerMode")}return c||(c=e()),t.previousToken=c};const c=/^;?(?:\r\n|\n|\r)/;function d(e,t){let r,s,o,a=e.input.length,d=e.position;for(let t=d+3;d<t;++d)if(d>=a||"<"!==e.input[d])return null;for(;d<a&&(" "===e.input[d]||"\t"===e.input[d]);)++d;if(d<a&&("'"===e.input[d]||'"'===e.input[d])&&(o=e.input[d],++d),r=d,!(d<a&&n(e.input[d])))return null;for(;++d<a&&i(e.input[d]););if(s=d,o){if(!(d<a&&e.input[d]===o))return null;++d}if(d<a)if("\r"===e.input[d])++d,"\n"===e.input[d]&&++d;else{if("\n"!==e.input[d])return null;++d}e.position=d,e.heredocLabel=e.input.slice(r,s);let l={kind:153,length:e.position-t,previous:e.previousToken};return e.modeStack.pop(),"'"===o?e.modeStack.push(4):e.modeStack.push(5),e.input.substr(e.position,e.heredocLabel.length)===e.heredocLabel&&e.input.substr(e.position+e.heredocLabel.length,3).search(c)>=0&&(e.modeStack.pop(),e.modeStack.push(6)),l}function l(e){let t=e.input.length,n=e.position;for(;++e.position<t&&i(e.input[e.position]););let s=e.input.slice(n,e.position),o=0;if("_"===s[0]){switch(s){case"__CLASS__":o=76;break;case"__TRAIT__":o=75;break;case"__FUNCTION__":o=72;break;case"__METHOD__":o=73;break;case"__LINE__":o=71;break;case"__FILE__":o=70;break;case"__DIR__":o=69;break;case"__NAMESPACE__":o=74}if(o>0)return{kind:o,length:e.position-n,previous:e.previousToken}}switch(s=s.toLowerCase()){case"exit":case"die":o=27;break;case"function":o=33;break;case"const":o=11;break;case"return":o=57;break;case"yield":return function(e,t){let n=e.input.length,i=e.position;if(i<n&&r(e.input[i])){for(;++i<n&&r(e.input[i]););if("from"===e.input.substr(i,4).toLowerCase())return e.position=i+4,{kind:68,length:e.position-t,previous:e.previousToken}}return{kind:67,length:e.position-t,previous:e.previousToken}}(e,n);case"try":o=62;break;case"catch":o=8;break;case"finally":o=30;break;case"throw":o=60;break;case"if":o=37;break;case"elseif":o=18;break;case"endif":o=23;break;case"else":{let n=e.position;for(;n<t&&r(e.input[n]);)++n;"if"===e.input.substr(n,2).toLowerCase()?(e.position=n+2,o=18):o=17}break;case"while":o=66;break;case"endwhile":o=25;break;case"do":o=15;break;case"for":o=31;break;case"endfor":o=21;break;case"foreach":o=32;break;case"endforeach":o=22;break;case"declare":o=13;break;case"enddeclare":o=20;break;case"instanceof":o=41;break;case"as":o=4;break;case"switch":o=59;break;case"endswitch":o=24;break;case"case":o=7;break;case"default":o=14;break;case"break":o=5;break;case"continue":o=12;break;case"goto":o=35;break;case"echo":o=16;break;case"print":o=51;break;case"class":o=9;break;case"interface":o=43;break;case"trait":o=61;break;case"extends":o=28;break;case"implements":o=38;break;case"new":o=50;break;case"clone":o=10;break;case"var":o=65;break;case"eval":o=26;break;case"include_once":o=40;break;case"include":o=39;break;case"require_once":o=56;break;case"require":o=55;break;case"namespace":o=49;break;case"use":o=64;break;case"insteadof":o=42;break;case"global":o=34;break;case"isset":o=44;break;case"empty":o=19;break;case"__halt_compiler":o=36;break;case"static":o=58;break;case"abstract":o=2;break;case"final":o=29;break;case"private":o=52;break;case"protected":o=54;break;case"public":o=53;break;case"unset":o=63;break;case"list":o=45;break;case"array":o=3;break;case"callable":o=6;break;case"or":o=47;break;case"and":o=46;break;case"xor":o=48}return o||(o=82),{kind:o,length:e.position-n,previous:e.previousToken}}function u(e){return e>="0"&&e<="9"||e>="a"&&e<="f"||e>="A"&&e<="F"}function h(e,t,n){let i=e.input.length;for(;e.position<i&&e.input[e.position]>="0"&&e.input[e.position]<="9";)++e.position;if(e.position<i&&("e"===e.input[e.position]||"E"===e.input[e.position])){let n=e.position+1;if(n<i&&("+"===e.input[n]||"-"===e.input[n])&&++n,n<i&&e.input[n]>="0"&&e.input[n]<="9"){for(;++n<i&&e.input[n]>="0"&&e.input[n]<="9";);return e.position=n,{kind:78,length:e.position-t,previous:e.previousToken}}}return{kind:n?78:81,length:e.position-t,previous:e.previousToken}}function f(e,t){let n,i=e.input.length;for(;e.position<i;)if(n=e.input[e.position],++e.position,"\n"===n||"\r"===n||"?"===n&&e.position<i&&">"===e.input[e.position]){--e.position;break}return{kind:160,length:e.position-t,previous:e.previousToken}}}(t.Lexer||(t.Lexer={})),t.isKeyword=function(e){return e>=2&&e<=68},t.tokenKindToString=function(e){switch(e){case 0:return"Unknown";case 1:return"EndOfFile";case 2:return"abstract";case 3:return"array";case 4:return"as";case 5:return"break";case 6:return"callable";case 7:return"case";case 8:return"catch";case 9:return"class";case 76:return"__CLASS__";case 10:return"clone";case 11:return"const";case 12:return"continue";case 13:return"declare";case 14:return"default";case 15:return"do";case 16:return"echo";case 17:return"else";case 18:return"elseif";case 19:return"empty";case 20:return"enddeclare";case 21:return"endfor";case 22:return"endforeach";case 23:return"endif";case 24:return"endswitch";case 25:return"endwhile";case 154:return"EndHeredoc";case 26:return"eval";case 27:return"exit";case 28:return"extends";case 29:return"final";case 30:return"finally";case 31:return"for";case 32:return"foreach";case 33:return"function";case 34:return"global";case 35:return"goto";case 36:return"__halt_compiler";case 37:return"if";case 38:return"implements";case 39:return"include";case 40:return"include_once";case 41:return"instanceof";case 42:return"insteadof";case 43:return"interface";case 44:return"isset";case 45:return"list";case 46:return"and";case 47:return"or";case 48:return"xor";case 49:return"namespace";case 50:return"new";case 51:return"print";case 52:return"private";case 53:return"public";case 54:return"protected";case 55:return"require";case 56:return"require_once";case 57:return"return";case 58:return"static";case 59:return"switch";case 60:return"throw";case 61:return"trait";case 62:return"try";case 63:return"unset";case 64:return"use";case 65:return"var";case 66:return"while";case 67:return"yield";case 68:return"yield from";case 69:return"__DIR__";case 70:return"__FILE__";case 71:return"__LINE__";case 72:return"__FUNCTION__";case 73:return"__METHOD__";case 74:return"__NAMESPACE__";case 75:return"__TRAIT__";case 77:return"StringLiteral";case 78:return"FloatingLiteral";case 79:return"EncapsulatedAndWhitespace";case 80:return"Text";case 81:return"IntegerLiteral";case 82:return"Name";case 83:return"VariableName";case 84:return"=";case 85:return"~";case 86:return":";case 87:return";";case 88:return"!";case 89:return"$";case 90:return"/";case 91:return"%";case 92:return",";case 93:return"@";case 94:return"`";case 95:return"?";case 96:return'"';case 97:return"'";case 98:return"<";case 99:return">";case 100:return"*";case 101:return"&&";case 102:return"&";case 103:return"&=";case 104:return"^=";case 105:return"<<";case 106:return"<<=";case 107:return">>";case 108:return">>=";case 109:return"|=";case 110:return"+";case 111:return"+=";case 112:return"**";case 113:return"**=";case 114:return"->";case 115:return"{";case 116:return"[";case 117:return"(";case 118:return"}";case 119:return"]";case 120:return")";case 121:return"??";case 122:return"|";case 123:return"||";case 124:return"^";case 125:return".";case 126:return".=";case 127:return"{";case 128:return"--";case 129:return"/=";case 130:return"${";case 131:return"=>";case 132:return"::";case 133:return"...";case 134:return"++";case 135:return"==";case 136:return">=";case 137:return"===";case 138:return"!=";case 139:return"!==";case 140:return"<=";case 141:return"<=>";case 142:return"-";case 143:return"-=";case 144:return"%=";case 145:return"*=";case 146:return"\\";case 147:return"(bool)";case 148:return"(unset)";case 149:return"(string)";case 150:return"(object)";case 151:return"(int)";case 152:return"(float)";case 153:return"StartHeredoc";case 155:return"(array)";case 156:return"<?php";case 157:return"<?=";case 158:return"?>";case 160:return"Comment";case 161:return"InlineComment";case 162:return"DocumentComment";case 163:return"Whitespace";case 159:return"VisibleDocumentComment";default:throw new Error("Invalid Argument")}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){function t(e,t,n){return{kind:e,length:t,children:n}}e.create=t,e.createParseError=function(e,n){return t(1061,n||0,e)}}(t.Phrase||(t.Phrase={})),t.phraseKindToString=function(e){switch(e){case 1e3:return"Unknown";case 1001:return"AdditiveExpression";case 1002:return"AnonymousClassDeclaration";case 1003:return"AnonymousClassDeclarationHeader";case 1004:return"AnonymousFunctionCreationExpression";case 1005:return"AnonymousFunctionHeader";case 1006:return"AnonymousFunctionUseClause";case 1007:return"AnonymousFunctionUseVariable";case 1008:return"ArgumentExpressionList";case 1009:return"ArrayCreationExpression";case 1010:return"ArrayElement";case 1011:return"ArrayInitialiserList";case 1012:return"ArrayKey";case 1013:return"ArrayValue";case 1014:return"BitwiseExpression";case 1015:return"BreakStatement";case 1016:return"ByRefAssignmentExpression";case 1017:return"CaseStatement";case 1018:return"CaseStatementList";case 1019:return"CastExpression";case 1020:return"CatchClause";case 1021:return"CatchClauseList";case 1022:return"CatchNameList";case 1023:return"ClassBaseClause";case 1024:return"ClassConstantAccessExpression";case 1025:return"ClassConstDeclaration";case 1026:return"ClassConstElement";case 1027:return"ClassConstElementList";case 1028:return"ClassDeclaration";case 1029:return"ClassDeclarationBody";case 1030:return"ClassDeclarationHeader";case 1031:return"ClassInterfaceClause";case 1032:return"ClassMemberDeclarationList";case 1033:return"ClassModifiers";case 1034:return"ClassTypeDesignator";case 1035:return"CloneExpression";case 1036:return"ClosureUseList";case 1037:return"CoalesceExpression";case 1038:return"CompoundAssignmentExpression";case 1039:return"CompoundStatement";case 1040:return"TernaryExpression";case 1041:return"ConstantAccessExpression";case 1042:return"ConstDeclaration";case 1043:return"ConstElement";case 1044:return"ConstElementList";case 1045:return"ContinueStatement";case 1046:return"DeclareDirective";case 1047:return"DeclareStatement";case 1048:return"DefaultArgumentSpecifier";case 1049:return"DefaultStatement";case 1050:return"DoStatement";case 1051:return"DoubleQuotedStringLiteral";case 1052:return"EchoIntrinsic";case 1053:return"ElseClause";case 1054:return"ElseIfClause";case 1055:return"ElseIfClauseList";case 1056:return"EmptyIntrinsic";case 1057:return"EncapsulatedExpression";case 1058:return"EncapsulatedVariable";case 1059:return"EncapsulatedVariableList";case 1060:return"EqualityExpression";case 1061:return"ParseError";case 1062:return"ErrorControlExpression";case 1063:return"EvalIntrinsic";case 1064:return"ExitIntrinsic";case 1065:return"ExponentiationExpression";case 1066:return"ExpressionList";case 1067:return"ExpressionStatement";case 1068:return"FinallyClause";case 1069:return"ForControl";case 1071:return"ForeachCollection";case 1072:return"ForeachKey";case 1073:return"ForeachStatement";case 1074:return"ForeachValue";case 1075:return"ForEndOfLoop";case 1076:return"ForExpressionGroup";case 1070:return"ForExpressionGroupList";case 1077:return"ForInitialiser";case 1078:return"ForStatement";case 1079:return"FullyQualifiedName";case 1080:return"FunctionCallExpression";case 1081:return"FunctionDeclaration";case 1083:return"FunctionDeclarationHeader";case 1082:return"FunctionDeclarationBody";case 1084:return"FunctionStaticDeclaration";case 1085:return"FunctionStaticInitialiser";case 1086:return"GlobalDeclaration";case 1087:return"GotoStatement";case 1088:return"HaltCompilerStatement";case 1089:return"HeredocStringLiteral";case 1090:return"Identifier";case 1091:return"IfStatement";case 1092:return"IncludeExpression";case 1093:return"IncludeOnceExpression";case 1094:return"InlineText";case 1095:return"InstanceOfExpression";case 1096:return"InstanceofTypeDesignator";case 1097:return"InterfaceBaseClause";case 1098:return"InterfaceDeclaration";case 1099:return"InterfaceDeclarationBody";case 1100:return"InterfaceDeclarationHeader";case 1101:return"InterfaceMemberDeclarationList";case 1102:return"IssetIntrinsic";case 1103:return"ListIntrinsic";case 1104:return"LogicalExpression";case 1105:return"MemberModifierList";case 1106:return"MemberName";case 1107:return"MethodCallExpression";case 1108:return"MethodDeclaration";case 1109:return"MethodDeclarationBody";case 1110:return"MethodDeclarationHeader";case 1111:return"TraitMethodReference";case 1112:return"MultiplicativeExpression";case 1113:return"NamedLabelStatement";case 1114:return"NamespaceAliasingClause";case 1115:return"NamespaceDefinition";case 1116:return"NamespaceName";case 1117:return"NamespaceUseClause";case 1118:return"NamespaceUseClauseList";case 1119:return"NamespaceUseDeclaration";case 1120:return"NamespaceUseGroupClause";case 1121:return"NamespaceUseGroupClauseList";case 1122:return"NullStatement";case 1123:return"ObjectCreationExpression";case 1124:return"ParameterDeclaration";case 1125:return"ParameterDeclarationList";case 1126:return"PostfixDecrementExpression";case 1127:return"PostfixIncrementExpression";case 1128:return"PrefixDecrementExpression";case 1129:return"PrefixIncrementExpression";case 1130:return"PrintIntrinsic";case 1131:return"PropertyAccessExpression";case 1132:return"PropertyDeclaration";case 1133:return"PropertyElement";case 1134:return"PropertyElementList";case 1135:return"PropertyInitialiser";case 1136:return"QualifiedName";case 1137:return"QualifiedNameList";case 1138:return"RelationalExpression";case 1139:return"RelativeQualifiedName";case 1140:return"RelativeScope";case 1141:return"RequireExpression";case 1142:return"RequireOnceExpression";case 1143:return"ReturnStatement";case 1144:return"ReturnType";case 1145:return"ScopedCallExpression";case 1146:return"ScopedMemberName";case 1147:return"ScopedPropertyAccessExpression";case 1149:return"ShellCommandExpression";case 1148:return"Script";case 1150:return"ShiftExpression";case 1151:return"SimpleAssignmentExpression";case 1152:return"SimpleVariable";case 1153:return"StatementList";case 1154:return"StaticVariableDeclaration";case 1155:return"StaticVariableDeclarationList";case 1156:return"SubscriptExpression";case 1157:return"SwitchStatement";case 1158:return"ThrowStatement";case 1159:return"TraitAdaptationList";case 1160:return"TraitAlias";case 1161:return"TraitDeclaration";case 1162:return"TraitDeclarationBody";case 1163:return"TraitDeclarationHeader";case 1164:return"TraitMemberDeclarationList";case 1165:return"TraitPrecedence";case 1166:return"TraitUseClause";case 1167:return"TraitUseSpecification";case 1168:return"TryStatement";case 1169:return"TypeDeclaration";case 1170:return"UnaryOpExpression";case 1171:return"UnsetIntrinsic";case 1172:return"VariableList";case 1173:return"VariableNameList";case 1174:return"VariadicUnpacking";case 1175:return"WhileStatement";case 1176:return"YieldExpression";case 1177:return"YieldFromExpression";case 1178:return"TopStatementList";default:return""}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(3),r=n(7),s=n(5),o=n(8),a=n(14),c=n(11),d=n(32).html;class l{constructor(e){this.stores=e,this.parseTreeStore=e.parseTreeStore,this._options={}}set options(e){this._options=Object.assign({},e||{})}provideDocumentFormattingEdits(e,t){const n=this.parseTreeStore.find(e);if(!n)return[];if(n.getTraverser().hasEmbeddedLanguage()){const n=this.stores.documentStore.find(e),o=d(n.text,{}),a=new c.Document("virtual",o),l=new s.ParseTree(r.Parser.parse(a.text),a),u=this._provideDocumentFormattingEdits(l,t);for(let e of u)a.applyChange(e.range.start,e.range.end,e.newText);return[i.TextEdit.replace(i.Range.create(i.Position.create(0,0),n.offsetToPosition(n.text.length)),a.text)]}return this._provideDocumentFormattingEdits(n,t)}_provideDocumentFormattingEdits(e,t){const n=new u(e.getNodeUtils(),t);e.traverse(n);const r=n.edits,s=e.getNodeUtils();if(n.firstToken&&156===n.firstToken.kind&&1===n.openTagCount){let e,t=n.last3Tokens.findIndex(this._isCloseTag),o=n.last3Tokens.length?n.last3Tokens[n.last3Tokens.length-1]:void 0,a=s.nodeText(o);if(t<0)o&&163===o.kind&&a.search(l.BLANK_LINE_PATTERN)<0?e=i.TextEdit.replace(s.nodeRange(o),"\n"):o&&163!==o.kind&&(e=i.TextEdit.insert(s.nodeRange(o).end,"\n"));else if(t>0&&(158===o.kind||80===o.kind&&!a.trim())){let a,c=n.last3Tokens[t-1];if(a=163===c.kind?s.nodeRange(c).start:s.nodeRange(n.last3Tokens[t]).start,e=i.TextEdit.replace({start:a,end:s.nodeRange(o).end},"\n"),r.length){let t=r[r.length-1];(t.range.end.line>e.range.start.line||t.range.end.line===e.range.start.line&&t.range.end.character>e.range.start.character)&&r.shift()}}e&&r.unshift(e)}return r}provideDocumentRangeFormattingEdits(e,t,n){if(this.isFullDocumentRange(e,t))return this.provideDocumentFormattingEdits(e,n);let i=this.parseTreeStore.find(e);if(!i)return[];const r=i.getTraverser();if(r.hasEmbeddedLanguage())return this.provideDocumentFormattingEdits(e,n);const s=i.getNodeUtils(),o={start:s.positionToOffset(t.start),end:s.positionToOffset(t.end)};if(!r.seekRange(o.start,o.end))return a.Log.warn(`Format request for ${e} is out of range.`),[];let c=new u(s,n,o);return r.traverse(c),c.edits}_isCloseTag(e){return 158===e.kind}isFullDocumentRange(e,t){if(!t)return!0;const n=this.stores.documentStore.find(e);if(!n)return!1;const i=n.positionToOffset(t.end)===n.text.length;return 0===t.start.line&&0===t.start.character&&i}}l.BLANK_LINE_PATTERN=/^(\r\n|\r|\n)$/,t.FormatProvider=l;class u{constructor(e,t,n){this.nodeUtils=e,this.formatOptions=t,this.startOffset=-1,this.endOffset=1/0,this.lastParameterListWasMultiLine=!1,this.openTagCount=0,this._edits=[],t.insertSpaces?this.indentUnit=" ".repeat(t.tabSize):this.indentUnit="\t",n&&(this.startOffset=n.start,this.endOffset=n.end),this.last3Tokens=[],this.offsetVisitor=new s.OffsetVisitor,this.indentVisitor=new f(t.tabSize,t.insertSpaces,e.clone())}get edits(){return this._edits.reverse()}beforeTraverse(e,t){this.offsetVisitor.beforeTraverse(e,t),this.indentVisitor.beforeTraverse(e,t);const n=t.length>0?t[0]:e;this.firstToken=s.NodeUtils.firstToken(n);let i=s.NodeUtils.lastToken(n);for(i&&1===i.kind&&(i=i.previous),this.last3Tokens=[];i&&this.last3Tokens.length<3;)this.last3Tokens.unshift(i),i=i.previous}preorder(e,t){if(this.indentVisitor.preorder(e,t),this.offsetVisitor.preorder(e,t),t.length<1)return!0;const n=t[t.length-1],s=t.length>1?t[t.length-2]:void 0,o=this.nodeUtils.getLeadingTrivia(e);if(r.isPhrase(e)&&(!e.children||e.children.length<1))return!1;switch(e.kind){case 1125:case 1008:case 1036:case 1011:case 1121:case 1070:return this.indentVisitor.isIndentRoot(e)?this.nextFormatRule=h.newlineIndentBefore:this.nextFormatRule=h.noSpaceBefore,!0;case 1137:return this.indentVisitor.isIndentRoot(e)&&(this.nextFormatRule=h.newlineIndentBefore),!0;case 1044:case 1027:case 1134:case 1155:case 1173:case 1118:return this.nextFormatRule=h.singleSpaceOrNewlineIndentBefore,!0;case 1059:return this.nextFormatRule=h.noSpaceBefore,!0;case 1014:case 1065:case 1150:case 1104:case 1060:case 1001:case 1037:case 1138:case 1112:return this.isControlStructureWithEncapsulatedExpr(n)&&this.indentVisitor.isIndentRoot(e)&&(this.nextFormatRule=h.newlineIndentBefore),!0;default:if(r.isPhrase(e))return 1059===n.kind&&(this.nextFormatRule=h.noSpaceBefore),!0}if(this.offsetVisitor.offset>this.endOffset)return!1;if(this.offsetVisitor.offset+e.length<this.startOffset)return!1;let a=this.nextFormatRule;const c=o.length>0?o[0].token.previous:e.previous,d=o.length>0?o[o.length-1]:void 0;if(156!==e.kind&&157!==e.kind||this.openTagCount++,this.nextFormatRule=void 0,!c)return!1;let l=this.indentVisitor.indentText,u=this.shouldIncrementIndentTrivia(e,n);u&&(l+=this.indentUnit.repeat(u));let f=this.formatTrivia(o,l);switch(e.kind){case 134:1127===n.kind&&(a=f||h.noSpaceBefore);break;case 128:1126===n.kind&&(a=f||h.noSpaceBefore);break;case 146:1116===n.kind&&(a=f||h.noSpaceBefore);break;case 83:89===c.kind&&(a=f||h.noSpaceBefore);break;case 87:case 92:case 80:case 79:case 130:case 127:case 156:case 157:a=f||h.noSpaceBefore;break;case 115:1029===n.kind||1162===n.kind||1099===n.kind?a=h.newlineIndentBefore:1082===n.kind||s&&1109===s.kind?this.lastParameterListWasMultiLine||s&&(1002===s.kind||1004===s.kind)?(a=f||h.singleSpaceBefore,this.lastParameterListWasMultiLine=!1):a=h.newlineIndentBefore:89===c.kind?a=f||h.noSpaceBefore:a&&!f||(a=f||h.singleSpaceBefore);break;case 86:this.isControlStructure(n)?a=f||h.singleSpaceBefore:1040===n.kind&&95!==c.kind||(a=f||h.noSpaceBefore);break;case 17:case 18:118===c.kind&&(a=f||h.singleSpaceBefore);break;case 82:1131!==n.kind&&146!==c.kind||(a=f||h.noSpaceBefore);break;case 66:1050===n.kind&&118===c.kind&&(a=f||h.singleSpaceBefore);break;case 8:case 30:a=f||h.singleSpaceBefore;break;case 114:case 132:a=h.noSpaceOrNewlineIndentBefore;break;case 117:this._shouldOpenParenthesisHaveNoSpaceBefore(n,c)?a=f||h.noSpaceBefore:a&&!f||(a=f||h.singleSpaceBefore);break;case 116:1156===n.kind&&(a=f||h.noSpaceBefore);break;case 118:if(1156===n.kind||1057===n.kind||1058===n.kind)a=f||h.noSpaceBefore;else{const t=this.previousNonTriviaToken(e);a=t&&115===t.kind?f||h.singleSpaceBefore:h.singleNewlineIndentBefore}break;case 119:case 120:(!a||f||1078===n.kind&&!this.indentVisitor.isIndentRoot(n.children[2]))&&(a=f||h.noSpaceBefore);break;case 158:d&&160===d.token.kind?a=h.noSpaceBefore:a!==h.indentOrNewLineIndentBefore&&(a=h.spaceOrNewlineIndentBefore);break;default:1059===n.kind&&(a=h.noSpaceBefore)}a||(a=h.spaceOrNewlineIndentBefore);let p=a(d,i.Range.create(this.nodeUtils.offsetToPosition(this.offsetVisitor.offset),this.nodeUtils.offsetToPosition(this.offsetVisitor.offset+e.length)),this.indentVisitor.indentText,this.indentUnit);if(p&&this._edits.push(p),r.isKeyword(e.kind)){let t=this.nodeUtils.nodeText(e),n=t.toLowerCase();t!==n&&this._edits.push(i.TextEdit.replace(this.nodeUtils.nodeRange(e),n))}else if(this.isReservedName(e,t)){let t=this.nodeUtils.nodeText(e),n=t.toLowerCase();t!==n&&this._edits.push(i.TextEdit.replace(this.nodeUtils.nodeRange(e),n))}return!0}postorder(e,t){if(this.indentVisitor.postorder(e,t),this.offsetVisitor.postorder(e,t),t.length<1)return;const n=t[t.length-1];switch(e.kind){case 1115:return void(this.nextFormatRule=h.doubleNewlineIndentBefore);case 1119:return void(this._isLastNamespaceUseDeclaration(n,e)&&(this.nextFormatRule=h.doubleNewlineIndentBefore));case 1014:case 1065:case 1150:case 1104:case 1060:case 1001:case 1037:case 1138:case 1112:return void(this.isControlStructureWithEncapsulatedExpr(n)&&this.indentVisitor.isIndentRoot(e)&&(this.nextFormatRule=h.newlineIndentBefore));case 1125:return void(this.indentVisitor.isIndentRoot(e)&&(this.lastParameterListWasMultiLine=!0,this.nextFormatRule=h.newlineIndentBefore));case 1008:case 1036:case 1137:case 1011:case 1070:return void(this.indentVisitor.isIndentRoot(e)&&(this.nextFormatRule=h.newlineIndentBefore));case 1059:return void(this.nextFormatRule=h.noSpaceBefore);case 1004:this.nextFormatRule=void 0;break;case 115:1057===n.kind?this.nextFormatRule=h.noSpaceBefore:this.nextFormatRule=h.newlineIndentBefore;break;case 118:1058!==n.kind&&1057!==n.kind&&1156!==n.kind&&(this.nextFormatRule=h.newlineIndentBefore);break;case 87:1070!==n.kind||this.indentVisitor.isIndentRoot(n)?this.nextFormatRule=h.newlineIndentBefore:this.nextFormatRule=h.singleSpaceBefore;break;case 86:this.shouldIndentAfterColon(t[t.length-1])?this.nextFormatRule=h.newlineIndentBefore:this.isControlStructure(n)||(this.nextFormatRule=h.singleSpaceBefore);break;case 102:1014!==n.kind&&(this.nextFormatRule=h.noSpaceBefore);break;case 110:case 142:1170===n.kind&&(this.nextFormatRule=h.noSpaceBefore);break;case 134:1129===n.kind&&(this.nextFormatRule=h.noSpaceBefore);break;case 128:1128===n.kind&&(this.nextFormatRule=h.noSpaceBefore);break;case 133:case 88:case 93:case 155:case 147:case 152:case 151:case 150:case 149:case 148:case 85:case 146:case 117:case 116:this.nextFormatRule=h.noSpaceBefore;break;case 127:case 130:this.nextFormatRule=h.noSpaceBefore;break;case 92:1011===n.kind||1044===n.kind||1027===n.kind||1134===n.kind||1155===n.kind||1173===n.kind?this.nextFormatRule=h.spaceOrNewlineIndentBefore:this.indentVisitor.isIndentRoot(n)&&(this.nextFormatRule=h.newlineIndentBefore);break;case 114:case 132:this.nextFormatRule=h.noSpaceBefore;break;case 156:{const t=this.nodeUtils.nodeText(e);if(t.length>2){h.countNewlines(t)>0?this.nextFormatRule=h.indentOrNewLineIndentBefore:"="===t.slice(-1)?this.nextFormatRule=h.spaceOrNewlineIndentBefore:this.nextFormatRule=h.noSpaceOrNewlineIndentBefore;break}this.nextFormatRule=h.singleSpaceOrNewlineIndentBefore;break}case 157:this.nextFormatRule=h.singleSpaceOrNewlineIndentBefore}}isControlStructure(e){switch(e.kind){case 1091:case 1053:case 1054:case 1175:case 1050:case 1078:case 1073:return!0;default:return!1}}isControlStructureWithEncapsulatedExpr(e){switch(e.kind){case 1091:case 1054:case 1175:case 1050:return!0;default:return!1}}previousNonTriviaToken(e){for(;(e=e.previous)&&s.NodeUtils.isTrivia(e););return e}shouldIncrementIndentTrivia(e,t){switch(e.kind){case 118:return 1157===t.kind?2:1;case 120:case 119:case 7:case 14:case 87:return 1;default:return 0}}formatTrivia(e,t){let n,i,r,s;for(let o=0;o<e.length;++o)switch(n=e[o].token,s=o>0&&163===e[o-1].token.kind?e[o-1]:void 0,n.kind){case 162:(i=h.newlineIndentBefore(s,this.nodeUtils.nodeRange(n),t,this.indentUnit))&&this._edits.push(i),(i=this._formatDocBlock(n))&&this._edits.push(i),r=h.newlineIndentBefore;break;case 160:(i=(r=r||h.spaceOrNewlineIndentBefore)(s&&163===s.token.kind?s:void 0,this.nodeUtils.nodeRange(n),t,this.indentUnit))&&this._edits.push(i),r=h.newlineIndentBefore;break;case 161:(i=(r=r||h.spaceOrNewlineIndentBefore)(s,this.nodeUtils.nodeRange(n),t,this.indentUnit))&&this._edits.push(i),(i=this.formatInlineComment(n))&&this._edits.push(i),r=void 0}return r}isReservedName(e,t){let n=t.length?t[t.length-1]:void 0,i=t.length>2?t[t.length-3]:void 0;return s.NodeUtils.isTokenOfKind(e,[82])&&s.NodeUtils.isPhraseOfKind(n,[1116])&&1===n.children.length&&s.NodeUtils.isPhraseOfKind(i,[1041])&&o.PHP.isReservedName(this.nodeUtils.nodeText(e).toLowerCase())}formatInlineComment(e){}_formatDocBlock(e){let t=this.nodeUtils.nodeText(e),n=t.replace(u.DOCBLOCK_REPLACE_PATTERN,"\n"+this.indentVisitor.indentText+" *");return n!==t?i.TextEdit.replace(this.nodeUtils.nodeRange(e),n):null}_isLastNamespaceUseDeclaration(e,t){let n=e.children.indexOf(t);for(;n<e.children.length;)if(++n,(t=e.children[n]).kind)return 1119!==t.kind;return!0}shouldIndentAfterColon(e){switch(e.kind){case 1017:case 1049:return!0;default:return!1}}_shouldOpenParenthesisHaveNoSpaceBefore(e,t){switch(e.kind){case 1080:case 1107:case 1145:case 1052:case 1056:case 1063:case 1064:case 1102:case 1103:case 1130:case 1171:case 1009:case 1083:case 1110:case 1123:case 1141:case 1142:case 1092:case 1093:return!0;default:if(!t)return!1}switch(t.kind){case 55:case 56:case 39:case 40:case 44:case 45:case 51:case 63:case 26:case 27:case 19:return!0;default:return!1}}getLineComment(e){if(e.length<1)return;const t=e[e.length-2];return 160===t.kind?t:void 0}}var h;u.DOCBLOCK_REPLACE_PATTERN=/(?:\r\n|\r|\n)[ \t]*\*/g,function(e){const t=/\t/g;function n(e){let t,n=0,i=e.length,r=0;for(;r<i;)t=e[r],++r,"\r"===t?(++n,r<i&&"\n"===e[r]&&++r):"\n"===t&&++n;return n}e.singleSpaceBefore=function(e,t,n,r){return e?" "!==e.text?i.TextEdit.replace(e.range," "):void 0:i.TextEdit.insert(t.start," ")},e.spaceBefore=function(e,r,s,o){if(!e)return i.TextEdit.insert(r.start," ");if(n(e.text)>0)return i.TextEdit.replace(e.range," ");const a=e.text.replace(t,o);return a===e.text?void 0:i.TextEdit.replace(e.range,a)},e.indentBefore=function(e,t,n,r){return e?n?e.text!==n?i.TextEdit.replace(e.range,n):void 0:i.TextEdit.del(e.range):n?i.TextEdit.insert(t.start,n):void 0},e.indentOrNewLineIndentBefore=function(e,t,r,s){if(!e)return r?i.TextEdit.insert(t.start,r):void 0;let o=e.text,a=n(o);if(a){let t="\n".repeat(Math.max(1,a))+r;if(o===t)return;return i.TextEdit.replace(e.range,t)}return r?o!==r?i.TextEdit.replace(e.range,r):void 0:i.TextEdit.del(e.range)},e.newlineIndentBefore=function(e,t,r,s){if(!e)return i.TextEdit.insert(t.start,"\n"+r);let o=e.text,a="\n".repeat(Math.max(1,n(o)))+r;return o!==a?i.TextEdit.replace(e.range,a):void 0},e.singleNewlineIndentBefore=function(e,t,n,r){if(!e)return i.TextEdit.insert(t.start,"\n"+n);let s="\n"+n;return e.text!==s?i.TextEdit.replace(e.range,s):void 0},e.doubleNewlineIndentBefore=function(e,t,r,s){if(!e)return i.TextEdit.insert(t.start,"\n\n"+r);let o=e.text,a="\n".repeat(Math.max(2,n(o)))+r;return o!==a?i.TextEdit.replace(e.range,a):void 0},e.noSpaceBefore=function(e,t,n,r){if(e)return i.TextEdit.del(e.range)},e.noSpaceOrNewlineIndentBefore=function(e,t,r,s){if(!e)return;let o=e.text,a=n(o);if(!a)return i.TextEdit.del(e.range);let c="\n".repeat(a)+r;return o!==c?i.TextEdit.replace(e.range,c):void 0},e.singleSpaceOrNewlineIndentBefore=function(e,t,r,s){if(!e)return i.TextEdit.insert(t.start," ");let o=e.text;if(" "===o)return;let a=n(o);if(!a)return i.TextEdit.replace(e.range," ");let c="\n".repeat(a)+r;return o!==c?i.TextEdit.replace(e.range,c):void 0},e.spaceOrNewlineIndentBefore=function(e,r,s,o){if(!e)return i.TextEdit.insert(r.start," ");let a=e.text;if(" "===a)return;let c=n(a);if(!c){let n=e.text.replace(t,o);return n===e.text?void 0:i.TextEdit.replace(e.range,n)}let d="\n".repeat(c)+s;return a!==d?i.TextEdit.replace(e.range,d):void 0},e.countNewlines=n}(h||(h={}));class f{constructor(e,t,n,i){this.tabSize=e,this.useSpaces=t,this.nodeUtils=n,this.indentRootSet=new Set,this.useSpaces?this.indentUnit=" ".repeat(this.tabSize):this.indentUnit="\t",this._indentText=i?this.indentUnit.repeat(i):""}get indentText(){return this._indentText}isIndentRoot(e){return this.indentRootSet.has(e)}beforeTraverse(e,t){let n,i;(t=t.slice(0)).push(e);for(let r=1,s=t.length;r<s;++r){if(n=t[r],1153!==(i=t[t.length-1]).kind&&1178!==i.kind||this.isInlineTextWithOpenTag(e)||this.isEchoIntrinsicWithOpenTagEcho(e)||this.onStatementListChild(e,t),this.isEchoIntrinsicWithOpenTagEcho(i)&&e!==i.children[0]){const e=this.computeIndentSizeFromOpenTag(i.children[0],t,this.tabSize);this._indentText=this.indentUnit.repeat(e)}if(n!==e){const e=t.slice(0,r);this.preorder(n,e)}}}preorder(e,t){if(t.length<1)return!0;const n=t[t.length-1];switch(e.kind){case 1032:case 1164:case 1101:case 1018:case 1153:this.indentRootSet.add(e),this.increment();break;case 156:case 157:{const n=this.computeIndentSizeFromOpenTag(e,t,this.tabSize);this._indentText=this.indentUnit.repeat(n)}break;case 1125:case 1008:case 1036:case 1137:case 1044:case 1027:case 1134:case 1155:case 1173:case 1118:case 1121:case 1070:case 1011:{const n=[...t,e];if(e.children.length>0&&(this.hasChildWithLeadingWhitespaceNewline(n)||this.hasTrailingWhitespaceNewline(n)))return this.indentRootSet.add(e),this.increment(),!0}break;case 1014:case 1065:case 1150:case 1104:case 1060:case 1001:case 1037:case 1138:case 1112:if(this.isControlStructureWithEncapsulatedExpr(n)&&this.hasBinaryExprDescendentWithLeadingWhitespaceNewline([...t,e]))return this.indentRootSet.add(e),this.increment(),!0;break;default:if(r.isToken(e)&&this.hasLeadingWhitespaceNewline(this.nodeUtils.getLeadingTrivia(e))){const n=this.getIndentRootNode(e,t);n&&!this.indentRootSet.has(n)&&(this.indentRootSet.add(n),this.increment())}}return!0}postorder(e,t){this.indentRootSet.has(e)&&this.decrement()}isControlStructureWithEncapsulatedExpr(e){switch(e.kind){case 1091:case 1054:case 1175:case 1050:return!0;default:return!1}}isBinaryExpr(e){switch(e.kind){case 1014:case 1065:case 1150:case 1104:case 1060:case 1001:case 1037:case 1138:case 1112:return!0;default:return!1}}isList(e){switch(e.kind){case 1125:case 1008:case 1036:case 1011:case 1137:case 1044:case 1027:case 1134:case 1155:case 1173:case 1118:case 1121:case 1153:case 1032:case 1164:case 1101:case 1018:case 1070:case 1066:return!0;default:return!1}}hasTrailingWhitespaceNewline(e){const t=new s.ParseTreeTraverser(e,this.nodeUtils);return t.nextSibling()&&this.hasLeadingWhitespaceNewline(this.nodeUtils.getLeadingTriviaFromSpine(t.spine))}hasChildWithLeadingWhitespaceNewline(e){let t,n,i;const r=e[e.length-1];for(let s=0,o=r.children.length;s<o;++s)if(t=r.children[s],i=[...e,t],n=this.nodeUtils.getLeadingTriviaFromSpine(i),this.hasLeadingWhitespaceNewline(n))return!0;return!1}hasBinaryExprDescendentWithLeadingWhitespaceNewline(e){const t=[e];let n,i,r;if(this.hasTrailingWhitespaceNewline(e))return!0;for(;e=t.shift();){r=e[e.length-1];for(let s of r.children){if(i=[...e,s],n=this.nodeUtils.getLeadingTriviaFromSpine(i),this.hasLeadingWhitespaceNewline(n))return!0;this.isBinaryExpr(s)&&t.push(i)}}}hasLeadingWhitespaceNewline(e){let t;for(let n=0,i=e.length;n<i;++n)if(163===(t=e[n]).token.kind&&h.countNewlines(t.text)>0)return!0;return!1}increment(){this._indentText+=this.indentUnit}decrement(){this._indentText=this._indentText.slice(0,-this.indentUnit.length)}isEchoIntrinsicWithOpenTagEcho(e){return 1052===e.kind&&157===e.children[0].kind}isInlineTextWithOpenTag(e){return 1094===e.kind&&156===e.children[e.children.length-1].kind}computeIndentSizeFromOpenTag(e,t,n){(t=t.slice(0)).push(e);const r=this.nodeUtils.nodeRangeFromSpine([...t,e]);let s=this.nodeUtils.rangeText(i.Range.create(r.start.line,0,r.start.line,r.start.character));return s=s.replace(/\t/g," ".repeat(n)),Math.ceil(s.length/n)}onStatementListChild(e,t){const n=t[t.length-1];let i,r;for(let t=0,s=n.children.length;t<s&&(i=n.children[t])!==e;++t)(this.isInlineTextWithOpenTag(i)||this.isEchoIntrinsicWithOpenTagEcho(i))&&(r=i);if(!r)return;const s=1094===r.kind?r.children.length-1:0,o=r.children[s],a=this.computeIndentSizeFromOpenTag(o,[...t,r],this.tabSize);this._indentText=this.indentUnit.repeat(a)}getIndentRootNode(e,t){switch(e.kind){case 87:case 120:case 118:case 119:return}let n=(t=t.slice(0)).pop(),i=e;for(;n&&!this.isList(n)&&n.children[0]===i;)i=n,n=t.pop();if(n){if(this.isList(n))return n;if(1020===n.kind)return 83===i.kind?i:void 0;if(this.isStatementWithEncapsulatedExpression(n)){const e=n.children.findIndex(e=>e===i),t=n.children.findIndex(e=>117===e.kind),r=n.children.findIndex(e=>120===e.kind);if(e>t&&e<r)return i}if(this.isEncapsulatedExpression(n)){const e=n.children.findIndex(e=>e===i),t=n.children.findIndex(e=>117===e.kind||115===e.kind),r=n.children.findIndex(e=>120===e.kind||118===e.kind);return e>t&&e<r?i:void 0}if(this.isKeywordExpressionStatement(n))return n.children[1]===i&&87!==i.kind?i:void 0;if(1156===n.kind){const e=n.children.findIndex(e=>e===i),t=n.children.findIndex(e=>116===e.kind||115===e.kind),r=n.children.findIndex(e=>119===e.kind||118===e.kind);return e>t&&e<r?i:void 0}if(this.isBinaryOrKeywordExpression(n)){do{i=n,n=t.pop()}while(n&&this.isBinaryOrKeywordExpression(n));return i}if(this.isControlStmt(n)){const e=n.children.indexOf(i);if(e>0)switch(n.children[e-1].kind){case 120:case 15:case 17:return i}}}}isControlStmt(e){switch(e.kind){case 1078:case 1073:case 1050:case 1175:case 1091:case 1054:case 1053:return!0;default:return!1}}isKeywordExpressionStatement(e){switch(e.kind){case 1015:case 1045:case 1158:case 1143:case 1087:return!0;default:return!1}}isEncapsulatedExpression(e){switch(e.kind){case 1056:case 1063:case 1064:case 1057:return!0;default:return!1}}isStatementWithEncapsulatedExpression(e){switch(e.kind){case 1047:case 1050:case 1054:case 1073:case 1091:case 1157:case 1175:return!0;default:return!1}}isBinaryOrKeywordExpression(e){switch(e.kind){case 1001:case 1014:case 1016:case 1037:case 1038:case 1060:case 1065:case 1095:case 1104:case 1107:case 1112:case 1131:case 1138:case 1145:case 1147:case 1150:case 1151:case 1040:case 1035:case 1123:case 1130:case 1141:case 1142:case 1092:case 1093:case 1176:case 1177:return!0;default:return!1}}}t.IndentVisitor=f},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),s=n(4),o=n(5),a=n(9);var c;!function(e){e.fromUriIdAndNameSet=function(e,t){const n=[e];for(let e of t.values())n.push(a.hash32(e));return n},e.uriId=function(e){return e[0]},e.hashedNames=function(e){return e.slice(1)}}(c=t.HashedReferenceNames||(t.HashedReferenceNames={}));t.ReferenceStore=class{constructor(e){this.getParseTreeDelegate=e,this.hashedReferenceNameToUriIdMap=new Map,this.uriIdToHashedReferenceNamesMap=new Map}findHashedReferenceNames(e){return"string"==typeof e&&(e=s.UriMap.id(e)),this.uriIdToHashedReferenceNamesMap.get(e)}addHashedReferenceNames(e){const t=c.uriId(e),n=c.hashedNames(e);let i;this.removeHashedReferenceNames(t),this.uriIdToHashedReferenceNamesMap.set(t,e);for(let e=0,r=n.length;e<r;++e)i=n[e],this.hashedReferenceNameToUriIdMap.has(i)?this.hashedReferenceNameToUriIdMap.get(i).add(t):this.hashedReferenceNameToUriIdMap.set(i,new Set([t]));return e}removeHashedReferenceNames(e){"string"==typeof e&&(e=s.UriMap.id(e));const t=this.uriIdToHashedReferenceNamesMap.get(e);if(void 0===t)return;this.uriIdToHashedReferenceNamesMap.delete(e);const n=c.hashedNames(t);let i,r;for(let t=0,s=n.length;t<s;++t)i=n[t],(r=this.hashedReferenceNameToUriIdMap.get(i))&&(1===r.size?this.hashedReferenceNameToUriIdMap.delete(i):r.delete(e));return t}find(e,t,n){return i(this,void 0,void 0,function*(){if(!e)return[];let i=a.hash32(e.toLowerCase()),r=this.hashedReferenceNameToUriIdMap.get(i);const s=this.createReferencePredicate(e,t),c=[];let d;for(let e of r.values()){if(n&&n.isCancellationRequested)break;if(d=yield this.getParseTreeDelegate(e)){const e=new o.ReferencesVisitor(d.nodeReferenceMap,d.nodeDocBlockReferenceMap,d.getNodeUtils(),s);Array.prototype.push.apply(c,d.traverse(e).references)}}return c})}restoreState(e){this.hashedReferenceNameToUriIdMap=new Map(e._index),this.uriIdToHashedReferenceNamesMap=new Map(e._referenceNames)}getState(){return{_index:Array.from(this.hashedReferenceNameToUriIdMap.entries()),_referenceNames:Array.from(this.uriIdToHashedReferenceNamesMap.entries())}}clear(){this.hashedReferenceNameToUriIdMap=new Map,this.uriIdToHashedReferenceNamesMap=new Map}createReferencePredicate(e,t){const n=e.toLowerCase();return i=>(r.Definition.isCaseSensitive(i.kind)&&(e===i.name||8===i.kind&&i.unresolvedName===e)||!r.Definition.isCaseSensitive(i.kind)&&(n===i.name.toLowerCase()||64===i.kind&&i.unresolvedName&&i.unresolvedName.toLowerCase()===n))&&(!t||t(i))}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=n(1),s=n(4),o=n(20),a=n(38),c=n(39),d=n(6),l=n(2),u=n(0),h=n(7);class f{constructor(e,t,n,i){this.definition=e,this.summary=t,this.description=n,this.tags=i}inherit(e){switch(this.definition.kind){case 1:this.classInherit(e);break;case 2:this.interfaceInherit(e);break;case 16:this.propertyInherit(e);break;case 1024:this.classConstInherit(e);break;case 32:this.methodInherit(e)}}interfaceInherit(e){2===e.definition.kind&&(this.inheritCommon(e),this.inheritTagKind(e,1019))}classConstInherit(e){1024===e.definition.kind&&(this.inheritCommon(e),this.inheritVar(e))}propertyInherit(e){16===e.definition.kind&&(this.inheritCommon(e),this.inheritVar(e))}methodInherit(e){32!==e.definition.kind&&2048!==e.definition.kind||(this.inheritCommon(e),this.inheritTagKind(e,1010),this.inheritTagKind(e,1009),this.inheritParams(e))}inheritVar(e){const t=this.definition.name,n=e=>1008===e.kind&&(!e.elementName||e.elementName===t);let i=this.tags.find(n);i||(i=e.tags.find(n))&&this.tags.push(i)}inheritParams(e){const t=this.tags.filter(e=>1007===e.kind),n=new Map(t.map(e=>[e.elementName,e])),i=e.tags.filter(e=>1007===e.kind);let r;for(let e=0;e<i.length;++e)(r=i[e]).elementName&&!n.has(r.elementName)&&this.tags.push(r)}classInherit(e){1===e.definition.kind&&(this.inheritCommon(e),this.inheritTagKind(e,1019))}inheritCommon(e){!this.summary&&e.summary&&(this.summary=e.summary),!this.description&&e.description?this.description=e.description:e.description&&this.description&&this.description.text.replace(f.INLINE_INHERITDOC_PATTERN,e.description.text);const t=f.INHERITDOC_COMMON_TAG_KINDS;for(let n=0,i=t.length;n<i;++n)this.inheritTagKind(e,t[n])}inheritTagKind(e,t){const n=e=>e.kind===t,i=this.tags.find(n),r=e.tags.filter(n);!i&&r.length>0&&Array.prototype.push.apply(this.tags,r)}}f.INLINE_INHERITDOC_PATTERN=/\{@inheritdoc\}/i,f.INHERITDOC_COMMON_TAG_KINDS=[1016,1015,1017],t.Documentation=f;t.DocumentationFormatter=class{constructor(e){this.definitionStore=e}format(e){let t=[];384&e.definition.kind||t.push(this.title(e.definition)),e.summary&&t.push(e.summary.text);const n=this.signature(e);n&&t.push(n),e.description&&t.push(e.description.text);const i=e.tags.sort((e,t)=>e.kind-t.kind);return i.length&&t.push(i.map(e=>e.text).join("\n\n")),t.join("\n\n")}signature(e){switch(e.definition.kind){case 512:return this.namespaceSignature(e);case 1:return this.classSignature(e);case 2:return this.interfaceSignature(e);case 4:return this.traitSignature(e);case 8:case 1024:return this.constantSignature(e);case 64:return this.functionSignature(e);case 16:return this.propertySignature(e);case 32:case 2048:return this.methodSignature(e);default:return""}}namespaceSignature(e){return"```php\n<?php\nnamespace "+e.definition.name+";\n```"}constantSignature(e){const t=e.definition,n=e.typeAndValue&&void 0!==e.typeAndValue.value?e.typeAndValue.value:t.value,i=e.typeAndValue&&e.typeAndValue.type?e.typeAndValue.type:r.Definition.type(t);let s="";l.TypeString.isArray(i)?s="[]":void 0!==n&&(s="string"==typeof n?"'"+n+"'":n.toString());let o=this.signatureModifiers(t);return o&&(o+=" "),"```php\n<?php\n"+o+"const "+r.Definition.shortName(t.name)+" = "+s+";\n```"}propertySignature(e){const t=e.definition;let n=[];const i=this.signatureModifiers(t);return i&&n.push(i),n.push(t.name),"```php\n<?php\n"+n.join(" ")+";\n```"}functionSignature(e){const t=e.definition;let n=r.Definition.shortName(t.name);(1024&t.modifiers)>0&&(n="&"+n);let i="function "+n+"(",s=this.definitionStore.table(t.uriId).definitionChildren(t).filter(r.Definition.isParameter);if(i+=this.functionSignatureParams(s),i+=")",t.type&&t.type.declared){let e=l.TypeString.toString(t.type.declared);(32768&t.modifiers)>0&&(e="?"+e),i+=": "+e}return"```php\n<?php\n"+i+" { }\n```"}signatureModifiers(e){let t=[];return(8&e.modifiers)>0&&t.push("final"),(16&e.modifiers)>0&&t.push("abstract"),(1&e.modifiers)>0&&t.push("public"),(2&e.modifiers)>0&&t.push("protected"),(4&e.modifiers)>0&&t.push("private"),8!==e.kind&&1024!==e.kind&&(32&e.modifiers)>0&&t.push("static"),t.join(" ")}methodSignature(e){const t=e.definition;let n=[],i=this.signatureModifiers(t);i&&n.push(i);let s=r.Definition.shortName(t.name)+"(";(1024&t.modifiers)>0&&(s="&"+s),n.push("function",s);let o=n.join(" "),a=this.definitionStore.table(t.uriId),c=t instanceof d.MethodDefinition?t.parameters:a.definitionChildren(t).filter(r.Definition.isParameter);if(o+=this.functionSignatureParams(c),o+=")",t.type&&t.type.declared){let e=l.TypeString.toString(t.type.declared);(32768&t.modifiers)>0&&(e="?"+e),o+=": "+e}return"```php\n<?php\n"+o+" { }\n```"}functionSignatureParams(e){return e.length>1?"\n    "+e.map(e=>this.functionSignatureParam(e)).join(",\n    ")+"\n":1===e.length?this.functionSignatureParam(e[0]):""}functionSignatureParam(e){let t=[];e.type&&e.type.declared&&t.push(l.TypeString.toTypeDeclarationString(e.type.declared,e));let n=e.name;return(2048&e.modifiers)>0&&(n="..."+n),(1024&e.modifiers)>0&&(n="&"+n),t.push(n),void 0!==e.value&&t.push("=",e.value.toString()),t.join(" ")}classSignature(e){const t=e.definition;let n=[];(16&t.modifiers)>0&&n.push("abstract"),(8&t.modifiers)>0&&n.push("final"),n.push("class",r.Definition.shortName(t.name));const i=r.Definition.findAssociated(t,e=>1===e.kind);i&&n.push("extends",i.name);const s=r.Definition.filterAssociated(t,e=>2===e.kind);s.length>0?(n.push("implements"),s.length>1?n=[n.join(" ")+"\n    "+s.map(e=>e.name).join(",\n    ")]:(n.push(s[0].name),n=[n.join(" ")])):n=[n.join(" ")];const o=r.Definition.filterAssociated(t,e=>4==e.kind);return o.length?(n.push("{"),n.push("    use "+o.map(e=>e.name).join(",\n        ")+";"),n.push("}")):n.push("{ }"),"```php\n<?php\n"+n.join("\n")+"\n```"}traitSignature(e){const t=e.definition;let n=[];n.push("trait "+r.Definition.shortName(t.name));const i=r.Definition.filterAssociated(t,e=>4==e.kind);return i.length?(n.push("{"),n.push("    use "+i.map(e=>e.name).join(",\n        ")+";"),n.push("}")):n.push("{ }"),"```php\n<?php\n"+n.join("\n")+"\n```"}interfaceSignature(e){const t=e.definition;let n=[];n.push("interface "+r.Definition.shortName(t.name));const i=r.Definition.filterAssociated(t,e=>2===e.kind);return 1===i.length?n.push("extends "+i[0].name):i.length>1&&n.push("extends\n    "+i.map(e=>e.name).join(",\n    ")),"```php\n<?php\n"+n.join(" ")+"\n{ }\n```"}title(e){let t="";switch(e.kind){case 1024:case 32:case 16:case 2048:{const n=this.definitionStore.table(s.DocumentStore.uri(e.uriId)).get(e.scope);t=(n?n.name:"")+"::"+e.name}break;default:t=e.name}return"__"+(t=m.toMarkdown(t))+"__"}};t.DocumentationService=class{constructor(e,t,n){this.getParseTreeDelegate=e,this.definitionStore=t,this.typeAndValueDelegate=n}getDocumentation(e,t){return i(this,void 0,void 0,function*(){if(!e)return;let n,i=e;switch(e.kind){case 128:{const t=this.definitionStore.table(e.uriId);e=t.definitionScope(e),n=yield this._getDocumentation(e)}break;case 1:n=yield this.classDocumentation(e,t);break;case 2:n=yield this.interfaceDocumentation(this.getTypeDefinition(e),t);break;case 32:case 16:if((256&e.modifiers)>0){const t=yield this.getPhpDoc(this.getTypeDefinition(e));if(t){const i=t.tags.find(t=>this.isMagicTag(t)&&t.elementName.text===e.name);n=i&&i.description?new f(e,void 0,{kind:1003,text:i.description.toString()},[]):new f(e,void 0,void 0,[])}else n=new f(e,void 0,void 0,[]);break}case 2048:case 1024:d.ComplexDefinition.isComplexDefinition(e)||(e=d.MemberDefinition.fromDefinition(e,this.definitionStore)),(n=yield this.memberDocumentation(e,t))?n.definition=e:n=new f(e,void 0,void 0,[]);break;default:n=yield this._getDocumentation(e)}if(n||(n=new f(e,void 0,void 0,[])),(2144&e.kind)>0?(this.ensureReturnTag(e,n),this.ensureParameterTags(e,n)):(16&e.kind)>0&&this.ensureVarTag(e,n),i!==n.definition&&128===i.kind){const e=n.tags.find(e=>e.elementName===i.name);n=new f(i,void 0,void 0,e?[e]:[])}return n})}isMagicTag(e){switch(e.kind){case 1024:case 1021:case 1022:case 1023:return!0;default:return!1}}ensureReturnTag(e,t){if(t.tags.find(e=>1009===e.kind))return;t.typeAndValue=this.typeAndValueDelegate(e);const n=t.typeAndValue.type||l.TypeString.VOID_TYPE_STRING;t.tags.push({kind:1009,text:`_@return_ \`${l.TypeString.toString(n)}\``})}ensureVarTag(e,t){if(t.tags.find(t=>1008===t.kind&&(!t.elementName||t.elementName===e.name)))return;t.typeAndValue=this.typeAndValueDelegate(e);const n=t.typeAndValue.type||l.TypeString.MIXED_TYPE_STRING;t.tags.push({kind:1008,text:`_@var_ \`${l.TypeString.toString(n)} ${e.name}\``})}ensureParameterTags(e,t){const n=e instanceof d.MethodDefinition?e.parameters:this.definitionStore.table(e.uriId).definitionChildren(e).filter(r.Definition.isParameter),i=t.tags.filter(e=>1007===e.kind),s=new Map(i.map(e=>[e.elementName,e]));let o,a,c=l.TypeString.fromString("mixed");for(let e=0;e<n.length;++e)o=n[e],(a=r.Definition.type(o))||void 0===o.value?a||(a=c):a=this.typeAndValueDelegate(o).type||l.TypeString.MIXED_TYPE_STRING,!s.has(o.name)&&a&&t.tags.push({kind:1007,text:`_@param_ \`${l.TypeString.toString(a)} ${o.name}\``,elementName:o.name})}classDocumentation(e,t){return i(this,void 0,void 0,function*(){let n,i,r=this.getTypeDefinition(e),s=[];for(;r;)s.push(r),r=r.baseClass;for(;(r=s.pop())&&!t.isCancellationRequested;)i=yield this._getDocumentation(r.definition),n&&i.inherit(n),n=i;return i})}interfaceDocumentation(e,t){return i(this,void 0,void 0,function*(){const n=e.interfaces;let i,r,s=yield this._getDocumentation(e.definition);for(let e=0;e<n.length&&!t.isCancellationRequested;++e)i=n[e],r=yield this.interfaceDocumentation(i,t),s.inherit(r);return s})}memberDocumentation(e,t){return i(this,void 0,void 0,function*(){if(!t.isCancellationRequested){if(e instanceof d.MethodDefinition){let n,i,r;return e.method&&(n=yield this.memberDocumentation(e.method,t)),(!e.method||(24576&e.method.modifiers)>0)&&e.traitMethod?n=yield this.memberDocumentation(e.traitMethod,t):e.baseMethod&&(i=yield this.memberDocumentation(e.baseMethod,t),n&&i?n.inherit(i):n||(n=i)),e.interfaceMethod&&(r=yield this.memberDocumentation(e.interfaceMethod,t),n&&r?n.inherit(r):n||(n=r)),n}return yield this._getDocumentation(e)}})}getTypeDefinition(e){switch(e.kind){case 1:case 2:return d.TypeDefinition.fromDefinition(e,this.definitionStore);case 32:case 16:case 2048:case 1024:return d.TypeDefinition.fromDefinition(this.definitionStore.table(s.DocumentStore.uri(e.uriId)).definitionScope(e),this.definitionStore);default:return}}formatPhpDoc(e,t,n){let i,r;const s=[];if(!t)return new f(e,void 0,void 0,[]);let o=n.format(t.summary);o&&(i={text:o,kind:1005}),(o=n.format(t.description))&&(r={text:o,kind:1003});let a=t.tags;for(let e=0;e<a.length;++e)(o=n.format(a[e]))&&s.push({text:o,kind:a[e].kind,elementName:a[e].elementName.text});return new f(e,i,r,s)}_getDocumentation(e){return i(this,void 0,void 0,function*(){if(!e.range)return new f(e,void 0,void 0,[]);const t=yield this.getPhpDoc(e);return t?this.formatPhpDoc(e,t,new p(this.hasHtmlDescription(e))):new f(e,void 0,void 0,[])})}getPhpDoc(e){return i(this,void 0,void 0,function*(){const t=yield this.getParseTreeDelegate(e.uriId);if(!t)return;const n=t.getTraverser(),i=t.getNodeUtils().positionToOffset(u.PackedPosition.toLspPosition(e.range.start));if(n.seek(i),h.isToken(n.node)){switch(e.kind){case 16:n.ancestor(e=>1132===e.kind);break;case 8:n.ancestor(e=>1042===e.kind||1067===e.kind);break;case 1024:n.ancestor(e=>1025===e.kind);break;case 1:n.ancestor(e=>1028===e.kind);break;case 2:n.ancestor(e=>1098===e.kind);break;case 4:n.ancestor(e=>1161===e.kind);break;case 64:n.ancestor(e=>1081===e.kind);break;case 32:n.ancestor(e=>1108===e.kind);break;case 256:n.ancestor(e=>1067===e.kind)}if(n.prevSibling(),159===n.node.kind)return o.PhpDocParser.parse(n.text)}})}hasHtmlDescription(e){return(65536&e.modifiers)>0}};class p{constructor(e){this.hasHtmlDescription=e}format(e){if(!e)return"";switch(e.kind){case 1005:case 1003:return this.formatSummaryOrDescription(e);default:return e instanceof o.PhpDocTag?this.formatTag(e):""}}formatSummaryOrDescription(e){if(!e)return"";let t=e.toString();return this.hasHtmlDescription&&(t=m.toMarkdown(t)),t}formatTag(e){let t,n="_"+e.tagName.text+"_";switch(e.tagName.text){case"@return":case"@throws":n+=" `"+e.typeName.text+"`";break;case"@param":case"@property":case"@property-read":case"@property-write":case"@global":n+=" `"+e.typeName.text+" "+e.elementName.text+"`";break;case"@var":{let t=e.elementName.text;n+=t?" `"+e.typeName.text+" "+t+"`":" `"+e.typeName.text+"`"}break;case"@link":n+=" "+e.url.text;break;case"@see":{let t=e.typeName;t.kind?n+=" `"+t.text+"`":n+=" "+e.url.text}break;case"@since":case"@deprecated":{let t=e.semver.text;t&&(n+=" "+t)}break;case"@method":{let t=e.children.filter(e=>1004===e.kind).map(e=>e.toString()).join(", ");n+=` \`${e.children.filter(e=>e.kind<1e3).map(e=>e.text).join(" ")}(${t})\``}break;default:{let t=e.children.filter(e=>e.kind<1e3&&9!==e.kind),i=e.tagName;t.length&&(t[0].offset===i.offset+i.text.length?n+=t.map(e=>e.text).join(" "):n+=" "+t.map(e=>e.text).join(" "))}}if(n=n.trim(),t=e.description){let e=t.toString();this.hasHtmlDescription&&(e=m.toMarkdown(e)),e&&(n+="  \n"+e)}return n}}var m;t.PhpDocNodeFormatter=p,function(e){const t=new a({headingStyle:"atx",codeBlockStyle:"fenced"});t.use(c.gfm),t.addRule("code",{filter:"code",replacement:e=>"\n```php\n"+e+"\n```\n"}),e.toMarkdown=function(e){return t.turndown(e)}}(m||(m={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0),r=n(1),s=n(2);var o,a;!function(e){e.childOfKindAtIndex=function(e,t,n){return e.children&&e.children.length>n&&e.children[n].kind===t?e.children[n]:void 0},e.offsetRange=function(e){let t=function e(t){if(a.isToken(t))return t;let n;for(let i=0;i<t.children.length;++i)if(n=e(t.children[i]))return n}(e),n=function e(t){if(a.isToken(t))return t;let n;for(let i=t.children.length-1;i>-1;--i)if(n=e(t.children[i]))return n}(e);return t&&n?{start:t.offset,end:n.offset+n.text.length}:{start:0,end:0}}}(o=t.PhpDocNode||(t.PhpDocNode={})),function(e){e.create=function(e,t,n,i){return{kind:e,offset:t+i.offset,text:i.input.slice(t,n)}},e.isToken=function(e){return e.kind<1e3}}(a=t.PhpDocToken||(t.PhpDocToken={}));const c={kind:0,offset:0,text:""};class d{constructor(e){this.children=e,this.kind=1001}get summary(){return o.childOfKindAtIndex(this,1005,0)}get description(){return o.childOfKindAtIndex(this,1003,0)||o.childOfKindAtIndex(this,1003,1)}get tags(){return this.filterTags(e=>!0)}get offsetRange(){return o.offsetRange(this)}getReferences(e){const t=new g(e);return new i.TreeTraverser([this]).traverse(t).references}findParamTag(e){return this.children.find(t=>1007===t.kind&&t.elementName.text===e)}findVarTag(e){return this.children.find(t=>1008===t.kind&&(!t.elementName.kind||t.elementName.text===e))}findReturnTag(){return this.children.find(e=>1009===e.kind)}filterTags(e){return this.children.filter(t=>t instanceof f&&e(t))}}t.PhpDocBlock=d;class l{constructor(e){this.children=e,this.kind=1002}get offsetRange(){return o.offsetRange(this)}get text(){return o.childOfKindAtIndex(this,7,0)||c}isEmpty(){return 1===this.children.length&&5===this.children[0].kind}toString(){return this.children.length>0&&7===this.children[0].kind?this.children[0].text:""}}t.PhpDocLine=l;class u{constructor(e){this.children=e,this.kind=1003}get offsetRange(){return o.offsetRange(this)}toString(){return this.children.map(e=>e.toString()).join("\n").trim()}}t.PhpDocDescription=u;class h{constructor(e){this.children=e,this.kind=1005}get offsetRange(){return o.offsetRange(this)}toString(){return this.children.map(e=>e.toString()).join("\n").trim()}}t.PhpDocSummary=h;class f{constructor(e,t){this.children=e,this.kind=t}get tagName(){return o.childOfKindAtIndex(this,9,0)||c}get isStandard(){switch(this.tagName.text){case"@param":case"@property":case"@property-read":case"@property-write":case"@return":case"@link":case"@see":case"@throws":case"@method":case"@var":case"@since":case"@deprecated":case"@api":case"@author":case"@copyright":case"@example":case"@global":case"@internal":case"@license":case"@package":case"@todo":case"@uses":case"@version":case"@category":case"@subpackage":case"@filesource":case"@ignore":case"@source":return!0;default:return!1}}get offsetRange(){return o.offsetRange(this)}get elementName(){switch(this.kind){case 1021:case 1022:case 1023:case 1007:case 1008:case 1011:return o.childOfKindAtIndex(this,11,2)||c;case 1024:return o.childOfKindAtIndex(this,12,2)||o.childOfKindAtIndex(this,12,1)||o.childOfKindAtIndex(this,12,3)||c;default:return c}}get typeName(){switch(this.kind){case 1021:case 1022:case 1023:case 1007:case 1008:case 1009:case 1012:case 1010:case 1011:return o.childOfKindAtIndex(this,10,1)||c;case 1024:return o.childOfKindAtIndex(this,10,1)||o.childOfKindAtIndex(this,10,2)||c;default:return c}}get isStatic(){return 1024===this.kind&&this.children.length>=2&&8===this.children[1].kind&&"static"===this.children[1].text}get parameters(){return 1024!==this.kind?[]:this.children.filter(e=>1004===e.kind)}get description(){return o.childOfKindAtIndex(this,1003,this.children.length-1)}get semver(){switch(this.kind){case 1014:case 1006:return o.childOfKindAtIndex(this,13,1)||c;default:return c}}get url(){switch(this.kind){case 1012:case 1013:return o.childOfKindAtIndex(this,14,1)||c;default:return c}}}t.PhpDocTag=f;class p{constructor(e){this.children=e,this.kind=1004}get elementName(){return o.childOfKindAtIndex(this,11,1)||c}get typeName(){return o.childOfKindAtIndex(this,10,0)||c}get offsetRange(){return o.offsetRange(this)}toString(){return this.typeName.text+" "+this.elementName.text}}var m;t.PhpDocMethodParameter=p,function(e){const t=92,n=45,i=95;let r;function s(e){return" "===e||"\t"===e}function o(e){let t=e.position;const n=e.input.length;for(;e.position<n&&(i=e.input[e.position],r=e.position+1<n?e.input[e.position+1]:"","\r"!==i&&"\n"!==i&&("*"!==i||"/"!==r));)++e.position;var i,r;return a.create(7,t,e.position,e)}function c(e){let t=e.position,n=e.input[e.position],i=e.input.length;for("\r"===n&&++e.position,e.position<i&&"\n"===e.input[e.position]&&++e.position;e.position<i&&s(e.input[e.position]);)++e.position;for(;e.position<i&&"*"===e.input[e.position]&&(e.position+1===i||"/"!==e.input[e.position+1]);)++e.position;for(;e.position<i&&s(e.input[e.position]);)++e.position;return a.create(5,t,e.position,e)}function d(e){return e>=65&&e<=90||e>=97&&e<=122}function l(e){return e>=48&&e<=57}e.setInput=function(e,t){r={position:0,input:e,mode:0,offset:t||0}},e.lex=function e(){if(r.position>=r.input.length)return a.create(1,r.position,r.position,r);let u;switch(r.mode){case 0:u=function(e){let t=e.input.length;for(e.position+=3;e.position<t&&"*"===e.input[e.position]&&(e.position+1===t||"/"!==e.input[e.position+1]);)++e.position;for(;e.position<t&&s(e.input[e.position]);)++e.position;return e.mode=1,a.create(3,0,e.position,e)}(r);break;case 1:u=function(e){switch(e.input[e.position]){case"@":return e.position+1<e.input.length&&(d(e.input.charCodeAt(e.position+1))||"\\"===e.input[e.position+1])?void(e.mode=2):o(e);case"\r":case"\n":return c(e);case"*":if(e.position+1<e.input.length&&"/"===e.input[e.position+1])return void(e.mode=3);default:return o(e)}}(r);break;case 2:u=function(e){switch(e.input[e.position]){case"@":return e.position+1<e.input.length&&(d(e.input.charCodeAt(e.position+1))||"\\"===e.input[e.position+1])?function(e){let r=e.input.length,s=e.position;e.position+=2;let o=e.input.charCodeAt(e.position);for(;!isNaN(o)&&(d(o)||l(o)||o===t||o===n||o===i);)o=e.input.charCodeAt(++e.position);if(e.position<r&&":"===e.input[e.position])for(++e.position,o=e.input.charCodeAt(e.position);d(o)||l(o)||o===n;)o=e.input.charCodeAt(++e.position);return a.create(9,s,e.position,e)}(e):o(e);case"\r":case"\n":return c(e);case" ":case"\t":return function(e){let t=e.position,n=e.input.length;for(;++e.position<n&&s(e.input[e.position]););return a.create(6,t,e.position,e)}(e);case"*":if(e.position+1<e.input.length&&"/"===e.input[e.position+1])return void(e.mode=3);default:return o(e)}}(r);break;case 3:u=a.create(4,r.position,r.position+=2,r);break;default:throw new Error("Unexpected lexer mode")}return u||e()}}(m||(m={})),function(e){const t=/^\d+\.\d+\.\d+[0-9a-zA-Z\-]*|\d+\.\d+/,n=/^[\\a-zA-Z0-9_\x80-\uffff]+(?:$|\s)/;let i;function r(){return 6===(i=m.lex()).kind?r():i}function s(){let e,t=[i];switch(i.text){case"@param":e=g(t,1007);break;case"@property":e=g(t,1021);break;case"@property-read":e=g(t,1022);break;case"@property-write":e=g(t,1023);break;case"@return":e=k(t,1009,10);break;case"@link":e=k(t,1013,14);break;case"@see":e=function(e,t){let i,s=r();if(7!==s.kind)return new f(e,t);const o=s.text.match(n)?10:14;[s,i]=y(s,void 0,o),s&&e.push(s);let a=v(i);a&&e.push(a);return new f(e,t)}(t,1012);break;case"@throws":e=k(t,1010,10);break;case"@method":e=function(e){let t,n,i=r();if(7!==i.kind)return new f(e,1024);[n,t]=function(e){let t;const n=[];let i,r,s=e;for(;s&&s.text&&"("!==s.text[0];)[t,s]=y(s,["("]),n.push(t);n.length>0&&(n[n.length-1].kind=12);n.length>1&&"static"!==n[n.length-2].text&&(n[n.length-2].kind=10);s=T(s,"(");for(;s&&s.text&&")"!==s.text[0];)[i,s]=y(s,[")",","],10),[r,s]=y(s,[")",","],11),r||(r=i),r&&n.push(new p([i,r])),s=T(s,",");return s=T(s,")"),[n,s]}(i),Array.prototype.push.apply(e,n);let s=v(t);s&&e.push(s);return new f(e,1024)}(t);break;case"@var":e=c(t,1008);break;case"@since":e=S(t,1014);break;case"@deprecated":e=S(t,1006);break;case"@api":e=new f(t,1025),r();break;case"@author":e=a(t,1016);break;case"@copyright":e=o(t,1017);break;case"@example":e=k(t,1027,14);break;case"@global":e=c(t,1011);break;case"@internal":e=new f(t,1026),r();break;case"@license":e=a(t,1018);break;case"@package":e=function(e,t){let n,i;[n,i]=y(r()),n&&e.push(n);return new f(e,t)}(t,1019);break;case"@todo":e=o(t,1028);break;case"@uses":e=k(t,1020);break;case"@version":e=k(t,1015);break;default:e=o(t,1029)}return function(e){for(;i.kind!==e&&1!==i.kind&&4!==i.kind;)r()}(9),e}function o(e,t){let n=v();return n&&e.push(n),new f(e,t)}function a(e,t){let n=r();return 7===n.kind&&e.push(n),new f(e,t)}function c(e,t){let n,i=r();if(7!==i.kind)return new f(e,t);[i,n]=y(i,void 0,10),e.push(i),n&&n.text&&"$"===n.text[0]&&([i,n]=y(n,void 0,11),e.push(i));let s=v(n);return s&&e.push(s),new f(e,t)}function g(e,t){let n,i=r();if(7!==i.kind)return new f(e,t);[i,n]=y(i,void 0,10),e.push(i),[i,n]=y(n,void 0,11),i&&e.push(i);let s=v(n);return s&&e.push(s),new f(e,t)}function k(e,t,n){let i,s=r();if(7!==s.kind)return new f(e,t);[s,i]=y(s,void 0,n),s&&e.push(s);let o=v(i);return o&&e.push(o),new f(e,t)}function S(e,n){let i,s=r();if(7!==s.kind)return new f(e,n);[s,i]=function(e){return e&&e.text.match(t)?y(e,void 0,13):[void 0,e]}(s),s&&e.push(s);let o=v(i);return o&&e.push(o),new f(e,n)}function T(e,t){if(e){if(e.text&&e.text[0]===t){let t=1;for(;t<e.text.length&&(" "===e.text[t]||"\t"===e.text[t]);)++t;const n=e.text.slice(t);return n?{kind:7,offset:e.offset+t,text:n}:void 0}return e}}function y(e,t,n){if(!e)return[void 0,void 0];let i=e.text||"",r=0;for(;r<i.length&&" "!==i[r]&&"\t"!==i[r]&&(!t||t.indexOf(i[r])<0);)++r;const s=i.slice(0,r);for(;r<i.length&&(" "===i[r]||"\t"===i[r]);)++r;const o=i.slice(r);return[s?{kind:n||8,offset:e.offset,text:s}:void 0,o?{kind:7,offset:e.offset+r,text:o}:void 0]}function v(e){const t=[];let n,i;do{n=e||r(),e=void 0,i=[],7===n.kind&&(i.push(n),n=r()),5===n.kind&&i.push(n),i.length>0&&t.push(new l(i))}while(i.length>0);return t.length>0?new u(t):void 0}e.parse=function(e,t){m.setInput(e,t),r();let n=r();for(;5===n.kind;)n=r();let o=[];for(7===n.kind&&o.push(function(e){const t=[];let n,i,s;do{n=e||r(),e=void 0,s=void 0,i=[],7===n.kind&&(i.push(n),n=r()),5===n.kind&&i.push(n),i.length>0&&(s=new l(i),t.push(s))}while(s&&s.text.kind>0&&"."!==s.text.text.slice(-1));return t.length>0?new h(t):void 0}(n)),n=i;5===n.kind;)n=r();return 7===n.kind&&o.push(v(n)),9===(n=i).kind&&Array.prototype.push.apply(o,function(){let e,t=[];do{(e=s())&&t.push(e)}while(9===i.kind);return t}()),new d(o)}}(t.PhpDocParser||(t.PhpDocParser={}));class g{constructor(e){this.context=e,this._references=[]}get references(){return this._references}preorder(e,t){let n;switch(e.kind){case 1008:n=this.varTag(e,t);break;case 1021:case 1022:case 1023:n=this.typeAndElementNode(e,t,16,s.TypeString.fromString(this.context.ownerTypeName));break;case 1007:n=this.typeAndElementNode(e,t,128);break;case 1012:case 1010:case 1009:case 1011:n=this.typeAndElementNode(e,t,1);break;case 1024:n=this.typeAndElementNode(e,t,32,s.TypeString.fromString(this.context.ownerTypeName));break;case 1004:n=this.typeAndElementNode(e,t,128);default:return!0}return Array.prototype.push.apply(this._references,n),!0}typeAndElementNode(e,t,n,i){const o=[],a=e.elementName.text,c=s.TypeString.fromString(e.typeName.text);if(c){const t=s.TypeString.toReferences(c,e.typeName.offset,this.context.nodeUtils,this.context.nameResolver);Array.prototype.push.apply(o,t)}if(a){const t=r.Reference.create(n,a,this.context.nodeUtils.uriId);i&&(t.scope=i),t.range=this.createRange(e.elementName.offset,a.length),t.type=s.TypeString.nameResolve(c,this.context.nameResolver),o.push(t)}return o}varTag(e,t){const n=[],i=e.elementName.text,o=s.TypeString.fromString(e.typeName.text),a=s.TypeString.nameResolve(o,this.context.nameResolver);if(1025===this.context.ownerNodeKind&&i){const t=r.Reference.create(1024,i,this.context.nodeUtils.uriId);t.scope=s.TypeString.fromString(this.context.nameResolver.className),t.range=this.createRange(e.elementName.offset,i.length),t.type=a,n.push(t)}else if(1042===this.context.ownerNodeKind&&i){const t=r.Reference.create(8,i,this.context.nodeUtils.uriId);t.range=this.createRange(e.elementName.offset,i.length),t.type=a,n.push(t)}else if(1132===this.context.ownerNodeKind){if(o){const t=s.TypeString.toReferences(o,e.typeName.offset,this.context.nodeUtils,this.context.nameResolver);Array.prototype.push.apply(n,t)}if(i){const t=r.Reference.create(16,i,this.context.nodeUtils.uriId);t.scope=s.TypeString.fromString(this.context.nameResolver.className),t.range=this.createRange(e.elementName.offset,i.length),t.type=a,n.push(t)}}else{if(o){const t=s.TypeString.toReferences(o,e.typeName.offset,this.context.nodeUtils,this.context.nameResolver);Array.prototype.push.apply(n,t)}if(i){const t=r.Reference.create(256,i,this.context.nodeUtils.uriId);t.type=a,t.range=this.createRange(e.elementName.offset,i.length),n.push(t)}}return n}createRange(e,t){return{start:i.PackedPosition.fromLspPosition(this.context.nodeUtils.offsetToPosition(e)),end:i.PackedPosition.fromLspPosition(this.context.nodeUtils.offsetToPosition(e+t))}}}},function(e,t){e.exports=require("lru-cache")},function(e,t){e.exports=require("fs-extra")},function(e,t){e.exports=require("path")},function(e,t,n){e.exports=n(25)},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=n(26),s=n(27),o=n(52),a=n(57),c=n(14),d=n(23),l=n(58),u="php",h=["*.php","*.phtml"],f=["**/.git/**","**/.svn/**","**/.hg/**","**/CVS/**","**/.DS_Store/**","**/node_modules/**","**/bower_components/**","**/vendor/**/{Test,test,Tests,tests}/**"],p=["apache","bcmath","bz2","calendar","com_dotnet","Core","csprng","ctype","curl","date","dba","dom","enchant","exif","fileinfo","filter","fpm","ftp","gd","hash","iconv","imap","interbase","intl","json","ldap","libxml","mbstring","mcrypt","mssql","mysql","mysqli","oci8","odcb","openssl","password","pcntl","pcre","PDO","pdo_ibm","pdo_mysql","pdo_pgsql","pdo_sqlite","pgsql","Phar","posix","pspell","readline","recode","Reflection","regex","session","shmop","SimpleXML","snmp","soap","sockets","sodium","SPL","sqlite3","standard","superglobals","sybase","sysvmsg","sysvsem","sysvshm","tidy","tokenizer","wddx","xml","xmlreader","xmlrpc","xmlwriter","Zend OPcache","zip","zlib"],m=d.join(__dirname,"stub"),g=o.UriUtil.pathToUri(m),k=new r.RequestType("documentLanguageRanges"),S=new r.NotificationType("indexingStarted"),T=new r.NotificationType("indexingEnded"),y=new r.RequestType("indexWorkspace"),v=new r.RequestType("cancelIndexing");let _,b,P,D,N,w,I=r.createConnection(),R=l.tmpdir();c.Log.connection=I;const x=new s.Intelephense,E=o.MasterFileProvider.create(),M=o.MasterFileSearchProvider.create(),C=new o.Workspace([]),O=new o.Indexer(x,1e6),A=[o.FILE_SCHEME,o.UNTITLED_SCHEME],U=[];let L;function F(e){e&&c.Log.error(e.stack)}function V(){return i(this,void 0,void 0,function*(){let e=function(){const e=O.indexingEndedEvent(t=>i(this,void 0,void 0,function*(){try{e.dispose();const t=yield a.Cache.create(K(R,C.folders));c.Log.info(`Writing state to ${t.directory}.`);const n=process.hrtime();yield x.snapshot(t);const i=process.hrtime(n);c.Log.info(`Wrote state in ${(i[0]+i[1]/1e9).toFixed(1)}s.`)}catch(e){F(e)}}));return e}();try{(yield O.indexWorkspace(C))<1&&e.dispose()}catch(t){e&&e.dispose(),F(t)}})}function G(e,t,n){if(!e)return n;const i=t.split(".");let r,s=e;for(;(r=i.shift())&&void 0!==s;)s=s[r];return void 0!==s?s:n}function K(e,t){let n=t.reduce((e,t)=>e+t.uri," ");return d.join(e,Math.abs(function(e){let t,n=0;for(let i=0,r=e.length;i<r;++i)t=e.charCodeAt(i),n=(n<<5)-n+t,n|=0;return n}(n)).toString(16))}function H(e,t){if(!e&&!t||!e.size&&!t.size)return!0;if(!e||!t)return!1;if(e.size!==t.size)return!1;for(let n of e)if(!t.has(n))return!1;return!0}function B(){return A.map(e=>({language:u,scheme:e}))}function q(e){return e.map(e=>e+"/**/*.php")}O.indexingStartedEvent(()=>{c.Log.info("Indexing started."),L=process.hrtime(),I.sendNotification(S.method)},void 0,U),O.indexingEndedEvent(e=>{c.Log.info(`Indexing ended. ${e} files indexed in ${process.hrtime(L)[0]}s.`),I.sendNotification(T.method)},void 0,U),I.onInitialize(e=>i(this,void 0,void 0,function*(){let t=process.hrtime();_=e,c.Log.info("Initialising"),N=!(!e.capabilities.workspace||!e.capabilities.workspace.configuration),w=!(!e.capabilities.workspace||!e.capabilities.workspace.workspaceFolders),D=new o.WorkspaceFolder(g,E,M,q(p),[],1),C.addFolder(D),e.workspaceFolders?e.workspaceFolders.forEach(e=>{C.addFolder(new o.WorkspaceFolder(e.uri,E,M,[],[],0))}):e.rootUri&&C.addFolder(new o.WorkspaceFolder(e.rootUri,E,M,[],[],0)),e.initializationOptions&&e.initializationOptions.storagePath&&(R=e.initializationOptions.storagePath);let n,i=e.initializationOptions&&e.initializationOptions.clearCache;C.folders.length>1&&(n=yield a.Cache.create(K(R,C.folders)));try{yield x.initialise({logger:c.Log,cache:i?void 0:n,fileProvider:E})}catch(e){F(e)}return c.Log.info(`Initialised in ${function(e){if(!e)return 0;let t=process.hrtime(e);return 1e3*t[0]+t[1]/1e6}(t).toFixed()} ms`),{capabilities:{textDocumentSync:r.TextDocumentSyncKind.Incremental,documentSymbolProvider:!0,workspaceSymbolProvider:!0,completionProvider:{triggerCharacters:["$",">",":","\\",".","<","/"],resolveProvider:!0},signatureHelpProvider:{triggerCharacters:["(",","]},definitionProvider:!0,documentRangeFormattingProvider:!1,referencesProvider:!0,hoverProvider:!0,documentHighlightProvider:!0}}})),I.onInitialized(()=>i(this,void 0,void 0,function*(){x.onPublishDiagnostics(e=>{I.sendDiagnostics(e)}),w&&I.workspace.onDidChangeWorkspaceFolders(e=>i(this,void 0,void 0,function*(){try{for(let t=0;t<e.added.length;++t){const n=new o.WorkspaceFolder(e.added[t].uri,E,M,[],[],0);C.addFolder(n),yield O.indexFolder(n)}for(let t=0;t<e.removed.length;++t)yield O.forgetFolder(e.removed[t].uri)}catch(e){F(e)}})),N&&((P=yield I.workspace.getConfiguration("intelephense"))?(x.setConfig(P),O.maxFileSize=G(P,"files.maxSize",1e6)):c.Log.warn("Failed to get configuration from client."));const e=q(G(P,"stubs",p));D.includeGlobs=e;const t=G(P,"files.associations",h);C.folders.forEach(e=>{e.uri!==g&&(e.includeGlobs=t)});const n=G(P,"files.exclude",f);if(C.folders.forEach(e=>{e.uri!==g&&(e.excludeGlobs=n)}),G(P,"format.enable",!0)){let e=B();b||(b=I.client.register(r.DocumentRangeFormattingRequest.type,{documentSelector:e}))}V()})),I.onRequest(y.method,()=>i(this,void 0,void 0,function*(){O.isIndexing()&&(yield new Promise((e,t)=>{O.cancel();const n=O.indexingEndedEvent(()=>{e(),n.dispose()})})),V()})),I.onRequest(v.method,()=>{O.cancel()}),I.onDidChangeConfiguration(e=>{let t=e.settings.intelephense;if(!t)return;const n=P;if(P=t,x.setConfig(P),O.maxFileSize=G(P,"files.maxSize",1e6),P.format&&P.format.enable){let e=B();b||(b=I.client.register(r.DocumentRangeFormattingRequest.type,{documentSelector:e}))}else b&&(b.then(e=>e.dispose()),b=null);const i=G(n,"files.maxSize",1e6)!==G(P,"files.maxSize",1e6),s=H(new Set(G(n,"files.associations",h)),new Set(G(P,"files.associations",h)));if(!s){const e=G(P,"files.associations",h);C.folders.forEach(t=>{t.uri!==g&&(t.includeGlobs=e)})}const o=H(new Set(G(n,"files.exclude",f)),new Set(G(P,"files.exclude",f)));if(!o){const e=G(P,"files.exclude",f);C.folders.forEach(t=>{t.uri!==g&&(t.excludeGlobs=e)})}const a=H(new Set(G(n,"stubs",p)),new Set(G(P,"stubs",p)));a||(D.includeGlobs=q(G(P,"stubs",p))),a&&i&&s&&o||O.indexWorkspace(C)}),I.onDocumentLinks(e=>[]),I.onHover((e,t)=>{const n=x.provideHover(e.textDocument.uri,e.position,t);return n.catch(F),n}),I.onDocumentHighlight(e=>{const t=x.provideHighlights(e.textDocument.uri,e.position);return t.catch(F),t}),I.onDidOpenTextDocument(e=>{const t=G(P,"files.maxSize",1e6);if(e.textDocument.text.length>t)return void c.Log.warn(`${e.textDocument.uri} is over the maximum file size of ${t} bytes.`);if(e.textDocument.languageId!==u)return;let n=0;C.isVendor(e.textDocument.uri)&&(n|=2);try{return x.openDocument(e.textDocument.uri,e.textDocument.text,e.textDocument.version,n)}catch(e){F(e)}}),I.onDidChangeTextDocument(e=>{try{return x.editDocument(e.textDocument.uri,e.textDocument.version,e.contentChanges)}catch(e){F(e)}}),I.onDidCloseTextDocument(e=>{try{C.contains(e.textDocument.uri)?x.closeDocument(e.textDocument.uri):x.forgetDocument(e.textDocument.uri)}catch(e){F(e)}}),I.onDocumentSymbol(e=>{const t=x.documentSymbols(e.textDocument.uri);return t.catch(F),t}),I.onWorkspaceSymbol(e=>{try{return x.workspaceSymbols(e.query)}catch(e){F(e)}}),I.onReferences((e,t)=>{const n=x.provideReferences(e.textDocument.uri,e.position,e.context,t);return n.catch(F),n}),I.onCompletion(e=>{const t=x.provideCompletions(e.textDocument.uri,e.position);return t.catch(F),t}),I.onCompletionResolve((e,t)=>{const n=x.completionItemResolve(e,t);return n.catch(F),n}),I.onSignatureHelp((e,t)=>{const n=x.provideSignatureHelp(e.textDocument.uri,e.position,t);return n.catch(F),n}),I.onDefinition(e=>{const t=x.provideDefinition(e.textDocument.uri,e.position);return t.catch(F),t}),I.onDocumentRangeFormatting(e=>{const t=x.provideDocumentRangeFormattingEdits(e.textDocument.uri,e.range,e.options);return t.catch(F),t}),I.onShutdown(()=>{U.forEach(e=>{e.dispose()}),O.isIndexing()&&O.cancel()}),I.onDidChangeWatchedFiles(e=>{let t;try{for(let n=0,i=e.changes.length;n<i;++n)(t=e.changes[n]).type===r.FileChangeType.Deleted?O.forgetFile(t.uri):C.contains(t.uri)&&!x.isDocumentOpen(t.uri)&&O.indexFile(t.uri,C.isVendor(t.uri)?2:0)}catch(t){F(t)}}),I.onRequest(k,e=>{const t=x.documentLanguageRanges(e.textDocument.uri);return t.catch(F),t}),I.listen()},function(e,t){e.exports=require("vscode-languageserver")},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=n(11),s=n(4),o=n(12),a=n(28),c=n(33),d=n(0),l=n(34),u=n(35),h=n(17),f=n(3),p=n(36),m=n(18),g=n(10),k=n(37),S=n(40),T=n(41),y=n(5),v=n(46),_=n(47),b=n(19),P=n(48),D=n(49);t.Intelephense=class{constructor(){this.cacheTimestamp=0,this.onPublishDiagnostics=(e=>{this.diagnosticsUnsubscribe&&this.diagnosticsUnsubscribe(),e&&(this.diagnosticsUnsubscribe=this.diagnosticsProvider.publishDiagnosticsEvent.subscribe(e))}),this.isDocumentOpen=(e=>this.compiler.isOpened(e)),this.initialise=(e=>i(this,void 0,void 0,function*(){e.logger&&(g.Log.writer=e.logger);let t=e.cache;this.fileProvider=e.fileProvider;const n=(e,t)=>i(this,void 0,void 0,function*(){return this.compiler.isLoadedWithTransform(e,t)?this.parseTreeStore.find(e):1===(yield this.compiler.loadUri(e,t))?this.parseTreeStore.find(e):void 0});this.documentStore=new s.DocumentStore,this.parseTreeStore=new y.ParseTreeStore,this.definitionStore=new o.DefinitionStore,this.referenceStore=new m.ReferenceStore(e=>n(s.DocumentStore.uri(e),3)),this.diagnosticStore=new P.DiagnosticStore;const r={documentStore:this.documentStore,parseTreeStore:this.parseTreeStore,definitionStore:this.definitionStore,referenceStore:this.referenceStore,diagnosticStore:this.diagnosticStore};this.compiler=new T.Compiler(r,this.fileProvider),this.documentationService=new b.DocumentationService(e=>n(s.DocumentStore.uri(e),1),this.definitionStore,e=>this.compiler.inferDefinitionTypeAndValue(e));const d=new b.DocumentationFormatter(this.definitionStore);return this.documentSymbolProvider=new v.DocumentSymbolProvider(r),this.workspaceSymbolProvider=new _.WorkspaceSymbolProvider(r),this.definitionProvider=new u.DefinitionProvider(r),this.completionProvider=new a.CompletionProvider(r,d,e=>this.compiler.inferDefinitionTypeAndValue(e),this.documentationService),this.signatureHelpProvider=new l.SignatureHelpProvider(r,new l.SignatureHelpFactory(this.documentationService,d,this.definitionStore)),this.diagnosticsProvider=new c.DiagnosticsProvider(r),this.formatProvider=new h.FormatProvider(r),this.referenceProvider=new p.ReferenceProvider(r),this.hoverProvider=new k.HoverProvider(r,d,this.documentationService),this.highlightProvider=new S.HighlightProvider(r),t?(g.Log.info(`Reading state from ${t.directory}.`),this.readStateFromCache(t)):Promise.resolve()})),this.snapshot=(e=>this.writeStateToCache(e)),this.clear=(()=>{this.compiler.clear()}),this.writeStateToCache=(e=>D.Serialiser.writeStateToCache({documentStore:this.documentStore,parseTreeStore:this.parseTreeStore,definitionStore:this.definitionStore,referenceStore:this.referenceStore,diagnosticStore:this.diagnosticStore},e)),this.readStateFromCache=(e=>i(this,void 0,void 0,function*(){this.cacheTimestamp=yield D.Serialiser.readStateFromCache({documentStore:this.documentStore,parseTreeStore:this.parseTreeStore,definitionStore:this.definitionStore,referenceStore:this.referenceStore,diagnosticStore:this.diagnosticStore},e)})),this.provideHighlights=((e,t)=>i(this,void 0,void 0,function*(){return 1===this.compiler.ready(e)?this.highlightProvider.provideHightlights(e,t):void 0})),this.provideHover=((e,t,n)=>i(this,void 0,void 0,function*(){return 1===this.compiler.ready(e)?this.hoverProvider.provideHover(e,t,n):void 0})),this.documentLanguageRanges=(e=>i(this,void 0,void 0,function*(){if(1!==this.compiler.ready(e))return;const t=this.parseTreeStore.find(e),n=this.documentStore.find(e);return t&&n?{version:n.version,ranges:t.documentLanguageRanges()}:void 0})),this.setConfig=(e=>{e&&(this.completionProvider.options=e.completion,this.definitionProvider.options=e.definition,this.diagnosticsProvider.options=e.diagnostic,this.signatureHelpProvider.options=e.signatureHelp,this.hoverProvider.options=e.hover,this.highlightProvider.options=e.highlight,this.referenceProvider.options=e.reference,this.documentSymbolProvider.options=e.documentSymbol,this.workspaceSymbolProvider.options=e.workspaceSymbol,this.formatProvider.options=e.format)}),this.openDocument=((e,t,n,i)=>{const s=new r.Document(e,t,n,i);return this.compiler.open(s)}),this.closeDocument=(e=>this.compiler.close(e)),this.editDocument=((e,t,n)=>this.compiler.applyChanges(e,t,n)),this.documentSymbols=(e=>i(this,void 0,void 0,function*(){return 1===this.compiler.ready(e)?this.documentSymbolProvider.provideDocumentSymbols(e):void 0})),this.workspaceSymbols=(e=>e?this.workspaceSymbolProvider.provideWorkspaceSymbols(e):[]),this.provideCompletions=((e,t)=>i(this,void 0,void 0,function*(){return 1===this.compiler.ready(e)?this.completionProvider.provideCompletionItems(e,t):void 0})),this.completionItemResolve=((e,t)=>this.completionProvider.resolveCompletionItem(e,t)),this.provideSignatureHelp=((e,t,n)=>i(this,void 0,void 0,function*(){return 1===this.compiler.ready(e)?this.signatureHelpProvider.provideSignatureHelp(e,t,n):void 0})),this.provideDefinition=((e,t)=>i(this,void 0,void 0,function*(){return 1===this.compiler.ready(e)?this.definitionProvider.provideDefinition(e,t):void 0})),this.indexDocument=((e,t)=>this.compiler.loadUri(e,2,t)),this.forgetDocument=(e=>this.compiler.forget(e)),this.forgetFolder=(e=>{const t=this.getIndexedDocuments();for(let n of t)0===n.indexOf(e)&&this.forgetDocument(n)}),this.provideDocumentFormattingEdits=((e,t)=>i(this,void 0,void 0,function*(){return 1===this.compiler.ready(e)?this.formatProvider.provideDocumentFormattingEdits(e,t):void 0})),this.provideDocumentRangeFormattingEdits=((e,t,n)=>i(this,void 0,void 0,function*(){return 1===this.compiler.ready(e)?this.formatProvider.provideDocumentRangeFormattingEdits(e,t,n):void 0})),this.provideReferences=((e,t,n,r)=>i(this,void 0,void 0,function*(){if(1===this.compiler.ready(e))return(yield this.referenceProvider.provideReferences(e,t,n,r)).map(e=>f.Location.create(s.UriMap.uri(e.uriId),d.PackedRange.toLspRange(e.range)))}))}get indexTimestamp(){return this.cacheTimestamp}getIndexedDocuments(){return this.documentStore.getIndexedDocumentUris()}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=n(7),s=n(1),o=n(2),a=n(5),c=n(3),d=n(9),l=n(6),u=n(31),h=n(10);var f,p;t.DEFAULT_COMPLETION_PROVIDER_OPTIONS={insertUseDeclaration:!0,fullyQualifyGlobalConstantsAndFunctions:!1},function(e){e.create=function(e){if(e&&e.uriId&&e.fqsenHash)return{uriId:e.uriId,fqsenHash:e.fqsenHash}}}(f=t.CompletionItemData||(t.CompletionItemData={})),function(e){e.MAX_ITEMS=100,e.signatureString=function(e,t,n){if(!(e&&96&e.kind))return"";const i=t.definitionChildren(e).filter(s.Definition.isParameter),r=[];let a,c,d="";for(let e=0,t=i.length;e<t;++e)if(a=i[e],c=[],e&&c.push(","),n||a.type&&a.type.declared&&c.push(o.TypeString.toTypeDeclarationString(a.type.declared,a,!0)),c.push([(1024&a.modifiers)>0?"&":"",(2048&a.modifiers)>0?"...":"",a.name].join("")),a.value){const t=e?" ":"";r.push(`${t}[${c.join(" ")}`),d+="]"}else r.push(c.join(" "));let l=`(${r.join("")}${d})`;return n||e.type&&e.type.declared&&(l+=`: ${o.TypeString.toTypeDeclarationString(e.type.declared,e,!0)}`),e.name+l},e.keywordCompletionItems=function(e,t,n){let i,r;const s=t.toLowerCase(),o=[];for(let t=0,a=e.length;t<a;++t)i=e[t],(r=s.length>0?d.contSubstringMatch(s,i):1)>0&&o.push({label:i,kind:c.CompletionItemKind.Keyword,textEdit:{range:n,newText:i},sortText:i});return o},e.NO_COMPLETION_RESPONSE={items:[],isIncomplete:!1},e.TRIGGER_PARAMETER_HINTS_CMD={title:"Trigger Parameter Hints",command:"editor.action.triggerParameterHints"};const t=/[$}\\]/g;function n(e,t,n){return"\\"+e}e.snippetEscape=function(e){return e.replace(t,n)},e.correctForKeywordAndOrTrailingBackslash=function(e){const t=e.clone();return r.isKeyword(t.node.kind)&&t.prevToken(),146===t.node.kind&&t.prevToken(),t.node!==e.node?t:void 0},e.traitUseClauseDefinitions=function(e,t){e.nthChild(1),e.nthChild(0);const n=[];let i,r;do{a.NodeUtils.isNamePhrase(e.node)&&(e.lastChild(),(i=e.reference())&&i.name&&(r=l.TypeDefinition.fromName(i.name,t,4))&&n.push(r),e.parent())}while(e.nextSibling());return n},e.createUseDeclarationDetail=function(e,t,n){let i="";64===n?i="function ":8===n&&(i="const ");let r=`use ${i}${e}`;return e.slice(-t.length)!==t&&(r+=` as ${t}`),r}}(p=t.CompletionStrategy||(t.CompletionStrategy={}));t.CompletionProvider=class{constructor(e,n,i,r){this.stores=e,this.documentationFormatter=n,this.typeAndValueDelegate=i,this.documentationService=r,this._options=Object.assign({},t.DEFAULT_COMPLETION_PROVIDER_OPTIONS),this._strategies=[new L(this._options,this.stores.definitionStore),new k(this._options,this.stores.definitionStore),new v(this._options,this.stores.definitionStore,this.typeAndValueDelegate),new _(this._options,this.stores.definitionStore,this.typeAndValueDelegate),new S(this._options,this.stores.definitionStore),new b(this._options,this.stores.definitionStore),new P(this._options,this.stores.definitionStore),new D(this._options,this.stores.definitionStore),new N(this._options,this.stores.definitionStore),new w(this._options,this.stores.definitionStore),new I(this._options,this.stores.definitionStore),new R(this._options,this.stores.definitionStore),new E(this._options,this.stores.definitionStore),new x(this._options),new g(this._options,this.stores.definitionStore),new M(this._options,this.stores.definitionStore),new O(this._options,this.stores.definitionStore),new C(this._options,this.stores.definitionStore),new A(this._options,this.stores.definitionStore),new U(this._options,this.stores.definitionStore),new T(this._options,this.stores.definitionStore)]}set options(e){this._options=Object.assign({},e||t.DEFAULT_COMPLETION_PROVIDER_OPTIONS);for(let t=0,n=this._strategies.length;t<n;++t)this._strategies[t].options=e}provideCompletionItems(e,t){const n=this.stores.documentStore.find(e),i=this.stores.parseTreeStore.find(e),s=this.stores.definitionStore.table(e);if(!n||!i||!s)return h.Log.warn(`[CompletionProvider] Could not find file ${e}.`),p.NO_COMPLETION_RESPONSE;const o=i.getNodeUtils().positionToOffset(t),a=i.getTraverser();if(!a.seek(o-1))return h.Log.warn(`[CompletionProvider] Could not find node at position (${t.line}, ${t.character}).`),p.NO_COMPLETION_RESPONSE;let d=a.node;if(!r.isToken(d)||80===d.kind)return p.NO_COMPLETION_RESPONSE;const l=n.wordToLeftOfOffset(o);let u=void 0;for(let e=0,t=this._strategies.length;e<t&&!u;++e)this._strategies[e].canSuggest(a.clone())&&(u=this._strategies[e]);const f={document:n,parseTree:i,parseTreeTraverser:a.clone(),definitionTable:s,word:l,position:t,offset:o,insertRange:c.Range.create(t.line,t.character-l.length,t.line,t.character)};return u?u.completions(f):p.NO_COMPLETION_RESPONSE}resolveCompletionItem(e,t){return i(this,void 0,void 0,function*(){if(!e.data)return e;const n=e.data,i=this.stores.definitionStore.table(n.uriId);if(!i)return e;let r=i.get(n.fqsenHash);if(!r)return e;if(void 0===e.detail&&(1024===r.kind||8===r.kind)){let t=s.Definition.type(r),n=r.value;if(void 0===t||void 0===n){const e=yield this.typeAndValueDelegate(r);t=e.type,n=e.value}const i=[];1&r.modifiers?i.push("public"):2&r.modifiers?i.push("protected"):4&r.modifiers&&i.push("private"),i.push("const"),i.push(s.Definition.shortName(r.name)),void 0!==r.value?(i.push("="),i.push(o.TypeString.isEqual(t,o.TypeString.ARRAY_TYPE_STRING)?`'${r.value}'`:r.value)):o.TypeString.isEqual(t,o.TypeString.ARRAY_TYPE_STRING)&&(i.push("="),i.push("[]")),e.detail=i.join(" ")}if(void 0===e.documentation){const n=yield this.documentationService.getDocumentation(r,t);n&&(e.documentation={kind:c.MarkupKind.Markdown,value:this.documentationFormatter.format(n)})}return e})}};class m{constructor(e,t){this.options=e,this.definitionStore=t}correctForTrailingBackslash(e){const t=e.clone();return a.NodeUtils.isTokenOfKind(t.node,[146])?(t.prevToken(),t):e}completions(e){let t=e.word;if(!t)return p.NO_COMPLETION_RESPONSE;let n=e.document.textToLeftOfOffset(e.offset,t.length+1),i=1136;n.length&&"\\"===n[0]?i=1079:0===t.indexOf("namespace")&&(i=1139);const r=[],o=e.parseTreeTraverser.getNameResolver();let a=this._definitionFilter,c=void 0;const h=new u.UseDeclarationHelper(e.parseTree,e.definitionTable,e.position);let f=void 0;if(1139===i||1079===i||t.indexOf("\\")>-1)1139===i?t=o.resolveRelative(t.slice(10)):1136===i&&(f=o.matchUnqualified(t.slice(0,t.indexOf("\\")),1),t=o.resolveNotFullyQualified(t)),e.insertRange.start.character+=e.word.lastIndexOf("\\")+1,c=t.lastIndexOf("\\")+1;else{const n=a,i=!o.namespaceName,c=t.toLowerCase(),u=new Set,f=p.keywordCompletionItems(this._getKeywords(e.parseTreeTraverser.clone()),t,e.insertRange);h.useDeclarationDefinitions.filter(e=>d.contSubstringMatch(c,e.name.toLowerCase())>0).forEach(t=>{let n=l.UseDefinition.create(t,this.definitionStore);return n.external&&u.add(n.external),r.push(this._toCompletionItem(n,h,o.namespaceName,void 0,void 0,e.insertRange)),n}),a=(e=>n(e)&&!u.has(e)&&(i||512!==e.kind)&&(512===e.kind||s.Definition.shortName(e.name).toLowerCase().indexOf(c)>-1)),Array.prototype.push.apply(r,f)}const m=new Set,g=this.definitionStore.match(t,a),k=p.MAX_ITEMS;let S=!1;for(let t of g)if((512!==t.kind||!m.has(t.name))&&(512===t.kind&&m.add(t.name),r.push(this._toCompletionItem(t,h,o.namespaceName,c,f,e.insertRange)),r.length>=k)){S=!0;break}return{items:r,isIncomplete:S}}_toCompletionItem(e,t,n,i,r,o){const a={kind:s.PhpSymbol.toLspCompletionItemKind(e),label:e.name,textEdit:{range:o,newText:e.name},data:f.create(e)};(262144&e.modifiers)>0&&(a.deprecated=!0);const d=s.Definition.namespace(e.name);if(void 0!==i)a.label=e.name.slice(i),a.textEdit.newText=a.label,r&&(a.detail=p.createUseDeclarationDetail(r.fqn,r.name));else if((4096&e.modifiers)>0)a.detail=p.createUseDeclarationDetail(e.associated[0].name,e.name,e.kind),a.label=s.Definition.shortName(e.name),a.textEdit.newText=a.label,a.sortText="a"+a.label;else if(512===e.kind||!n&&!d||8===e.kind&&this._isMagicConstant(e.name));else if(n===d)a.detail=`namespace ${n}`,a.label=s.Definition.shortName(e.name),a.textEdit.newText=a.label;else if(n&&!d)a.label=e.name,8!==e.kind&&64!==e.kind||this.options.fullyQualifyGlobalConstantsAndFunctions?a.textEdit.newText="\\"+e.name:a.textEdit.newText=a.label;else if(this.options.insertUseDeclaration){a.label=s.Definition.shortName(e.name),a.textEdit.newText=a.label;let n=void 0;if(t.findUseSymbolByName(a.label)){if(!(n=s.Definition.createAlias(e,t)))return a.textEdit.newText="\\"+e.name,this.setSortText(e,a);a.textEdit.newText=n}a.detail=p.createUseDeclarationDetail(e.name,n||a.label,e.kind),a.additionalTextEdits=[t.getUseDeclarationInsertTextEdit(e,n)]}else 512!==e.kind&&(a.label=s.Definition.shortName(e.name)),a.textEdit.newText="\\"+e.name,a.detail=e.name;return 64===e.kind?(a.textEdit.newText||(a.textEdit.newText=a.label),a.detail=p.signatureString(e,this.definitionStore.table(e.uriId)),this.definitionStore.table(e.uriId).definitionChildren(e).filter(s.Definition.isParameter).length?(a.textEdit.newText+="($0)",a.insertTextFormat=c.InsertTextFormat.Snippet,a.command=p.TRIGGER_PARAMETER_HINTS_CMD):a.textEdit.newText+="()"):8===e.kind&&void 0!==e.value&&(a.detail=`${e.name} = ${e.value}`),this.setSortText(e,a)}setSortText(e,t){return t.sortText||((65536&e.modifiers)>0?t.sortText="z"+t.label:t.sortText=t.label),t}_isMagicConstant(e){switch(e){case"__DIR__":case"__FILE__":case"__CLASS__":case"__LINE__":case"__FUNCTION__":case"__TRAIT__":case"__METHOD__":case"__NAMESPACE__":return!0;default:return!1}}_isNamePhrase(e){switch(e.kind){case 1136:case 1079:case 1139:return!0;default:return!1}}}m.NAME_PHRASE_KINDS=[1079,1136,1139];class g extends m{canSuggest(e){const t=p.correctForKeywordAndOrTrailingBackslash(e);if(t)switch(t.node.kind){case 41:return!0;case 82:e=t;break;default:return!1}return a.NodeUtils.isPhraseOfKind(e.parent(),[1116])&&a.NodeUtils.isPhraseOfKind(e.parent(),g.NAME_PHRASE_KINDS)&&a.NodeUtils.isPhraseOfKind(e.parent(),[1096])}_definitionFilter(e){return(515&e.kind)>0&&!(512&e.modifiers)}_getKeywords(e){return g.KEYWORDS}}g.KEYWORDS=["namespace","self"];class k extends m{canSuggest(e){const t=p.correctForKeywordAndOrTrailingBackslash(e);if(t)switch(t.node.kind){case 50:return!0;case 82:e=t;break;default:return!1}return a.NodeUtils.isPhraseOfKind(e.parent(),[1116])&&a.NodeUtils.isPhraseOfKind(e.parent(),k.NAME_PHRASE_KINDS)&&a.NodeUtils.isPhraseOfKind(e.parent(),[1034])}_definitionFilter(e){return(513&e.kind)>0&&!(528&e.modifiers)}_getKeywords(e){return k.KEYWORDS}_toCompletionItem(e,t,n,i,r,o){const a=super._toCompletionItem(e,t,n,i,r,o);if(512===e.kind)return a;const d=l.TypeDefinition.fromDefinition(e,this.definitionStore).findMember("__construct",2048);return a.kind=c.CompletionItemKind.Constructor,d?(this.definitionStore.table(d.uriId).definitionChildren(d).filter(s.Definition.isParameter).length&&(a.textEdit.newText||(a.textEdit.newText=a.label),a.data=f.create(d),a.textEdit.newText+="($0)",a.insertTextFormat=c.InsertTextFormat.Snippet,a.command=p.TRIGGER_PARAMETER_HINTS_CMD),a):a}}k.KEYWORDS=["class","static","namespace","self"];class S{constructor(e,t){this.options=e,this.definitionStore=t}canSuggest(e){return this.isInAnonymousFunctionUseClause(e.clone())||this.isDollarCurlyOpenVariable(e.clone())||a.NodeUtils.isTokenOfKind(e.node,[89,83])&&a.NodeUtils.isPhraseOfKind(e.parent(),[1152])}completions(e){const t=e.parseTreeTraverser.clone();let n;if(!e.word)return p.NO_COMPLETION_RESPONSE;this.isInAnonymousFunctionUseClause(e.parseTreeTraverser.clone())&&(89===t.node.kind&&t.prevToken(),t.ancestor(a.NodeUtils.isScopeNode)),n=t.ancestor(a.NodeUtils.isScopeNode);const i=t.getDefinitions(t=>(384&t.kind)>0&&t.name.indexOf(e.word)>-1,e=>!1),r=t.references(t=>(384&t.kind)>0&&t.name.indexOf(e.word)>-1,e=>!1),l=new Map(i.map(e=>[e.name,[e,void 0]]));r.forEach(e=>{const t=l.get(e.name);t?t[1]=e:l.set(e.name,[void 0,e])});const u=this.definitionStore.match(e.word,this.isSuperGlobal),h=new Set;for(let e of u)l.set(e.name,[e,void 0]),h.add(e.name);if(!l.has("$this")){const t=e.parseTreeTraverser.thisName,n={kind:256,name:"$this",uriId:0,modifiers:0};t&&(n.type=o.TypeString.fromString(t)),l.set("$this",[void 0,n])}let m;this.isInArgumentList(e.parseTreeTraverser.clone())&&(m=this.determineArgumentType(e));let g=Math.min(l.size,p.MAX_ITEMS);const k=l.size>p.MAX_ITEMS,S=[],T=[];let y,v,_,b;const P=e.word.toLowerCase(),D=this.isDollarCurlyOpenVariable(e.parseTreeTraverser);let N;for(let t of l)if(_=t[0],v=t[1],b=void 0,N=D?_.slice(1):_,v[0]&&(b=s.Definition.type(v[0])),v[1]&&!b&&(b=v[1].type),!(d.contSubstringMatch(P,_.toLowerCase())<0)&&((y={label:N,kind:c.CompletionItemKind.Variable,textEdit:{range:e.insertRange,newText:N},detail:o.TypeString.toString(b)||void 0,sortText:h.has(_)?"z"+N:N}).data=f.create(v[0]),m&&o.TypeString.isEqual(b,m)&&!h.has(_)&&T.push(y),S.push(y),--g<1))break;return 1===T.length&&(T[0].preselect=!0),{items:S,isIncomplete:k}}isDollarCurlyOpenVariable(e){return 83===(e=e.clone()).node.kind&&a.NodeUtils.isTokenOfKind(e.prevToken(),[130])}isInArgumentList(e){return a.NodeUtils.isPhraseOfKind(e.parent(),[1152])&&a.NodeUtils.isPhraseOfKind(e.parent(),[1008])}isInAnonymousFunctionUseClause(e){if(89===e.node.kind){const t=e.prevToken();return a.NodeUtils.isTokenOfKind(t,S.CLOSURE_USE_TOKENS)&&a.NodeUtils.isPhraseOfKind(e.parent(),S.CLOSURE_USE_PHRASES)}return!(83!==e.node.kind||!a.NodeUtils.isPhraseOfKind(e.parent(),[1007]))}determineArgumentType(e){const t=e.parseTreeTraverser.clone(),n=t.parent(),i=t.parent();let r=0;for(let e=0;e<i.children.length&&i.children[e]!==n;++e)92===i.children[e].kind&&++r;t.prevSibling(),t.prevSibling();const a=t.reference();if(!(a&&2144&a.kind))return[];const c=this.definitionStore.findByReference(a);let d,l,u;for(let e=0;e<c.length;++e)u=c[e],(d=this.definitionStore.table(u.uriId).definitionChildren(u).filter(s.Definition.isParameter)).length>r&&(l=o.TypeString.merge(l,s.Definition.type(d[r])));return l||[]}isSuperGlobal(e){return 256===e.kind&&(4194304&e.modifiers)>0}}S.CLOSURE_USE_PHRASES=[1007,1006,1036],S.CLOSURE_USE_TOKENS=[92,117,102];class T extends m{canSuggest(e){return!!r.isKeyword(e.node.kind)||(e=this.correctForTrailingBackslash(e),a.NodeUtils.isPhraseOfKind(e.parent(),[1116])&&void 0!==e.ancestor(this._isNamePhrase))}completions(e){if(!e.word)return p.NO_COMPLETION_RESPONSE;if(("p"===e.word||"ph"===e.word||"php"===e.word)&&0===a.NodeUtils.leadingTriviaLength(e.parseTreeTraverser.node)&&a.NodeUtils.isTokenOfKind(e.parseTreeTraverser.clone().prevToken(),[156]))return{isIncomplete:!1,items:p.keywordCompletionItems(["php"],e.word,e.insertRange)};const t=e.parseTreeTraverser.clone();if(a.NodeUtils.isTokenOfKind(t.prevToken(),[82])){if(void 0!==t.ancestor(e=>1023===e.kind))return{isIncomplete:!1,items:p.keywordCompletionItems(["implements"],e.word,e.insertRange)};const n=t.prevToken();if(a.NodeUtils.isTokenOfKind(n,[43]))return{isIncomplete:!1,items:p.keywordCompletionItems(["extends"],e.word,e.insertRange)};if(a.NodeUtils.isTokenOfKind(n,[9]))return{isIncomplete:!1,items:p.keywordCompletionItems(["implements","extends"],e.word,e.insertRange)}}return super.completions(e)}_getKeywords(e){let t=[];return Array.prototype.push.apply(t,T._expressionKeywords),Array.prototype.push.apply(t,T._statementKeywords),t}_definitionFilter(e){return(591&e.kind)>0&&!(512&e.modifiers)}}T._statementKeywords=["__halt_compiler","abstract","break","case","catch","class","const","continue","declare","default","die","do","echo","else","elseif","enddeclare","endfor","endforeach","endif","endswitch","endwhile","final","finally","for","foreach","function","global","goto","if","interface","list","namespace","return","switch","throw","trait","try","unset","use","while"],T._expressionKeywords=["array","clone","empty","eval","exit","function","include","include_once","isset","new","parent","print","require","require_once","static","yield","as","self"];class y{constructor(e,t,n){this.options=e,this.definitionStore=t,this.typeAndValueDelegate=n}completions(e){let t=e.parseTreeTraverser.clone();const n=t.ancestor(this.isMemberAccessExpr);t.nthChild(0);const i=t.thisName,r=i?l.TypeDefinition.fromName(i,this.definitionStore):void 0,s=new F(e.parseTree.nodeReferenceMap,this.definitionStore,this.typeAndValueDelegate);let a,u,h,f=t.clone().traverse(s).type,m=o.TypeString.atomicClassLikeTypes(o.TypeString.resolveThisOrStatic(f,o.TypeString.fromString(i)));if(!m)return p.NO_COMPLETION_RESPONSE;let g=[];for(let t=0,n=m.length;t<n;++t)a=m[t],(h=r&&r.name.toLowerCase()===a.toLowerCase()?r:l.TypeDefinition.fromName(a,this.definitionStore))&&(u=this.createMemberPredicate(a,e.word,r),Array.prototype.push.apply(g,Array.from(h.getMembers()).filter(u)));const k=(g=Array.from(new Set(g))).length>p.MAX_ITEMS,S=Math.min(g.length,p.MAX_ITEMS),T=[];1024!==n.kind&&1145!==n.kind&&1147!==n.kind||e.word&&!(d.contSubstringMatch(e.word.toLowerCase(),"class")>-1)||T.push({label:"class",kind:c.CompletionItemKind.Constant,textEdit:{range:e.insertRange,newText:"class"}});for(let t=0;t<S;++t)T.push(this.toCompletionItem(g[t],e.insertRange));return{isIncomplete:k,items:T}}isMemberAccessExpr(e){switch(e.kind){case 1145:case 1024:case 1147:case 1131:case 1107:return!0;default:return!1}}toCompletionItem(e,t){switch(e.kind){case 1024:return this.toClassConstantCompletionItem(e,t);case 32:case 2048:return this.toMethodCompletionItem(e,t);case 16:return this.toPropertyCompletionItem(e,t);default:throw Error("Invalid Argument")}}toMethodCompletionItem(e,t){let n={kind:c.CompletionItemKind.Method,label:e.name,detail:p.signatureString(e,this.definitionStore.table(e.uriId))};return(262144&e.modifiers)>0&&(n.deprecated=!0),"__"===e.name.slice(0,2)?n.sortText="z"+n.label:n.sortText=n.label,this.definitionStore.table(e.uriId).definitionChildren(e).filter(s.Definition.isParameter).length?(n.textEdit={range:t,newText:e.name+"($0)"},n.insertTextFormat=c.InsertTextFormat.Snippet,n.command=p.TRIGGER_PARAMETER_HINTS_CMD):n.textEdit={range:t,newText:e.name+"()"},n.data=f.create(e),n}toClassConstantCompletionItem(e,t){let n={kind:c.CompletionItemKind.Constant,label:e.name};return(262144&e.modifiers)>0&&(n.deprecated=!0),void 0!==e.value&&(n.detail=`${e.name} = ${e.value}`),n.sortText=n.label,n.textEdit={range:t,newText:n.label},n.data=f.create(e),n}toPropertyCompletionItem(e,t){let n={kind:c.CompletionItemKind.Property,label:(32&e.modifiers)>0?e.name:e.name.slice(1),detail:o.TypeString.toString(s.Definition.type(e))};return(262144&e.modifiers)>0&&(n.deprecated=!0),n.sortText=n.label,n.textEdit={range:t,newText:n.label},n.data=f.create(e),n}isNameOrRelative(e){if(!e)return!1;switch(e.kind){case 1140:case 1079:case 1139:case 1136:return!0;default:return!1}}}class v extends y{canSuggest(e){return a.NodeUtils.isTokenOfKind(e.node,[132])?a.NodeUtils.isPhraseOfKind(e.parent(),v.SCOPED_ACCESS_PHRASES):a.NodeUtils.isTokenOfKind(e.node,[83])?a.NodeUtils.isPhraseOfKind(e.parent(),[1146]):a.NodeUtils.isTokenOfKind(e.node,[89])?a.NodeUtils.isPhraseOfKind(e.parent(),[1152])&&a.NodeUtils.isPhraseOfKind(e.parent(),[1146]):a.NodeUtils.isPhraseOfKind(e.parent(),[1090])&&a.NodeUtils.isPhraseOfKind(e.parent(),[1146])}createMemberPredicate(e,t,n){const i=t.toLowerCase(),r=e.toLowerCase();if(n&&r===n.name.toLowerCase())return e=>(32&e.modifiers)>0&&(!i||d.contSubstringMatch(i,e.name.toLowerCase()))>0;if(n&&n.baseClass&&n.baseClass.name.toLowerCase()===r)return e=>!(4&e.modifiers)&&(!i||d.contSubstringMatch(i,e.name.toLowerCase())>0);if(n&&n.isAssociated(e))return e=>(32&e.modifiers)>0&&!(4&e.modifiers)&&(!i||d.contSubstringMatch(i,e.name.toLowerCase())>0);{const e=33;return t=>(t.modifiers&e)===e&&(!i||d.contSubstringMatch(i,t.name.toLowerCase())>0)}}}v.SCOPED_ACCESS_PHRASES=[1145,1024,1147];class _ extends y{canSuggest(e){return a.NodeUtils.isTokenOfKind(e.node,[114])?a.NodeUtils.isPhraseOfKind(e.parent(),[1131,1107]):a.NodeUtils.isPhraseOfKind(e.parent(),[1106])}createMemberPredicate(e,t,n){const i=t.toLowerCase();if(n&&e.toLowerCase()===n.name.toLowerCase())return e=>!(32&e.modifiers&&32!==e.kind||i&&!(d.contSubstringMatch(i,e.name.toLowerCase())>0));if(n&&n.isAssociated(e)){const e=4;return t=>!(t.modifiers&e||32&t.modifiers&&32!==t.kind||i&&!(d.contSubstringMatch(i,t.name.toLowerCase())>0))}{const e=6;return t=>!(t.modifiers&e||32&t.modifiers&&32!==t.kind||i&&!(d.contSubstringMatch(i,t.name.toLowerCase())>0))}}}class b extends m{canSuggest(e){const t=p.correctForKeywordAndOrTrailingBackslash(e);if(t){switch(t.node.kind){case 86:return a.NodeUtils.isPhraseOfKind(t.parent(),[1144]);case 92:return a.NodeUtils.isPhraseOfKind(t.parent(),[1125]);case 117:return a.NodeUtils.isPhraseOfKind(t.parent(),b.HEADER_PHRASE_KINDS);case 82:e=t;default:return!1}}return a.NodeUtils.isTokenOfKind(e.node,b.TOKEN_KINDS)&&void 0!==e.ancestor(e=>1169===e.kind)}_getKeywords(e){return b.KEYWORDS}_definitionFilter(e){return(515&e.kind)>0}}b.KEYWORDS=["self","array","callable","bool","float","int","string","iterable","object","void"],b.HEADER_PHRASE_KINDS=[1110,1083,1005],b.TOKEN_KINDS=[82,146,3,6];class P extends m{canSuggest(e){const t=p.correctForKeywordAndOrTrailingBackslash(e);if(t)switch(t.node.kind){case 28:return a.NodeUtils.isPhraseOfKind(t.parent(),[1023]);case 82:e=t;break;default:return!1}return a.NodeUtils.isTokenOfKind(e.node,[146,82])&&void 0!==e.ancestor(e=>1023===e.kind)}_getKeywords(e){return[]}_definitionFilter(e){return(513&e.kind)>0&&!(8&e.modifiers)}}class D extends m{canSuggest(e){const t=p.correctForKeywordAndOrTrailingBackslash(e);if(t)switch(t.node.kind){case 38:case 28:case 92:case 82:return void 0!==t.ancestor(this.isInterfaceClause);default:return!1}return a.NodeUtils.isTokenOfKind(e.node,[146,82])&&void 0!==e.ancestor(this.isInterfaceClause)}_getKeywords(e){return[]}_definitionFilter(e){return(514&e.kind)>0}isInterfaceClause(e){return 1031===e.kind||1097===e.kind}}class N extends m{canSuggest(e){const t=p.correctForKeywordAndOrTrailingBackslash(e);if(t){switch(t.node.kind){case 64:return a.NodeUtils.isPhraseOfKind(t.parent(),[1166]);case 92:return a.NodeUtils.isPhraseOfKind(t.parent(),[1137])&&a.NodeUtils.isPhraseOfKind(t.parent(),[1166]);case 82:e=t;break;default:return!1}}return a.NodeUtils.isTokenOfKind(e.node,[146,82])&&void 0!==e.ancestor(e=>1137===e.kind)&&a.NodeUtils.isPhraseOfKind(e.parent(),[1166])}_getKeywords(e){return[]}_definitionFilter(e){return(516&e.kind)>0}}class w{constructor(e,t){this.options=e,this.definitionStore=t}canSuggest(e){const t=p.correctForKeywordAndOrTrailingBackslash(e);if(t)switch(t.node.kind){case 49:return a.NodeUtils.isPhraseOfKind(t.parent(),[1115]);case 82:e=t;break;default:return!1}return a.NodeUtils.isTokenOfKind(e.node,[146,82])&&a.NodeUtils.isPhraseOfKind(e.parent(),[1116])&&a.NodeUtils.isPhraseOfKind(e.parent(),[1115])}completions(e){if(!e.word)return p.NO_COMPLETION_RESPONSE;const t=[],n=new Set,i=this.definitionStore.match(e.word,this._symbolFilter);let r=!1,s=p.MAX_ITEMS;const o=e.word.lastIndexOf("\\")+1,a=e.insertRange;let d;a.start.character+=o;for(let e of i)if(!n.has(e.name.toLowerCase())&&(n.add(e.name.toLowerCase()),(d={label:e.name.slice(o),kind:c.CompletionItemKind.Module}).textEdit={range:a,newText:d.label},t.push(d),--s<1)){r=!0;break}return{items:t,isIncomplete:r}}_symbolFilter(e){return 512===e.kind}}class I{constructor(e,t){this.options=e,this.definitionStore=t}canSuggest(e){const t=p.correctForKeywordAndOrTrailingBackslash(e);if(t)switch(e.node.kind){case 92:return a.NodeUtils.isPhraseOfKind(e.parent(),[1118]);case 64:case 33:case 11:case 9:return a.NodeUtils.isPhraseOfKind(e.parent(),[1119]);case 82:e=t;break;default:return!1}return a.NodeUtils.isTokenOfKind(e.node,[146,82])&&a.NodeUtils.isPhraseOfKind(e.parent(),[1116])&&a.NodeUtils.isPhraseOfKind(e.parent(),[1119,1117])}completions(e){if(!e.word)return p.NO_COMPLETION_RESPONSE;let t=[];const n=e.parseTreeTraverser.clone();r.isKeyword(n.node.kind)&&n.prevToken(),a.NodeUtils.isTokenOfKind(n.node,[146])&&n.prevToken(),n.ancestor(this.isNamespaceUseDeclaration);const i=new u.UseDeclarationHelper(e.parseTree,e.definitionTable,e.position),s=new Set;i.useDeclarationDefinitions.forEach(e=>{let t=l.UseDefinition.create(e,this.definitionStore);t&&t.external&&s.add(t.external)});const o=n.child(this.isModifier),c=this.modifierToSymbolKind(o),d=this.definitionStore.match(e.word,e=>(e.kind&c)>0&&!(4096&e.modifiers)&&!s.has(e)),h=new Set;let f=p.MAX_ITEMS,m=!1;const g=e.word.lastIndexOf("\\")+1,k=e.word.toLowerCase(),S=e.insertRange;let T;S.start.character+=g,o||g||Array.prototype.push.apply(t,p.keywordCompletionItems(["function","const"],e.word,S));for(let e of d){if(512===e.kind){if(T=e.name.toLowerCase(),h.has(T))continue;h.add(T)}if(t.push(this._toCompletionItem(e,k,g,S)),--f<1){m=!0;break}}return{isIncomplete:m,items:t}}_toCompletionItem(e,t,n,i){const r=e.name.slice(0,t.length).toLowerCase()===t;let o={kind:s.PhpSymbol.toLspCompletionItemKind(e),label:r?e.name.slice(n):s.Definition.shortName(e.name)};return(262144&e.modifiers)>0&&(o.deprecated=!0),512===e.kind||r?o.textEdit={range:i,newText:o.label}:(o.detail=e.name,o.textEdit={range:i,newText:e.name}),o.data=f.create(e),o}isNamespaceUseDeclaration(e){return 1119===e.kind}modifierToSymbolKind(e){if(!e)return 519;switch(e.kind){case 33:return 576;case 11:return 520;default:return 519}}isModifier(e){switch(e.kind){case 9:case 33:case 11:return!0;default:return!1}}}class R{constructor(e,t){this.options=e,this.definitionStore=t}canSuggest(e){const t=p.correctForKeywordAndOrTrailingBackslash(e);if(t)switch(e.node.kind){case 92:return a.NodeUtils.isPhraseOfKind(e.parent(),[1121]);case 115:return a.NodeUtils.isPhraseOfKind(e.parent(),[1119]);case 33:case 11:case 9:return a.NodeUtils.isPhraseOfKind(e.parent(),[1120]);case 82:e=t;break;default:return!1}return a.NodeUtils.isTokenOfKind(e.node,[146,82])&&a.NodeUtils.isPhraseOfKind(e.parent(),[1116])&&a.NodeUtils.isPhraseOfKind(e.parent(),[1120])}completions(e){if(!e.word)return p.NO_COMPLETION_RESPONSE;let t=[];const n=e.parseTreeTraverser.clone();let i;r.isKeyword(n.node.kind)&&n.prevToken(),146===n.node.kind&&n.prevToken(),n.ancestor(this._isNamespaceUseGroupClause)&&(i=n.child(this._isModifier)),n.ancestor(this._isNamespaceUseDeclaration);let s=n.child(this._isModifier),o=this._modifierToSymbolKind(i||s),a="";s&&n.parent(),n.child(this._isNamespaceName)&&(a=n.text);const c=new u.UseDeclarationHelper(e.parseTree,e.definitionTable,e.position),d=new Set;c.useDeclarationDefinitions.forEach(e=>{let t=l.UseDefinition.create(e,this.definitionStore);t&&t.external&&d.add(t.external)});const h=e.word.indexOf("\\")>-1;let f,m=e.word;if(h)m=a+"\\"+e.word,f=(e=>(e.kind&o)>0&&!(4096&e.modifiers)&&!d.has(e));else{const e=a.toLowerCase();f=(t=>(t.kind&o)>0&&!(4096&t.modifiers)&&!d.has(t)&&t.name.toLowerCase().slice(0,e.length)===e)}const g=this.definitionStore.match(m,f),k=new Set;let S=!1,T=p.MAX_ITEMS;const y=a.length+1,v=e.insertRange;let _;!i&&!s&&e.word.indexOf("\\")<0&&Array.prototype.push.apply(t,p.keywordCompletionItems(["function","const"],e.word,v));for(let e of g){if(512===e.kind){if(_=e.name.toLowerCase(),k.has(_))continue;k.add(_)}if(t.push(this._toCompletionItem(e,y,v)),--T<1){S=!0;break}}return{isIncomplete:S,items:t}}_toCompletionItem(e,t,n){let i={kind:s.PhpSymbol.toLspCompletionItemKind(e),label:e.name.slice(t),detail:e.name};return(262144&e.modifiers)>0&&(i.deprecated=!0),i.textEdit={range:n,newText:i.label},i.data=f.create(e),i}_isNamespaceUseGroupClause(e){return 1120===e.kind}_isNamespaceUseDeclaration(e){return 1119===e.kind}_isModifier(e){switch(e.kind){case 9:case 33:case 11:return!0;default:return!1}}_isNamespaceName(e){return 1116===e.kind}_modifierToSymbolKind(e){if(!e)return 519;switch(e.kind){case 33:return 576;case 11:return 520;default:return 519}}}class x{constructor(e){this.options=e}canSuggest(e){const t=e.clone();if(a.NodeUtils.isPhraseOfKind(t.parent(),[1061])){const n=e.prevToken();return!a.NodeUtils.isTokenOfKind(n,[65,64])&&(!!a.NodeUtils.isPhraseOfKind(e.parent(),[1105])||(!(!n||115!==n.kind||!a.NodeUtils.isPhraseOfKind(e.clone().parent(),x.DECLARATION_KINDS))||a.NodeUtils.isPhraseOfKind(t.parent(),x.PHRASE_KINDS)))}return a.NodeUtils.isPhraseOfKind(e.parent(),x.PHRASE_KINDS)}completions(e){if(!e.word)return p.NO_COMPLETION_RESPONSE;let t=x.KEYWORDS;const n=this.memberModifiers(e.parseTreeTraverser.clone());if(this.isInterface(e.parseTreeTraverser.clone()))t=n.length?d.arrayDifference(["function","public","static"],n):["const","public","static","function"];else if(n.length>0){t=["public","private","protected","function","static"];const e=n.indexOf("abstract")>-1,i=n.indexOf("final")>-1;e||i||t.push("abstract","final"),t=d.arrayDifference(t,n)}return{items:p.keywordCompletionItems(x.KEYWORDS,e.word,e.insertRange)}}isInterface(e){return e.parent(),a.NodeUtils.isPhraseOfKind(e.node,[1061])&&a.NodeUtils.isPhraseOfKind(e.parent(),[1099,1101])}memberModifiers(e){e.prevToken();const t=e.parent(),n=[];if(!t||1105!==t.kind)return n;let i;for(let e=0;e<t.children.length;++e)(i=this.memberModifierTokenToText(t.children[e]))&&n.push(i);return n}memberModifierTokenToText(e){switch(e.kind){case 53:return"public";case 54:return"protected";case 52:return"private";case 29:return"final";case 58:return"static";case 2:return"abstract";case 29:return"final";default:return""}}}x.PHRASE_KINDS=[1029,1099,1162,1032,1164,1101],x.DECLARATION_KINDS=[1028,1161,1002,1098],x.KEYWORDS=["var","public","private","protected","final","function","abstract","use","static"];class E{constructor(e,t){this.options=e,this.definitionStore=t}canSuggest(e){return e.prevToken(),33===e.node.kind&&a.NodeUtils.isPhraseOfKind(e.parent(),[1110])&&void 0!==e.ancestor(this.isClassMemberDeclarationList)}completions(e){if(!e.word)return p.NO_COMPLETION_RESPONSE;const t=e.parseTreeTraverser;t.ancestor(this._isMethodDeclarationHeader);const n=t.nthChild(0);let i=0;if(1105===n.kind&&(i=n.children.reduce((e,t)=>e|this.memberModifierTokenToSymbolModifier(t),0)),20&i)return p.NO_COMPLETION_RESPONSE;i&=3;let r=t.thisDefinition,s=e.definitionTable.definitionChildren(r).filter(this._isMethod),o=new Set(s.map(this._toName));const a=e.word.toLowerCase();const c=l.TypeDefinition.fromDefinition(r,this.definitionStore),u=Array.from(c.getMembers()).filter(e=>32===e.kind&&(!i||(e.modifiers&i)>0)&&!(12&e.modifiers)&&!o.has(e.name.toLowerCase())&&d.contSubstringMatch(a,e.name.toLowerCase())>0);let h=u.length>p.MAX_ITEMS;const f=Math.min(p.MAX_ITEMS,u.length),m=[];let g;for(let t=0;t<f;++t)(g=u[t]).name&&"_"===g.name[0]&&o.add(g.name),m.push(this._toCompletionItem(g,e.insertRange));return Array.prototype.push.apply(m,this._magicMethodCompletionItems(e.word,o,e.insertRange)),{isIncomplete:h,items:m}}memberModifierTokenToSymbolModifier(e){if(!e)return 0;switch(e.kind){case 53:return 1;case 54:return 2;case 52:return 4;case 2:return 16;case 29:return 8;case 58:return 32;default:return 0}}_magicMethodCompletionItems(e,t,n){let i;const r=[],s=Object.keys(E.MAGIC_METHODS),o=e.toLowerCase();for(let e=0;e<s.length;++e)i=s[e],d.contSubstringMatch(o,i.toLowerCase())&&!t.has(i)&&r.push({kind:c.CompletionItemKind.Method,label:i,textEdit:{range:n,newText:E.MAGIC_METHODS[i]},insertTextFormat:c.InsertTextFormat.Snippet});return r}_toCompletionItem(e,t){let n=this.definitionStore.table(e.uriId).definitionChildren(e).filter(s.Definition.isParameter),i=[];for(let e=0,t=n.length;e<t;++e)i.push(this._parameterToString(n[e]));let r=i.join(", "),o=p.snippetEscape(r),a=`${e.name}(${o})${p.snippetEscape(this._returnType(e))}\n{\n\t$0\n\\}`,d=this.definitionStore.table(e.uriId).definitionScope(e);return{kind:c.CompletionItemKind.Method,label:e.name,textEdit:{range:t,newText:a},insertTextFormat:c.InsertTextFormat.Snippet,detail:`${d?d.name:"mixed"}::${e.name}`,data:f.create(e)}}_returnType(e){if(e.type&&e.type.declared){return`: ${o.TypeString.toTypeDeclarationString(e.type.declared,e)}`}return""}_parameterToString(e){let t=[];if(e.type&&e.type.declared){const n=o.TypeString.toTypeDeclarationString(e.type.declared,e);t.push(n)}return t.push(e.name),e.value&&t.push(`= ${e.value}`),t.join(" ")}_isMethodDeclarationHeader(e){return 1110===e.kind}_isMethod(e){return 32===e.kind}_toName(e){return e.name.toLowerCase()}isClassMemberDeclarationList(e){return 1032===e.kind}}E.MAGIC_METHODS={__construct:"__construct($1)\n{\n\t$0\n\\}",__destruct:"__destruct()\n{\n\t$0\n\\}",__call:"__call(\\$name, \\$arguments)\n{\n\t$0\n\\}",__callStatic:"__callStatic(\\$name, \\$arguments)\n{\n\t$0\n\\}",__get:"__get(\\$name)\n{\n\t$0\n\\}",__set:"__set(\\$name, \\$value)\n{\n\t$0\n\\}",__isset:"__isset(\\$name)\n{\n\t$0\n\\}",__unset:"__unset(\\$name)\n{\n\t$0\n\\}",__sleep:"__sleep()\n{\n\t$0\n\\}",__wakeup:"__wakeup()\n{\n\t$0\n\\}",__toString:"__toString()\n{\n\t$0\n\\}",__invoke:"__invoke($1)\n{\n\t$0\n\\}",__set_state:"__set_state(\\$properties)\n{\n\t$0\n\\}",__clone:"__clone()\n{\n\t$0\n\\}",__debugInfo:"__debugInfo()\n{\n\t$0\n\\}"};class M{constructor(e,t){this.options=e,this.definitionStore=t}canSuggest(e){const t=e.node;return e.prevToken(),102!==e.node.kind&&133!==e.node.kind||e.prevToken(),102!==e.node.kind&&133!==e.node.kind||e.prevToken(),(83===t.kind||89===t.kind)&&void 0!==e.ancestor(e=>1169===e.kind)&&void 0!==e.ancestor(e=>1124===e.kind)}completions(e){const t=e.parseTreeTraverser.clone();t.prevToken(),102!==t.node.kind&&133!==t.node.kind||t.prevToken(),102!==t.node.kind&&133!==t.node.kind||t.prevToken();const n=t.reference();if(!n)return p.NO_COMPLETION_RESPONSE;const i="$"+d.lcFirst(s.Definition.shortName(n.name));return{items:[{label:i,kind:c.CompletionItemKind.Variable,textEdit:{range:e.insertRange,newText:i}}],isIncomplete:!1}}}class C{constructor(e,t){this.options=e,this.definitionStore=t}canSuggest(e){return void 0!==e.ancestor(e=>1111===e.kind)}completions(e){let t,n=e.parseTreeTraverser.clone();if(132===n.prevToken().kind){n.prevToken();const i=n.reference();let r;if(i&&i.name&&(r=l.TypeDefinition.fromName(i.name,this.definitionStore,4)),!r)return p.NO_COMPLETION_RESPONSE;t=this.findMembers(r,e.word);const o=[];let a=!1;for(let n of t)if(o.push({label:n.name,kind:c.CompletionItemKind.Method,textEdit:{range:e.insertRange,newText:n.name},detail:s.Definition.fqsen(n.name,r.name,32),deprecated:(262144&n.modifiers)>0,data:f.create(n)}),o.length>p.MAX_ITEMS){a=!0;break}return{isIncomplete:a,items:o}}{(n=e.parseTreeTraverser.clone()).ancestor(e=>1166===e.kind);const i=p.traitUseClauseDefinitions(n,this.definitionStore),r=new u.UseDeclarationHelper(e.parseTree,this.definitionStore.table(e.parseTree.id),e.position),s=new Map;r.useDeclarationDefinitions.forEach(e=>{e.associated&&e.associated.length&&s.set(e.associated[0].name,e)});let o=!1;const a=[];let l,h,m=e.word.toLowerCase();for(let n of i){l=n.name,(h=s.get(l))&&d.contSubstringMatch(m,h.name.toLowerCase())>-1?a.push({label:h.name,kind:c.CompletionItemKind.Module,textEdit:{range:e.insertRange,newText:h.name},deprecated:(262144&n.modifiers)>0,detail:p.createUseDeclarationDetail(l,h.name),data:f.create(n)}):d.contSubstringMatch(m,n.name.toLowerCase())>-1&&a.push({label:n.name,kind:c.CompletionItemKind.Module,textEdit:{range:e.insertRange,newText:n.name},deprecated:(262144&n.modifiers)>0,data:f.create(n)}),t=this.findMembers(n,e.word);for(let i of t)if(a.push({label:i.name,kind:c.CompletionItemKind.Method,textEdit:{range:e.insertRange,newText:(h?h.name:n.name)+"::"+i.name},detail:(h?h.name:n.name)+"::"+i.name,deprecated:(262144&i.modifiers)>0,data:f.create(i)}),a.length>p.MAX_ITEMS){o=!0;break}if(a.length>p.MAX_ITEMS){o=!0;break}}return{isIncomplete:o,items:a}}}findMembers(e,t){let n=t.toLowerCase(),i=[];for(let t of e.getMembers())32===t.kind&&d.contSubstringMatch(n,t.name.toLowerCase())>-1&&i.push(t);return i}}class O{constructor(e,t){this.options=e,this.definitionStore=t}canSuggest(e){return e.prevToken(),void 0!==e.ancestor(e=>1111===e.kind)}completions(e){return{isIncomplete:!1,items:p.keywordCompletionItems(["insteadof","as"],e.word,e.insertRange)}}}class A{constructor(e,t){this.options=e,this.definitionStore=t}canSuggest(e){let t=e.prevToken();return t&&4===t.kind&&void 0!==e.ancestor(e=>1160===e.kind)}completions(e){return{isIncomplete:!1,items:p.keywordCompletionItems(["public","protected","private"],e.word,e.insertRange)}}}class U{constructor(e,t){this.options=e,this.definitionStore=t}canSuggest(e){if(void 0!==e.clone().ancestor(e=>1137===e.kind)&&void 0!==e.ancestor(e=>1165===e.kind))return!0;let t=e.prevToken();return t&&42===t.kind&&void 0!==e.ancestor(e=>1165===e.kind)}completions(e){let t=e.parseTreeTraverser.clone();t.prevToken();const n=t.clone();n.ancestor(e=>1166===e.kind);let i=p.traitUseClauseDefinitions(n,this.definitionStore);t.prevSibling(),t.nthChild(0),t.lastChild();const r=t.reference();r&&(i=i.filter(e=>e.name!==r.name));const s=new u.UseDeclarationHelper(e.parseTree,this.definitionStore.table(e.parseTree.id),e.position),o=new Map;s.useDeclarationDefinitions.forEach(e=>{e.associated&&e.associated.length&&o.set(e.associated[0].name,e)});const a=[];let l,h,m=e.word.toLowerCase();for(let t of i)l=t.name,(h=o.get(l))&&d.contSubstringMatch(m,h.name.toLowerCase())>-1?a.push({label:h.name,kind:c.CompletionItemKind.Module,textEdit:{range:e.insertRange,newText:h.name},deprecated:(262144&t.modifiers)>0,detail:p.createUseDeclarationDetail(l,h.name),data:f.create(t)}):d.contSubstringMatch(m,t.name.toLowerCase())>-1&&a.push({label:t.name,kind:c.CompletionItemKind.Module,textEdit:{range:e.insertRange,newText:t.name},deprecated:(262144&t.modifiers)>0,data:f.create(t)});return{isIncomplete:!1,items:a}}}class L extends m{constructor(e,t){super(e,t),this.options=e,this.definitionStore=t}canSuggest(e){return 159===e.node.kind}completions(e){let t=e.document.textToLeftOfOffset(e.offset,e.offset-e.document.lineOffset(e.position.line));if(t.match(L.TYPE_TAG_PATTERN)||t.match(L.METHOD_PARAM_PATTERN)){let t=e.document.wordToLeftOfOffset(e.offset,L.CLASS_NAME_PATTERN);const n=c.Range.create(c.Position.create(e.position.line,e.position.character-t.length),e.position);if("\\"===t)return p.NO_COMPLETION_RESPONSE;if("$"===t[0])return{isIncomplete:!1,items:[{label:"$this",kind:c.CompletionItemKind.Variable,textEdit:{range:n,newText:"$this"}}]};{const i=e.parseTreeTraverser.getNameResolver(),r=new u.UseDeclarationHelper(e.parseTree,e.definitionTable,e.position);let o=!1,a=t.indexOf("\\");const c=p.keywordCompletionItems(L.KEYWORDS,t,n),h=new Set,f=515,m=!i.namespaceName,g=t.toLowerCase();let k,S,T;a>-1?(0===t.indexOf("namespace")?(o=!0,t=t.replace("namespace",i.namespaceName)):0===a?t=t.slice(1):(k=i.matchUnqualified(t.slice(0,a),1),t=i.resolveNotFullyQualified(t)),T=t.lastIndexOf("\\")+1,S=(e=>(e.kind&f)>0)):(r.useDeclarationDefinitions.filter(e=>d.contSubstringMatch(g,e.name.toLowerCase())>0).forEach(t=>{let n=l.UseDefinition.create(t,this.definitionStore);return n.external&&h.add(n.external),c.push(this._toCompletionItem(n,r,i.namespaceName,void 0,void 0,e.insertRange)),n}),S=(e=>(e.kind&f)>0&&!h.has(e)&&(m||512!==e.kind)&&(512===e.kind||s.Definition.shortName(e.name).toLowerCase().indexOf(g)>-1)));const y=new Set,v=this.definitionStore.match(t,S),_=p.MAX_ITEMS;let b=!1;for(let t of v)if((512!==t.kind||!y.has(t.name))&&(512===t.kind&&y.add(t.name),c.push(this._toCompletionItem(t,r,i.namespaceName,T,k,e.insertRange)),c.length>=_)){b=!0;break}return{items:c,isIncomplete:b}}}if(t.match(L.TAG_PATTERN)){const t=e.document.wordToLeftOfOffset(e.offset,L.TAG_NAME_PATTERN);return{isIncomplete:!1,items:p.keywordCompletionItems(L.TAG_NAMES,t.toLowerCase(),c.Range.create(c.Position.create(e.position.line,e.position.character-t.length),e.position))}}return p.NO_COMPLETION_RESPONSE}_definitionFilter(e){return!0}_getKeywords(e){return L.KEYWORDS}}L.TYPE_TAG_PATTERN=/@(?:method(?:\s+static)?|global|param|property(?:-(?:read|write))?|return|throws|var)\s+\$?[\\a-zA-Z_\x80-\uffff][\\a-zA-Z0-9_\x80-\uffff]*$/,L.METHOD_PARAM_PATTERN=/@method(?:\s+static)?\s+(?:\$?[\\a-zA-Z_\x80-\uffff][\\a-zA-Z0-9_\x80-\uffff]*\s+)?[a-zA-Z_\x80-\uffff]+\s*\((?:[^,)]+,)*\s*\$?[\\a-zA-Z_\x80-\uffff][\\a-zA-Z0-9_\x80-\uffff]*$/,L.TAG_PATTERN=/^(?:\/\*+|[\t ]*\*+)?[\t ]*@[a-zA-Z]*$/,L.TAG_NAME_PATTERN=/@[a-zA-Z]*$/,L.CLASS_NAME_PATTERN=/\$?[\\a-zA-Z_\x80-\uffff][\\a-zA-Z0-9_\x80-\uffff]*$/,L.TAG_NAMES=["@api","@author","@category","@copyright","@deprecated","@example","@filesource","@global","@ignore","@inheritdoc","@internal","@license","@link","@method","@package","@param","@property","@property-read","@property-write","@return","@see","@since","@source","@subpackage","@throws","@todo","@uses","@var","@version"],L.KEYWORDS=["self","array","callable","bool","float","int","string","iterable","object","void"];class F{constructor(e,t,n){this.nodeReferenceMap=e,this.definitionStore=t,this.typeAndValueDelegate=n,this.typeStack=[[]],this.ignore=new Set}get type(){const e=this.typeStack.pop();return e.length?e[0]:o.TypeString.MIXED_TYPE_STRING}preorder(e,t){if(this.ignore.has(e))return!1;switch(this.typeStack.push([]),e.kind){case 1107:case 1131:case 1145:case 1147:case 1024:return this.ignoreMany(e.children.filter((e,t,n)=>2!==t)),!0;case 1151:case 1016:case 1156:return this.ignoreMany(e.children.slice(1)),!0;case 1057:return this.ignoreMany(e.children.filter((e,t,n)=>1!==t)),!0;case 1123:case 1035:case 1034:case 1037:case 1040:case 1079:case 1139:case 1136:case 1009:case 1011:case 1013:return!0;case 1080:{const t=e.children[0];return!(!a.NodeUtils.isNamePhrase(t)&&!this.isClosureSimpleVariable(t))&&(this.ignoreMany(e.children.slice(1)),!0)}default:return!1}}postorder(e,t){if(this.ignore.has(e))return;const n=this.typeStack.pop();let i,r;switch(e.kind){case 1116:case 1140:r=this.nodeReferenceMap.get(e),this.typeStackTop().push(r.type?r.type:o.TypeString.fromString(r.name));break;case 1106:case 1146:case 1152:r=this.nodeReferenceMap.get(e),this.typeStackTop().push(r.type);break;case 1080:i=o.TypeString.mergeMany(n),o.TypeString.isEqual(i,o.TypeString.CLOSURE_TYPE_STRING)?this.typeStackTop().push(this.getAnonFnReturnType(i)):i&&this.typeStackTop().push(i);break;case 1156:i=o.TypeString.mergeMany(n),this.typeStackTop().push(this.getArrayAccessType(i));break;case 1040:(i=o.TypeString.mergeMany(n.slice(-2)))&&this.typeStackTop().push(i);break;case 1009:i=o.TypeString.mergeMany(n),(i=o.TypeString.arrayReference(i))&&this.typeStackTop().push(i);break;default:(i=o.TypeString.mergeMany(n))&&this.typeStackTop().push(i)}}getAnonFnReturnType(e){let t,n,i=o.TypeString.toArray(o.TypeString.atomicClassLikeTypes(e));const r=e=>64===e.kind&&(512&e.modifiers)>0;let a;for(let e=0,c=i.length;e<c;++e){t=i[e],n=this.definitionStore.find(t,r);for(let e of n)(a=o.TypeString.merge(a,s.Definition.type(e)))||(a=o.TypeString.merge(a,this.typeAndValueDelegate(e).type))}return a||o.TypeString.MIXED_TYPE_STRING}getArrayAccessType(e){const t=o.TypeString.toArray(o.TypeString.atomicClassLikeTypes(e));let n,i;for(let e=0,r=t.length;e<r;++e)if(n=t[e],(i=l.TypeDefinition.fromName(n,this.definitionStore,3))&&i.isAssociated("ArrayAccess")){let e=i.findMember("offsetGet",32);if(e){let t=s.Definition.type(e);if(!t){t=this.typeAndValueDelegate(e).type}return t}}return o.TypeString.arrayDereference(e)}isClosureSimpleVariable(e){return 1152===e.kind&&this.nodeReferenceMap.has(e)&&o.TypeString.isEqual(this.nodeReferenceMap.get(e).type,o.TypeString.CLOSURE_TYPE_STRING)}typeStackTop(){return this.typeStack[this.typeStack.length-1]}ignoreMany(e){for(let t=0,n=e.length;t<n;++t)this.ignore.add(e[t])}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(15),r=n(16),s=n(30);!function(e){function t(e){switch(e.kind){case 112:return[48,2];case 134:case 128:case 85:case 151:case 152:case 149:case 155:case 150:case 147:case 148:case 93:return[47,2];case 41:return[46,0];case 88:return[45,2];case 100:case 90:case 91:return[44,1];case 110:case 142:case 125:return[43,1];case 105:case 107:return[42,1];case 98:case 99:case 140:case 136:return[41,0];case 135:case 137:case 138:case 139:case 141:return[40,0];case 102:return[39,1];case 124:return[38,1];case 122:return[37,1];case 101:return[36,1];case 123:return[35,1];case 121:return[34,2];case 95:return[33,1];case 84:case 126:case 111:case 143:case 145:case 129:case 144:case 113:case 103:case 109:case 104:case 106:case 108:return[32,2];case 46:return[31,1];case 48:return[30,1];case 47:return[29,1];default:Y(e)}}function n(e){switch(e.kind){case 53:case 54:case 52:case 58:case 2:case 29:case 33:case 65:case 11:case 64:case 118:return!0;default:return!1}}function o(e){switch(e.kind){case 95:return 1040;case 125:case 110:case 142:return 1001;case 122:case 102:case 124:return 1014;case 100:case 90:case 91:return 1112;case 112:return 1065;case 105:case 107:return 1150;case 101:case 123:case 46:case 47:case 48:return 1104;case 137:case 139:case 135:case 138:return 1060;case 98:case 140:case 99:case 136:case 141:return 1138;case 121:return 1037;case 84:return 1151;case 111:case 143:case 145:case 113:case 129:case 126:case 144:case 103:case 109:case 104:case 106:case 108:return 1038;case 41:return 1095;default:return 1e3}}var a,c,d,l=0,u=-1;function h(e){return e===T().kind?p():void 0}function f(e){return e.indexOf(T().kind)>-1?p():void 0}function p(e){let t;do{t=a.length>0?a.shift():i.Lexer.lex(),l+=t.length,e&&162===t.kind&&(t.kind=159)}while(t.kind>159);return u=-1,t}function m(){return u<0&&(u=l+function(e){let t=0;for(;(e=e.previous)&&e.kind>=160;)t+=e.length;return t}(T())),u}function g(e){let t=l-e;return t>0?t:0}function k(e){let t=T();if(t.kind===e)return p();if(87===e&&158===t.kind)return p();{const n=s.ProblemFactory.unexpectedToken(t,e);let i;if(T(1).kind===e){const e=m();i=r.Phrase.createParseError([p(),p()],g(e))}else i=r.Phrase.createParseError([]);return d.set(i,n),i}}function S(e){let t=T();if(e.indexOf(t.kind)>-1)return p();if(e.indexOf(87)>-1&&158===t.kind)return p();{const n=s.ProblemFactory.unexpectedToken(t);let i;if(e.indexOf(T(1).kind)>-1){const e=m();i=r.Phrase.createParseError([p(),p()],g(e))}return i=r.Phrase.createParseError([]),d.set(i,n),i}}function T(e,t){e=e?e+1:1;let n,r=-1;do{++r===a.length&&a.push(i.Lexer.lex()),n=a[r],t&&162===n.kind&&(n.kind=159),n.kind<160&&--e}while(1!==n.kind&&e>0);return n}function y(e,t){let n=T(),i=[];for(;!e(n)&&1!==n.kind;)i.push(p()),n=T();return t&&1!==n.kind&&i.push(p()),i}function v(e,t,n,i,o,a){const l=m();let u,h=[];for(c.push(o);;)if(n(u=T(0,a)))h.push(t());else{if(!i||i.indexOf(u.kind)>-1)break;{let e=T(1,a),t=m();const c=s.ProblemFactory.unexpectedToken(u);let l;if(_(u)){l=r.Phrase.createParseError([],g(t)),h.push(l),d.set(l,c);break}if(n(e)||i&&i.indexOf(e.kind)>-1)u=p(a),l=r.Phrase.createParseError([u],g(t)),h.push(l),d.set(l,c);else{const e=y(_),n=r.Phrase.createParseError(e,g(t));if(h.push(n),d.set(n,c),u=T(0,a),!o||!o(u))break}}}return c.pop(),r.Phrase.create(e,g(l),h)}function _(e){let t;for(let n=c.length-1;n>=0;--n)if((t=c[n])&&t(e))return!0;return!1}function b(){return y(_)}function P(e){return v(1153,de,Et,e,t=>(function(e){switch(e.kind){case 64:case 11:case 33:case 9:case 2:case 29:case 61:case 43:case 115:case 37:case 66:case 15:case 31:case 59:case 5:case 12:case 57:case 34:case 58:case 16:case 63:case 32:case 13:case 62:case 60:case 35:case 87:case 158:case 157:case 80:case 156:return!0;default:return!1}})(t)||e.indexOf(t.kind)>-1,!0)}function D(e){return 92===e.kind||87===e.kind||158===e.kind}function N(e){return 82===e.kind||xt(e)}function w(e){return 82===e.kind}function I(){const e=m(),t=k(82),n=k(84),i=x(0);return r.Phrase.create(1043,g(e),[t,n,i])}function R(e){switch(e.kind){case 1152:case 1156:case 1147:case 1131:case 1080:case 1107:case 1145:return!0;default:return!1}}function x(e){let n,i;const a=m();let c,l=function(){let e=T();switch(e.kind){case 58:return 33===T(1).kind?We():M();case 77:return A(T(1))?M():p();case 83:case 89:case 3:case 116:case 146:case 82:case 49:case 117:return M();case 134:return $e(1129);case 128:return $e(1128);case 110:case 142:case 88:case 85:return $e(1170);case 93:return $e(1062);case 151:case 152:case 149:case 155:case 150:case 147:case 148:return $e(1019);case 45:return function(){const e=m(),t=p(),n=k(117);if(!Ye(T())){const i=k(120);return r.Phrase.create(1103,g(e),[t,n,i])}const i=mt(120,ft),s=k(120);return r.Phrase.create(1103,g(e),[t,n,i,s])}();case 10:return function(){const e=m(),t=p(),n=x(0);return r.Phrase.create(1035,g(e),[t,n])}();case 50:return function(){const e=m(),t=p();if(9===T().kind){const n=function(){const e=m(),t=function(){const e=m(),t=[];t.push(p());const n=h(117);n&&(t.push(n),dt(T())&&t.push(ct()),t.push(k(120)));28===T().kind&&t.push(ae());38===T().kind&&t.push(K());return r.Phrase.create(1003,g(e),t)}(),n=J(1029,B,H);return r.Phrase.create(1002,g(e),[t,n])}();return r.Phrase.create(1123,g(e),[t,n])}const n=Be(1034),i=h(117);if(!i)return r.Phrase.create(1123,g(e),[t,n]);if(!dt(T())){const s=k(120);return r.Phrase.create(1123,g(e),[t,n,i,s])}const s=ct(),o=k(120);return r.Phrase.create(1123,g(e),[t,n,i,s,o])}();case 78:case 81:case 71:case 70:case 69:case 75:case 73:case 72:case 74:case 76:return p();case 153:return function(){const e=m(),t=p(),n=L(154),i=k(154);return r.Phrase.create(1089,g(e),[t,n,i])}();case 96:return function(){const e=m(),t=p(),n=L(96),i=k(96);return r.Phrase.create(1051,g(e),[t,n,i])}();case 94:return function(){const e=m(),t=p(),n=L(94),i=k(94);return r.Phrase.create(1149,g(e),[t,n,i])}();case 51:return function(){const e=m(),t=p(),n=x(0);return r.Phrase.create(1130,g(e),[t,n])}();case 67:return function(){const e=m(),t=p();if(!Ue(T()))return r.Phrase.create(1176,g(e),[t]);const n=x(0),i=h(131);if(!i)return r.Phrase.create(1176,g(e),[t,n]);const s=x(0);return r.Phrase.create(1176,g(e),[t,n,i,s])}();case 68:return function(){const e=m(),t=p(),n=x(0);return r.Phrase.create(1177,g(e),[t,n])}();case 33:return We();case 39:return U(1092);case 40:return U(1093);case 55:return U(1141);case 56:return U(1142);case 26:return function(){const e=m(),t=p(),n=k(117),i=x(0),s=k(120);return r.Phrase.create(1063,g(e),[t,n,i,s])}();case 19:return function(){const e=m(),t=p(),n=k(117),i=x(0),s=k(120);return r.Phrase.create(1056,g(e),[t,n,i,s])}();case 27:return function(){const e=m(),t=p(),n=h(117);if(!n)return r.Phrase.create(1064,g(e),[t]);if(!Ue(T())){const i=k(120);return r.Phrase.create(1064,g(e),[t,n,i])}const i=x(0),s=k(120);return r.Phrase.create(1064,g(e),[t,n,i,s])}();case 44:return function(){const e=m(),t=p(),n=k(117),i=ye([120],X),s=k(120);return r.Phrase.create(1102,g(e),[t,n,i,s])}();default:{const t=s.ProblemFactory.unexpectedToken(e),n=r.Phrase.createParseError([]);return d.set(n,t),n}}}(),u=T(),f=o(u);for(;1e3!==f&&([n,i]=t(u),!(n<e)||(1151===f||1038===f)&&R(l)||1151===f&&(1103===(S=l).kind||1009===S.kind&&S.children&&S.children.length&&116===S.children[0].kind));)if(1===i&&++n,1040!==f){if(u=p(),1095===f)c=Be(1096),l=r.Phrase.create(f,g(a),[l,u,c]);else if(1151===f&&102===T().kind){const e=p();c=x(n),l=r.Phrase.create(1016,g(a),[l,u,e,c])}else c=x(n),l=r.Phrase.create(f,g(a),[l,u,c]);f=o(u=T())}else l=E(a,l),f=o(u=T());var S;return l}function E(e,t){const n=p();let i,s=h(86);if(s)return i=x(0),r.Phrase.create(1040,g(e),[t,n,s,i]);const o=x(0);return s=k(86),i=x(0),r.Phrase.create(1040,g(e),[t,n,o,s,i])}function M(){const e=m();let t=yt(),n=1152===t.kind;if(A(T()))t=Je(e,t),n=!0;else switch(t.kind){case 1136:case 1079:case 1139:t=C(e,t)}if(!n)return t;let i=T();return 134===i.kind?O(e,1127,t):128===i.kind?O(e,1126,t):t}function C(e,t){return r.Phrase.create(1041,g(e),[t])}function O(e,t,n){const i=p();return r.Phrase.create(t,g(e),[n,i])}function A(e){switch(e.kind){case 116:case 115:case 114:case 117:case 132:return!0;default:return!1}}function U(e){const t=m(),n=p(),i=x(0);return r.Phrase.create(e,g(t),[n,i])}function L(e){return v(1059,V,F,[e],t=>(function(e){switch(e.kind){case 79:case 130:case 127:return!0;default:return!1}})(t)||t.kind===e)}function F(e){switch(e.kind){case 79:case 83:case 130:case 127:return!0;default:return!1}}function V(){switch(T().kind){case 79:return p();case 83:{let e=T(1);return 116===e.kind?function(){const e=m(),t=vt(),n=p();let i;switch(T().kind){case 82:case 81:i=p();break;case 83:i=vt();break;case 142:{const e=m(),t=p(),n=k(81);i=r.Phrase.create(1170,g(e),[t,n])}break;default:i=r.Phrase.createParseError([]),d.set(i,s.ProblemFactory.unexpectedToken(T()))}const o=k(119);return r.Phrase.create(1156,g(e),[t,n,i,o])}():114===e.kind?function(){const e=m(),t=vt(),n=p(),i=k(82);return r.Phrase.create(1131,g(e),[t,n,r.Phrase.create(1106,i.length,[i])])}():vt()}case 130:return function(){const e=m(),t=p(),n=T();let i;if(83===n.kind)if(116===T(1).kind)i=function(){const e=m(),t=p(),n=p(),i=x(0),s=k(119);return r.Phrase.create(1156,g(e),[t,n,i,s])}();else{const e=m(),t=p();i=r.Phrase.create(1152,g(e),[t])}else if(Ue(n))i=x(0);else{const e=s.ProblemFactory.unexpectedToken(n);i=r.Phrase.createParseError([]),d.set(i,e)}const o=k(118);return r.Phrase.create(1058,g(e),[t,i,o])}();case 127:return function(){const e=m(),t=p(),n=Je(e,yt()),i=k(118);return r.Phrase.create(1058,g(e),[t,n,i])}();default:Y(T())}}function G(e){return 92===e.kind||115===e.kind}function K(){const e=m(),t=p(),n=He([115],G);return r.Phrase.create(1031,g(e),[t,n])}function H(){return v(1032,q,B,[118],n,!0)}function B(e){switch(e.kind){case 53:case 54:case 52:case 58:case 2:case 29:case 33:case 65:case 11:case 64:case 159:return!0;default:return!1}}function q(){const e=m();let t=T();switch(t.kind){case 53:case 54:case 52:case 58:case 2:case 29:{const n=function(){const e=m();let t=[];for(;Ke(T());)t.push(p());return r.Phrase.create(1105,g(e),t)}();if(83===(t=T()).kind)return Ve(e,n);if(33===t.kind)return z(e,n);if(11===t.kind)return Ae(e,n);return n.children.findIndex(e=>2===e.kind||29===e.kind)>-1?z(e,n):Ve(e,n)}case 33:return z(e);case 65:return Ve(e,p());case 11:return Ae(e);case 64:return function(){const e=m(),t=p(),n=He([87,115],$),i=function(){const e=m(),t=S([87,115]);if(115!==t.kind)return r.Phrase.create(1167,g(e),[t]);if(!j(T())){const n=k(118);return r.Phrase.create(1167,g(e),[t,n])}const n=v(1159,W,j,[118],e=>118===e.kind),i=k(118);return r.Phrase.create(1167,g(e),[t,n,i])}();return r.Phrase.create(1166,g(e),[t,n,i])}();case 159:return p();default:Y(t)}}function Y(e){throw new Error(`Unexpected token: ${i.tokenKindToString(e.kind)}`)}function $(e){switch(e.kind){case 92:case 87:case 115:return!0;default:return!1}}function j(e){switch(e.kind){case 82:case 146:case 49:return!0;default:return xt(e)}}function W(){const e=m(),t=function(){const e=m(),t=T(),n=T(1);if(146===t.kind||49===t.kind||82===t.kind&&(132===n.kind||146===n.kind)){const t=lt(),n=k(132),i=Q();return r.Phrase.create(1111,g(e),[t,n,i])}{const t=Q();return r.Phrase.create(1111,g(e),[t])}}();let n=S([4,42]);if(42===n.kind)return function(e,t){return t.push(He([87],D)),t.push(k(87)),r.Phrase.create(1165,g(e),t)}(e,[t,n]);if(4===n.kind)return function(e,t){let n=T();if(82===n.kind||Rt(n))t.push(Q());else if(Ke(n))t.push(p()),(82===(n=T()).kind||xt(n))&&t.push(Q());else{const e=s.ProblemFactory.unexpectedToken(n),i=r.Phrase.createParseError([]);d.set(i,e),t.push(i)}return t.push(k(87)),r.Phrase.create(1160,g(e),t)}(e,[t,n]);{const i=1===t.children.length?1160:1165;return r.Phrase.create(i,g(e),[t,n,r.Phrase.createParseError([])])}}function X(e){return 92===e.kind||120===e.kind}function z(e,t){const n=function(e,t){const n=[];t&&n.push(t),n.push(k(33));const i=h(102);return i&&n.push(i),n.push(Q()),n.push(k(117)),se(T())&&n.push(Pt(1125,Ze,se,92,[120],void 0,X)),n.push(k(120)),86===T().kind&&n.push(Ce()),r.Phrase.create(1110,g(e),n)}(e,t),i=function(){const e=m();let t;t=87===T().kind?p():ce();return r.Phrase.create(1109,g(e),[t])}();return r.Phrase.create(1108,g(e),[n,i])}function Q(){const e=m();let t=T();if(82===t.kind||xt(t))t=p();else{const e=s.ProblemFactory.unexpectedToken(t);t=r.Phrase.createParseError([]),d.set(t,e)}return r.Phrase.create(1090,g(e),[t])}function Z(){const e=m(),t=function(){const e=m(),t=p(),n=k(82);if(28!==T().kind)return r.Phrase.create(1100,g(e),[t,n]);const i=function(){const e=m(),t=p(),n=He([115],G);return r.Phrase.create(1097,g(e),[t,n])}();return r.Phrase.create(1100,g(e),[t,n,i])}(),n=J(1099,B,ee);return r.Phrase.create(1098,g(e),[t,n])}function J(e,t,n){const i=m(),s=k(115);if(!t(T(0,!0))){const t=k(118);return r.Phrase.create(e,g(i),[s,t])}const o=n(),a=k(118);return r.Phrase.create(e,g(i),[s,o,a])}function ee(){return v(1101,q,B,[118],n,!0)}function te(){const e=m(),t=function(){const e=m(),t=p(),n=k(82);return r.Phrase.create(1163,g(e),[t,n])}(),n=J(1162,B,ne);return r.Phrase.create(1161,g(e),[t,n])}function ne(){return v(1164,q,B,[118],n,!0)}function ie(){const e=m(),t=function(){const e=m(),t=[];t.push(p());const n=h(102);n&&t.push(n);t.push(k(82)),t.push(k(117)),se(T())&&t.push(Pt(1125,Ze,se,92,[120],void 0,X));t.push(k(120)),86===T().kind&&t.push(Ce());return r.Phrase.create(1083,g(e),t)}(),n=re();return r.Phrase.create(1081,g(e),[t,n])}function re(){let e=ce();return e.kind=1082,e}function se(e){switch(e.kind){case 102:case 133:case 83:return!0;default:return Qe(e)}}function oe(){const e=m(),t=function(){const e=m(),t=[],n=f([2,29]);n&&t.push(n);t.push(k(9)),t.push(k(82)),28===T().kind&&t.push(ae());38===T().kind&&t.push(K());return r.Phrase.create(1030,g(e),t)}(),n=J(1029,B,H);return r.Phrase.create(1028,g(e),[t,n])}function ae(){const e=m(),t=p(),n=lt();return r.Phrase.create(1023,g(e),[t,n])}function ce(){const e=m(),t=k(115);if(!Et(T(0,!0))){const n=k(118);return r.Phrase.create(1039,g(e),[t,n])}const n=P([118]),i=k(118);return r.Phrase.create(1039,g(e),[t,n,i])}function de(e){switch(T(0,!e).kind){case 159:return p();case 49:return function(){const e=m(),t=p();let n;82===T().kind&&(n=It());const i=S([87,115]);if(87===i.kind)return n||(n=r.Phrase.createParseError([]),d.set(n,s.ProblemFactory.unexpectedToken(T(),115))),r.Phrase.create(1115,g(e),[t,n,i]);if(115!==i.kind){const i=r.Phrase.createParseError([]);return d.set(i,s.ProblemFactory.unexpectedToken(T())),r.Phrase.create(1115,g(e),n?[t,n,i]:[t,i])}const o=P([118]),a=k(118);return r.Phrase.create(1115,g(e),n?[t,n,i,o,a]:[t,i,o,a])}();case 64:return function(){const e=m(),t=[];t.push(p());const n=f([33,11]);n&&t.push(n);const i=m(),s=h(146),o=It();let a=T();if(146===a.kind||115===a.kind)return s&&t.push(s),t.push(o),t.push(k(146)),t.push(k(115)),t.push(Pt(1121,Nt,Dt,92,[118],void 0,_t)),t.push(k(118)),t.push(k(87)),r.Phrase.create(1119,g(e),t);return t.push(Pt(1118,function(e,t,n){return()=>{let i=t,s=n;if(i?(t=void 0,n=void 0):(e=m(),s=h(146),i=It()),4!==T().kind)return r.Phrase.create(1117,g(e),s?[s,i]:[i]);const o=wt();return r.Phrase.create(1117,g(e),s?[s,i,o]:[i,o])}}(i,o,s),bt,92,[87],i,D)),t.push(k(87)),r.Phrase.create(1119,g(e),t)}();case 11:return function(){const e=m(),t=p(),n=Pt(1044,I,w,92,[87],void 0,D),i=k(87);return r.Phrase.create(1042,g(e),[t,n,i])}();case 33:return t=T(1),n=T(2),117===t.kind||102===t.kind&&117===n.kind?Me():ie();case 9:case 2:case 29:return oe();case 61:return te();case 43:return Z();case 115:return ce();case 37:return function(){const e=m(),t=[],n=p();t.push(n),t.push(k(117)),t.push(x(0)),t.push(k(120));let i=T(),o=we,a=Re,c=!1;if(86===i.kind)t.push(p()),t.push(P([18,17,23])),o=Ie,a=xe,c=!0;else if(Et(i))t.push(de(!0));else{const e=r.Phrase.createParseError([]);d.set(e,s.ProblemFactory.unexpectedToken(i)),t.push(e)}18===T().kind&&t.push(v(1055,o,Ee));17===T().kind&&t.push(a());c&&(t.push(k(23)),t.push(k(87)));return r.Phrase.create(1091,g(e),t)}();case 66:return function(){const e=m(),t=p(),n=k(117),i=x(0),o=k(120);let a=T();if(86===a.kind){const s=p(),a=P([25]),c=k(25),d=k(87);return r.Phrase.create(1175,g(e),[t,n,i,o,s,a,c,d])}if(Et(a)){const s=de(!0);return r.Phrase.create(1175,g(e),[t,n,i,o,s])}{const c=r.Phrase.createParseError([]);return d.set(c,s.ProblemFactory.unexpectedToken(a)),r.Phrase.create(1175,g(e),[t,n,i,o,c])}}();case 15:return function(){const e=m(),t=p(),n=de(!0),i=k(66),s=k(117),o=x(0),a=k(120),c=k(87);return r.Phrase.create(1050,g(e),[t,n,i,s,o,a,c])}();case 31:return function(){const e=m(),t=[];t.push(p()),t.push(k(117)),t.push(function(){const e=m(),t=[];Ue(T())&&t.push(Ne(1077,[87],D));t.push(k(87)),Ue(T())&&t.push(Ne(1069,[87],D));t.push(k(87)),Ue(T())&&t.push(Ne(1075,[120],X));return r.Phrase.create(1070,g(e),t)}()),t.push(k(120));let n=T();if(86===n.kind)t.push(p()),t.push(P([21])),t.push(k(21)),t.push(k(87));else if(Et(T()))t.push(de(!0));else{const e=r.Phrase.createParseError([]);d.set(e,s.ProblemFactory.unexpectedToken(n)),t.push(e)}return r.Phrase.create(1078,g(e),t)}();case 59:return function(){const e=m(),t=p(),n=k(117),i=x(0),o=k(120),a=S([86,115]);let l,u=T();7!==u.kind&&14!==u.kind||(l=function(e){const t=m();let n;const i=[],o=[7,14];o.push(e),c.push(pe);for(;;)if(7===(n=T()).kind)i.push(me(o));else{if(14!==n.kind){if(e===n.kind)break;{let e=b(),t=m();const a=r.Phrase.createParseError(e,g(t));if(i.push(a),d.set(a,s.ProblemFactory.unexpectedToken(n)),o.indexOf(T().kind)>-1)continue;break}}i.push(ge(o))}return c.pop(),r.Phrase.create(1018,g(t),i)}(86===a.kind?24:118));if(86===a.kind){const s=k(24),c=k(87);return r.Phrase.create(1157,g(e),l?[t,n,i,o,a,l,s,c]:[t,n,i,o,a,s,c])}{const s=k(118);return r.Phrase.create(1157,g(e),l?[t,n,i,o,a,l,s]:[t,n,i,o,a,s])}}();case 5:return function(){const e=m(),t=p();if(!Ue(T())){const n=k(87);return r.Phrase.create(1015,g(e),[t,n])}const n=x(0),i=k(87);return r.Phrase.create(1015,g(e),[t,n,i])}();case 12:return function(){const e=m(),t=p();if(!Ue(T())){const n=k(87);return r.Phrase.create(1045,g(e),[t,n])}const n=x(0),i=k(87);return r.Phrase.create(1045,g(e),[t,n,i])}();case 57:return function(){const e=m(),t=p();if(!Ue(T())){const n=k(87);return r.Phrase.create(1143,g(e),[t,n])}const n=x(0),i=k(87);return r.Phrase.create(1143,g(e),[t,n,i])}();case 34:return function(){const e=m(),t=p(),n=Pt(1173,vt,Pe,92,[87],void 0,D),i=k(87);return r.Phrase.create(1086,g(e),[t,n,i])}();case 58:return function(e,t){return 83===e.kind&&(87===t.kind||92===t.kind||158===t.kind||84===t.kind)}(T(1),T(2))?function(){const e=m(),t=p(),n=Pt(1155,De,be,92,[87],void 0,D),i=k(87);return r.Phrase.create(1084,g(e),[t,n,i])}():Me();case 80:case 156:case 158:return function(){const e=m(),t=[],n=h(158),i=h(80),s=h(156);n&&t.push(n);i&&t.push(i);s&&t.push(s);return r.Phrase.create(1094,g(e),t)}();case 32:return function(){const e=m(),t=p(),n=k(117),i=function(){const e=m();let t=x(0);return r.Phrase.create(1071,g(e),[t])}(),o=k(4),a=102===T().kind?ke():function(){const e=m(),t=x(0),n=h(131);if(!n)return r.Phrase.create(1074,g(e),[t]);return r.Phrase.create(1072,g(e),[t,n])}();let c;1072===a.kind&&(c=ke());const l=k(120);let u=T();if(86===u.kind){const s=p(),d=P([22]),u=k(22),h=k(87);return r.Phrase.create(1073,g(e),c?[t,n,i,o,a,c,l,s,d,u,h]:[t,n,i,o,a,l,s,d,u,h])}if(Et(u)){const s=de(!0);return r.Phrase.create(1073,g(e),c?[t,n,i,o,a,c,l,s]:[t,n,i,o,a,l,s])}{const h=r.Phrase.createParseError([]);return d.set(h,s.ProblemFactory.unexpectedToken(u)),r.Phrase.create(1073,g(e),c?[t,n,i,o,a,c,l,h]:[t,n,i,o,a,l,h])}}();case 13:return function(){const e=m(),t=p(),n=k(117),i=function(){const e=m(),t=k(82),n=k(84),i=S([81,78,77]);return r.Phrase.create(1046,g(e),[t,n,i])}(),o=k(120);let a=T();if(86===a.kind){const s=p(),a=P([20]),c=k(20),d=k(87);return r.Phrase.create(1047,g(e),[t,n,i,o,s,a,c,d])}if(Et(a)){const s=de(!0);return r.Phrase.create(1047,g(e),[t,n,i,o,s])}if(87===a.kind){const s=p();return r.Phrase.create(1047,g(e),[t,n,i,o,s])}{const c=r.Phrase.createParseError([]);return d.set(c,s.ProblemFactory.unexpectedToken(a)),r.Phrase.create(1047,g(e),[t,n,i,o,c])}}();case 62:return function(){const e=m(),t=p(),n=ce();let i,o=T();if(8!==o.kind){if(30===o.kind)i=ue();else{const e=s.ProblemFactory.unexpectedToken(o);i=r.Phrase.createParseError([]),d.set(i,e)}return r.Phrase.create(1168,g(e),[t,n,i])}i=v(1021,fe,le);if(30!==T().kind)return r.Phrase.create(1168,g(e),[t,n,i]);const a=ue();return r.Phrase.create(1168,g(e),[t,n,i,a])}();case 60:return function(){const e=m(),t=p(),n=x(0),i=k(87);return r.Phrase.create(1158,g(e),[t,n,i])}();case 35:return function(){const e=m(),t=p(),n=k(82),i=k(87);return r.Phrase.create(1087,g(e),[t,n,i])}();case 16:case 157:return function(){const e=m(),t=p(),n=Pt(1066,ve,Ue,92,[87,158],void 0,_e),i=k(87);return r.Phrase.create(1052,g(e),[t,n,i])}();case 63:return function(){const e=m(),t=p(),n=k(117),i=ye([120],X),s=k(120),o=k(87);return r.Phrase.create(1171,g(e),[t,n,i,s,o])}();case 87:return function(){const e=m(),t=p();return r.Phrase.create(1122,g(e),[t])}();case 82:if(86===T(1).kind)return function(){const e=m(),t=p(),n=p();return r.Phrase.create(1113,g(e),[t,n])}();default:return Me()}var t,n}function le(e){return 8===e.kind}function ue(){const e=m(),t=p(),n=ce();return r.Phrase.create(1068,g(e),[t,n])}function he(e){return 122===e.kind||83===e.kind}function fe(){const e=m(),t=p(),n=k(117),i=Pt(1022,lt,ut,122,[83],void 0,he),s=k(83),o=k(120),a=ce();return r.Phrase.create(1020,g(e),[t,n,i,s,o,a])}function pe(e){return 7===e.kind||14===e.kind}function me(e){const t=m(),n=p(),i=x(0),s=S([86,87]);if(!Et(T(0,!0)))return r.Phrase.create(1017,g(t),[n,i,s]);const o=P(e);return r.Phrase.create(1017,g(t),[n,i,s,o])}function ge(e){const t=m(),n=p(),i=S([86,87]);if(!Et(T(0,!0)))return r.Phrase.create(1017,g(t),[n,i]);const s=P(e);return r.Phrase.create(1017,g(t),[n,i,s])}function ke(){const e=m(),t=h(102),n=x(0);return r.Phrase.create(1074,g(e),t?[t,n]:[n])}function Se(e){switch(e.kind){case 83:case 89:case 117:case 3:case 116:case 77:case 58:case 82:case 49:case 146:return!0;default:return!1}}function Te(){return Je(m(),yt())}function ye(e,t){return Pt(1172,Te,Se,92,e,void 0,t)}function ve(){return x(0)}function _e(e){switch(e.kind){case 92:case 87:case 158:return!0;default:return!1}}function be(e){return 83===e.kind}function Pe(e){return 83===e.kind||89===e.kind}function De(){const e=m(),t=k(83);if(84!==T().kind)return r.Phrase.create(1154,g(e),[t]);const n=function(){const e=m(),t=p(),n=x(0);return r.Phrase.create(1085,g(e),[t,n])}();return r.Phrase.create(1154,g(e),[t,n])}function Ne(e,t,n){return Pt(e,ve,Ue,92,t,void 0,n)}function we(){const e=m(),t=p(),n=k(117),i=x(0),s=k(120),o=de(!0);return r.Phrase.create(1054,g(e),[t,n,i,s,o])}function Ie(){const e=m(),t=p(),n=k(117),i=x(0),s=k(120),o=k(86),a=P([23,17,18]);return r.Phrase.create(1054,g(e),[t,n,i,s,o,a])}function Re(){const e=m(),t=p(),n=de(!0);return r.Phrase.create(1053,g(e),[t,n])}function xe(){const e=m(),t=p(),n=k(86),i=P([23]);return r.Phrase.create(1053,g(e),[t,n,i])}function Ee(e){return 18===e.kind}function Me(){const e=m(),t=x(0),n=k(87);return r.Phrase.create(1067,g(e),[t,n])}function Ce(){const e=m(),t=p(),n=Oe();return r.Phrase.create(1144,g(e),[t,n])}function Oe(){const e=m(),t=h(95);let n;switch(T().kind){case 6:case 3:n=p();break;case 82:case 49:case 146:n=lt();break;default:n=r.Phrase.createParseError([]),d.set(n,s.ProblemFactory.unexpectedToken(T()))}return r.Phrase.create(1169,g(e),t?[t,n]:[n])}function Ae(e,t){const n=p(),i=Pt(1027,Le,N,92,[87],void 0,D),s=k(87);return r.Phrase.create(1025,g(e),t?[t,n,i,s]:[n,i,s])}function Ue(e){switch(e.kind){case 83:case 89:case 3:case 116:case 77:case 146:case 82:case 49:case 117:case 58:case 134:case 128:case 110:case 142:case 88:case 85:case 93:case 151:case 152:case 149:case 155:case 150:case 147:case 148:case 45:case 10:case 50:case 78:case 81:case 71:case 70:case 69:case 75:case 73:case 72:case 74:case 76:case 153:case 96:case 94:case 51:case 67:case 68:case 33:case 39:case 40:case 55:case 56:case 26:case 19:case 44:case 27:return!0;default:return!1}}function Le(){const e=m(),t=Q(),n=k(84),i=x(0);return r.Phrase.create(1026,g(e),[t,n,i])}function Fe(e){return 83===e.kind}function Ve(e,t){const n=Pt(1134,Ge,Fe,92,[87],void 0,D),i=k(87);return r.Phrase.create(1132,g(e),[t,n,i])}function Ge(){const e=m(),t=k(83);if(84!==T().kind)return r.Phrase.create(1133,g(e),[t]);const n=function(){const e=m(),t=p(),n=x(0);return r.Phrase.create(1135,g(e),[t,n])}();return r.Phrase.create(1133,g(e),[t,n])}function Ke(e){switch(e.kind){case 53:case 54:case 52:case 58:case 2:case 29:return!0;default:return!1}}function He(e,t){return Pt(1137,lt,ut,92,e,void 0,t)}function Be(e){const t=m();let n=function(){let e=T();switch(e.kind){case 58:return Tt();case 83:case 89:return vt();case 82:case 49:case 146:return lt();default:{const t=r.Phrase.createParseError([]);return d.set(t,s.ProblemFactory.unexpectedToken(e)),t}}}();for(;;){switch(T().kind){case 116:n=ot(t,n,119);continue;case 115:n=ot(t,n,118);continue;case 114:n=it(t,n);continue;case 132:{const e=p(),i=qe();n=r.Phrase.create(1147,g(t),[n,e,i])}continue}break}return r.Phrase.create(e,g(t),[n])}function qe(){const e=m();let t,n=T();switch(n.kind){case 83:t=p();break;case 89:t=vt();break;default:t=r.Phrase.createParseError([]),d.set(t,s.ProblemFactory.unexpectedToken(n))}return r.Phrase.create(1146,g(e),[t])}function Ye(e){return ht(e)||92===e.kind}function $e(e){const n=m(),i=p();let s;switch(e){case 1128:case 1129:s=Je(n,yt());break;default:s=x(t(i)[0])}return r.Phrase.create(e,g(n),[i,s])}function je(){const e=m(),t=[],n=h(58);n&&t.push(n),t.push(p());const i=h(102);return i&&t.push(i),t.push(k(117)),se(T())&&t.push(Pt(1125,Ze,se,92,[120],void 0,X)),t.push(k(120)),64===T().kind&&t.push(function(){const e=m(),t=p(),n=k(117),i=Pt(1036,ze,Xe,92,[120],void 0,X),s=k(120);return r.Phrase.create(1006,g(e),[t,n,i,s])}()),86===T().kind&&t.push(Ce()),r.Phrase.create(1005,g(e),t)}function We(){const e=m(),t=je(),n=re();return r.Phrase.create(1004,g(e),[t,n])}function Xe(e){return 83===e.kind||102===e.kind}function ze(){const e=m(),t=h(102),n=k(83);return r.Phrase.create(1007,g(e),t?[t,n]:[n])}function Qe(e){switch(e.kind){case 146:case 82:case 49:case 95:case 3:case 6:return!0;default:return!1}}function Ze(){const e=m(),t=[];Qe(T())&&t.push(Oe());const n=h(102);n&&t.push(n);const i=h(133);return i&&t.push(i),t.push(k(83)),84===T().kind&&t.push(function(){const e=m(),t=p(),n=x(0);return r.Phrase.create(1048,g(e),[t,n])}()),r.Phrase.create(1124,g(e),t)}function Je(e,t){let n;for(;;){switch((n=T()).kind){case 132:t=nt(e,t);continue;case 114:t=rt(e,t);continue;case 116:case 115:et(t)&&(t=C(e,t)),t=ot(e,t,116===n.kind?119:118);continue;case 117:t=tt(e,t);continue}break}return t}function et(e){switch(e.kind){case 1079:case 1139:case 1136:return!0;default:return!1}}function tt(e,t){const n=k(117);if(!dt(T())){const i=k(120);return r.Phrase.create(1080,g(e),[t,n,i])}const i=ct(),s=k(120);return r.Phrase.create(1080,g(e),[t,n,i,s])}function nt(e,t){const n=p(),i=function(){const e=m();let t=T();const n=[void 0,1145];let i;switch(t.kind){case 115:n[1]=1145,i=St(115,118);break;case 83:n[1]=1147,i=p();break;case 89:i=vt(),n[1]=1147;break;default:82===t.kind||xt(t)?(i=Q(),n[1]=1024):(i=r.Phrase.createParseError([]),d.set(i,s.ProblemFactory.unexpectedToken(t)))}return n[0]=r.Phrase.create(1146,g(e),[i]),n}(),o=h(117);if(o){if(!dt(T())){const s=k(120);return r.Phrase.create(1145,g(e),[t,n,i[0],o,s])}const s=ct(),a=k(120);return r.Phrase.create(1145,g(e),[t,n,i[0],o,s,a])}if(1145===i[1]){let o=r.Phrase.createParseError([]);return d.set(o,s.ProblemFactory.unexpectedToken(T(),117)),r.Phrase.create(1145,g(e),[t,n,i[0],o])}return r.Phrase.create(i[1],g(e),[t,n,i[0]])}function it(e,t){const n=p(),i=st();return r.Phrase.create(1131,g(e),[t,n,i])}function rt(e,t){const n=p(),i=st(),s=h(117);if(!s)return r.Phrase.create(1131,g(e),[t,n,i]);if(!dt(T())){const o=k(120);return r.Phrase.create(1107,g(e),[t,n,i,s,o])}const o=ct(),a=k(120);return r.Phrase.create(1107,g(e),[t,n,i,s,o,a])}function st(){const e=m();let t;switch(T().kind){case 82:t=p();break;case 115:t=St(115,118);break;case 89:case 83:t=vt();break;default:t=r.Phrase.createParseError([]),d.set(t,s.ProblemFactory.unexpectedToken(T()))}return r.Phrase.create(1106,g(e),[t])}function ot(e,t,n){const i=p();if(115===i.kind){const s=x(0),o=k(n);if(1061===o.kind){const e=m(),t=y(function(){let e=1;return t=>{if(115===t.kind)++e;else if(118===t.kind&&0==--e)return!0;return!1}}(),!0);Array.prototype.push.apply(o.children,t),o.length=g(e)}return r.Phrase.create(1156,g(e),[t,i,s,o])}if(!Ue(T())){const s=k(n);return r.Phrase.create(1156,g(e),[t,i,s])}const s=x(0),o=k(n);return r.Phrase.create(1156,g(e),[t,i,s,o])}function at(e){return 120===e.kind||92===e.kind}function ct(){const e=m();let t;const n=[];for(c.push(at);;){if(n.push(133===T().kind?function(){const e=m(),t=p(),n=x(0);return r.Phrase.create(1174,g(e),[t,n])}():x(0)),92!==(t=T()).kind){if(120!==t.kind){if(dt(t)){const e=r.Phrase.createParseError([]);n.push(e),d.set(e,s.ProblemFactory.unexpectedToken(t,92));continue}{const e=m(),i=b();if(92===T().kind){i.push(p());const o=r.Phrase.createParseError(i,g(e));if(n.push(o),d.set(o,s.ProblemFactory.unexpectedToken(t)),120===T().kind)break;continue}const o=r.Phrase.createParseError(i,g(e));n.push(o),d.set(o,s.ProblemFactory.unexpectedToken(t))}break}break}if(n.push(p()),120===T().kind)break}return c.pop(),r.Phrase.create(1008,g(e),n)}function dt(e){return 133===e.kind||Ue(e)}function lt(){const e=m();let t,n=T();if(146===n.kind)return n=p(),t=It(),r.Phrase.create(1079,g(e),[n,t]);if(49===n.kind){n=p();const i=k(146);return t=It(),r.Phrase.create(1139,g(e),[n,i,t])}return t=It(),r.Phrase.create(1136,g(e),[t])}function ut(e){switch(e.kind){case 146:case 82:case 49:return!0;default:return!1}}function ht(e){return 102===e.kind||Ue(e)}function ft(e){return 120===e.kind||92===e.kind}function pt(e){return 119===e.kind||92===e.kind}function mt(e,t){const n=m();let i=T();const o=[];c.push(t);do{if(ht(T())&&o.push(kt()),92===(i=T()).kind)o.push(p());else if(i.kind!==e){if(ht(i)){const e=r.Phrase.createParseError([]);d.set(e,s.ProblemFactory.unexpectedToken(i,92)),o.push(e);continue}{const e=m(),t=b(),n=r.Phrase.createParseError(t,g(e));if(o.push(n),d.set(n,s.ProblemFactory.unexpectedToken(i)),92===(i=T()).kind)continue}break}}while(i.kind!==e);return c.pop(),r.Phrase.create(1011,g(n),o)}function gt(){const e=m(),t=h(102),n=x(0);return r.Phrase.create(1013,g(e),t?[t,n]:[n])}function kt(){const e=m();if(102===T().kind){const t=gt();return r.Phrase.create(1010,g(e),[t])}let t=function(){const e=m(),t=x(0);return r.Phrase.create(1012,g(e),[t])}();const n=h(131);if(!n)return t.kind=1013,r.Phrase.create(1010,g(e),[t]);const i=gt();return r.Phrase.create(1010,g(e),[t,n,i])}function St(e,t){const n=m(),i=k(e),s=x(0),o=k(t);return r.Phrase.create(1057,g(n),[i,s,o])}function Tt(){const e=m(),t=p();return r.Phrase.create(1140,g(e),[t])}function yt(){let e=T();switch(e.kind){case 83:case 89:return vt();case 117:return St(117,120);case 3:return function(){const e=m(),t=p(),n=k(117);if(!Ye(T())){const i=k(120);return r.Phrase.create(1009,g(e),[t,n,i])}const i=mt(120,ft),s=k(120);return r.Phrase.create(1009,g(e),[t,n,i,s])}();case 116:return function(){const e=m(),t=p();if(!Ye(T())){const n=k(119);return r.Phrase.create(1009,g(e),[t,n])}const n=mt(119,pt),i=k(119);return r.Phrase.create(1009,g(e),[t,n,i])}();case 77:return p();case 58:return Tt();case 82:case 49:case 146:return lt();default:{const t=r.Phrase.createParseError([]);return d.set(t,s.ProblemFactory.unexpectedToken(e)),t}}}function vt(){const e=m(),t=S([83,89]);if(89!==t.kind)return r.Phrase.create(1152,g(e),[t]);const n=T();let i;return 115===n.kind?i=St(115,118):89===n.kind||83===n.kind?i=vt():(i=r.Phrase.createParseError([]),d.set(i,s.ProblemFactory.unexpectedToken(n))),r.Phrase.create(1152,g(e),[t,i])}function _t(e){return 92===e.kind||118===e.kind}function bt(e){return 82===e.kind||146===e.kind}function Pt(e,t,n,i,o,a,l){let u;void 0===a&&(a=m()),(o?o.slice(0):[]).push(i),c.push(l);const h=[];for(;;){if(h.push(t()),(u=T()).kind!==i){if(!o||o.indexOf(u.kind)>-1)break;if(n(u)){const e=r.Phrase.createParseError([]);h.push(e),d.set(e,s.ProblemFactory.unexpectedToken(u,i));continue}{const e=m();let t=b();const n=s.ProblemFactory.unexpectedToken(u);if(T().kind===i){t.push(p());const i=r.Phrase.createParseError(t,g(e));h.push(i),d.set(i,n);continue}const o=r.Phrase.createParseError(t,g(e));h.push(o),d.set(o,n)}break}h.push(p())}return c.pop(),r.Phrase.create(e,g(a),h)}function Dt(e){switch(e.kind){case 11:case 33:case 82:return!0;default:return!1}}function Nt(){const e=m(),t=f([33,11]),n=It();if(4!==T().kind)return r.Phrase.create(1120,g(e),t?[t,n]:[n]);const i=wt();return r.Phrase.create(1120,g(e),t?[t,n,i]:[n,i])}function wt(){const e=m(),t=p(),n=k(82);return r.Phrase.create(1114,g(e),[t,n])}function It(){const e=m(),t=[];for(t.push(k(82));146===T().kind&&82===T(1).kind;)t.push(p(),p());return r.Phrase.create(1116,g(e),t)}function Rt(e){switch(e.kind){case 39:case 40:case 26:case 55:case 56:case 47:case 48:case 46:case 41:case 50:case 10:case 27:case 37:case 18:case 17:case 23:case 16:case 15:case 66:case 25:case 31:case 21:case 32:case 22:case 13:case 20:case 4:case 62:case 8:case 30:case 60:case 64:case 42:case 34:case 65:case 63:case 44:case 19:case 12:case 35:case 33:case 11:case 57:case 51:case 67:case 45:case 59:case 24:case 7:case 14:case 5:case 3:case 6:case 28:case 38:case 49:case 61:case 43:case 9:case 76:case 75:case 72:case 73:case 71:case 70:case 69:case 74:return!0;default:return!1}}function xt(e){switch(e.kind){case 58:case 2:case 29:case 52:case 54:case 53:return!0;default:return Rt(e)}}function Et(e){switch(e.kind){case 49:case 64:case 11:case 33:case 9:case 2:case 29:case 61:case 43:case 115:case 37:case 66:case 15:case 31:case 59:case 5:case 12:case 57:case 34:case 58:case 16:case 63:case 32:case 13:case 62:case 60:case 35:case 82:case 87:case 158:case 80:case 156:case 157:case 159:return!0;default:return Ue(e)}}e.parse=function(e){!function(e,t){d=new Map,i.Lexer.setInput(e,d,t),a=[],c=[]}(e);const t=m(),n=function(e){e.push(36);const t=P(e);if(t.kind=1178,36===T().kind){const e=function(){const e=m(),t=p(),n=k(117),i=k(120),s=k(87);return r.Phrase.create(1088,g(e),[t,n,i,s])}();t.children.push(e)}return t}([1]),s=p();return r.Phrase.create(1148,g(t),[n,s])},e.getNodeProblemMap=function(){return d}}(t.Parser||(t.Parser={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(15);!function(e){e.unexpectedToken=function(e,t){let n=`Unexpected '${i.tokenKindToString(e.kind)}'.`;t&&(n+=` Expected '${i.tokenKindToString(t)}'.`);const r={level:1,code:1,message:n};return r.unexpected=e,t&&(r.expected=t),r}}(t.ProblemFactory||(t.ProblemFactory={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(3),r=n(5),s=n(17);t.UseDeclarationHelper=class{constructor(e,t,n){this.parseTree=e,this.definitionTable=t,this._useDeclarationDefinitions=[];for(let e of t.definitions)this._isUseDeclarationSymbol(e)&&this._useDeclarationDefinitions.push(e);this.offset=e.getNodeUtils().positionToOffset(n);const i=new o(this.offset,this.parseTree.getNodeUtils(),this.parseTree.nodeReferenceMap);this.useDeclarationAppendAfterOptions=this.parseTree.traverse(i).useDeclarationPreceedingNodeOptions}get useDeclarationDefinitions(){return this._useDeclarationDefinitions.slice(0)}getUseDeclarationInsertTextEdit(e,t){const[n,r]=this.getUseDeclarationAppendAfter(e.name);let s,o="";if(n)o=",\n ",s=e.name.slice(n.length);else switch(o="\n",s=e.name,1115===r.node.kind&&(o+="\n"),o+=r.indentText,o+="use ",e.kind){case 8:o+="const ";break;case 64:o+="function "}return o+=s,t&&(o+=" as "+t),1120!==r.node.kind&&(o+=";"),1119!==r.node.kind&&(o+="\n"),i.TextEdit.insert(r.range.end,o)}findUseSymbolByFqn(e){let t=e.toLowerCase();return this._useDeclarationDefinitions.find(e=>e.associated&&e.associated.length>0&&e.associated[0].name.toLowerCase()===t)}findUseSymbolByName(e){let t=e.toLowerCase();return this._useDeclarationDefinitions.find(e=>e.name.toLowerCase()===t)}_isUseDeclarationSymbol(e){return(4096&e.modifiers)>0&&(73&e.kind)>0}getUseDeclarationAppendAfter(e){const t=e.toLowerCase(),n=Array.from(this.useDeclarationAppendAfterOptions.lastGroupUseClauseMap.entries()).filter(e=>0===t.indexOf(e[0]));return n.sort((e,t)=>t[0].length-e[0].length),n.length?n.shift():["",this.useDeclarationAppendAfterOptions.lastNamespaceUseDeclaration||this.useDeclarationAppendAfterOptions.lastNamespaceDefinition||this.useDeclarationAppendAfterOptions.firstInlineText]}_isNamespaceAliasingClause(e){return 1114===e.kind}};class o{constructor(e,t,n){this.haltAtOffset=e,this.nodeUtils=t,this.nodeReferenceMap=n,this.offsetVisitor=new r.OffsetVisitor,this.IndentVisitor=new s.IndentVisitor(4,!0,this.nodeUtils),this.lastGroupUseClauseMap=new Map}get useDeclarationPreceedingNodeOptions(){return{firstInlineText:this.firstInlineText,lastNamespaceDefinition:this.lastNamespaceDefinition,lastNamespaceUseDeclaration:this.lastNamespaceUseDeclaration,lastGroupUseClauseMap:this.lastGroupUseClauseMap}}beforeTraverse(e,t){this.offsetVisitor.beforeTraverse(e,t)}preorder(e,t){this.offsetVisitor.preorder(e,t),this.IndentVisitor.preorder(e,t);const n=this.offsetVisitor.offset;if(n>=this.haltAtOffset)return!1;let r=!0;switch(e.kind){case 1094:this.firstInlineText||(this.firstInlineText={node:e,range:i.Range.create(this.nodeUtils.offsetToPosition(n),this.nodeUtils.offsetToPosition(n+e.length)),indentText:this.IndentVisitor.indentText});break;case 1115:{const t=e.children.find(e=>115===e.kind);this.lastNamespaceDefinition=t?{node:t,range:i.Range.create(this.nodeUtils.offsetToPosition(n),this.nodeUtils.offsetToPosition(n+t.length)),indentText:this.IndentVisitor.indentText}:{node:e,range:i.Range.create(this.nodeUtils.offsetToPosition(n),this.nodeUtils.offsetToPosition(n+e.length)),indentText:this.IndentVisitor.indentText}}break;case 1119:{this.lastNamespaceUseDeclaration={node:e,range:i.Range.create(this.nodeUtils.offsetToPosition(n),this.nodeUtils.offsetToPosition(n+e.length)),indentText:this.IndentVisitor.indentText};const t=e.children.find(e=>1116===e.kind);t&&this.nodeReferenceMap.has(t)?this.lastGroupUseClausePrefix=this.nodeReferenceMap.get(t).name.toLowerCase():r=!1}break;case 1120:this.lastGroupUseClausePrefix&&this.lastGroupUseClauseMap.set(this.lastGroupUseClausePrefix,{node:e,range:i.Range.create(this.nodeUtils.offsetToPosition(n),this.nodeUtils.offsetToPosition(n+e.length)),indentText:this.IndentVisitor.indentText}),r=!1;break;case 1028:case 1161:case 1098:case 1002:case 1081:case 1004:case 1067:r=!1}return r}postorder(e,t){this.offsetVisitor.postorder(e,t),this.IndentVisitor.postorder(e,t)}}},function(e,t){e.exports=require("js-beautify")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0);t.DEFAULT_DIAGNOSTIC_OPTIONS={publishOnChange:!0};t.DiagnosticsProvider=class{constructor(e){this.stores=e,this._publishDiagnosticsEvent=new i.Event,this._options=Object.assign({},t.DEFAULT_DIAGNOSTIC_OPTIONS),this.diagnosticStoreChangedEventUnsubscribe=this.stores.diagnosticStore.diagnosticsChangedEvent.subscribe(e=>{this._options.publishOnChange&&this._publishDiagnosticsEvent.trigger(e)})}set options(e){this._options=Object.assign({},e||t.DEFAULT_DIAGNOSTIC_OPTIONS)}get publishDiagnosticsEvent(){return this._publishDiagnosticsEvent}publish(e){const t=this.stores.diagnosticStore.find(e);this._publishDiagnosticsEvent.trigger(t||{uri:e,diagnostics:[]})}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=n(3),s=n(1),o=n(5),a=n(2),c=n(6),d=n(10);t.SignatureHelpProvider=class{constructor(e,t){this.signatureHelpFactory=t,this.definitionStore=e.definitionStore,this.parseTreeStore=e.parseTreeStore,this._options={}}set options(e){this._options=Object.assign({},e||{})}provideSignatureHelp(e,t,n){const i=this.parseTreeStore.find(e);if(!i)return void d.Log.warn("Could not find parse tree for "+e);const r=i.getTraverser(),s=i.getNodeUtils().positionToOffset(t)-1;if(r.seek(s),!this.shouldSuggest(r.clone(),t))return;120===r.node.kind&&this.isCallableExpr(r.clone().parent())&&(r.parent(),r.parent()),this.isCallableExpr(r.node)||r.ancestor(this.isCallableExpr);let o=this.getDefinitions(r.clone()),a=this.getArgNumber(r.clone(),t);return this.signatureHelpFactory.getSignatureHelp(o,a,n)}getArgNumber(e,t){if(!e.child(e=>1008===e.kind))return 0;let n=0,i=e.nthChild(0),r=i?e.range:void 0;for(;i&&r&&(t.line>r.start.line||t.line===r.start.line&&t.character>r.start.character);)92===i.kind&&++n,r=(i=e.nextSibling())?e.range:void 0;return n}shouldSuggest(e,t){if(120===e.node.kind&&this.isCallableExpr(e.clone().parent())&&(e.parent(),e.parent()),!this.isCallableExpr(e.node)&&!e.ancestor(this.isCallableExpr))return!1;if(!e.child(e=>117===e.kind))return!1;const n=e.range;if(t.line<n.end.line||t.line===n.end.line&&t.character<n.end.character)return!1;if(o.NodeUtils.isTokenOfKind(e.nextSibling(),[120])||e.nextSibling(),!o.NodeUtils.isTokenOfKind(e.node,[120]))return!0;const i=e.range;return t.line<i.start.line||t.line===i.start.line&&t.character<=i.start.character}getDefinitions(e){let t;switch(e.node.kind){case 1080:if(e.child(o.NodeUtils.isNamePhrase)&&e.lastChild())t=e.reference();else if(e.child(e=>1152===e.kind)&&(t=e.reference())&&a.TypeString.isEqual(t.type,a.TypeString.CALLABLE_TYPE_STRING)){const e=a.TypeString.atomicClassLikeTypes(t.type)||[],n=[];for(let t=0,i=e.length;t<i;++t)Array.prototype.push.apply(n,this.definitionStore.find(e[t],s.Definition.isFunction));return n}break;case 1107:e.child(e=>1106===e.kind)&&e.child(e=>82===e.kind)&&(t=e.reference());break;case 1145:e.child(e=>1146===e.kind)&&e.child(e=>1090===e.kind)&&(t=e.reference());break;case 1123:e.child(e=>1034===e.kind)&&e.child(this.isNamePhraseOrRelativeScope)&&(1140===e.node.kind?t=e.reference():(e.lastChild(),t=e.reference()));break;default:throw new Error("Invalid Argument")}return t&&!Array.isArray(t)?this.definitionStore.findByReference(t):[]}isCallableExpr(e){switch(e.kind){case 1080:case 1107:case 1145:case 1123:return!0;default:return!1}}isNamePhraseOrRelativeScope(e){switch(e.kind){case 1079:case 1139:case 1136:case 1140:return!0;default:return!1}}};t.SignatureHelpFactory=class{constructor(e,t,n){this.documentationService=e,this.documentationFormatter=t,this.definitionStore=n}getSignatureHelp(e,t,n){return i(this,void 0,void 0,function*(){const i=[];let r;for(let t=0;t<e.length&&!n.isCancellationRequested;++t)(r=yield this.toSignatureInformation(e[t],n))&&i.push(r);if(i.length<1)return;let s=i.findIndex(e=>e.parameters.length>t||e.parameters[e.parameters.length-1].label.indexOf("...")>-1);return s<0&&(s=0),i.length>0&&t>=i[s].parameters.length&&(t=i[s].parameters.length-1),{activeParameter:t,activeSignature:s,signatures:i}})}toSignatureInformation(e,t){return i(this,void 0,void 0,function*(){let n;const i=this.definitionStore.table(e.uriId);switch(e.kind){case 64:n=i.definitionChildren(e).filter(e=>128===e.kind);break;case 32:case 2048:n=c.MethodDefinition.fromDefinition(e,this.definitionStore).parameters;break;default:throw new Error("Invalid Argument")}if(n.length<1)return;const r=yield this.documentationService.getDocumentation(e,t);let s=this.toParameterInformationArray(n,r),o="(";return o+=s.map(e=>e.label).join(", "),{label:o+=")",parameters:s}})}toParameterInformationArray(e,t){let n,i,r=[];for(let s=0,o=e.length;s<o;++s)n=e[s],i=t.tags.find(e=>e.elementName===n.name),r.push(this.toParameterInformation(n,i));return r}toParameterInformation(e,t){let n=[];e.type&&e.type.declared&&n.push(a.TypeString.toTypeDeclarationString(e.type.declared,e));let i=e.name;return(2048&e.modifiers)>0&&(i="..."+i),(1024&e.modifiers)>0&&(i="&"+i),n.push(i),void 0!==e.value&&n.push("=",e.value.toString()),{label:n.join(" "),documentation:t?{kind:r.MarkupKind.Markdown,value:t.text}:void 0}}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(4),r=n(0),s=n(6);t.DefinitionProvider=class{constructor(e){this.definitionStore=e.definitionStore,this.parseTreeStore=e.parseTreeStore,this._options={}}set options(e){this._options=Object.assign({},e||{})}provideDefinition(e,t){const n=this.parseTreeStore.find(e);if(!n)return null;const s=n.findReferenceAtPosition(t);if(!s)return null;const o=s.reference;let a=this.definitionStore.findByReference(o);if(2048===o.kind){const e=this.definitionStore.find(o.name,e=>1===e.kind);Array.prototype.push.apply(e,a),a=e}let c,d=[];for(let e=0;e<a.length;++e){if((24576&(c=a[e]).modifiers)>0)c=this.getTraitDefinition(c);else if(256===c.kind&&(16777216&c.modifiers)>0){Array.prototype.push.apply(d,this.getGlobalVariableDefinitionLocations(c));continue}!c.range||65536&c.modifiers||d.push({uri:i.DocumentStore.uri(c.uriId),range:r.PackedRange.toLspRange(c.range)})}return 1===d.length?d[0]:d}getTraitDefinition(e){return e instanceof s.MethodDefinition||(e=s.MemberDefinition.fromDefinition(e,this.definitionStore)),(24576&e.modifiers)>0&&e.traitMethod?e.traitMethod:e}getGlobalVariableDefinitionLocations(e){return this.definitionStore.find(e.name,this.isGlobalVariable).map(e=>({uri:i.DocumentStore.uri(e.uriId),range:r.PackedRange.toLspRange(e.range)}))}isGlobalVariable(e){return!(256!==e.kind||e.scope||4259840&e.modifiers||void 0===e.range)}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=n(5),s=n(6),o=n(2);t.ReferenceProvider=class{constructor(e){this.parseTreeStore=e.parseTreeStore,this.definitionStore=e.definitionStore,this.referenceStore=e.referenceStore,this._options={}}set options(e){this._options=Object.assign({},e||{})}provideReferences(e,t,n,r){return i(this,void 0,void 0,function*(){const i=this.parseTreeStore.find(e);if(!i)return[];const s=i.findReferenceAtPosition(t);if(!s)return[];const o=s.reference;switch(o.kind){case 128:case 256:return this.getVariableReferences(s.traverser,i,o,n.includeDeclaration);case 1:case 2:case 4:case 2048:{const e=2055;return this.referenceStore.find(o.name,t=>(t.kind&e)>0&&(n.includeDeclaration||!(2097152&t.modifiers))&&"self"!==t.unresolvedName&&"static"!==t.unresolvedName&&"parent"!==t.unresolvedName,r)}case 64:case 8:{let e=o.name;return this.definitionStore.find(e,e=>e.kind===o.kind).length<1&&o.unresolvedName&&(e=o.unresolvedName),this.referenceStore.find(e,e=>e.kind===o.kind&&(n.includeDeclaration||!(2097152&e.modifiers)),r)}case 16:case 1024:case 32:return this.referenceStore.find(o.name,this.createMemberReferenceFilterFn(this.definitionStore.findByReference(o),n.includeDeclaration),r);default:return Promise.resolve([])}})}createMemberReferenceFilterFn(e,t){const n=this.definitionStore,i={},r=new Set;let a=0;e.forEach(e=>{a=e.kind,s.MemberDefinition.fromDefinition(e,n).definitions.forEach(e=>{r.add(e);const t=n.table(e.uriId).definitionScope(e);t&&(i[t.name.toLowerCase()]=!0)})});const c=(e,t)=>e||r.has(t);return e=>{if(!(e.kind&a)||!e.scope||!t&&(2097152&e.modifiers)>0)return!1;const r=o.TypeString.toArray(o.TypeString.atomicClassLikeTypes(e.scope));let d,l,u;for(let t=0;t<r.length;++t)if(l=(d=r[t]).toLowerCase(),void 0!==i[l]){if(i[l])return!0}else{if(!(u=s.TypeDefinition.fromName(d,n)))continue;const t=u.findMember(e.name,a);if(!t)continue;if(i[l]=t.definitions.reduce(c,!1),i[l])return!0}return!1}}getVariableReferences(e,t,n,i){const s=[],o=e=>(256===e.kind||128===e.kind)&&e.name===n.name&&(i||!(2097152&e.modifiers));if(159!==e.node.kind){if(!e.scope(n.name))return[];e.prevSibling(),159!==e.node.kind&&e.nextSibling()}if(159===e.node.kind){const t=e.reference;Array.isArray(t)&&Array.prototype.push.apply(s,t.filter(o)),e.nextSibling()}return e.references(o,e=>r.NodeUtils.hasAnonymousFunctionUseVariable(e,t,n.name))}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=n(3),s=n(19),o=n(1),a=n(0),c=n(2),d=n(8);t.HoverProvider=class{constructor(e,t,n){this.formatter=t,this.documentationService=n,this.parseTreeStore=e.parseTreeStore,this.definitionStore=e.definitionStore,this._options={}}set options(e){this._options=Object.assign({},e||{})}provideHover(e,t,n){return i(this,void 0,void 0,function*(){const i=this.parseTreeStore.find(e);if(!i)return null;const s=i.findReferenceAtPosition(t);if(!s||d.PHP.isReservedName(s.reference.name))return null;let o=s.reference;2048===o.kind&&"__construct"!==o.name&&(o=Object.assign({},o,{kind:1}));const c=this.definitionStore.findByReference(o);if(o!==s.reference&&Array.prototype.push.apply(c,this.definitionStore.findByReference(s.reference)),c.length<1)return null;const l=[];let u,h;for(let e=0;e<c.length&&(!n||!n.isCancellationRequested);++e)h=c[e],(u=yield this.getMarkdownDocumentation(h,o,n))&&l.push(u);const f=l.join("\n\n---\n\n");return f?{contents:{kind:r.MarkupKind.Markdown,value:f},range:a.PackedRange.toLspRange(s.reference.range)}:null})}getMarkdownDocumentation(e,t,n){return i(this,void 0,void 0,function*(){let i=yield this.documentationService.getDocumentation(e,n);if(!(256!==e.kind||i&&i.tags.find(e=>1008===e.kind))){i||(i=new s.Documentation(e,void 0,void 0,[]));const n=o.Definition.type(e)||t.type;i.tags.push({kind:1008,text:`_@var_ \`${c.TypeString.toString(n)} ${e.name}\``})}return i?this.formatter.format(i):""})}}},function(e,t){e.exports=require("turndown")},function(e,t){e.exports=require("turndown-plugin-gfm")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(3),r=n(5),s=n(7),o=n(0),a=n(2);var c;t.HighlightProvider=class{constructor(e){this.parseTreeStore=e.parseTreeStore,this._options={}}set options(e){this._options=Object.assign({},e||{})}provideHightlights(e,t){let n=this.parseTreeStore.find(e);if(!n)return[];const i=n.getNodeUtils().positionToOffset(t),r=n.getTraverser();r.seek(i-1);let s=this._provideHighlights(r,t,n);if(s)return s;const o=n.getTraverser();return o.seek(i),this._provideHighlights(o,t,n)||[]}_provideHighlights(e,t,n){const i=e.node,r=e.clone();let a=r.reference();if(a){if(Array.isArray(a)){const e=o.PackedPosition.fromLspPosition(t);a=a.find(t=>t.range&&e>=t.range.start&&e<=t.range.end)}if(a)return this.provideReferenceHighlights(a,r,n)}else if(s.isKeyword(i.kind))return this.provideKeywordHighlights(e.clone(),n.getNodeUtils())}provideReferenceHighlights(e,t,n){let s,c,d=e.kind,l=e.name.toLowerCase(),u=e.unresolvedName?e.unresolvedName.toLowerCase():void 0;switch(e.kind){case 256:case 128:d=384,128===e.kind&&159===t.node.kind?t.nextSibling():t.scope(e.name),s=(t=>(t.kind&d)>0&&t.name===e.name),c=(t=>r.NodeUtils.hasAnonymousFunctionUseVariable(t,n,e.name));break;case 1:case 2:case 4:case 2048:d=2055,t=n.getTraverser(),s=(e=>(e.kind&d)>0&&e.name.toLowerCase()===l&&(!u&&!e.unresolvedName||u&&e.unresolvedName&&u===e.unresolvedName.toLowerCase())),c=(e=>!0);break;case 32:t=n.getTraverser(),s=(t=>(t.kind&d)>0&&t.name.toLowerCase()===l&&a.TypeString.isEqual(t.scope,e.scope)),c=(e=>!0);break;case 16:{const i="$"===e.name.slice(0,1)?e.name.slice(1):e.name;t=n.getTraverser(),s=(t=>(t.kind&d)>0&&(t.name===i||"$"===t.name.slice(0,1)&&t.name.slice(1)===i)&&a.TypeString.isEqual(t.scope,e.scope)),c=(e=>!0)}break;case 1024:t=n.getTraverser(),s=(t=>(t.kind&d)>0&&t.name===e.name&&a.TypeString.isEqual(t.scope,e.scope)),c=(e=>!0);break;case 64:t=n.getTraverser(),s=(e=>(e.kind&d)>0&&e.name.toLowerCase()===l),c=(e=>!0);break;default:t=n.getTraverser(),s=(t=>(t.kind&d)>0&&t.name===e.name),c=(e=>!0)}return t.references(s,c).map(e=>i.DocumentHighlight.create(o.PackedRange.toLspRange(e.range),(1048576&e.modifiers)>0?i.DocumentHighlightKind.Write:i.DocumentHighlightKind.Read))}provideKeywordHighlights(e,t){let n;const i=e.node.kind;switch(i){case 57:case 67:case 68:e.scope(),n=c.returnOrYieldVisitor(t);break;case 66:case 15:case 12:case 31:case 32:case 21:case 22:case 25:n=c.loopVisitor(t),e.ancestor(r.NodeUtils.isLoopPhrase);break;case 5:n=1157===e.ancestor(e=>r.NodeUtils.isLoopPhrase(e)||1157===e.kind).kind?c.switchVisitor(t):c.loopVisitor(t);break;case 4:e.ancestor(r.NodeUtils.isLoopPhrase)&&(n=c.loopVisitor(t));break;case 59:case 24:case 7:case 14:n=c.switchVisitor(t),e.ancestor(e=>1157===e.kind);break;case 37:case 18:case 17:case 23:n=c.ifVisitor(t),e.ancestor(e=>1091===e.kind);break;case 27:e.ancestor(e=>1178===e.kind),n=c.tokenKindVisitor(t,i);break;case 62:case 8:case 30:e.ancestor(e=>1168===e.kind),n=c.tryVisitor(t)}return n?e.traverse(n).highlights:[]}},function(e){function t(e,t){return i.DocumentHighlight.create(t,i.DocumentHighlightKind.Read)}function n(e,t){switch(e.kind){case 66:case 31:case 32:case 15:case 12:case 21:case 22:case 25:case 4:return!0;case 5:return void 0===t.find(e=>1157===e.kind);default:return!1}}e.memberTokenVisitor=function(e,n,i){let r;return new d(t,e,e=>e.kind===n,r=i?e=>1105===e.kind||e.kind===i:e=>{switch(e.kind){case 1105:case 1025:case 1132:case 1108:return!0;default:return!1}})},e.tokenKindVisitor=function(e,n){return new d(t,e,e=>e.kind===n,e=>!0)},e.returnOrYieldVisitor=function(e){return new d(t,e,e=>57===e.kind||67===e.kind||68===e.kind,e=>!r.NodeUtils.isScopeNode(e))},e.switchVisitor=function(e){return new d(t,e,e=>59===e.kind||7===e.kind||14===e.kind||5===e.kind||24===e.kind,e=>!r.NodeUtils.isScopeNode(e)&&!r.NodeUtils.isLoopPhrase(e)&&1157!==e.kind)},e.loopVisitor=function(e){return new d(t,e,n,e=>!r.NodeUtils.isLoopPhrase(e)&&!r.NodeUtils.isScopeNode(e))},e.ifVisitor=function(e){return new d(t,e,e=>37===e.kind||17===e.kind||18===e.kind||23===e.kind,e=>1055===e.kind||1054===e.kind||1053===e.kind)},e.heredocVisitor=function(e){return new d(t,e,e=>153===e.kind||154===e.kind,e=>!1)},e.tryVisitor=function(e){return new d(t,e,e=>62===e.kind||8===e.kind||30===e.kind,e=>1021===e.kind||1020===e.kind||1068===e.kind)}}(c||(c={}));class d{constructor(e,t,n,i){this.highlightFactoryFn=e,this.nodeUtils=t,this.filter=n,this.shouldDescend=i,this._highlights=[]}get highlights(){return this._highlights}preorder(e,t){return this.filter(e,t)&&this._highlights.push(this.highlightFactoryFn(e,this.nodeUtils.nodeRangeFromSpine([...t,e]))),this._firstNode?this.shouldDescend(e):(this._firstNode=e,!0)}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=n(11),s=n(4),o=n(12),a=n(18),c=n(42),d=n(43),l=n(0),u=n(7),h=n(5),f=n(13),p=n(1),m=n(21),g=n(45),k=n(6),S=n(10),T=n(2);var y;!function(e){const t=250,n=500;e.create=function(e,i,r,s){const o={document:e,isOpened:r,withTransform:0,compileDebounce:void 0};if(r){const r=t=>(o.withTransform=3,i(e,3));o.compileDebounce=new l.Debounce(r,t),o.diagnoseDebounce=new l.Debounce(s,n)}return o}}(y||(y={}));class v{constructor(e,t){this.stores=e,this.fileProvider=t,this.cacheDisposeFn=((e,t)=>{this.isOpened(e)||(this.compilationStateMap.delete(e),this.stores.documentStore.remove(e),this.stores.parseTreeStore.remove(e))}),this.loadSync=((e,t,n)=>{if(this.isOpened(e)){return this.compilationStateMap.get(e).compileDebounce.flush(1)}if(!this.fileProvider)return 3;const i=this.fileProvider.readFileSync(e);if(void 0===i)return 3;const o=new r.Document(e,i,0,n||s.DocumentStore.flags(e)),a=y.create(o,void 0,!1,void 0);return this.compilationStateMap.set(e,a),this.loadedDocuments.get(o.uri)||this.loadedDocuments.set(o.uri,o.uri),this.stores.documentStore.add(o),a.withTransform=t,this.compile(o,t)}),this.compile=((e,t)=>{if(t<1)return 1;const n=this.parse(e);return this.stores.parseTreeStore.add(n),t<2?1:(this.definitionTransform(n,e.flags),t<3?1:(this.referenceTransform(n),1))}),this.loadFileWithTransformSyncIfNotLoaded=((e,t,n)=>this.isOpened(e)||this.isLoadedWithTransform(e,t)?1:this.loadSync(e,t,n)),this.diagnosticsTransform=(e=>{const t=this.stores.parseTreeStore.find(e);if(!t)return;const n={nodeProblemMap:t.nodeProblemMap,nodeDefinitionMap:t.nodeDefinitionMap,nodeReferenceMap:t.nodeReferenceMap,nodeMagicDefinitionMap:t.nodeMagicDefinitionMap,nodePhpDocMap:t.nodeDocBlockMap,nodePhpDocReferenceMap:t.nodeDocBlockReferenceMap},i=new g.MasterDiagnosticsVisitor(t.getNodeUtils(),n,this.stores.definitionStore,this.typeAndValueCache);try{const e=t.getTraverser().traverse(i).diagnostics;this.stores.diagnosticStore.add({uri:t.uri,diagnostics:e})}catch(e){e&&S.Log.error(e.stack),this.stores.diagnosticStore.add({uri:t.uri,diagnostics:[]})}}),this.compilationStateMap=new Map,this.loadedDocuments=new m({max:v.MAX_LOADED_DOCUMENTS,dispose:this.cacheDisposeFn}),this.typeAndValueCache=new d.InferredTypeAndValueCache}open(e){(this.isOpened(e.uri)||this.isLoadedWithTransform(e.uri,0))&&this.close(e.uri);const t=this.typeAndValueCache,n=this.compile,i=this.diagnosticsTransform;this.stores.documentStore.add(e);const r=y.create(e,(e,i)=>{t.clearUri(s.DocumentStore.id(e.uri));const o=n(e,i);return r.diagnoseDebounce&&r.diagnoseDebounce.handle(),o},!0,()=>{i(e.uri)});this.compilationStateMap.set(e.uri,r),r.withTransform=3;const o=this.compile(e,3);return r.compileDebounce.handle(),o}loadUri(e,t,n){return i(this,void 0,void 0,function*(){if(this.isOpened(e)){const t=this.compilationStateMap.get(e);return t&&t.compileDebounce?t.compileDebounce.flush(1):3}if(!this.fileProvider)return 3;const i=yield this.fileProvider.readFile(e);if(void 0===i)return 3;const o=new r.Document(e,i,0,n||s.DocumentStore.flags(e)),a=y.create(o,void 0,!1,void 0);return this.compilationStateMap.set(e,a),this.loadedDocuments.get(o.uri)||this.loadedDocuments.set(o.uri,o.uri),this.stores.documentStore.add(o),a.withTransform=t,this.compile(o,t)})}close(e){if(this.compilationStateMap.has(e)){const t=this.compilationStateMap.get(e);t.compileDebounce&&t.compileDebounce.clear(),t.diagnoseDebounce&&t.diagnoseDebounce.clear(),this.compilationStateMap.delete(e)}this.loadedDocuments.del(e),this.stores.documentStore.remove(e),this.stores.parseTreeStore.remove(e)}forget(e){this.close(e),this.stores.definitionStore.remove(e),this.stores.referenceStore.removeHashedReferenceNames(e),this.stores.diagnosticStore.remove(e),this.typeAndValueCache.clearUri(s.DocumentStore.id(e)),this.stores.documentStore.forget(e)}ready(e){const t=this.compilationStateMap.get(e);return t&&t.compileDebounce?t.compileDebounce.flush(1):3}applyChanges(e,t,n){if(!this.isOpened(e))return void S.Log.warn("Failed to apply changes to "+e);const i=this.stores.documentStore.find(e),r=this.compilationStateMap.get(e);r.diagnoseDebounce.clear(),this.stores.diagnosticStore.remove(i.uri),i.version=t,i.applyChanges(n),r.compileDebounce.handle(n)}isOpened(e){return this.compilationStateMap.has(e)&&this.compilationStateMap.get(e).isOpened}isLoadedWithTransform(e,t){return void 0!==this.loadedDocuments.get(e)&&this.compilationStateMap.has(e)&&this.compilationStateMap.get(e).withTransform>=t}inferDefinitionTypeAndValue(e){if((65536&e.modifiers)>0)return{type:p.Definition.type(e)||T.TypeString.MIXED_TYPE_STRING,value:e.value,callStack:new Set([e.uriId])};if(e.type&&(void 0!==e.value||!(1032&e.kind)))return{type:p.Definition.type(e)||T.TypeString.MIXED_TYPE_STRING,callStack:new Set([e.uriId])};const t=s.DocumentStore.uri(e.uriId);if(!this.isOpened(t)&&!this.isLoadedWithTransform(t,2)){if(1!==this.loadSync(t,2,r.DocumentFlagFactory.fromDefinition(e)))return{type:p.Definition.type(e)||T.TypeString.MIXED_TYPE_STRING,callStack:new Set([e.uriId])}}let n,i;switch(e.kind){case 1:case 2:case 4:return{type:T.TypeString.fromString(e.name),callStack:new Set([e.uriId])};case 2048:return{type:T.TypeString.VOID_TYPE_STRING,callStack:new Set([e.uriId])};case 32:n=d.TypeAndValueInferrence.inferMethodTypeAndValue;break;case 64:n=d.TypeAndValueInferrence.inferFunctionTypeAndValue;break;case 16:n=d.TypeAndValueInferrence.inferPropertyTypeAndValue;break;case 128:n=d.TypeAndValueInferrence.inferOptionalParameterTypeAndValue;break;case 256:return{type:T.TypeString.MIXED_TYPE_STRING,callStack:new Set([e.uriId])};case 4096:n=d.TypeAndValueInferrence.inferScriptTypeAndValue;break;case 8:n=d.TypeAndValueInferrence.inferConstantTypeAndValue;break;case 1024:n=d.TypeAndValueInferrence.inferClassConstantTypeAndValue;break;case 512:return{type:T.TypeString.VOID_TYPE_STRING,callStack:new Set([e.uriId])}}return(i=this.typeAndValueCache.has(e)?this.typeAndValueCache.get(e):n(e,this.stores.parseTreeStore,this.stores.definitionStore,new Set,this.typeAndValueCache,new Set([e.uriId]),new k.TypeFactory(this.stores.definitionStore),this.loadFileWithTransformSyncIfNotLoaded,0)).typeAndValue}clear(){for(let e of this.compilationStateMap.values())e.compileDebounce&&e.compileDebounce.clear(),e.diagnoseDebounce&&e.diagnoseDebounce.clear();this.compilationStateMap=new Map,this.loadedDocuments=new m({max:v.MAX_LOADED_DOCUMENTS,dispose:this.cacheDisposeFn}),this.stores.definitionStore.clear(),this.stores.referenceStore.clear(),this.stores.parseTreeStore.clear(),this.stores.diagnosticStore.clear(),this.stores.documentStore.clear()}parse(e){const t=u.Parser.parse(e.text),n=u.Parser.getNodeProblemMap(),i=new h.ParseTree(t,e);return i.nodeProblemMap=n,i}definitionTransform(e,t){let n=0;(1&t)>0&&(n|=65536),(2&t)>0&&(n|=131072);const i=c.DefinitionTransformer.transform({node:e.root,nodeUtils:e.getNodeUtils(),nameResolver:new f.NameResolver,definitionTable:new o.DefinitionTable(e.id,new Map),nodeDefinitionMap:new Map,nodeMagicDefinitionMap:new Map,nodePhpDocMap:new Map,modifiers:n});e.nodeDefinitionMap=i.nodeDefinitionMap,e.nodeMagicDefinitionMap=i.nodeMagicDefinitionMap,e.nodeProblemMap=new Map([...e.nodeProblemMap,...i.nodeProblemMap]),e.nodeDocBlockMap=i.nodeDocBlockMap,this.stores.definitionStore.add(i.definitionTable),65536&n||this.stores.referenceStore.addHashedReferenceNames(a.HashedReferenceNames.fromUriIdAndNameSet(e.id,i.referenceNames))}referenceTransform(e){const t=d.ReferenceTransformer.transform({parseTree:e,nameResolver:new f.NameResolver,definitionStore:this.stores.definitionStore,parseTreeStore:this.stores.parseTreeStore,circularReferenceGuard:new Set,typeAndValueCache:this.typeAndValueCache,callStack:new Set([e.id]),loadFileWithTransformSyncDelegate:this.loadFileWithTransformSyncIfNotLoaded});e.nodeReferenceMap=t.nodeReferenceMap,e.nodeDocBlockReferenceMap=t.nodeDocBlockReferenceMap}}v.MAX_LOADED_DOCUMENTS=100,t.Compiler=v},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(2),r=n(1),s=n(13),o=n(7),a=n(20),c=n(8),d=n(0);class l{constructor(e){this.nodeUtils=e.nodeUtils,this.nameResolver=e.nameResolver,this.definitionStack=[],this.lastPhpDoc=void 0,this.nameResolver=e.nameResolver,this._referenceNames=new Set,this._definitionTable=e.definitionTable,this._nodeDefinitionMap=e.nodeDefinitionMap,this._nodeMagicDefinitionMap=e.nodeMagicDefinitionMap,this._nodePhpDocMap=e.nodePhpDocMap,this.nodeProblemMap=new Map,this.modifiers=e.modifiers,this.assignmentStack=[]}get referenceNames(){return this._referenceNames}get definitionTable(){return this._definitionTable}get nodeDefinitionMap(){return this._nodeDefinitionMap}get nodeMagicDefinitionMap(){return this._nodeMagicDefinitionMap}get nodeDocBlockMap(){return this._nodePhpDocMap}pushAssignment(e){this.assignmentStack.push(e)}popAssignment(){this.assignmentStack.pop()}isNodeAssignedTo(e){const t=this.assignmentStack[this.assignmentStack.length-1];return t&&t.children[0]===e}addName(e){e&&this.referenceNames.add(e.toLowerCase())}enterDefinition(e,t){if(e.modifiers|=this.modifiers,this.definitionStack.push(e),(4096&e.modifiers)>0&&256!==e.kind){const t=s.UseRule.fromDefinition(e);t.fqn&&this.nameResolver.rules.push(t)}switch(e.kind){case 512:this.nameResolver.namespaceName=e.name;break;case 1:this.nameResolver.pushClass(e.name,e.associated.length>0&&1===e.associated[0].kind?e.associated[0].name:"");break;case 256:if(c.PHP.isPredefinedVariable(e.name)){if((65536&e.modifiers)>0){e.modifiers|=4194304,r.Definition.setDocumentedType(e,i.TypeString.fromString(c.PHP.getPredefinedVariableType(e.name)));break}return}if(this.definitionTable.has(e.fqsenHash))return}this._nodeDefinitionMap.set(t,e),e.name&&!this.definitionTable.has(e.fqsenHash)&&this.definitionTable.add(e)}leaveDefinition(){switch(this.definitionStack.pop().kind){case 1:this.nameResolver.popClass()}}addDefinition(e,t){this.enterDefinition(e,t),this.leaveDefinition()}addMagicDefinitions(e,t){let n;for(let t=0,i=e.length;t<i;++t)n=e[t],this._definitionTable.add(n);this._nodeMagicDefinitionMap.set(t,e)}addDocBlock(e,t){this._nodePhpDocMap.set(t,e)}addAssociated(e){const t=this.currentDefinition();t.associated?t.associated.push(e):t.associated=[e]}currentDefinition(){return this.definitionStack.length?this.definitionStack[this.definitionStack.length-1]:void 0}clearLastPhpDoc(){this.lastPhpDoc=void 0}}!function(e){function t(e,d){switch(e.kind){case 1061:break;case 1148:!function(e,t){const n=r.Definition.create(4096,t.nodeUtils.uri,t.nodeUtils.uriId,void 0);n.range=t.nodeUtils.nodePackedRange(e),t.enterDefinition(n,e),O(e.children,t),t.leaveDefinition()}(e,d);break;case 1115:!function(e,t){let i="";const s=t.nodeUtils.nodePackedRange(e),o=1116===e.children[1].kind?n(e.children[1],t):void 0;let a;o?(i=o.name,a=5===e.children.length?e.children[3]:void 0):a=4===e.children.length?e.children[2]:void 0;if(i){const n=r.Definition.create(512,i,t.nodeUtils.uriId,t.currentDefinition());n.range=s,t.addDefinition(n,e)}else t.nameResolver.namespaceName="";a&&1153===a.kind&&O(a.children,t)}(e,d);break;case 1119:!function(e,t){let i,r=0,o="";for(let a=1,c=e.children.length;a<c;++a)switch((i=e.children[a]).kind){case 11:r=8;break;case 33:r=64;break;case 1116:{const e=n(i,t);e&&(o=e.name,e.kind=512)}break;case 1118:s(i,t,r);break;case 1121:u(i,o,t,r)}}(e,d);break;case 1043:!function(e,t){let n="";const i=t.nodeUtils.nodePackedRange(e);82===e.children[0].kind&&(n=t.nodeUtils.nodeText(e.children[0]));n||(n=t.nodeUtils.createSymbolName(e,"Constant"));const s=r.Definition.create(8,n,t.nodeUtils.uriId,t.currentDefinition());s.range=i;const[o,a]=m(e.children[2],t);void 0!==o&&(s.value=o);a&&r.Definition.setDocumentedType(s,a);A(t)&&(s.modifiers|=524288,r.Definition.setDocumentedType(s,U(s.name,t)));t.addDefinition(s,e)}(e,d);break;case 1081:!function(e,n){(function(e,t,n){let i,s;const o=n.nodeUtils.nodePackedRange(t);let a=0;for(let o=0,c=e.children.length;o<c;++o)switch((s=e.children[o]).kind){case 102:a|=1024;break;case 82:{const e=n.nameResolver.resolveRelative(n.nodeUtils.nodeText(s));i=r.Definition.create(64,e,n.nodeUtils.uriId,n.currentDefinition()),n.enterDefinition(i,t)}break;case 1125:i||(i=r.Definition.create(64,n.nodeUtils.createSymbolName(t,"Function"),n.nodeUtils.uriId,n.currentDefinition()),n.enterDefinition(i,t)),O(s.children,n);break;case 1144:r.Definition.setDeclaredType(i,M(s,n))}i||(i=r.Definition.create(64,n.nodeUtils.createSymbolName(t,"Function"),n.nodeUtils.uriId,n.currentDefinition()),n.enterDefinition(i,t));i.modifiers|=a,i.range=o,A(n)&&(r.Definition.setDocumentedType(i,L(n)),i.modifiers|=524288);n.addName(i.name),n.clearLastPhpDoc()})(e.children[0],e,n),t(e.children[1],n),n.leaveDefinition()}(e,d);break;case 1004:!function(e,n){const i=n.nodeUtils.nodePackedRange(e),s=r.Definition.create(64,n.nodeUtils.createSymbolName(e,"Function"),n.nodeUtils.uriId,n.currentDefinition());s.range=i,s.modifiers=512,n.enterDefinition(s,e),function(e,n,i){let s;for(let o=0,a=e.children.length;o<a;++o)switch((s=e.children[o]).kind){case 58:n.modifiers|=32;break;case 102:n.modifiers|=1024;break;case 1125:O(s.children,i);break;case 1144:r.Definition.setDeclaredType(n,M(s,i));break;default:t(s,i)}i.clearLastPhpDoc()}(e.children[0],s,n),t(e.children[1],n),n.leaveDefinition()}(e,d);break;case 1028:!function(e,n){const i=n.nodeUtils.nodePackedRange(e),s=function(e,t,n){let i=0;const s=[];let o,a="";for(let n=0,r=e.children.length;n<r;++n)switch((o=e.children[n]).kind){case 2:i|=16;break;case 29:i|=8;break;case 82:a=t.nameResolver.resolveRelative(t.nodeUtils.nodeText(o));break;case 1023:{const e=S(o,t);e&&s.push(e)}break;case 1031:Array.prototype.push.apply(s,T(o,t))}const c=r.Definition.create(1,a||t.nodeUtils.createSymbolName(n,"Class"),t.nodeUtils.uriId,t.currentDefinition());return c.modifiers|=i,c.associated=s,t.addName(c.name),c}(e.children[0],n,e);if(s.range=i,n.enterDefinition(s,e),A(n)){s.modifiers|=524288;const t=F(n);n.addMagicDefinitions(t,e)}n.clearLastPhpDoc(),t(e.children[1],n),n.leaveDefinition()}(e,d);break;case 1025:!function(e,t){let n=1,i=0;4===e.children.length&&(i=P(e.children[0]),n=2);(function(e,t,n){for(let i=0,r=e.children.length;i<r;++i)1026===e.children[i].kind&&v(e.children[i],t,n)})(e.children[n],i,t),t.clearLastPhpDoc()}(e,d);break;case 1132:!function(e,t){let n=0;n=65===e.children[0].kind?1:N(P(e.children[0]),1);(function(e,t,n){for(let i=0,r=e.children.length;i<r;++i)1133===e.children[i].kind&&w(e.children[i],t,n)})(e.children[1],n,t),t.clearLastPhpDoc()}(e,d);break;case 1166:!function(e,t){const n=y(e.children[1],t,4);for(let e=0,i=n.length;e<i;++e)t.addAssociated(n[e]);!function(e,t,n){3===e.children.length&&1159===e.children[1].kind&&function(e,t,n){let i;for(let r=0,s=e.children.length;r<s;++r)1165===(i=e.children[r]).kind?R(i,t):1160===i.kind&&x(i,t,n)}(e.children[1],t,n)}(e.children[2],t,n)}(e,d);break;case 1108:!function(e,n){(function(e,n,i){let s,o,a,c=1,d="";const l=i.nodeUtils.nodePackedRange(n);for(let l=0,u=e.children.length;l<u;++l)switch((o=e.children[l]).kind){case 1105:c=N(P(o),1);break;case 102:c|=1024;break;case 1090:{const e=b(o,32,i);let t=32;e&&"__construct"===(d=e.name).toLowerCase()&&(t=2048),s=r.Definition.create(t,d||i.nodeUtils.createSymbolName(n,"Method"),i.nodeUtils.uriId,i.currentDefinition()),i.enterDefinition(s,n)}break;case 1125:s||(s=r.Definition.create(32,d||i.nodeUtils.createSymbolName(n,"Method"),i.nodeUtils.uriId,i.currentDefinition()),i.enterDefinition(s,n)),t(o,i);break;case 1144:a=M(o,i)}s||(s=r.Definition.create(32,d||i.nodeUtils.createSymbolName(n,"Method"),i.nodeUtils.uriId,i.currentDefinition()),i.enterDefinition(s,n));s.range=l,s.modifiers|=c,A(i)&&(r.Definition.setDocumentedType(s,L(i)),s.modifiers|=524288);r.Definition.setDeclaredType(s,a),i.addName(s.name),i.clearLastPhpDoc()})(e.children[0],e,n),t(e.children[1],n),n.leaveDefinition()}(e,d);break;case 1124:!function(e,t){let n,s,o,a=0,c="";const d=t.nodeUtils.nodePackedRange(e);for(let r=0,d=e.children.length;r<d;++r)switch((o=e.children[r]).kind){case 1169:s=C(o,t),i.TypeString.isEqual(s,i.TypeString.NULL_TYPE_STRING)&&(a|=32768);break;case 102:a|=1024;break;case 133:a|=2048,s&&(s=i.TypeString.arrayReference(s));break;case 83:c=t.nodeUtils.nodeText(o);break;case 1048:n=E(o,t),a|=8388608}c||(c=t.nodeUtils.createSymbolName(e,"Parameter"));const l=r.Definition.create(128,c,t.nodeUtils.uriId,t.currentDefinition());l.range=d,l.modifiers|=a,l.value=n,s&&n&&"null"===n.toLowerCase()&&(s=i.TypeString.merge(s,i.TypeString.NULL_TYPE_STRING));r.Definition.setDeclaredType(l,s),A(t)&&(r.Definition.setDocumentedType(l,function(e,t){if(!t.lastPhpDoc)return;const n=t.lastPhpDoc.findParamTag(e);return n?i.TypeString.nameResolve(i.TypeString.fromString(n.typeName.text),t.nameResolver):void 0}(l.name,t)),l.modifiers|=524288);t.addDefinition(l,e)}(e,d);break;case 1098:!function(e,n){const i=n.nodeUtils.nodePackedRange(e),s=function(e,t,n){const i=t.nameResolver.resolveRelative(t.nodeUtils.nodeText(e.children[1])),s=r.Definition.create(2,i||t.nodeUtils.createSymbolName(n,"Interface"),t.nodeUtils.uriId,t.currentDefinition());t.addName(s.name),e.children.length>2&&(s.associated=function(e,t){if(1097!==e.kind)return[];return y(e.children[1],t,2)}(e.children[2],t));return s}(e.children[0],n,e);if(s.range=i,n.enterDefinition(s,e),A(n)){s.modifiers|=524288;const t=F(n);n.addMagicDefinitions(t,e)}n.clearLastPhpDoc(),t(e.children[1],n),n.leaveDefinition()}(e,d);break;case 1161:!function(e,n){const i=n.nodeUtils.nodePackedRange(e),s=function(e,t,n){const i=t.nameResolver.resolveRelative(t.nodeUtils.nodeText(e.children[1])),s=r.Definition.create(4,i||t.nodeUtils.createSymbolName(n,"Trait"),t.nodeUtils.uriId,t.currentDefinition());return t.addName(s.name),s}(e.children[0],n,e);if(s.range=i,n.enterDefinition(s,e),A(n)){s.modifiers|=524288;const t=F(n);n.addMagicDefinitions(t,e)}n.clearLastPhpDoc(),t(e.children[1],n),n.leaveDefinition()}(e,d);break;case 1080:!function(e,n){let i=e.children[0];if(1079===i.kind||1139===i.kind||1136===i.kind){const s=g(i,n,64);if(!s)return void O(e.children.slice(1),n);s.unresolvedName&&"define"===s.unresolvedName.toLowerCase()?function(e,t,n){const i=n.nodeUtils.nodePackedRange(t);if(1008!==e.kind||e.children.length<3||77!==e.children[0].kind)return void O(e.children,n);let[s,o]=m(e.children[0],n);s&&"\\"===s[0]&&(s=s.slice(1));if(s){const o=r.Definition.create(8,s,n.nodeUtils.uriId,n.currentDefinition());if(o.range=i,e.children.length>2){const[t,i]=m(e.children[2],n);void 0!==t&&(o.value=t),i&&r.Definition.setDocumentedType(o,i)}n.addDefinition(o,t)}O(e.children,n)}(e.children[2],e,n):t(e.children[2],n)}else O(e.children,n)}(e,d);break;case 1002:!function(e,n){const i=n.nodeUtils.nodePackedRange(e),s=r.Definition.create(1,n.nodeUtils.createSymbolName(e,"Class"),n.nodeUtils.uriId,n.currentDefinition());s.range=i,function(e,t,n){let i;t.associated=[];for(let r=0,s=e.children.length;r<s;++r)switch((i=e.children[r]).kind){case 1023:{const e=S(i,n);e&&t.associated.push(e)}break;case 1031:Array.prototype.push.apply(t.associated,T(i,n));break;case 1008:O(i.children,n)}n.clearLastPhpDoc()}(e.children[0],s,n),n.enterDefinition(s,e),t(e.children[1],n),n.leaveDefinition()}(e,d);break;case 1042:!function(e,t){O(e.children,t),t.clearLastPhpDoc()}(e,d);break;case 1131:!function(e,n){t(e.children[0],n),1106===e.children[2].kind?_(e.children[2],n,16):t(e.children[2],n)}(e,d);break;case 1106:_(e,d);break;case 1146:!function(e,t){let n=e.children[0];83!==n.kind&&1090!==n.kind||t.addName(t.nodeUtils.nodeText(n))}(e,d);break;case 1041:!function(e,t){g(e.children[0],t,8)}(e,d);break;case 1086:if(1173===e.children[1].kind){const t=e.children[1];let n;for(let e=0,i=t.children.length;e<i;++e)1152===(n=t.children[e]).kind&&k(n,d,16778240)}break;case 1074:102===e.children[0].kind&&1152===e.children[1].kind?k(e.children[1],d,1024):(t(e.children[0],d),e.children[1]&&t(e.children[1],d));break;case 1016:1152===e.children[0].kind?k(e.children[0],d,1024):t(e.children[0],d),t(e.children[3],d);break;case 1152:k(e,d,0);break;case 1154:!function(e,n){const i=n.nodeUtils.nodePackedRange(e);if(83===e.children[0].kind){const t=r.Definition.create(256,n.nodeUtils.nodeText(e.children[0]),n.nodeUtils.uriId,n.currentDefinition());t.range=i,t.modifiers|=32,n.addDefinition(t,e)}e.children.length>1&&t(e.children[1],n)}(e,d);break;case 1007:!function(e,t){let n=e.children[0],i=4096;102===n.kind&&(i|=1024,n=e.children[1]);if(!n||83!==n.kind)return;const s=t.nodeUtils.nodePackedRange(e);let o=t.nodeUtils.nodeText(n);const a=r.Definition.create(256,o,t.nodeUtils.uriId,t.currentDefinition());a.range=s,a.modifiers=i,t.addDefinition(a,e)}(e,d);break;case 1020:!function(e,n){let i=e.children[3];const s=n.nodeUtils.nodePackedRange(e);let o=n.nodeUtils.nodeText(i);if(!o)return;const a=r.Definition.create(256,o,n.nodeUtils.uriId,n.currentDefinition());a.range=s,n.addDefinition(a,e),t(e.children[e.children.length-1],n)}(e,d);break;case 87:case 118:d.clearLastPhpDoc();break;case 159:{const t=d.nodeUtils.nodeOffset(e),n=d.nodeUtils.nodeText(e),i=a.PhpDocParser.parse(n,t);if(d.lastPhpDoc=i,i){const t={nameResolver:d.nameResolver,nodeUtils:d.nodeUtils,ownerNodeKind:0},n=i.getReferences(t);let r;const s=48,o=7;for(let e=0;e<n.length;++e)(((r=n[e]).kind&s)>0||(r.kind&o)>0&&!c.PHP.isReservedNameOrRelativeName(r.name.toLowerCase()))&&d.addName(r.name);d.addDocBlock(d.lastPhpDoc,e)}}break;case 1151:d.pushAssignment(e),O(e.children,d),d.popAssignment();break;default:o.isPhrase(e)&&O(e.children,d)}}function n(e,t,n){let i,s="";for(let n=0,r=e.children.length;n<r;++n)82===(i=e.children[n]).kind&&(s+="\\"+t.nodeUtils.nodeText(i));return r.Reference.create(n||1,s.slice(1),t.nodeUtils.uriId)}function s(e,t,n){for(let i=0,r=e.children.length;i<r;++i)1117===e.children[i].kind&&p(e.children[i],t,n)}function u(e,t,n,i){for(let r=0,s=e.children.length;r<s;++r)1120===e.children[r].kind&&h(e.children[r],t,n,i)}function h(e,t,i,s){let o;const a=i.nodeUtils.nodePackedRange(e);11===e.children[0].kind?(s=8,o=n(e.children[1],i,s)):33===e.children[0].kind?(s=64,o=n(e.children[1],i,s)):1116===e.children[0].kind&&(o=n(e.children[0],i)),t&&o&&(o.name=t+"\\"+o.name);let c="";o&&(c=r.Definition.shortName(o.name),i.addName(o.name));const d=e.children[e.children.length-1];if(1114===d.kind){const e=f(d,i);e&&(c=e)}if(c){const t=r.Definition.create(s||1,c,i.nodeUtils.uriId,i.currentDefinition());t.range=a,t.modifiers=4096,t.associated=o?[o]:[],i.addDefinition(t,e)}}function f(e,t){const n=e.children[1];return 82===n.kind?t.nodeUtils.nodeText(n):""}function p(e,t,i){let s,o,a="";const c=t.nodeUtils.nodePackedRange(e);for(let c=0,d=e.children.length;c<d;++c)switch((o=e.children[c]).kind){case 1116:(s=n(o,t,i||1))&&(t.addName(s.name),a=r.Definition.shortName(s.name));break;case 1114:{const e=f(o,t);e&&(a=e)}}if(a){const n=r.Definition.create(i||1,a,t.nodeUtils.uriId,t.currentDefinition());n.range=c,n.modifiers=4096,n.associated=s?[s]:[],t.addDefinition(n,e)}}function m(e,n){let r,s;switch(e.kind){case 78:r=n.nodeUtils.nodeText(e),s=i.TypeString.FLOAT_TYPE_STRING;break;case 81:r=n.nodeUtils.nodeText(e),s=i.TypeString.INT_TYPE_STRING;break;case 77:r=n.nodeUtils.nodeText(e).slice(1,-1),s=i.TypeString.STRING_TYPE_STRING;break;case 1009:s=i.TypeString.ARRAY_TYPE_STRING;break;default:t(e,n)}return[r,s]}function g(e,t,i){let r=void 0;switch(e.kind){case 1079:r=function(e,t,i){return n(e.children[1],t,i)}(e,t,i);break;case 1136:r=function(e,t,i){const r=n(e.children[0],t,i);if(!r)return;const s=r.name.toLowerCase();r.name.indexOf("\\")<0&&(i&&(72&i)>0&&!c.PHP.isReservedNameOrRelativeName(s)&&t.addName(r.name),r.unresolvedName=r.name);c.PHP.isReservedName(s)||(r.name=t.nameResolver.resolveNotFullyQualified(r.name,i));return r}(e,t,i);break;case 1139:r=function(e,t,i){const r=n(e.children[2],t,i);if(!r)return;return r.name=t.nameResolver.resolveRelative(r.name),r}(e,t,i)}return r&&!c.PHP.isReservedNameOrRelativeName(r.name.toLowerCase())&&t.addName(r.name),r}function k(e,t,n){const i=t.nodeUtils.nodePackedRange(e);if(83===e.children[0].kind){let s=t.nodeUtils.nodeText(e.children[0]);"$"!==s[0]&&(s="$"+s);const o=r.Definition.create(256,s,t.nodeUtils.uriId,t.currentDefinition());o.range=i,o.modifiers|=n,t.isNodeAssignedTo(e)&&(o.modifiers|=2097152),t.addDefinition(o,e)}else O(e.children,t)}function S(e,t){return g(e.children[1],t,1)}function T(e,t){return y(e.children[1],t,2)}function y(e,t,n){const i=[];let r;for(let s=0,o=e.children.length;s<o;++s)(r=g(e.children[s],t,n))&&i.push(r);return i}function v(e,t,n){let i="";const s=n.nodeUtils.nodePackedRange(e);t=t||1;const o=b(e.children[0],1024,n);o&&(i=o.name),i||(i=n.nodeUtils.createSymbolName(e,"ClassConstant"));const a=r.Definition.create(1024,i,n.nodeUtils.uriId,n.currentDefinition());a.range=s,a.modifiers|=32|t;const[c,d]=m(e.children[2],n);void 0!==c&&(a.value=c),d&&r.Definition.setDocumentedType(a,d),A(n)&&(r.Definition.setDocumentedType(a,U(a.name,n)),a.modifiers|=524288),n.addName(a.name),n.addDefinition(a,e)}function _(e,t,n){if(82===e.children[0].kind){let i=t.nodeUtils.nodeText(e.children[0]);16===n&&"$"!==i.slice(0,1)&&(i="$"+i),t.addName(i)}}function b(e,t,n){const i=n.nodeUtils.nodeText(e);if(i)return r.Reference.create(t,i,n.nodeUtils.uriId)}function P(e){let t=0;for(let n=0,i=e.children.length;n<i;++n)t|=D(e.children[n]);return t}function D(e){switch(e.kind){case 53:return 1;case 54:return 2;case 52:return 4;case 2:return 16;case 29:return 8;case 58:return 32;default:return 0}}function N(e,t){return 7&e||(e|=t),e}function w(e,n,i){let s="";const o=i.nodeUtils.nodePackedRange(e);83===e.children[0].kind&&(s=i.nodeUtils.nodeText(e.children[0])),s||(s=i.nodeUtils.createSymbolName(e,"Property"));const a=r.Definition.create(16,s,i.nodeUtils.uriId,i.currentDefinition());a.range=o,a.modifiers|=n,A(i)&&(r.Definition.setDocumentedType(a,U(a.name,i)),a.modifiers|=524288),i.addName(s),i.addDefinition(a,e),2===e.children.length&&t(e.children[1],i)}function I(e,t){if(1111===e.kind)if(1===e.children.length){const n=b(e.children[0],32,t);if(n)return[void 0,n]}else{const n=g(e.children[0],t,4),r=b(e.children[2],32,t);if(n&&r)return t.addName(r.name),r.scope=i.TypeString.fromString(n.name),[n,r]}}function R(e,t){const n=t.nodeUtils.nodePackedRange(e),s=I(e.children[0],t),o=y(e.children[2],t);if(!s||!o.length)return;const a=r.Definition.create(32,s[1].name,t.nodeUtils.uriId,t.currentDefinition());a.range=n,o.unshift(s[0]),a.associated=o.map(e=>{let n=r.Reference.create(32,s[1].name,t.nodeUtils.uriId);return n.scope=i.TypeString.fromString(e.name),n}),a.modifiers=8192,t.addDefinition(a,e)}function x(e,t,n){let s,o=16384,a="";const c=t.nodeUtils.nodePackedRange(e);let d;for(let r=0,c=e.children.length;r<c;++r)switch((d=e.children[r]).kind){case 1111:{const e=I(d,t);e&&(a=e[1].name,s=e[1],e[0]||(s.scope=i.TypeString.fromString(n.map(e=>e.name).join("|"))),t.addName(a))}break;case 1090:{const e=b(d,32,t);e&&(a=e.name)}break;case 53:case 54:case 52:o|=D(d)}a||(a=t.nodeUtils.createSymbolName(e,"Method"));const l=r.Definition.create(32,a,t.nodeUtils.uriId,t.currentDefinition());l.range=c,l.modifiers|=o,l.associated=[s],t.addName(l.name),t.addDefinition(l,e)}function E(e,t){return t.nodeUtils.nodeText(e.children[1])}function M(e,t){return C(e.children[1],t)}function C(e,t){if(1169!==e.kind)return;let n,r=0;95===e.children[0].kind&&(n=i.TypeString.NULL_TYPE_STRING,r=1);const s=e.children[r];if(6===s.kind)n=i.TypeString.merge(n,i.TypeString.CALLABLE_TYPE_STRING);else if(3===s.kind)n=i.TypeString.merge(n,i.TypeString.ARRAY_TYPE_STRING);else{const e=g(s,t);e&&(n=e.unresolvedName&&"static"===e.unresolvedName.toLowerCase()?i.TypeString.STATIC_TYPE_STRING:i.TypeString.merge(n,i.TypeString.fromString(e.name)))}return n}function O(e,n){if(e)for(let i=0,r=e.length;i<r;++i)t(e[i],n)}function A(e){return!!e.lastPhpDoc}function U(e,t){if(!t.lastPhpDoc)return;const n=t.lastPhpDoc.findVarTag(e);return n?i.TypeString.nameResolve(i.TypeString.fromString(n.typeName.text),t.nameResolver):void 0}function L(e){if(!e.lastPhpDoc)return;const t=e.lastPhpDoc.findReturnTag();return t?i.TypeString.nameResolve(i.TypeString.fromString(t.typeName.text),e.nameResolver):void 0}function F(e){if(!e.lastPhpDoc)return[];let t,n=e.lastPhpDoc,i=n.tags.filter(e=>1021===e.kind||1022===e.kind||1023===e.kind),r=[];for(let n=0,s=i.length;n<s;++n)(t=H(i[n],e))&&r.push(t);for(let t=0,s=(i=n.filterTags(e=>1024===e.kind)).length;t<s;++t)Array.prototype.push.apply(r,G(i[t],e));return r}function V(e,t){let n=a.PhpDocNode.offsetRange(e);return d.PackedRange.fromLspRange({start:t.nodeUtils.offsetToPosition(n.start),end:t.nodeUtils.offsetToPosition(n.end)})}function G(e,t){if(!e.elementName.text)return[];let n=r.Definition.create(32,e.elementName.text,t.nodeUtils.uriId,t.currentDefinition());n.range=V(e,t),n.modifiers=257,r.Definition.setDocumentedType(n,i.TypeString.nameResolve(i.TypeString.fromString(e.typeName.text),t.nameResolver)),n.children=[];const s=[n];e.isStatic&&(n.modifiers|=32);const o=e.parameters;if(!o)return s;let a;for(let e=0,i=o.length;e<i;++e)(a=K(o[e],t,n))&&s.push(a);return s}function K(e,t,n){if(!e.elementName.text)return;let s=r.Definition.create(128,e.elementName.text,t.nodeUtils.uriId,n);return s.range=V(e,t),s.modifiers=256,r.Definition.setDocumentedType(s,i.TypeString.nameResolve(i.TypeString.fromString(e.typeName.text),t.nameResolver)),s}function H(e,t){if(!e.elementName.text)return;let n=r.Definition.create(16,e.elementName.text,t.nodeUtils.uriId,t.currentDefinition());return n.range=V(e,t),n.modifiers=257|function(e){switch(e.kind){case 1022:return 64;case 1023:return 128;default:return 0}}(e),r.Definition.setDocumentedType(n,i.TypeString.nameResolve(i.TypeString.fromString(e.typeName.text),t.nameResolver)),n}e.transform=function(e){const n=new l(e);return t(e.node,n),{definitionTable:n.definitionTable,nodeDefinitionMap:n.nodeDefinitionMap,nodeMagicDefinitionMap:n.nodeMagicDefinitionMap,referenceNames:n.referenceNames,nodeProblemMap:n.nodeProblemMap,nodeDocBlockMap:n.nodeDocBlockMap}}}(t.DefinitionTransformer||(t.DefinitionTransformer={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(7),r=n(1),s=n(1),o=n(5),a=n(6),c=n(2),d=n(4),l=n(0),u=n(44),h=n(9),f=n(9),p=n(11),m=10;var g,k,S,T,y;!function(e){e.create=function(e,t,n,i,r,s,o,a,c,d,l){return{parseTree:e,nameResolver:t,definitionStore:n,parseTreeStore:i,circularReferenceGuard:o,parseTreeTraverser:a,typeAndValueCache:c,callStack:r,typeFactory:d,loadFileWithTransformSyncDelegate:s,fileDepth:l}}}(g=t.ReferenceTransformContext||(t.ReferenceTransformContext={})),function(e){function t(e,t){return{type:c.TypeString.merge(e.type,t.type)||c.TypeString.MIXED_TYPE_STRING,callStack:f.setUnion(e.callStack,t.callStack),value:void 0!==e.value?e.value:t.value,flag:(e.flag||0)|(t.flag||0)}}e.merge=t,e.mergeMany=function(e){let n=e[0];for(let i=1;i<e.length;++i)n=t(n,e[i]);return n}}(k=t.TypeAndValue||(t.TypeAndValue={}));t.InferredTypeAndValueCache=class{constructor(){this.uriIdToNodeMap=new Map,this.callStackUriIdToNodeMap=new Map}has(e){return void 0!==this.get(e)}get(e){return this._get(e.uriId,e.fqsenHash)}_get(e,t){let n=this.uriIdToNodeMap.get(e);return n?n.get(t):void 0}set(e,t){this.delete(e);let n,i=this.uriIdToNodeMap.get(e.uriId);i?i.set(t.fqsenHash,t):((i=new Map).set(t.fqsenHash,t),this.uriIdToNodeMap.set(e.uriId,i));const r=t.typeAndValue.callStack.values();for(let i of r)e.uriId!==i&&((n=this.callStackUriIdToNodeMap.get(i))?n.add(t):this.callStackUriIdToNodeMap.set(i,new Set([t])))}delete(e){this._delete(e.uriId,e.fqsenHash)}_delete(e,t){const n=this._get(e,t);if(!n)return;let i;const r=n.typeAndValue.callStack.values();for(let t of r)t!==e&&(1===(i=this.callStackUriIdToNodeMap.get(t)).size?this.callStackUriIdToNodeMap.delete(t):i.delete(n));this.uriIdToNodeMap.get(e).delete(t)}clearUri(e){const t=this.callStackUriIdToNodeMap.get(e);if(t)for(let e of t.values())e&&this._delete(e.uriId,e.fqsenHash)}};class v{constructor(e){if(this.variableTable=new _,this.definitionStack=[],this.returnTypeStack=[],this.nodeUtils=e.parseTree.getNodeUtils(),this.definitionStore=e.definitionStore,this.parseTreeStore=e.parseTreeStore,this.typeAndValueCache=e.typeAndValueCache,this.nodeDefinitionMap=e.parseTree.nodeDefinitionMap,this.nameResolver=e.nameResolver,this.nodeReferenceMap=new Map,this.circularReferenceGuard=e.circularReferenceGuard||new Set,this.nodeDocBlockMap=e.parseTree.nodeDocBlockMap,this.nodePhpDocReferenceMap=new Map,this.callStack=e.callStack,this.typeFactory=e.typeFactory||new a.TypeFactory(e.definitionStore),this.loadFileWithTransformSyncDelegate=e.loadFileWithTransformSyncDelegate,this.fileDepth=e.fileDepth||0,e.parseTreeTraverser){const t=e.parseTreeTraverser.spine;this.init(t)}}init(e){let t;for(let n=0;n<e.length-1;++n)switch((t=e[n]).kind){case 1148:case 1081:case 1004:case 1028:case 1098:case 1161:case 1002:case 1108:this.enterScope(t,!0);continue;default:continue}}static circularReferenceGuardKey(e){return e.uriId.toString(16)+"."+e.fqsenHash.toString(16)}definition(e){return this.nodeDefinitionMap.get(e)}definitionTable(){return this.definitionStore.table(this.nodeUtils.uri)}enterScope(e,t){const n=this.definition(e);switch(n.kind){case 1:case 2:case 4:{const e=this.typeFactory.fromDefinition(n);t||this.nameResolver.pushClass(e.name,e.baseClass?e.baseClass.name:""),this.definitionStack.push(e),this.variableTable.pushScope(),this.variableTable.setVariable({name:"$this",typeAndValue:{type:c.TypeString.fromString(e.name),callStack:this.callStack}})}break;case 2048:case 32:{this.variableTable.pushScope(["$this"]);const t=this.typeContext().findMember(n.name,n.kind);this.definitionStack.push(t),this.setVariablesFromDefinitions(t.parameters),this.returnTypeStack.push([]),this.setFunctionGlobalVariableTypes(e)}break;case 64:if((512&n.modifiers)>0){const e=this.definitionTable().definitionChildren(n).filter(r.Definition.isUseVariable).map(e=>e.name);e.push("$this"),this.variableTable.pushScope(e)}else this.variableTable.pushScope();{const t=this.definitionTable().definitionChildren(n).filter(r.Definition.isParameter);this.setVariablesFromDefinitions(t),this.returnTypeStack.push([]),this.definitionStack.push(n),this.setFunctionGlobalVariableTypes(e)}break;case 4096:this.returnTypeStack.push([]),this.variableTable.pushScope(),this.definitionStack.push(n);break;default:throw new Error("Invalid Argument")}}setFunctionGlobalVariableTypes(e){let t=o.NodeUtils.firstToken(e);if(!t)return;for(;(t=t.previous)&&o.NodeUtils.isTrivia(t););if(159!==t.kind)return;const n=this.nodeDocBlockMap.get(t);if(!n)return;const i=n.filterTags(e=>1011===e.kind);for(let e of i)this.setVariable(e.elementName.text,{type:c.TypeString.nameResolve(c.TypeString.fromString(e.typeName.text),this.nameResolver),callStack:new Set([this.nodeUtils.uriId])},!0)}setVariablesFromDefinitions(e){let t;for(let n=0;n<e.length;++n)128===(t=e[n]).kind&&this.variableTable.setVariable({name:t.name,typeAndValue:{type:r.Definition.type(t)||c.TypeString.MIXED_TYPE_STRING,callStack:this.callStack}})}leaveScope(e){const t=this.definition(e);switch(this.variableTable.popScope(),t.kind){case 32:case 64:case 2048:case 4096:{let e,n=this.returnTypeStack.pop();e=n.length>0?k.mergeMany(n):{type:c.TypeString.VOID_TYPE_STRING,callStack:this.callStack},this.typeAndValueCache.set(t,{uriId:t.uriId,fqsenHash:t.fqsenHash,typeAndValue:e})}this.definitionStack.pop();break;case 1:case 2:case 4:this.definitionStack.pop(),this.nameResolver.popClass();break;default:throw new Error("Invalid Argument")}}enterBranch(){this.variableTable.pushBranch()}leaveBranch(e){this.variableTable.popBranch(),e&&this.variableTable.pruneBranches()}addReference(e,t){e&&this.nodeReferenceMap.set(t,e)}addPhpDocReferences(e,t){!e||e.length<1||this.nodePhpDocReferenceMap.set(t,e)}setVariable(e,t,n){this.variableTable.setVariable({name:e,typeAndValue:t,isVarTag:n})}getVariable(e){return this.variableTable.getVariable(e)}pushScopeReturnType(e){e&&this.returnTypeStack.length>0&&this.returnTypeStack[this.returnTypeStack.length-1].push(e)}typeContext(){let e,t,n=this.definitionStack.length;for(;--n>=0&&!t;)(7&(e=this.definitionStack[n]).kind)>0&&(t=e);return t}typeContextName(){const e=this.typeContext();return e?e.name:""}currentFunctionOrMethod(){const e=this.definitionStack.length?this.definitionStack[this.definitionStack.length-1]:void 0;return e&&(2144&e.kind)>0?e.name:""}}!function(e){function t(e,t,i){for(let r=0,s=e.length;r<s;++r)n(e[r],t,i)}function n(e,a,d){switch(e.kind){case 1061:break;case 1148:!function(e,n){n.enterScope(e),t(e.children,e,n),n.leaveScope(e)}(e,d);break;case 1115:!function(e,n){let i,r;1116===e.children[1].kind&&(i=y(e.children[1],n,512));i?(n.nameResolver.namespaceName=i.name,r=5===e.children.length?e.children[3]:void 0):(n.nameResolver.namespaceName="",r=4===e.children.length?e.children[2]:void 0);r&&1153===r.kind&&t(r.children,e,n)}(e,d);break;case 1119:!function(e,t){let n,i=0,r="";for(let s=1,o=e.children.length;s<o;++s)switch((n=e.children[s]).kind){case 11:i=8;break;case 33:i=64;break;case 1116:{const e=y(n,t);e&&(r=e.name,e.kind=512)}break;case 1118:P(n,t,i);break;case 1121:D(n,t,r,i)}}(e,d);break;case 1028:!function(e,t){t.enterScope(e),function(e,t){let n;for(let i=1,r=e.children.length;i<r;++i)switch((n=e.children[i]).kind){case 82:{const e=s.Reference.create(1,t.nodeUtils.nodeText(n),t.nodeUtils.uriId);e.unresolvedName=e.name,e.modifiers|=2097152,e.name=t.nameResolver.resolveRelative(e.unresolvedName),t.addReference(e,n)}break;case 1023:R(n,t);break;case 1031:x(n,t)}}(e.children[0],t),n(e.children[1],e,t),t.leaveScope(e)}(e,d);break;case 1098:!function(e,t){t.enterScope(e),function(e,t){const n=s.Reference.create(2,t.nodeUtils.nodeText(e.children[1]),t.nodeUtils.uriId);n.modifiers|=2097152,n.unresolvedName=n.name,n.name=t.nameResolver.resolveRelative(n.unresolvedName),t.addReference(n,e.children[1]),e.children.length>2&&1097===e.children[2].kind&&function(e,t){E(e.children[1],t,2)}(e.children[2],t)}(e.children[0],t),n(e.children[1],e,t),t.leaveScope(e)}(e,d);break;case 1161:!function(e,t){t.enterScope(e),function(e,t){const n=s.Reference.create(4,t.nodeUtils.nodeText(e.children[1]),t.nodeUtils.uriId);n.modifiers|=2097152,n.unresolvedName=n.name,n.name=t.nameResolver.resolveRelative(n.unresolvedName),t.addReference(n,e.children[1])}(e.children[0],t),n(e.children[1],e,t),t.leaveScope(e)}(e,d);break;case 1023:R(e,d);break;case 1031:x(e,d);break;case 1026:!function(e,t){const n=t.nodeDefinitionMap.get(e),i=s.Reference.create(1024,n.name,n.uriId);i.modifiers|=2097152,i.scope=c.TypeString.fromString(t.typeContextName()),t.addReference(i,e.children[0]);const o=C(e.children[2],t,void 0===n.value);r.Definition.type(n)&&void 0!==n.value||t.typeAndValueCache.set(n,{uriId:n.uriId,fqsenHash:n.fqsenHash,typeAndValue:o})}(e,d);break;case 1133:!function(e,t){const n=t.definition(e),i=s.Reference.create(16,n.name,n.uriId);if(i.modifiers|=2097152,i.scope=c.TypeString.fromString(t.typeContextName()),t.addReference(i,e.children[0]),e.children.length>1&&1135===e.children[1].kind){const i=function(e,t){return C(e.children[1],t,!1)}(e.children[1],t);r.Definition.type(n)||t.typeAndValueCache.set(n,{uriId:n.uriId,fqsenHash:n.fqsenHash,typeAndValue:i})}}(e,d);break;case 1108:!function(e,t){t.enterScope(e),function(e,t){let r;for(let o=0,a=e.children.length;o<a;++o)if(1090===(r=e.children[o]).kind){const e=s.Reference.create(32,t.nodeUtils.nodeText(r),t.nodeUtils.uriId);e.modifiers|=2097152,e.scope=c.TypeString.fromString(t.typeContextName()),t.addReference(e,r)}else i.isPhrase(r)&&n(r,e,t)}(e.children[0],t),n(e.children[1],e,t),t.leaveScope(e)}(e,d);break;case 1043:K(e,d);break;case 1081:!function(e,t){t.enterScope(e),function(e,t){let r;for(let o=0,a=e.children.length;o<a;++o)if(82===(r=e.children[o]).kind){const e=s.Reference.create(64,t.nodeUtils.nodeText(r),t.nodeUtils.uriId);e.unresolvedName=e.name,e.name=t.nameResolver.resolveRelative(e.unresolvedName),e.modifiers|=2097152,t.addReference(e,r)}else i.isPhrase(r)&&n(r,e,t)}(e.children[0],t),n(e.children[1],e,t),t.leaveScope(e)}(e,d);break;case 1091:case 1157:d.enterBranch(),t(e.children,e,d),d.leaveBranch(!0);break;case 1017:case 1054:case 1049:case 1053:d.leaveBranch(),t(e.children,e,d),d.enterBranch();break;case 1073:!function(e,t){let r,s={type:c.TypeString.ARRAY_TYPE_STRING,callStack:t.callStack};for(let o=0,a=e.children.length;o<a;++o)switch((r=e.children[o]).kind){case 1071:s=C(r,t,!1);break;case 1074:{const e=t.nodeUtils.nodeOffset(r);X(r,t),t.nodeUtils.markOffset(r,e);let n=s?s.type:c.TypeString.MIXED_TYPE_STRING,i=W(n,t,"Iterator","current");i||(i=c.TypeString.arrayDereference(n)),i||(i=c.TypeString.MIXED_TYPE_STRING),Z(r,{type:i,callStack:s.callStack},t)}break;case 1072:{const e=t.nodeUtils.nodeOffset(r);C(r,t,!1),t.nodeUtils.markOffset(r,e),Z(r,{type:c.TypeString.STRING_OR_INT_TYPE_STRING,callStack:t.callStack},t)}break;default:i.isPhrase(r)&&n(r,e,t)}}(e,d);break;case 1020:!function(e,t){const i=function(e,t){const n=[];let i;for(let r=0,s=e.children.length;r<s;++r)(i=_(e.children[r],t))&&(i.type=c.TypeString.fromString(i.name),n.push(i.type));return c.TypeString.mergeMany(n)}(e.children[2],t);let r;const o=e.children[3];83===o.kind&&((r=s.Reference.create(256,t.nodeUtils.nodeText(o),t.nodeUtils.uriId)).type=i,r.modifiers|=3145728,t.setVariable(r.name,{type:r.type,callStack:t.callStack}),t.addReference(r,o));n(e.children[5],e,t)}(e,d);break;case 1124:z(e,d);break;case 1007:!function(e,t){let n=2097152;102===e.children[0].kind&&(n|=1024);const i=e.children[e.children.length-1];if(83!==i.kind)return;const r=s.Reference.create(256,t.nodeUtils.nodeText(i),t.nodeUtils.uriId);r.modifiers|=n;const o=t.getVariable(r.name);r.type=o?o.typeAndValue.type:c.TypeString.MIXED_TYPE_STRING,t.addReference(r,i)}(e,d);break;case 1067:!function(e,t){C(e.children[0],t,!1)}(e,d);break;case 1143:!function(e,t){let n;switch(e.children[1].kind){case 87:case 158:case 1061:n={type:c.TypeString.VOID_TYPE_STRING,callStack:t.callStack};break;default:n=C(e.children[1],t,!1)}t.pushScopeReturnType(n)}(e,d);break;case 1169:Q(e,d);break;case 1166:!function(e,t){const n=E(e.children[1],t,4);!function(e,t,n){3===e.children.length&&1159===e.children[1].kind&&function(e,t,n){let i;for(let r=0,s=e.children.length;r<s;++r)1165===(i=e.children[r]).kind?l(i,t):1160===i.kind&&f(i,t,n)}(e.children[1],t,n)}(e.children[2],t,n)}(e,d);break;case 159:!function(e,t,n){const i=n.nodeDocBlockMap.get(e);if(!i)return;const r=i.filterTags(e=>(1008===e.kind||1011===e.kind)&&""!==e.elementName.text);let s;for(let e=0;e<r.length;++e)s=r[e],n.setVariable(s.elementName.text,{type:c.TypeString.nameResolve(c.TypeString.fromString(s.typeName.text),n.nameResolver),callStack:n.callStack},!0);const a=t?function(e,t){const n=t.children.indexOf(e)+1;return n>0||n<t.children.length?t.children[n]:void 0}(e,t):void 0;let d,l=1e3;if(a&&(l=a.kind,o.NodeUtils.isTypeDefinitionNode(a))){const e=n.nodeDefinitionMap.get(a);e&&(d=e.name)}const u={nameResolver:n.nameResolver,nodeUtils:n.nodeUtils,ownerNodeKind:l,ownerTypeName:d},h=i.getReferences(u);n.addPhpDocReferences(h,e)}(e,a,d);break;case 1154:!function(e,t){let n,i=e.children[0];if(83===i.kind){n=s.Reference.create(256,t.nodeUtils.nodeText(i),t.nodeUtils.uriId);const e=t.getVariable(n.name);n.type=e?e.typeAndValue.type:c.TypeString.NULL_TYPE_STRING,n.modifiers|=2097152,t.addReference(n,i)}if((i=e.children.length>1?e.children[1]:void 0)&&1085===i.kind){const e=function(e,t){return C(e.children[1],t,!1)}(i,t);n&&(n.modifiers|=1048576,n.type=e.type),t.setVariable(n.name,e)}}(e,d);break;case 1086:!function(e,t){let n=e.children[1];if(1173===n.kind){let e;for(let i=0,r=n.children.length;i<r;++i)1152===(e=n.children[i]).kind&&b(e,t,19923968)}}(e,d);break;default:!function(e){switch(e.kind){case 1001:case 1019:case 1170:case 1112:case 1065:case 1151:case 1016:case 1038:case 1014:case 1150:case 1095:case 1037:case 1035:case 1040:case 1009:case 1156:case 1057:case 1060:case 1062:case 1104:case 1126:case 1127:case 1128:case 1129:case 1138:case 1149:case 1102:case 1080:case 1131:case 1107:case 1024:case 1147:case 1145:case 1004:case 1152:case 1136:case 1079:case 1139:case 1041:case 1123:case 1092:case 1093:case 1141:case 1142:case 1051:case 1089:case 1057:case 77:case 81:case 78:case 76:case 70:case 71:case 75:case 73:case 72:case 69:case 74:case 79:return!0;default:return!1}}(e)?i.isPhrase(e)&&t(e.children,e,d):C(e,d,!1)}}function l(e,t){g(e.children[0],t),E(e.children[2],t)}function f(e,t,n){let i;for(let r=0,s=e.children.length;r<s;++r)switch((i=e.children[r]).kind){case 1111:{const e=g(i,t);if(e){const t=e[1];e[0]||(t.scope=c.TypeString.fromString(n.map(e=>e.name).join("|")))}}break;case 1090:{const e=S(i,32,t);e&&(e.scope=c.TypeString.fromString(t.typeContextName()),t.addReference(e,i))}}}function g(e,t){if(1111===e.kind)if(1===e.children.length){const n=S(e.children[0],32,t);if(n)return t.addReference(n,e.children[0]),[void 0,n]}else{const n=_(e.children[0],t,4),i=S(e.children[2],32,t);if(n&&i)return i.scope=c.TypeString.fromString(n.name),t.addReference(i,e.children[2]),[n,i]}}function S(e,t,n){const i=n.nodeUtils.nodeText(e);if(i)return s.Reference.create(t,i,n.nodeUtils.uriId)}function y(e,t,n){let i,r="";for(let n=0,s=e.children.length;n<s;++n)82===(i=e.children[n]).kind&&(r+="\\"+t.nodeUtils.nodeText(i));const o=s.Reference.create(n||1,r.slice(1),t.nodeUtils.uriId);return t.addReference(o,e),o}function _(e,t,n){switch(e.kind){case 1079:return function(e,t,n){return y(e.children[1],t,n)}(e,t,n);case 1136:return function(e,t,n){const i=y(e.children[0],t,n);if(!i)return;return i.unresolvedName=i.name,i.name=t.nameResolver.resolveNotFullyQualified(i.name,i.kind),i}(e,t,n);case 1139:return function(e,t,n){const i=y(e.children[2],t,n);if(!i)return;return i.unresolvedName=i.name,i.name=t.nameResolver.resolveRelative(i.name),i}(e,t,n);default:return}}function b(e,n,i){if(83===e.children[0].kind){let t=n.nodeUtils.nodeText(e.children[0]);"$"!==t[0]&&(t="$"+t),n.definition(e)&&(i|=2097152);const r=s.Reference.create(256,t,n.nodeUtils.uriId),o=n.getVariable(r.name);if(r.type=o?o.typeAndValue.type:void 0,"$this"===r.name&&(r.type=c.TypeString.THIS_TYPE_STRING),n.addReference(r,e),r.modifiers|=i,(16777216&i)>0&&!o){const t=J(n.definitionStore.find(r.name,e=>256===e.kind&&!e.scope&&!(16781312&e.modifiers)&&(2097152&e.modifiers)>0),n,T.inferGlobalVariableTypeAndValue,c.TypeString.MIXED_TYPE_STRING);return Z(e,t,n),t}return o&&"$this"!==r.name?o.typeAndValue:{type:r.type,callStack:n.callStack}}return t(e.children,e,n),{type:c.TypeString.MIXED_TYPE_STRING,callStack:n.callStack}}function P(e,t,n){for(let i=0,r=e.children.length;i<r;++i)1117===e.children[i].kind&&I(e.children[i],t,n)}function D(e,t,n,i){for(let r=0,s=e.children.length;r<s;++r)1120===e.children[r].kind&&N(e.children[r],t,n,i)}function N(e,t,n,i){let o;if(11===e.children[0].kind?o=y(e.children[1],t,8):33===e.children[0].kind?o=y(e.children[1],t,64):1116===e.children[0].kind&&(o=y(e.children[0],t)),!o)return;n&&(o.name=n+"\\"+o.name);const a={kind:o.kind,name:r.Definition.shortName(o.name),fqn:o.name},c=e.children[e.children.length-1];if(1114===c.kind){const e=w(c,t);if(e){a.name=e;const n=s.Reference.create(o.kind,o.name,t.nodeUtils.uriId);n.unresolvedName=n.name,t.addReference(n,c)}}else o.modifiers|=2097152;t.nameResolver.rules.push(a)}function w(e,t){return t.nodeUtils.nodeText(e.children[1])}function I(e,t,n){let i=0;146===e.children[i].kind&&++i;const o=y(e.children[i],t,n);if(++i,!o)return;const a={kind:o.kind,name:r.Definition.shortName(o.name),fqn:o.name};if(e.children.length===i+1){const n=w(e.children[i],t);if(n){a.name=n;const r=s.Reference.create(o.kind,o.name,t.nodeUtils.uriId);r.unresolvedName=r.name,t.addReference(r,e.children[i])}}else o.modifiers|=2097152;t.nameResolver.rules.push(a)}function R(e,t){return _(e.children[1],t,1)}function x(e,t){return E(e.children[1],t,2)}function E(e,t,n){if(1137!==e.kind)return[];const i=[];let r;for(let s=0,o=e.children.length;s<o;++s)(r=_(e.children[s],t,n))&&i.push(r);return i}function M(e,t){return C(e.children[1],t,!1)}function C(e,o,a){switch(e.kind){case 1176:case 1177:o.pushScopeReturnType({type:c.TypeString.GENERATOR_TYPE_STRING,callStack:o.callStack});for(let t=1,n=e.children.length;t<n;++t)C(e.children[t],o,!1);return{type:c.TypeString.MIXED_TYPE_STRING,callStack:o.callStack};case 1001:return function(e,t,n){const i=C(e.children[0],t,n),r=C(e.children[2],t,n);let s={type:c.TypeString.MIXED_TYPE_STRING,callStack:t.callStack};switch(e.children[1].kind){case 125:s.type=c.TypeString.STRING_TYPE_STRING,n&&(s.value=(o=i.value,a=r.value,F(o)+F(a)));break;case 110:c.TypeString.isArray(i.type)&&c.TypeString.isArray(r.type)?s.type=c.TypeString.arrayReference(c.TypeString.merge(c.TypeString.arrayDereference(i.type),c.TypeString.arrayDereference(r.type))):(s.type=c.TypeString.NUMERIC_TYPE_STRING,n&&(s.value=function(e,t){return O(e)+O(t)}(i.value,r.value)));break;case 142:s.type=c.TypeString.NUMERIC_TYPE_STRING,n&&(s.value=function(e,t){return O(e)-O(t)}(i.value,r.value))}var o,a;return s}(e,o,a);case 1019:return function(e,t){const n=C(e.children[1],t,!1),i={type:n.type,callStack:n.callStack};switch(e.children[0].kind){case 150:i.type=c.TypeString.OBJECT_TYPE_STRING;break;case 149:i.type=c.TypeString.STRING_TYPE_STRING;break;case 155:i.type=c.TypeString.ARRAY_TYPE_STRING;break;case 147:i.type=c.TypeString.BOOLEAN_TYPE_STRING;break;case 152:i.type=c.TypeString.FLOAT_TYPE_STRING;break;case 151:i.type=c.TypeString.INT_TYPE_STRING;break;case 148:i.type=c.TypeString.NULL_TYPE_STRING}return i}(e,o);case 1170:return function(e,t,n){const i=C(e.children[1],t,n),r={type:c.TypeString.NUMERIC_TYPE_STRING,callStack:t.callStack};switch(e.children[0].kind){case 88:r.type=c.TypeString.BOOLEAN_TYPE_STRING;break;case 110:r.type=c.TypeString.NUMERIC_TYPE_STRING,n&&(r.value=O(i.value));break;case 142:r.type=c.TypeString.NUMERIC_TYPE_STRING,n&&(r.value=function(e){return-O(e)}(i.value));break;case 85:c.TypeString.isEqual(i.type,c.TypeString.STRING_TYPE_STRING)?r.type=c.TypeString.STRING_TYPE_STRING:(r.type=c.TypeString.INT_TYPE_STRING,n&&(r.value=function(e){return~O(e)}(i.value)))}return r}(e,o,a);case 1112:return function(e,t,n){const i=C(e.children[0],t,n),r=C(e.children[2],t,n),s={type:c.TypeString.NUMERIC_TYPE_STRING,callStack:t.callStack};switch(e.children[1].kind){case 91:s.type=c.TypeString.INT_TYPE_STRING,n&&(s.value=(o=i.value,a=r.value,O(o)%O(a)));break;case 100:s.type=c.TypeString.NUMERIC_TYPE_STRING,n&&(s.value=function(e,t){return O(e)*O(t)}(i.value,r.value));break;case 90:s.type=c.TypeString.NUMERIC_TYPE_STRING,n&&(s.value=function(e,t){return O(e)/O(t)}(i.value,r.value))}var o,a;return s}(e,o,a);case 1065:return function(e,t,n){const i=C(e.children[0],t,n),r=C(e.children[2],t,n),s={type:c.TypeString.NUMERIC_TYPE_STRING,callStack:t.callStack};n&&(s.value=(o=i.value,a=r.value,Math.pow(O(o),O(a))));var o,a;return s}(e,o,a);case 1151:return function(e,t){const n=e.children[0],i=t.nodeUtils.nodeOffset(n);C(n,t,!1);const r=C(e.children[2],t,!1);return t.nodeUtils.markOffset(n,i),Z(n,r,t),r}(e,o);case 1016:return function(e,t){const n=e.children[0],i=t.nodeUtils.nodeOffset(n);1152===n.kind?b(n,t,1024):C(n,t,!1);const r=C(e.children[3],t,!1);return t.nodeUtils.markOffset(n,i),Z(n,r,t),r}(e,o);case 1038:return function(e,t){const n=C(e.children[0],t,!1),i=C(e.children[2],t,!1);let r={type:c.TypeString.MIXED_TYPE_STRING,callStack:t.callStack};switch(e.children[1].kind){case 108:case 106:case 109:case 104:case 103:case 144:r.type=c.TypeString.INT_TYPE_STRING;break;case 145:case 129:case 113:case 143:r.type=c.TypeString.NUMERIC_TYPE_STRING;break;case 126:r.type=c.TypeString.STRING_TYPE_STRING;break;case 111:c.TypeString.isArray(n.type)&&c.TypeString.isArray(i.type)?r.type=c.TypeString.arrayReference(c.TypeString.merge(c.TypeString.arrayDereference(n.type),c.TypeString.arrayDereference(i.type))):r.type=c.TypeString.NUMERIC_TYPE_STRING}return r}(e,o);case 1014:return function(e,t,n){const i=C(e.children[0],t,n),r=C(e.children[2],t,n),s={type:c.TypeString.INT_TYPE_STRING,callStack:t.callStack};if(n)switch(e.children[1].kind){case 122:s.value=(o=i.value,a=r.value,O(o)|O(a));break;case 102:s.value=function(e,t){return O(e)&O(t)}(i.value,r.value);break;case 124:s.value=function(e,t){return O(e)^O(t)}(i.value,r.value)}var o,a;return s}(e,o,a);case 1150:return function(e,t,n){const i=C(e.children[0],t,n),r=C(e.children[2],t,n),s={type:c.TypeString.INT_TYPE_STRING,callStack:t.callStack};n&&(s.value=105===e.children[1].kind?(o=i.value,a=r.value,O(o)<<O(a)):function(e,t){return O(e)>>O(t)}(i.value,r.value));var o,a;return s}(e,o,a);case 1095:return function(e,t){const i=t.nodeUtils.nodeOffset(e),r=e.children[0];n(r,e,t);const s=C(e.children[2],t,!1);return t.nodeUtils.markOffset(r,i),Z(r,s,t),{type:c.TypeString.BOOLEAN_TYPE_STRING,callStack:t.callStack}}(e,o);case 1037:return function(e,t){const n=C(e.children[0],t,!1),i=C(e.children[2],t,!1);return k.merge(n,i)}(e,o);case 1035:return function(e,t){return C(e.children[1],t,!1)}(e,o);case 1040:return function(e,t){let n,i;5===e.children.length?(C(e.children[0],t,!1),n=C(e.children[2],t,!1),i=C(e.children[4],t,!1)):(n=C(e.children[0],t,!1),i=C(e.children[3],t,!1));return k.merge(n,i)}(e,o);case 1009:return function(e,t){const n=e.children[e.children.length-2];let i;i=1011===n.kind?function(e,t){const n=[];let i,r;for(let s=0,o=e.children.length;s<o;++s)1010===(r=e.children[s]).kind&&(i=V(e.children[s],t))&&n.push(i);const s=k.mergeMany(function(e,t){const n=Math.floor(e.length/t);if(n<2)return e;const i=[];for(let t=0;t<e.length;t+=n)i.push(e[t]);return i}(n,5));s.type||(s.type=c.TypeString.MIXED_TYPE_STRING);if(s.type.length>3)return{type:c.TypeString.ARRAY_TYPE_STRING,callStack:t.callStack};return{type:c.TypeString.arrayReference(s.type),callStack:s.callStack}}(n,t):{type:c.TypeString.ARRAY_TYPE_STRING,callStack:t.callStack};return i}(e,o);case 1156:return function(e,t){const n=C(e.children[0],t,!1);C(e.children[2],t,!1);const i=W(n.type,t,"ArrayAccess","offsetGet");if(i)return{type:i,callStack:n.callStack};return{type:c.TypeString.arrayDereference(n.type)||c.TypeString.MIXED_TYPE_STRING,callStack:n.callStack}}(e,o);case 1057:return function(e,t,n){return C(e.children[1],t,n)}(e,o,a);case 1060:return function(e,t){C(e.children[0],t,!1),C(e.children[2],t,!1);return{type:c.TypeString.BOOLEAN_TYPE_STRING,callStack:t.callStack}}(e,o);case 1062:return function(e,t){return C(e.children[1],t,!1)}(e,o);case 1104:return function(e,t){return C(e.children[0],t,!1),C(e.children[2],t,!1),{type:c.TypeString.BOOLEAN_TYPE_STRING,callStack:t.callStack}}(e,o);case 1126:case 1127:return function(e,t,n){const i=e.children[0],r=C(i,t,n),s={type:c.TypeString.INT_TYPE_STRING,callStack:t.callStack};Z(i,s,t);const o=t.nodeReferenceMap.get(i);o&&(o.modifiers|=33554432);n&&(134===e.children[1].kind?s.value=A(r.value):s.value=U(r.value));return s}(e,o,a);case 1128:case 1129:return function(e,t,n){const i=e.children[1],r=C(i,t,n),s={type:c.TypeString.INT_TYPE_STRING,callStack:t.callStack};Z(i,s,t);const o=t.nodeReferenceMap.get(i);o&&(o.modifiers|=33554432);n&&(134===e.children[0].kind?s.value=A(r.value):s.value=U(r.value));return s}(e,o,a);case 1138:return function(e,t){C(e.children[0],t,!1),C(e.children[2],t,!1);let n=c.TypeString.BOOLEAN_TYPE_STRING;141===e.children[1].kind&&(n=c.TypeString.INT_TYPE_STRING);return{type:n,callStack:t.callStack}}(e,o);case 1149:return function(e,t){return C(e.children[1],t,!1),{type:c.TypeString.STRING_TYPE_STRING,callStack:t.callStack}}(e,o);case 1102:return function(e,t){return C(e.children[2],t,!1),{type:c.TypeString.BOOLEAN_TYPE_STRING,callStack:t.callStack}}(e,o);case 1080:return function(e,t){let n,i,o,a,d,l=!1;if(function(e){return 1079===e.kind||1139===e.kind||1136===e.kind}(e.children[0]))(o=_(e.children[0],t,64))&&(l=o.unresolvedName&&"define"===o.unresolvedName.toLowerCase(),!(i=t.definitionStore.find(o.name,r.Definition.isFunction)).length&&o.unresolvedName&&o.name!==o.unresolvedName&&(i=t.definitionStore.find(o.unresolvedName,r.Definition.isFunction)),n=J(i,t,T.inferFunctionTypeAndValue,c.TypeString.MIXED_TYPE_STRING),o.type=n.type);else{const s=C(e.children[0],t,!1);if(a=t.nodeReferenceMap.get(e.children[0]),c.TypeString.isEqual(s.type,c.TypeString.CLOSURE_TYPE_STRING)){const e=c.TypeString.atomicClassLikeTypes(s.type)||[];i=[];for(let n=0,s=e.length;n<s;++n)Array.prototype.push.apply(i,t.definitionStore.find(e[n],r.Definition.isFunction));n=J(i,t,T.inferFunctionTypeAndValue,c.TypeString.MIXED_TYPE_STRING),a&&(a.type=n.type)}}if(1008===e.children[2].kind){if(d=H(e.children[2],t,l),B(i||[],Array.from(d.keys()),t),o||a){const e=o||a;e.argumentTypes=Array.from(d.values()).map(e=>e.type)}let n=t.definition(e);if(n&&l&&d.size>1){if(!r.Definition.type(n)||void 0===n.value){const e=Array.from(d.values())[1];t.typeAndValueCache.set(n,{uriId:n.uriId,fqsenHash:n.fqsenHash,typeAndValue:{type:e.type,value:e.value,callStack:t.callStack}})}const i=s.Reference.create(8,n.name,n.uriId);i.modifiers|=2097152,t.addReference(i,e.children[2].children[0])}}return n||{type:c.TypeString.MIXED_TYPE_STRING,callStack:t.callStack}}(e,o);case 1131:return function(e,t){let n=c.TypeString.atomicClassLikeTypes(c.TypeString.resolveThisOrStatic(C(e.children[0],t,!1).type,[t.typeContextName()]));const i=q(e.children[2],t,16,n);if(!i)return{type:c.TypeString.MIXED_TYPE_STRING,callStack:t.callStack};const r=Y(n,3,t),s=J($(i.name,16,r),t,T.inferPropertyTypeAndValue,c.TypeString.MIXED_TYPE_STRING);return i.type=c.TypeString.resolveThisOrStatic(s.type,n),{type:i.type,callStack:s.callStack}}(e,o);case 1107:return function(e,t){const n=C(e.children[0],t,!1),i=c.TypeString.isEqual(n.type,c.TypeString.STATIC_OR_THIS_TYPE_STRING),r=c.TypeString.atomicClassLikeTypes(c.TypeString.resolveThisOrStatic(n.type,c.TypeString.fromString(t.typeContextName()))),s=q(e.children[2],t,32,r);if(!s)return{type:c.TypeString.MIXED_TYPE_STRING,callStack:t.callStack};let o;e.children.length>4&&1008===e.children[4].kind&&(o=H(e.children[4],t,!1),s.argumentTypes=Array.from(o.values()).map(e=>e.type));const a=Y(r,3,t),d=$(s.name,32,a);o&&B(d,Array.from(o.keys()),t);const l=J(d,t,T.inferMethodTypeAndValue,c.TypeString.MIXED_TYPE_STRING);return s.type=c.TypeString.resolveThisOrStatic(l.type,i?c.TypeString.merge(c.TypeString.atomicClassLikeTypes(n.type),c.TypeString.STATIC_OR_THIS_TYPE_STRING):r),{type:s.type,callStack:l.callStack}}(e,o);case 1024:return function(e,t){const n=c.TypeString.atomicClassLikeTypes(c.TypeString.resolveThisOrStatic(C(e.children[0],t,!1).type,[t.typeContextName()])),i=j(e.children[2],t);if(!i)return{type:c.TypeString.MIXED_TYPE_STRING,callStack:t.callStack};if(i.kind=1024,i.scope=n,"class"===i.name)return i.type=c.TypeString.STRING_TYPE_STRING,{type:i.type,callStack:t.callStack,value:c.TypeString.toString(n),flag:1};const r=Y(n,3,t),s=J($(i.name,1024,r),t,T.inferClassConstantTypeAndValue,c.TypeString.MIXED_TYPE_STRING,!0);return i.type=s.type,{type:i.type,callStack:s.callStack}}(e,o);case 1147:return function(e,t){let n=c.TypeString.atomicClassLikeTypes(c.TypeString.resolveThisOrStatic(C(e.children[0],t,!1).type,[t.typeContextName()]));const i=j(e.children[2],t);if(!i)return{type:c.TypeString.MIXED_TYPE_STRING,callStack:t.callStack};i.kind=16,i.scope=n;const r=Y(n,3,t),s=J($(i.name,16,r),t,T.inferPropertyTypeAndValue,c.TypeString.MIXED_TYPE_STRING),o=c.TypeString.resolveThisOrStatic(s.type,n);return i.type=o,{type:o,callStack:s.callStack}}(e,o);case 1145:return function(e,t){const n=C(e.children[0],t,!1),i=c.TypeString.isEqual(n.type,c.TypeString.STATIC_OR_THIS_TYPE_STRING);let r=c.TypeString.atomicClassLikeTypes(c.TypeString.resolveThisOrStatic(n.type,[t.typeContextName()]));const s=j(e.children[2],t);if(!s)return{type:c.TypeString.MIXED_TYPE_STRING,callStack:t.callStack};let o;e.children.length>4&&1008===e.children[4].kind&&(o=H(e.children[4],t,!1),s.argumentTypes=Array.from(o.values()).map(e=>e.type));s.kind=32,s.scope=r;const a=Y(r,3,t),d=$(s.name,32,a);o&&B(d,Array.from(o.keys()),t);const l=J(d,t,T.inferMethodTypeAndValue,c.TypeString.MIXED_TYPE_STRING);return s.type=c.TypeString.resolveThisOrStatic(l.type,i?c.TypeString.merge(c.TypeString.atomicClassLikeTypes(n.type),c.TypeString.STATIC_OR_THIS_TYPE_STRING):r),{type:s.type,callStack:l.callStack}}(e,o);case 1004:return function(e,n){return n.enterScope(e),t(e.children,e,n),n.leaveScope(e),{type:c.TypeString.fromString(`Closure|${n.nodeDefinitionMap.get(e).name}`),callStack:n.callStack}}(e,o);case 1152:return b(e,o,0);case 1136:case 1079:case 1139:{const t=_(e,o);return t?(t.type=c.TypeString.fromString(t.name),{type:t.type,callStack:o.callStack}):{type:c.TypeString.MIXED_TYPE_STRING,callStack:o.callStack}}case 1041:return function(e,t){const n=_(e.children[0],t,8);if(!n)return{type:c.TypeString.MIXED_TYPE_STRING,callStack:t.callStack};const i=n.unresolvedName?n.unresolvedName.toLowerCase():"";if("true"===i||"false"===i)return n.type=c.TypeString.BOOLEAN_TYPE_STRING,{type:n.type,callStack:t.callStack};if("null"===i)return n.type=c.TypeString.NULL_TYPE_STRING,{type:n.type,callStack:t.callStack};let s=t.definitionStore.find(n.name,r.Definition.isConstant);!s.length&&n.unresolvedName&&n.name!==n.unresolvedName&&(s=t.definitionStore.find(n.unresolvedName,r.Definition.isConstant));const o=J(s,t,T.inferConstantTypeAndValue,c.TypeString.MIXED_TYPE_STRING);return n.type=o.type,o}(e,o);case 1123:return function(e,n){let i,r=e.children[1],o=c.TypeString.MIXED_TYPE_STRING;if(1034===r.kind){if((i=function(e,t){const n=e.children[0];if(1079===n.kind||1136===n.kind||1139===n.kind){const e=_(n,t,2048);return e?(e.type=c.TypeString.fromString(e.name),e):void 0}if(1140===n.kind){const e=s.Reference.create(1,"static",t.nodeUtils.uriId);return e.type=c.TypeString.STATIC_TYPE_STRING,e.unresolvedName="static",e.name=t.typeContextName(),t.addReference(e,n),e}{const e=C(n,t,!0);if((1&e.flag)>0&&e.value){const n=s.Reference.create(1,e.value,t.nodeUtils.uriId);return n.type=c.TypeString.fromString(n.name),n}return}}(r,n))&&(o=i.type),i&&e.children.length>3&&1008===e.children[3].kind){const t=H(e.children[3],n,!1);i.argumentTypes=Array.from(t.values()).map(e=>e.type);const r=c.TypeString.toArray(c.TypeString.atomicClassLikeTypes(c.TypeString.resolveThisOrStatic(o,c.TypeString.fromString(n.typeContextName())))).pop();if(r){const e=n.typeFactory.fromName(r,1);if(e){const i=e.findMember("__construct",2048);i&&B([i],Array.from(t.keys()),n)}}}}else 1002===r.kind&&(o=function(e,n){const i=n.nodeDefinitionMap.get(e).name;return n.enterScope(e),t(e.children,e,n),n.leaveScope(e),c.TypeString.fromString(i)}(r,n));if((r=e.children[e.children.length-2])&&1008===r.kind){const e=H(r,n,!1);i&&(i.argumentTypes=Array.from(e.values()).map(e=>e.type))}return{type:o,callStack:n.callStack}}(e,o);case 1092:case 1093:case 1141:case 1142:return function(e,t){const n=C(e.children[1],t,!0);if(n.value){const i=function(e){try{return new u.URL(e).toString()}catch(e){return""}}(n.value);i&&t.addReference(s.Reference.create(4096,i,t.nodeUtils.uriId),e)}return{type:c.TypeString.MIXED_TYPE_STRING,callStack:t.callStack}}(e,o);case 1051:for(let t=0,n=e.children.length;t<n;++t)C(e.children[t],o,!1);return{type:c.TypeString.STRING_TYPE_STRING,callStack:o.callStack};case 1140:{const t=s.Reference.create(1,o.typeContextName(),o.nodeUtils.uriId);return t.unresolvedName="static",t.type=c.TypeString.STATIC_TYPE_STRING,o.addReference(t,e),{type:t.type,callStack:o.callStack}}default:if(i.isToken(e))return function(e,t,n){const i={type:c.TypeString.MIXED_TYPE_STRING,callStack:t.callStack};switch(e.kind){case 78:i.type=c.TypeString.FLOAT_TYPE_STRING,n&&(i.value=O(t.nodeUtils.nodeText(e)));break;case 77:case 79:i.type=c.TypeString.STRING_TYPE_STRING,n&&(i.value=F(t.nodeUtils.nodeText(e)));break;case 69:if(i.type=c.TypeString.STRING_TYPE_STRING,n){const e=t.nodeUtils.uri,n=e.lastIndexOf("/");i.value=e.slice(0,n)}break;case 70:i.type=c.TypeString.STRING_TYPE_STRING,n&&(i.value=t.nodeUtils.uri);break;case 72:case 73:i.type=c.TypeString.STRING_TYPE_STRING,n&&(i.value=t.currentFunctionOrMethod());break;case 74:i.type=c.TypeString.STRING_TYPE_STRING,n&&(i.value=t.nameResolver.namespaceName);break;case 75:case 76:i.type=c.TypeString.STRING_TYPE_STRING,n&&(i.value=t.nameResolver.className);break;case 81:i.type=c.TypeString.INT_TYPE_STRING,n&&(i.value=O(t.nodeUtils.nodeText(e)));break;case 71:if(i.type=c.TypeString.INT_TYPE_STRING,n){const n=t.nodeUtils.nodeRange(e);n&&(i.value=n.start.line)}}return i}(e,o,a);if(i.isPhrase(e)){if(1===e.children.length)return C(e.children[0],o,a);for(let t=0,n=e.children.length;t<n;++t)C(e.children[t],o,a)}return{type:c.TypeString.MIXED_TYPE_STRING,callStack:o.callStack}}}function O(e){const t=typeof e;if("string"===t)e=L(e);else if("number"===t)return e;return Number(e)}function A(e){return O(e)+1}function U(e){return O(e)-1}function L(e){const t=e.slice(0,1),n=e.slice(-1);return"'"!==t&&'"'!==t||"'"!==n&&'"'!==n||(e=e.slice(1,-1)),e}function F(e){return e?L(e.toString()):""}function V(e,t){return e.children.length>1?(n(e.children[0],e,t),G(e.children[e.children.length-1],t)):G(e.children[0],t)}function G(e,t){return C(e.children[e.children.length-1],t,!1)}function K(e,t){const n=t.definition(e),i=s.Reference.create(8,n.name,n.uriId);i.modifiers|=2097152,i.unresolvedName=r.Definition.shortName(n.name),t.addReference(i,e.children[0]);const o=C(e.children[2],t,!0);r.Definition.type(n)&&void 0!==n.value||t.typeAndValueCache.set(n,{uriId:n.uriId,fqsenHash:n.fqsenHash,typeAndValue:o})}function H(e,t,n){const i=new Map;let r;const s=c.TypeString.fromString(t.typeContextName());let o;for(let a=0,d=e.children.length;a<d;++a)92!==(r=e.children[a]).kind&&(o=C(r,t,n),i.set(r,Object.assign({},o,{type:c.TypeString.resolveThisOrStatic(o.type,s)})));return i}function B(e,t,n){let i,s,o,d;for(let l=0,u=e.length;l<u;++l){s=(i=e[l])instanceof a.MethodDefinition?i.parameters:n.definitionStore.getDefinitionChildren(i).filter(r.Definition.isParameter);for(let e=0,i=Math.min(t.length,s.length);e<i;++e)if(o=s[e],d=t[e],(1024&o.modifiers)>0&&1152===d.kind){let e=n.nodeReferenceMap.get(d);e&&(e.modifiers|=33555456),Z(d,{type:r.Definition.type(o)||c.TypeString.MIXED_TYPE_STRING,callStack:new Set([o.uriId])},n)}}}function q(e,t,n,i){let r;const o=e.children[0];return 82===o.kind?(r=s.Reference.create(n,t.nodeUtils.nodeText(o),t.nodeUtils.uriId),16===n&&"$"!==r.name.slice(0,1)&&(r.name="$"+r.name),r.scope=i,t.addReference(r,e)):C(o,t,!1),r}function Y(e,t,n){const i=c.TypeString.toArray(e),r=[];let s,o;for(let e=0,a=i.length;e<a;++e)s=i[e],(o=n.typeFactory.fromName(s,t))&&r.push(o);return r}function $(e,t,n){const i=[];let r;for(let s=0,o=n.length;s<o;++s)(r=n[s].findMember(e,t))&&i.push(r);return i}function j(e,t){const n=e.children[0];if(83===n.kind||1090===n.kind){const i=s.Reference.create(0,t.nodeUtils.nodeText(n),t.nodeUtils.uriId);return t.addReference(i,e),i}C(n,t,!1)}function W(e,t,n,i){const s=c.TypeString.toArray(c.TypeString.atomicClassLikeTypes(e));let o,d;for(let e=0,l=s.length;e<l;++e)if(o=s[e],(d=a.TypeDefinition.fromName(o,t.definitionStore,3))&&d.isAssociated(n)){let e=d.findMember(i,32);if(e){let n=r.Definition.type(e);if(!n){n=J([e],t,T.inferMethodTypeAndValue,c.TypeString.MIXED_TYPE_STRING).type}return n}}}function X(e,t){102===e.children[0].kind&&1152===e.children[1].kind?b(e.children[1],t,1024):n(e.children[e.children.length-1],e,t)}function z(e,t){let n,i="",o=2097152;for(let a=0,d=e.children.length;a<d;++a)switch((n=e.children[a]).kind){case 102:o|=1024;break;case 83:{i=t.nodeUtils.nodeText(n);const e=s.Reference.create(128,i,t.nodeUtils.uriId);e.modifiers|=o,t.addReference(e,n)}break;case 1169:Q(n,t);break;case 1048:{let s=M(n,t),o=t.definition(e);!s||!s.type||o&&o.type&&o.type.declared||(c.TypeString.isEqual(s.type,c.TypeString.NULL_TYPE_STRING)&&(s=Object.assign({},s,{type:c.TypeString.MIXED_OR_NULL_TYPE_STRING})),o&&!r.Definition.type(o)&&(t.variableTable.setVariable({name:i,typeAndValue:s}),t.typeAndValueCache.set(o,{uriId:o.uriId,fqsenHash:o.fqsenHash,typeAndValue:s})))}}}function Q(e,t){let n,i;return 95===e.children[0].kind?(i=_(e.children[1],t),n=c.TypeString.NULL_TYPE_STRING):i=_(e.children[0],t),i&&(n=c.TypeString.merge(n,c.TypeString.fromString(i.name))),n}function Z(e,t,n){switch(e.kind){case 1152:{const i=n.nodeReferenceMap.get(e);i&&(t=function(e,t,n){const i=n.getVariable(e);return i&&i.isVarTag?i.typeAndValue:t}(i.name,t,n),i.type=t.type,i.modifiers|=1048576,n.setVariable(i.name,t));const r=n.nodeDefinitionMap.get(e);!r||r.scope||16777216&r.modifiers||n.typeAndValueCache.set(r,{uriId:r.uriId,fqsenHash:r.fqsenHash,typeAndValue:t})}break;case 1156:{const i=e.children[0];if(1152===i.kind&&n.nodeReferenceMap.has(i)&&n.nodeReferenceMap.get(i).type){n.nodeReferenceMap.get(i).modifiers|=1048576;break}Z(i,{type:c.TypeString.ARRAY_TYPE_STRING,callStack:t.callStack,flag:t.flag},n)}break;case 1131:case 1147:Z(e.children[2],t,n);break;case 1106:case 1146:{const i=n.nodeReferenceMap.get(e);if(i&&16===i.kind){i.type=t.type,i.modifiers|=1048576;const e=n.currentFunctionOrMethod(),s="$"===i.name.slice(0,1)?i.name.slice(1):i.name,o=n.typeContextName();if(o&&i.scope&&c.TypeString.isEqual(i.scope,c.TypeString.fromString(o))&&("__construct"===e||e==="set"+h.ucFirst(s))){const e=r.Definition.fqsenHash(i.name,o,16),s=n.definitionStore.table(n.nodeUtils.uri).get(e);s&&!r.Definition.type(s)&&n.typeAndValueCache.set(s,{uriId:s.uriId,fqsenHash:s.fqsenHash,typeAndValue:t})}}}break;case 1011:t={type:c.TypeString.arrayDereference(t.type),callStack:t.callStack,flag:t.flag};for(let i=0,r=e.children.length;i<r;++i)Z(e.children[i],t,n);break;case 1010:case 1013:case 1074:Z(e.children[e.children.length-1],t,n);break;case 1072:Z(e.children[0],t,n);break;case 1009:case 1103:Z(e.children[e.children.length-2],t,n)}}function J(e,t,n,i,s){let o;if(0===e.length||e.length>1)return{type:i,callStack:t.callStack};const a=e[0];if(65792&a.modifiers||r.Definition.type(a)&&!(s&&void 0===a.value&&(1032&a.kind)>0)){const e=r.Definition.type(a);o=e?{type:e,value:a.value,callStack:t.callStack}:void 0}else{let e=t.typeAndValueCache.get(a);if(!e&&t.callStack.size<m){1===t.loadFileWithTransformSyncDelegate(d.DocumentStore.uri(a.uriId),2,p.DocumentFlagFactory.fromDefinition(a))&&(e=n(a,t.parseTreeStore,t.definitionStore,t.circularReferenceGuard,t.typeAndValueCache,t.callStack,t.typeFactory,t.loadFileWithTransformSyncDelegate,t.fileDepth+1))}e&&e.typeAndValue&&(o=e.typeAndValue)}return o||(o={type:i,callStack:t.callStack}),o.type||(o.type=i),o}e.transform=function(e){const t=new v(e);let i,r;if(e.parseTreeTraverser?(i=e.parseTreeTraverser.node,r=e.parseTreeTraverser.clone().parent()):i=e.parseTree.root,1148===i.kind){if(t.circularReferenceGuard.has(i))return{nodeReferenceMap:t.nodeReferenceMap,nodeDocBlockReferenceMap:t.nodePhpDocReferenceMap,typeAndValueCache:t.typeAndValueCache};t.circularReferenceGuard.add(i)}return n(i,r,t),{nodeReferenceMap:t.nodeReferenceMap,nodeDocBlockReferenceMap:t.nodePhpDocReferenceMap,typeAndValueCache:t.typeAndValueCache}},e.transformExpression=function(e,t){const n=new v(e),i=C(e.parseTreeTraverser?e.parseTreeTraverser.node:e.parseTree.root,n,t);return{nodeReferenceMap:n.nodeReferenceMap,nodeDocBlockReferenceMap:n.nodePhpDocReferenceMap,typeAndValueCache:n.typeAndValueCache,expressionResult:i}},e.transformConstElement=function(e){const t=new v(e);return K(e.parseTreeTraverser?e.parseTreeTraverser.node:e.parseTree.root,t),{nodeReferenceMap:t.nodeReferenceMap,nodeDocBlockReferenceMap:t.nodePhpDocReferenceMap,typeAndValueCache:t.typeAndValueCache}},e.transformParameterDeclaration=function(e){const t=new v(e);return z(e.parseTreeTraverser?e.parseTreeTraverser.node:e.parseTree.root,t),{nodeReferenceMap:t.nodeReferenceMap,nodeDocBlockReferenceMap:t.nodePhpDocReferenceMap,typeAndValueCache:t.typeAndValueCache}}}(S=t.ReferenceTransformer||(t.ReferenceTransformer={})),function(e){function t(e,t,n,i,r,s,o,a,c,u){if(u>m)return;const h=d.DocumentStore.uri(e.uriId),f=(n.table(h),t.find(h));if((o=new Set(o)).add(e.uriId),!f||!f.nodeDefinitionMap)return;const p=f.getTraverser(),k=l.PackedRange.toLspRange(e.range).start,S=f.getNodeUtils().positionToOffset(k);return p.seek(S)&&p.ancestor(s)&&!i.has(p.node)?(i.add(p.node),g.create(f,p.getNameResolver(),n,t,o,c,i,p,r,a,u)):void 0}e.inferConstantTypeAndValue=function(e,n,i,r,s,o,a,d,l){const u=new Set,h=t(e,n,i,r,s,e=>1043===e.kind||1080===e.kind,u,a,d,l);if(h){1043===h.parseTreeTraverser.node.kind?S.transformConstElement(h):S.transformExpression(h,!1);for(let e of u.values())o.add(e)}return s.get(e)||{uriId:e.uriId,fqsenHash:e.fqsenHash,typeAndValue:{type:c.TypeString.MIXED_TYPE_STRING,callStack:u}}},e.inferFunctionTypeAndValue=function(e,n,i,r,s,o,a,d,l){const u=(512&e.modifiers)>0?1004:1081,h=new Set,f=t(e,n,i,r,s,e=>e.kind===u,h,a,d,l);if(f){S.transform(f);for(let e of h.values())o.add(e)}return s.get(e)||{uriId:e.uriId,fqsenHash:e.fqsenHash,typeAndValue:{type:c.TypeString.MIXED_TYPE_STRING,callStack:h}}},e.inferMethodTypeAndValue=function(e,n,i,r,s,o,a,d,l){const u=new Set,h=t(e,n,i,r,s,e=>1108===e.kind,u,a,d,l);if(h){S.transform(h);for(let e of u.values())o.add(e)}return s.get(e)||{uriId:e.uriId,fqsenHash:e.fqsenHash,typeAndValue:{type:c.TypeString.MIXED_TYPE_STRING,callStack:o}}},e.inferClassConstantTypeAndValue=function(e,n,i,r,s,o,a,d,l){const u=new Set,h=t(e,n,i,r,s,e=>1026===e.kind,u,a,d,l);if(h){S.transformConstElement(h);for(let e of u.values())o.add(e)}return s.get(e)||{uriId:e.uriId,fqsenHash:e.fqsenHash,typeAndValue:{type:c.TypeString.MIXED_TYPE_STRING,callStack:u}}},e.inferGlobalVariableTypeAndValue=function(e,n,i,r,s,o,a,d,l){const u=new Set,h=t(e,n,i,r,s,e=>1151===e.kind,u,a,d,l);if(h){S.transformExpression(h,!1);for(let e of u.values())o.add(e)}return s.get(e)||{uriId:e.uriId,fqsenHash:e.fqsenHash,typeAndValue:{type:c.TypeString.MIXED_TYPE_STRING,callStack:u}}},e.inferPropertyTypeAndValue=function(e,n,i,s,o,a,l,u,f){const p=d.DocumentStore.uri(e.uriId),m=i.table(p),g=m?m.definitionScope(e):void 0,k=new Set;if(!g)return{uriId:e.uriId,fqsenHash:e.fqsenHash,typeAndValue:{type:c.TypeString.MIXED_TYPE_STRING,callStack:k}};const T=r.Definition.fqsenHash("__construct",g.name,2048);let y=m.get(T);if(y||(y=m.get(r.Definition.fqsenHash("set"+h.ucFirst(e.name.slice(1)),g.name,32))),!y)return{uriId:e.uriId,fqsenHash:e.fqsenHash,typeAndValue:{type:c.TypeString.MIXED_TYPE_STRING,callStack:k}};const v=t(y,n,i,s,o,e=>1108===e.kind,k,l,u,f);if(v){S.transform(v);for(let e of k.values())a.add(e)}return o.get(e)||{uriId:e.uriId,fqsenHash:e.fqsenHash,typeAndValue:{type:c.TypeString.MIXED_TYPE_STRING,callStack:k}}},e.inferOptionalParameterTypeAndValue=function(e,n,i,r,s,o,a,d,l){const u=new Set;if(void 0===e.value)return{uriId:e.uriId,fqsenHash:e.fqsenHash,typeAndValue:{type:c.TypeString.MIXED_TYPE_STRING,callStack:o}};const h=t(e,n,i,r,s,e=>1124===e.kind,u,a,d,l);if(h){S.transformParameterDeclaration(h);for(let e of u.values())o.add(e)}return s.get(e)||{uriId:e.uriId,fqsenHash:e.fqsenHash,typeAndValue:{type:c.TypeString.MIXED_TYPE_STRING,callStack:u}}},e.inferScriptTypeAndValue=function(e,n,i,r,s,o,a,d,l){const u=new Set,h=t(e,n,i,r,s,e=>1148===e.kind,u,a,d,l);if(h){S.transform(h);for(let e of u.values())o.add(e)}return s.get(e)||{uriId:e.uriId,fqsenHash:e.fqsenHash,typeAndValue:{type:c.TypeString.MIXED_TYPE_STRING,callStack:u}}}}(T=t.TypeAndValueInferrence||(t.TypeAndValueInferrence={}));class _{constructor(){this._typeVariableSetStack=[y.create(1)]}setVariable(e){if(e&&e.name&&e.typeAndValue&&e.typeAndValue.type){if(!e.isVarTag){const t=this._typeVariableSetStack[this._typeVariableSetStack.length-1].variables[e.name];if(t&&t.isVarTag)return}this._typeVariableSetStack[this._typeVariableSetStack.length-1].variables.set(e.name,e)}}setVariables(e){if(e)for(let t=0;t<e.length;++t)this.setVariable(e[t])}pushScope(e){let t=y.create(1);if(e){let n,i;for(let r=0;r<e.length;++r)i=e[r],(n=this.getVariable(i))&&i&&t.variables.set(i,n)}this._typeVariableSetStack.push(t)}popScope(){this._typeVariableSetStack.pop()}pushBranch(){let e=y.create(3);this._typeVariableSetStack[this._typeVariableSetStack.length-1].branches.push(e),this._typeVariableSetStack.push(e)}popBranch(){this._typeVariableSetStack.pop()}pruneBranches(){let e=this._typeVariableSetStack[this._typeVariableSetStack.length-1],t=e.branches;e.branches=[];let n=e.variables;for(let e=0,i=t.length;e<i;++e)n=this._mergeSets(n,t[e].variables);e.variables=n}getVariable(e){return this._getVariable(this._typeVariableSetStack,e)}carry(e){if(!e)return;let t=-1;for(let e=this._typeVariableSetStack.length-1;e>=0;--e)if(1===this._typeVariableSetStack[e].kind){t=e;break}if(t<0)return;const n=this._getVariable(this._typeVariableSetStack.slice(0,t),e);n&&this.setVariable(n)}_getVariable(e,t){let n,i;for(let r=e.length-1;r>=0;--r){if(i=(n=e[r]).variables.get(t))return i;if(1===n.kind)break}}_mergeSets(e,t){let n;const i=new Map(e);for(let e of t.values())(n=i.get(e.name))?n.isVarTag&&e.isVarTag||!n.isVarTag&&!e.isVarTag?i.set(n.name,{name:n.name,typeAndValue:k.merge(n.typeAndValue,e.typeAndValue),isVarTag:n.isVarTag}):e.isVarTag&&i.set(e.name,e):i.set(e.name,e);return i}}!function(e){e.create=function(e){return{kind:e,variables:new Map,branches:[]}}}(y||(y={}))},function(e,t){e.exports=require("url")},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),r=n(3),s=n(7),o=n(5),a=n(6),c=n(2),d=n(8),l=n(13);var u;!function(e){function t(e,t,n,i){return{range:e,message:t,severity:n,code:i,source:"intelephense"}}e.incorrectArgumentCount=function(e,n,i){return t(i,`Expected ${e} arguments. Found ${n}.`,r.DiagnosticSeverity.Error,10005)},e.nonStaticMethodCalledStatically=function(e,n){return t(n,`Non-static method '${e}' called statically.`,r.DiagnosticSeverity.Warning,10011)},e.duplicateIdentifier=function(e,n){return t(n,`Duplicate symbol declaration '${e}'.`,r.DiagnosticSeverity.Error,10002)},e.unusedSymbol=function(e,n){return t(n,`Symbol '${e}' is declared but not used.`,r.DiagnosticSeverity.Hint,10010)},e.undefinedVariable=function(e,n){return t(n,`Undefined variable '${e}'.`,r.DiagnosticSeverity.Warning,10001)},e.incorrectType=function(e,n,i){return t(i,`Expected type '${c.TypeString.toString(e)}'. Found '${c.TypeString.toString(n||c.TypeString.NULL_TYPE_STRING)}'.`,r.DiagnosticSeverity.Error,10006)},e.create=t,e.toDiagnostic=function(e,t){return r.Diagnostic.create(t,e.message,e.level,e.code,"intelephense")}}(u=t.DiagnosticFactory||(t.DiagnosticFactory={}));t.MasterDiagnosticsVisitor=class{constructor(e,t,n,i){this.nodeUtils=e,this.nodeMaps=t,this.definitionStore=n,this.typeAndValueCache=i,this.errorFlag=!1,this.offsetVisitor=new o.OffsetVisitor,this._diagnostics=[],this.visitors=[],this.typeFactory=new a.TypeFactory(this.definitionStore),t.nodeDefinitionMap&&this.visitors.push(new f(this.nodeMaps.nodeDefinitionMap,this.nodeUtils)),t.nodeReferenceMap&&this.visitors.push(new h(this.nodeMaps.nodeDefinitionMap,this.nodeMaps.nodeReferenceMap,this.nodeUtils,this.definitionStore,this.nodeMaps.nodePhpDocMap),new p(this.nodeMaps.nodeReferenceMap,this.nodeUtils,this.nodeMaps.nodePhpDocMap),new m(this.nodeMaps.nodeDefinitionMap,this.nodeMaps.nodeReferenceMap,this.nodeUtils,this.definitionStore),new g(this.nodeMaps.nodeDefinitionMap,this.nodeMaps.nodeReferenceMap,this.nodeUtils,this.typeFactory,this.definitionStore,this.typeAndValueCache))}get diagnostics(){const e=[];Array.prototype.push.apply(e,this._diagnostics);for(let t of this.visitors)Array.prototype.push.apply(e,t.diagnostics);return e}beforeTraverse(e,t){this.offsetVisitor.beforeTraverse(e,t)}preorder(e,t){this.offsetVisitor.preorder(e,t);const n=this.nodeMaps.nodeProblemMap.get(e);switch(e.kind){case 1061:if(!this.errorFlag&&n){this.errorFlag=!0;const t=n.unexpected,i=t.length;let s=this.offsetVisitor.offset;if(e.children.length<1){const e=o.NodeUtils.previousNonTriviaToken(t);this.nodeUtils.markOffset(e,s-e.length),s=this.nodeUtils.nodeOffset(t)}this._diagnostics.push(u.toDiagnostic(n,r.Range.create(this.nodeUtils.offsetToPosition(s),this.nodeUtils.offsetToPosition(s+i))))}return!1;default:for(let n=0,i=this.visitors.length;n<i;++n)this.visitors[n].preorder&&this.visitors[n].preorder(e,t);s.isToken(e)&&(this.errorFlag=!1)}return!0}postorder(e,t){this.offsetVisitor.postorder(e,t);for(let n=0,i=this.visitors.length;n<i;++n)this.visitors[n].postorder&&this.visitors[n].postorder(e,t)}};class h{constructor(e,t,n,i,r){this.nodeDefinitionMap=e,this.nodeReferenceMap=t,this.nodeUtils=n,this.definitionStore=i,this.nodeDocBlockMap=r,this.definitionStack=[],this.nameResolver=new l.NameResolver,this.useDeclarationMap=new Map,this.privateMemberMap=new Map,this.varMap=new Map,this.privateMemberFoundSet=new Set}get diagnostics(){const e=[];let t,n,i;const r=e=>1119===e.kind;for(let s of this.useDeclarationMap.values())t=this.nodeDefinitionMap.get(s[s.length-1]),(i=new o.ParseTreeTraverser(s,this.nodeUtils.clone())).parent()&&1===i.node.children.length?(i.ancestor(r),n=i.range):n=this.nodeUtils.nodeRangeFromSpine(s),e.push(u.unusedSymbol(t.name,n));const s=e=>1132===e.kind||1025===e.kind;for(let r of this.privateMemberMap.values())t=this.nodeDefinitionMap.get(r[r.length-1]),this.privateMemberFoundSet.has(t.fqsenHash)||(i=new o.ParseTreeTraverser(r,this.nodeUtils.clone()),32===t.kind?n=i.range:i.parent()&&1===i.node.children.length?(i.ancestor(s),n=i.range):n=this.nodeUtils.nodeRangeFromSpine(r),e.push(u.unusedSymbol(t.name,n)));for(let{spine:n,isReference:i}of this.varMap.values())t=this.nodeDefinitionMap.get(n[n.length-1]),e.push(u.unusedSymbol(t.name,this.nodeUtils.nodeRangeFromSpine(n)));return e}preorder(e,t){let n,r;switch(e.kind){case 1120:case 1117:if(n=this.nodeDefinitionMap.get(e)){const i=l.UseRule.fromDefinition(n);this.nameResolver.rules.push(i),this.useDeclarationMap.set(i.name.toLowerCase(),[...t,e])}break;case 1026:case 1133:case 1108:if(n=this.nodeDefinitionMap.get(e)){1108===e.kind&&this.definitionStack.push(n);const i=this.getType();i&&1===i.kind&&(4&n.modifiers)>0&&this.privateMemberMap.set(n.fqsenHash,[...t,e])}break;case 1124:if(n=this.nodeDefinitionMap.get(e)){const i=this.getType(),r=this.getScope();i&&2===i.kind||!r||16&r.modifiers||this.varMap.set(n.fqsenHash,{spine:[...t,e],isReference:(1024&n.modifiers)>0})}break;case 83:(n=this.nodeDefinitionMap.get(e))&&this.varMap.set(n.fqsenHash,{spine:[...t,e]});break;case 1007:if(n=this.nodeDefinitionMap.get(e)){this.varMap.set(n.fqsenHash,{spine:[...t,e],isReference:(1024&n.modifiers)>0});const r=this.getScopeFqsenHash(1),s=i.Definition.fqsenHashFromScopeHash(n.name,r,n.kind);this.varMap.delete(s)}break;case 1152:if(r=this.nodeReferenceMap.get(e),(n=this.nodeDefinitionMap.get(e))&&n.scope&&!(4194304&n.modifiers)&&r&&(1048576&r.modifiers)>0&&this.varMap.set(n.fqsenHash,{spine:[...t,e],isReference:(1024&n.modifiers)>0}),r&&!n){const e=this.getScopeFqsenHash(),t=i.Definition.fqsenHashFromScopeHash(r.name,e,r.kind),n=this.varMap.get(t);n&&n.isReference||!(1048576&r.modifiers)||(33554432&r.modifiers)>0?this.varMap.delete(t):n&&(1024&r.modifiers)>0&&(n.isReference=!0)}break;case 1148:case 1028:case 1161:case 1098:case 1002:case 1004:case 1081:(n=this.nodeDefinitionMap.get(e))&&this.definitionStack.push(n);break;case 1080:if(this.isCompactCall(e)){const e=this.getScope();if(e)for(let t of this.definitionStore.getDefinitionChildren(e))256!==t.kind&&128!==t.kind||this.varMap.delete(t.fqsenHash)}break;case 1116:if((r=this.nodeReferenceMap.get(e))&&r.unresolvedName){const e=t[t.length-1],n=this.nameResolver.match(r.unresolvedName,r.kind);n&&1117!==e.kind&&1120!==e.kind&&this.useDeclarationMap.delete(n.name.toLowerCase())}break;case 1106:case 1146:{r=this.nodeReferenceMap.get(e);const t=this.getType();r&&t&&c.TypeString.isEqual(r.scope,c.TypeString.fromString(t.name))&&this.privateMemberFoundSet.add(i.Definition.fqsenHashFromScopeHash(r.name,t.fqsenHash,r.kind))}break;case 159:if(this.nodeDocBlockMap.has(e)){let t=[];for(let n of this.nodeDocBlockMap.get(e).tags){t=[],n.isStandard?(Array.prototype.push.apply(t,c.TypeString.toArray(c.TypeString.fromString(n.typeName.text))),1024===n.kind&&n.parameters.forEach(e=>{t.push(e.typeName.text)})):t.push(n.tagName.text.slice(1));for(let e of t)if(e&&"\\"!==e[0]&&"namespace"!==e.slice(0,9).toLowerCase()){const t=this.nameResolver.match(e,1);t&&this.useDeclarationMap.delete(t.name.toLowerCase())}}}}return!0}postorder(e,t){let n;switch(e.kind){case 1148:case 1028:case 1161:case 1098:case 1002:case 1004:case 1108:case 1081:(n=this.nodeDefinitionMap.get(e))&&this.definitionStack.pop()}}isCompactCall(e){if(1080!==e.kind)return!1;if(e=e.children[0],!o.NodeUtils.isNamePhrase(e))return!1;e=e.children[e.children.length-1];const t=this.nodeReferenceMap.get(e);return t&&(t.unresolvedName&&"compact"===t.unresolvedName.toLowerCase()||t.name&&"compact"===t.name.toLowerCase())}getScopeFqsenHash(e){const t=this.getScope(e);return t?t.fqsenHash:0}getScope(e){e||(e=0);const t=this.definitionStack.length>e?this.definitionStack[this.definitionStack.length-(e+1)]:void 0;if(t)switch(t.kind){case 1:case 2:case 4:case 64:case 32:case 2048:return t;default:return}}getType(){let e,t=this.definitionStack.length;for(;--t>-1&&!e;)(7&this.definitionStack[t].kind)>0&&(e=this.definitionStack[t]);return e}}class f{constructor(e,t){this.nodeDefinitionMap=e,this.nodeUtils=t,this.map=new Map}get diagnostics(){const e=[];for(let t of this.map.values())t.length>1&&Array.prototype.push.apply(e,this.toDiagnostics(t));return e}isDefinitionNode(e){switch(e.kind){case 1028:case 1098:case 1161:case 1081:case 1043:case 1026:case 1133:case 1108:case 1124:case 1120:case 1117:case 1080:return!0;default:return!1}}preorder(e,t){if(!this.isDefinitionNode(e))return!0;const n=this.nodeDefinitionMap.get(e);if(!n)return!0;if(this.addToMap(n.fqsenHash,[...t,e]),(7&n.kind)>0&&!(4096&n.modifiers)&&n.name.indexOf("\\")>-1){const r=i.Definition.shortName(n.name),s=i.Definition.fqsenHashFromScopeHash(r,0,n.kind);this.addToMap(s,[...t,e])}return!0}addToMap(e,t){this.map.has(e)?this.map.get(e).push(t):this.map.set(e,[t])}toDiagnostics(e){const t=[];let n=e[0],r=this.nodeDefinitionMap.get(n[n.length-1]);!r&&n.length>2&&(r=this.nodeDefinitionMap.get(n[n.length-3]));const s=i.Definition.shortName(r.name);let o;for(n of e)(o=this.getRange(n))&&t.push(u.duplicateIdentifier(s,o));return t}getRange(e){const t=new o.ParseTreeTraverser(e,this.nodeUtils);switch(t.node.kind){case 1028:case 1098:case 1161:case 1081:return t.nthChild(0),t.child(e=>82===e.kind),t.range;case 1108:return t.nthChild(0),t.child(e=>1090===e.kind),t.range;case 1133:case 1043:case 1026:return t.nthChild(0),t.range;case 1124:return t.child(e=>83===e.kind),t.range;case 1080:return t.nthChild(2),t.nthChild(0),t.range;case 1117:case 1120:return t.lastChild(),1114===t.node.kind&&t.lastChild(),t.range;default:return t.range}}}class p{constructor(e,t,n){this.nodeReferenceMap=e,this.nodeUtils=t,this.nodePhpDocMap=n,this.scopeStack=[],this._diagnostics=[]}get diagnostics(){return this._diagnostics}preorder(e,t){let n,i;switch(e.kind){case 1081:case 1108:case 1004:this.scopeStack.push(new Set);break;case 83:if(t.length&&1007===t[t.length-1].kind){const r=this.scopeStack.length>1?this.scopeStack[this.scopeStack.length-2]:void 0;n=this.nodeReferenceMap.get(e),i=this.getScopeSetTop(),n&&r&&!r.has(n.name)&&!r.has(p.DISABLE_CHECK)&&this._diagnostics.push(u.undefinedVariable(n.name,this.nodeUtils.nodeRangeFromSpine([...t,e])))}case 1124:n=this.nodeReferenceMap.get(e),i=this.getScopeSetTop(),n&&i&&i.add(n.name);break;case 1152:n=this.nodeReferenceMap.get(e),i=this.getScopeSetTop(),n&&(1048576&n.modifiers)>0&&i?i&&i.add(n.name):!n||d.PHP.isPredefinedVariable(n.name)||!i||i.has(n.name)||this.hasIntrinsicEmptyParentOrIntrinsicIssetUnsetGrandParent(t)||i.has(p.DISABLE_CHECK)||this._diagnostics.push(u.undefinedVariable(n.name,this.nodeUtils.nodeRangeFromSpine([...t,e])));break;case 159:{const t=this.nodePhpDocMap.get(e);if(i=this.getScopeSetTop(),t&&i)for(let e of t.tags)1008===e.kind&&e.elementName.text&&i.add(e.elementName.text)}break;case 1141:case 1142:case 1092:case 1093:(i=this.getScopeSetTop())&&i.add(p.DISABLE_CHECK);break;case 1080:(i=this.getScopeSetTop())&&this.isExtractCall(e)&&i.add(p.DISABLE_CHECK)}return!0}postorder(e,t){switch(e.kind){case 1081:case 1108:case 1004:this.scopeStack.pop()}}isExtractCall(e){if(1080!==e.kind)return!1;if(e=e.children[0],!o.NodeUtils.isNamePhrase(e))return!1;e=e.children[e.children.length-1];const t=this.nodeReferenceMap.get(e);return t&&(t.unresolvedName&&"extract"===t.unresolvedName.toLowerCase()||t.name&&"extract"===t.name.toLowerCase())}hasIntrinsicEmptyParentOrIntrinsicIssetUnsetGrandParent(e){const t=e[e.length-1];if(t&&1056===t.kind)return!0;const n=e[e.length-2];return!(!n||1102!==n.kind&&1171!==n.kind)}getScopeSetTop(){return this.scopeStack.length?this.scopeStack[this.scopeStack.length-1]:void 0}}p.DISABLE_CHECK="#DISABLE#";class m{constructor(e,t,n,i){this.nodeDefinitionMap=e,this.nodeReferenceMap=t,this.nodeUtils=n,this.definitionStore=i,this._diagnostics=[],this.classNameStack=[]}get diagnostics(){return this._diagnostics}preorder(e,t){switch(e.kind){case 1028:case 1161:case 1098:{const t=this.nodeDefinitionMap.get(e);this.classNameStack.push(t?t.name:"")}break;case 1145:this.checkMethodCall(e,t,e.children.find(this.isScopedMemberName));break;case 1107:this.checkMethodCall(e,t,e.children.find(this.isMemberName));break;case 1123:this.checkMethodCall(e,t,this.findObjectCreationExprNameNode(e));break;case 1080:this.checkFunctionCall(e,t)}return!0}postorder(e,t){switch(e.kind){case 1028:case 1161:case 1098:this.classNameStack.pop()}}isScopedMemberName(e){return 1146===e.kind}isMemberName(e){return 1106===e.kind}findObjectCreationExprNameNode(e){let t=e.children[1];if(1034===t.kind)return 1140===(t=t.children[0]).kind?t:o.NodeUtils.isNamePhrase(t)&&1116===(t=t.children[t.children.length-1]).kind?t:void 0}checkFunctionCall(e,t){let n,i,r=e.children[0];if(o.NodeUtils.isNamePhrase(r))r=r.children[r.children.length-1],n=this.nodeReferenceMap.get(r),i=this.definitionStore.findByReference(n);else{if(1152!==r.kind)return;if(n=this.nodeReferenceMap.get(r),!c.TypeString.isEqual(n.type,c.TypeString.CLOSURE_TYPE_STRING))return;i=this.definitionStore.find(c.TypeString.toArray(c.TypeString.atomicClassLikeTypes(n.type)).pop())}if(i.length<1)return;const s=n.argumentTypes;let a=e.children.find(e=>1008===e.kind);if(a&&a.children.find(e=>1174===e.kind))return;const d=[...t,e];a&&d.push(a),this.diagnoseArgumentCount(i,(s||[]).length,d)}checkMethodCall(e,t,n){if(!n)return;let i=this.nodeReferenceMap.get(n);if(!i)return;i=Object.assign({},i,{scope:c.TypeString.resolveThisOrStatic(i.scope,this.thisTypeString())});const r=this.definitionStore.findByReference(i);if(r.length<1)return;const s=i.argumentTypes,o=e.children.find(e=>1008===e.kind);if(o&&o.children.find(e=>1174===e.kind))return;const a=[...t,e,o||n];this.diagnoseArgumentCount(r,(s||[]).length,a)}thisTypeString(){return this.classNameStack.length>0?c.TypeString.fromString(this.classNameStack[this.classNameStack.length]):void 0}diagnoseArgumentCount(e,t,n){let r,s,o,a=[];if(e.length){for(let n=0;n<e.length;++n){if((256&(r=e[n]).modifiers)>0)return;if(s=this.definitionStore.table(r.uriId)){if(t>=(o=s.definitionChildren(r).filter(i.Definition.isRequiredParameter).length))return;a.push(o)}}a.length&&this._diagnostics.push(u.incorrectArgumentCount(Math.min(...a),t,this.nodeUtils.nodeRangeFromSpine(n)))}}}class g{constructor(e,t,n,i,r,s){this.nodeDefinitionMap=e,this.nodeReferenceMap=t,this.nodeUtils=n,this.typeFactory=i,this.definitionStore=r,this.typeAndValueCache=s,this._diagnostics=[],this.classNameStack=[]}get diagnostics(){return this._diagnostics}preorder(e,t){switch(e.kind){case 1028:case 1161:case 1098:{const t=this.nodeDefinitionMap.get(e);this.classNameStack.push(t?t.name:"")}break;case 1145:this.checkMethodCall(e,t,e.children.find(this.isScopedMemberName));break;case 1107:this.checkMethodCall(e,t,e.children.find(this.isMemberName));break;case 1123:this.checkMethodCall(e,t,this.findObjectCreationExprNameNode(e));break;case 1080:this.checkFunctionCall(e,t);break;case 1108:case 1081:case 1004:this.checkReturnType(e,t)}return!0}postorder(e,t){switch(e.kind){case 1028:case 1161:case 1098:this.classNameStack.pop()}}checkReturnType(e,t){const n=this.nodeDefinitionMap.get(e);if(!n||!n.type||!n.type.declared||!this.typeAndValueCache.has(n)||(16&n.modifiers)>0||i.Definition.isInterface(this.definitionStore.getDefinitionScope(n)))return;const r=c.TypeString.resolveThisOrStatic(this.typeAndValueCache.get(n).typeAndValue.type,c.TypeString.fromString(this.classNameStack[this.classNameStack.length-1]));if(!this.typeCheck(n.type.declared,r)){const i=new o.ParseTreeTraverser([...t,e],this.nodeUtils.clone());if(!i.find(e=>1144===e.kind)||!i.nthChild(1))return;const s=i.range;this._diagnostics.push(u.incorrectType(n.type.declared,r,s))}}isScopedMemberName(e){return 1146===e.kind}isMemberName(e){return 1106===e.kind}findObjectCreationExprNameNode(e){let t=e.children[1];if(1034===t.kind)return 1140===(t=t.children[0]).kind?t:o.NodeUtils.isNamePhrase(t)&&1116===(t=t.children[t.children.length-1]).kind?t:void 0}checkFunctionCall(e,t){const n=e.children.find(e=>1008===e.kind);if(!n)return;let i,r,s=e.children[0];if(o.NodeUtils.isNamePhrase(s))s=s.children[s.children.length-1],i=this.nodeReferenceMap.get(s),r=this.definitionStore.findByReference(i);else{if(1152!==s.kind)return;if(i=this.nodeReferenceMap.get(s),!c.TypeString.isEqual(i.type,c.TypeString.CLOSURE_TYPE_STRING))return;r=this.definitionStore.find(c.TypeString.toArray(c.TypeString.atomicClassLikeTypes(i.type)).pop())}if(r.length<1)return;const a=i.argumentTypes,d=[...t,e,n||s];this.diagnoseArgumentTypes(r,a||[],n.children.filter(e=>92!==e.kind),d)}checkMethodCall(e,t,n){const i=e.children.find(e=>1008===e.kind);if(!n||!i)return;let r=this.nodeReferenceMap.get(n);if(!r)return;r=Object.assign({},r,{scope:c.TypeString.resolveThisOrStatic(r.scope,this.thisTypeString())});const s=this.definitionStore.findByReference(r);if(s.length<1)return;const o=r.argumentTypes,a=[...t,e,i||n];this.diagnoseArgumentTypes(s,o||[],i.children.filter(e=>92!==e.kind),a)}thisTypeString(){return this.classNameStack.length>0?c.TypeString.fromString(this.classNameStack[this.classNameStack.length]):void 0}diagnoseArgumentTypes(e,t,n,r){let s,o,d,l,h=t.map(e=>!1),f=t.map(e=>void 0),p=!1;for(let n=0;n<e.length;++n)for(let r=0,u=(p=(o=(s=e[n])instanceof a.MethodDefinition?s.parameters:this.definitionStore.table(s.uriId).definitionChildren(s).filter(i.Definition.isParameter)).length&&(2048&o[o.length-1].modifiers)>0)?t.length:Math.min(o.length,t.length);r<u;++r)l=(d=o[r]||o[o.length-1]).type&&d.type.declared?(2048&d.modifiers)>0?c.TypeString.arrayDereference(d.type.declared):d.type.declared:void 0,(1024&d.modifiers)>0?h[r]=!0:h[r]||!d.type||!d.type.declared||this.typeCheck(l,t[r])?h[r]=!0:f[r]=c.TypeString.merge(f[r],l);for(let e=0,i=h.length;e<i;++e)!h[e]&&f[e]&&this._diagnostics.push(u.incorrectType(f[e],t[e],this.nodeUtils.nodeRangeFromSpine([...r,n[e]])))}typeCheck(e,t){if(!e||!t)return!0;if(c.TypeString.isEqual(t,c.TypeString.MIXED_TYPE_STRING))return!0;const n=c.TypeString.isArray(t);if(c.TypeString.isEqual(e,c.TypeString.ARRAY_TYPE_STRING)&&n||c.TypeString.isEqual(t,c.TypeString.ARRAY_TYPE_STRING)&&c.TypeString.isArray(e))return!0;const i=c.TypeString.isEqual(e,c.TypeString.ITERABLE_TYPE_STRING);if(i&&n)return!0;if(c.TypeString.isEqual(e,t))return!0;if(c.TypeString.isEqual(t,c.TypeString.INT_TYPE_STRING)&&c.TypeString.isEqual(e,c.TypeString.FLOAT_TYPE_STRING))return!0;if(c.TypeString.isEqual(e,c.TypeString.CALLABLE_TYPE_STRING)&&(c.TypeString.isEqual(t,c.TypeString.CLOSURE_TYPE_STRING)||n||c.TypeString.isEqual(t,c.TypeString.STRING_TYPE_STRING)))return!0;const r=c.TypeString.toArray(c.TypeString.atomicClassLikeTypes(t));let s=c.TypeString.toArray(c.TypeString.atomicClassLikeTypes(e)).pop();const o=c.TypeString.isEqual(t,c.TypeString.STATIC_TYPE_STRING);if(c.TypeString.isEqual(e,c.TypeString.OBJECT_TYPE_STRING)&&(r.length||o)||c.TypeString.isEqual(t,c.TypeString.OBJECT_TYPE_STRING)&&s)return!0;if(i&&(s="Traversable"),!s)return!1;if(o&&s)return!0;let a;for(let e=0,t=r.length;e<t;++e)if((a=this.typeFactory.fromName(r[e]))&&a.isAssociated(s))return!0;return!1}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(3),r=n(0),s=n(1);t.DEFAULT_DOCUMENT_SYMBOL_PROVIDER_OPTIONS={hierarchicalDocumentSymbolSupport:!0};t.DocumentSymbolProvider=class{constructor(e){this.parseTreeStore=e.parseTreeStore,this._options=Object.assign({},t.DEFAULT_DOCUMENT_SYMBOL_PROVIDER_OPTIONS)}set options(e){this._options=Object.assign({},e||t.DEFAULT_DOCUMENT_SYMBOL_PROVIDER_OPTIONS)}provideDocumentSymbols(e){const t=this.parseTreeStore.find(e);if(!t)return null;const n=t.traverse(new a(t.nodeDefinitionMap,t.getNodeUtils(),t.nodeMagicDefinitionMap)).documentSymbols;if(this._options.hierarchicalDocumentSymbolSupport)return n;{const t=i.DocumentSymbol.create(void 0,void 0,i.SymbolKind.File,void 0,void 0,n);return new r.TreeTraverser([t]).traverse(new o(e)).symbolInformationArray}}};class o{constructor(e){this.uri=e,this.symbolInformationArray=[]}preorder(e,t){const n=t.length>0?t[t.length-1]:void 0;if(!n)return!0;const r=i.SymbolInformation.create(e.name,e.kind,e.range,this.uri,4096!==n.kind&&this.hasContainer(e)?n.name:void 0);return r.deprecated=e.deprecated,this.symbolInformationArray.push(r),!0}hasContainer(e){switch(e.kind){case i.SymbolKind.Module:case i.SymbolKind.Namespace:case i.SymbolKind.Interface:case i.SymbolKind.Class:case i.SymbolKind.Constant:case i.SymbolKind.Function:case i.SymbolKind.File:return!1;default:return!0}}}class a{constructor(e,t,n){this.nodeDefinitionMap=e,this.nodeUtils=t,this.nodeMagicDefinitionMap=n,this.documentSymbols=[],this.stack=[]}preorder(e,t){const n=t.length>0?t[t.length-1]:void 0;switch(e.kind){case 1028:case 1098:case 1161:if(this.nodeDefinitionMap.has(e)&&this.addDocumentSymbol(this.createDocumentSymbol(e)),this.nodeMagicDefinitionMap.has(e)){const t=this.createMagicDocumentSymbols(e);for(let e=0;e<t.length;++e)this.addDocumentSymbol(t[e],!0)}break;case 1115:case 1117:case 1120:case 1081:case 1043:case 1080:case 1026:case 1108:case 1133:case 1124:case 1152:case 1002:case 1004:case 1007:case 1154:this.nodeDefinitionMap.has(e)&&this.addDocumentSymbol(this.createDocumentSymbol(e));break;case 82:1030!==n.kind&&1163!==n.kind&&1100!==n.kind&&1083!==n.kind&&1043!==n.kind&&1114!==n.kind||this.setSelectionRange(this.nodeUtils.nodeRange(e));break;case 1090:1026!==n.kind&&1110!==n.kind||this.setSelectionRange(this.nodeUtils.nodeRange(e));break;case 1116:1115!==n.kind&&1117!==n.kind&&1120!==n.kind||this.setSelectionRange(this.nodeUtils.nodeRange(e));break;case 83:this.nodeDefinitionMap.has(e)?this.addDocumentSymbol(this.createDocumentSymbol(e)):1133!==n.kind&&1124!==n.kind&&1154!==n.kind||this.setSelectionRange(this.nodeUtils.nodeRange(e))}return!0}postorder(e,t){switch(e.kind){case 1115:case 1117:case 1120:case 1028:case 1098:case 1161:case 1081:case 1043:case 1080:case 1026:case 1108:case 1133:case 1124:case 1152:case 1007:case 83:case 1002:case 1004:case 1154:this.nodeDefinitionMap.has(e)&&this.stack.pop()}}setSelectionRange(e){if(this.stack.length<1)return;this.stack[this.stack.length-1].selectionRange=e}createMagicDocumentSymbols(e){const t=this.nodeMagicDefinitionMap.get(e)||[],n=new Map;let o,a,c,d,l=[];for(let e=0;e<t.length;++e)128!==(o=t[e]).kind?(c=r.PackedRange.toLspRange(o.range),a=i.DocumentSymbol.create(s.PhpSymbol.shortName(o),void 0,s.PhpSymbol.toLspSymbolKind(o),c,c),n.set(o.fqsenHash,a)):l.push(o);for(let e=0;e<l.length;++e)o=l[e],c=r.PackedRange.toLspRange(o.range),a=i.DocumentSymbol.create(s.PhpSymbol.shortName(o),void 0,s.PhpSymbol.toLspSymbolKind(o),c,c),(d=n.get(o.scope)).children||(d.children=[]),d.children.push(a);return Array.from(n.values())}createDocumentSymbol(e){const t=this.nodeDefinitionMap.get(e),n=this.nodeUtils.leadingDocumentComment(e);let r;n&&(r=n.range);const o=this.nodeUtils.nodeRange(e);r&&(o.start=r.start);const a=i.DocumentSymbol.create(s.PhpSymbol.shortName(t),void 0,s.PhpSymbol.toLspSymbolKind(t),o,o);return(262144&t.modifiers)>0&&(a.deprecated=!0),a}addDocumentSymbol(e,t){const n=this.stack.length>0?this.stack[this.stack.length-1]:void 0;n?(n.children||(n.children=[]),n.children.push(e)):this.documentSymbols.push(e),t||this.stack.push(e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(1),r=n(3),s=n(0),o=n(4),a=100;t.WorkspaceSymbolProvider=class{constructor(e){this.workspaceSymbolFilter=(e=>!(70144&e.modifiers||128===e.kind||256===e.kind&&e.scope)),this.definitionStore=e.definitionStore,this._options={}}set options(e){this._options=Object.assign({},e||{})}provideWorkspaceSymbols(e){if(!e)return null;let t=a;const n=this.definitionStore.match(e,this.workspaceSymbolFilter),c=[];for(let e of n)if(c.push(r.SymbolInformation.create(i.PhpSymbol.shortName(e),i.PhpSymbol.toLspSymbolKind(e),s.PackedRange.toLspRange(e.range),o.DocumentStore.uri(e.uriId),this.containerName(e))),--t<1)break;return c}containerName(e){if(i.PhpSymbol.isNamespacedSymbolKind(e))return i.PhpSymbol.namespace(e)||o.DocumentStore.uri(e.uriId);if(i.PhpSymbol.isLocallyScopedDefinitionKind(e.kind)){const t=this.definitionStore.table(o.DocumentStore.uri(e.uriId)),n=t?t.definitionScope(e):void 0;return n?n.name:o.DocumentStore.uri(e.uriId)}return o.DocumentStore.uri(e.uriId)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const i=n(0),r=n(21),s=n(4);class o{constructor(){this._diagnosticsChangedEvent=new i.Event,this.lruCache=new r({max:o.MAX_DOCUMENTS,noDisposeOnSet:!0,dispose:(e,t)=>{this._diagnosticsChangedEvent.trigger({uri:e,diagnostics:[]})}})}get diagnosticsChangedEvent(){return this._diagnosticsChangedEvent}find(e){return"number"==typeof e&&(e=s.UriMap.uri(e)),this.lruCache.get(e)}add(e){this.lruCache.peek(e.uri)?e.diagnostics.length>0?(this.lruCache.set(e.uri,e),this._diagnosticsChangedEvent.trigger(e)):this.lruCache.del(e.uri):e.diagnostics.length>0?(this.lruCache.set(e.uri,e),this._diagnosticsChangedEvent.trigger(e)):this._diagnosticsChangedEvent.trigger(e)}remove(e){"number"==typeof e&&(e=s.UriMap.uri(e));let t=this.lruCache.peek(e);return this.lruCache.del(e),t}clear(){this.lruCache.reset()}}o.MAX_DOCUMENTS=50,t.DiagnosticStore=o},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=n(50),s=n(10),o=n(12),a=n(51),c=r.Root.fromJSON(a);!function(e){const t="intelephense_data_2",n="intelephense_data_3",a="intelephense_data_4",d="intelephense_data_5",l="intelephense_data_6",u="intelephense_data_1";function h(e){const t=new Map;for(let n of e)t.set(n.fqsenHash,n);return t}function f(e){const t=[];for(let n of e.entries())Array.isArray(n[1])?t.push({key:n[0],values:n[1]}):t.push({key:n[0],value:n[1]});return t}function p(e){const t=new Map;for(let n=0,i=e.length;n<i;++n)t.set(e[n].key,e[n].value||e[n].values);return t}e.writeStateToCache=function(e,r){return i(this,void 0,void 0,function*(){yield r.put(u,JSON.stringify({timestamp:Date.now(),counter:e.documentStore.getCounter()})),yield function(e,n){return new Promise((i,r)=>{const s=c.lookupType("DocumentIdentifier"),o=n.putStream(t);o.on("finish",i),o.on("error",r);for(let t of e)o.write(s.encodeDelimited(t,void 0).finish());o.end()})}(e.documentStore.getIndexedDocumentIdentifiers(),r),yield function(e,t){return new Promise((n,i)=>{const r=c.lookupType("NameIndexNode"),s=t.putStream(a);s.on("finish",n),s.on("error",i);for(let t of e)s.write(r.encodeDelimited({key:t.key,items:f(t.items)}).finish());s.end()})}(e.definitionStore.getNameIndexNodes(),r),yield function(e,t){return new Promise((i,r)=>{const s=c.lookupType("DefinitionTable"),o=t.putStream(n);o.on("finish",i),o.on("error",r);for(let t of e.values())o.write(s.encodeDelimited({id:t.id,items:Array.from(t.definitions)}).finish());o.end()})}(e.definitionStore.definitionTableMap,r),yield function(e,t){return new Promise((n,i)=>{const r=c.lookupType("ReferenceStoreMapPair"),s=t.putStream(d);s.on("finish",n),s.on("error",i);for(let t of e.entries())s.write(r.encodeDelimited({key:t[0],value:t[1]}).finish());s.end()})}(e.referenceStore.uriIdToHashedReferenceNamesMap,r),yield function(e,t){return new Promise((n,i)=>{const r=c.lookupType("ReferenceStoreMapPair"),s=t.putStream(l);s.on("finish",n),s.on("error",i);for(let t of e.entries())s.write(r.encodeDelimited({key:t[0],value:Array.from(t[1])}).finish());s.end()})}(e.referenceStore.hashedReferenceNameToUriIdMap,r)})},e.readStateFromCache=function(e,f){return i(this,void 0,void 0,function*(){try{const m=yield f.get(u);if(!m)return;const g=JSON.parse(m.toString()),k=yield function(e){return i(this,void 0,void 0,function*(){const n=c.lookupType("DocumentIdentifier"),i=yield e.get(t),s=r.Reader.create(i);if(s.len)return function*(){let e;for(;s.pos<s.len;)e=n.decodeDelimited(s),yield n.toObject(e)}()})}(f),S=yield function(e){return i(this,void 0,void 0,function*(){const t=c.lookupType("DefinitionTable"),i=yield e.get(n),s=r.Reader.create(i);if(!s.len)return;let a,d;const l=new Map;for(;s.pos<s.len;)a=t.decodeDelimited(s),d=t.toObject(a),l.set(d.id,new o.DefinitionTable(d.id,h(d.items)));return l})}(f),T=yield function(e){return i(this,void 0,void 0,function*(){const t=c.lookupType("NameIndexNode"),n=yield e.get(a),i=r.Reader.create(n);if(!i.len)return;let s,o;const d=[];for(;i.pos<i.len;)s=t.decodeDelimited(i),o=t.toObject(s),d.push({key:o.key,items:p(o.items)});return d})}(f),y=yield function(e){return i(this,void 0,void 0,function*(){const t=c.lookupType("ReferenceStoreMapPair"),n=yield e.get(d),i=r.Reader.create(n);if(!i.len)return;let s,o;const a=new Map;for(;i.pos<i.len;)s=t.decodeDelimited(i),o=t.toObject(s),a.set(o.key,o.value);return a})}(f),v=yield function(e){return i(this,void 0,void 0,function*(){const t=c.lookupType("ReferenceStoreMapPair"),n=yield e.get(l),i=r.Reader.create(n);if(!i.len)return;let s,o;const a=new Map;for(;i.pos<i.len;)s=t.decodeDelimited(i),o=t.toObject(s),a.set(o.key,new Set(o.value));return a})}(f);if(!(g&&k&&S&&T&&y&&v))return;return e.documentStore.restore(g.counter,k),e.definitionStore.definitionTableMap=S,e.definitionStore.setNameIndexNodes(T),e.referenceStore.uriIdToHashedReferenceNamesMap=y,e.referenceStore.hashedReferenceNameToUriIdMap=v,g.timestamp}catch(e){return yield f.destroy(),void(e&&"ENOENT"!==e.code&&s.Log.error(e.toString()))}})}}(t.Serialiser||(t.Serialiser={}))},function(e,t){e.exports=require("protobufjs/light")},function(e){e.exports={nested:{DocumentIdentifier:{fields:{uri:{type:"string",id:1},id:{type:"sint32",id:2},flags:{type:"sint32",id:3}}},NameIndexNode:{fields:{key:{type:"string",id:1},items:{type:"NameIndexNodeItemPair",id:2,rule:"repeated"}}},NameIndexNodeItemPair:{fields:{key:{type:"sint32",id:1},value:{type:"sint32",id:2},values:{type:"sint32",id:3,rule:"repeated"}}},DefinitionType:{fields:{declared:{type:"string",id:1,rule:"repeated"},documentedOrInferred:{type:"string",id:2,rule:"repeated"}}},PackedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},Reference:{fields:{kind:{type:"int32",id:1},name:{type:"string",id:2},modifiers:{type:"int32",id:3},uriId:{type:"int32",id:4},range:{type:"PackedRange",id:5},type:{type:"string",id:6,rule:"repeated"},unresolvedName:{type:"string",id:7},scope:{type:"string",id:8,rule:"repeated"}}},DefinitionTable:{fields:{id:{type:"sint32",id:1},items:{type:"Definition",id:2,rule:"repeated"}}},Definition:{fields:{kind:{type:"int32",id:1},name:{type:"string",id:2},modifiers:{type:"int32",id:3},uriId:{type:"int32",id:4},range:{type:"PackedRange",id:5},fqsenHash:{type:"sint32",id:6},type:{type:"DefinitionType",id:7},associated:{type:"Reference",id:8,rule:"repeated"},value:{type:"string",id:9},scope:{type:"sint32",id:10},children:{type:"sint32",id:11,rule:"repeated"}}},ReferenceStoreMapPair:{fields:{key:{type:"sint32",id:1},value:{type:"sint32",id:2,rule:"repeated"}}}}}},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=n(22),s=n(53),o=n(14),a=n(54),c=n(55),d=n(56);t.FILE_SCHEME="file",t.UNTITLED_SCHEME="untitled";t.Workspace=class{constructor(e){this._folders=e}set includeGlobs(e){this._folders.forEach(t=>{t.includeGlobs=e})}set excludeGlobs(e){this._folders.forEach(t=>{t.excludeGlobs=e})}get folders(){return this._folders.slice(0)}hasFolders(){return this._folders.length>0}addFolder(e){this._folders.push(e)}removeFolder(e){const t=this._folders.findIndex(t=>t.uri===e);if(t>-1)return this._folders.splice(t,1).pop()}contains(e){for(let t=0;t<this._folders.length;++t)if(this._folders[t].contains(e))return!0;return!1}isVendor(e){for(let t=0;t<this._folders.length;++t)if(this._folders[t].isVendor(e))return!0;return!1}};t.WorkspaceFolder=class{constructor(e,t,n,i,r,s){this._uri=e,this.fileProvider=t,this.fileSearchProvider=n,this.flags=s,this.globWithBaseMapFn=(e=>e.indexOf("/")<0?this.uriJoin(this._uri,"**/"+e):this.uriJoin(this._uri,e)),this.includeGlobs=i,this.excludeGlobs=r}get uri(){return this._uri}set includeGlobs(e){this._includeGlobsWithBase=e.map(this.globWithBaseMapFn),this._includeGlobs=e}set excludeGlobs(e){this._excludeGlobsWithBase=e.map(this.globWithBaseMapFn),this._excludeGlobs=e}findFiles(){return this.fileSearchProvider.findFiles(this._uri,this._includeGlobs,this._excludeGlobs)}contains(e){return a.any(e,this._includeGlobsWithBase,{ignore:this._excludeGlobsWithBase})}getVendorUri(){return this._uri+"/vendor/"}isVendor(e){return 0===e.indexOf(this.getVendorUri())}uriJoin(e,t){return"/"===e.slice(-1)&&(e=e.slice(0,-1)),"/"===t.slice(0,1)&&(t=t.slice(1)),e+"/"+t}};class l{constructor(){this._providerMap=new Map}registerProvider(e,t){this._providerMap.set(e,t)}findFiles(e,t,n){return i(this,void 0,void 0,function*(){const i=this._providerMap.get(p.getUriScheme(e));return i?i.findFiles(e,t,n):[]})}static create(){const e=new l;return e.registerProvider(t.FILE_SCHEME,new u),e}}t.MasterFileSearchProvider=l;class u{findFiles(e,n,i){if(p.getUriScheme(e)!==t.FILE_SCHEME)return Promise.resolve([]);const r=p.uriToPath(e);return n=n.map(this.expandFileGlob),i=i.map(this.expandFileGlob),s.async(n,{stats:!0,cwd:r,ignore:i,absolute:!0,transform:this.findFilesTransform})}expandFileGlob(e){return e.indexOf("/")<0?"**/"+e:e}findFilesTransform(e){return{uri:p.pathToUri(e.path),modified:e.mtime.getTime(),size:e.size}}}t.LocalFileSearchProvider=u;class h{constructor(){this._providers=new Map}registerProvider(e,t){this._providers.set(e,t)}readFile(e){return i(this,void 0,void 0,function*(){const t=this._providers.get(p.getUriScheme(e));if(t)return t.readFile(e)})}readFileSync(e){const t=this._providers.get(p.getUriScheme(e));if(t)return t.readFileSync(e)}getFileInfo(e){return i(this,void 0,void 0,function*(){const t=this._providers.get(p.getUriScheme(e));if(t)return t.getFileInfo(e)})}static create(){const e=new h;return e.registerProvider(t.FILE_SCHEME,new f),e}}t.MasterFileProvider=h;class f{readFile(e){return i(this,void 0,void 0,function*(){try{return(yield r.readFile(p.uriToPath(e))).toString()}catch(e){return void(e&&o.Log.warn(e.toString()))}})}readFileSync(e){try{return r.readFileSync(p.uriToPath(e)).toString()}catch(e){return void(e&&o.Log.warn(e.toString()))}}getFileInfo(e){return i(this,void 0,void 0,function*(){try{const t=yield r.stat(p.uriToPath(e));return{uri:e,modified:t.mtime.getTime(),size:t.size}}catch(e){return void(e&&o.Log.warn(e.toString()))}})}}var p;t.LocalFileProvider=f,function(e){e.pathToUri=function(e){return d.default.file(e).toString()},e.uriToPath=function(e){return d.default.parse(e).fsPath},e.getUriScheme=function(e){const t=e.indexOf(":");return t>-1?e.slice(0,t):""}}(p=t.UriUtil||(t.UriUtil={}));class m{constructor(e,t){this.intelephense=e,this.maxFileSize=t,this.queue=new g,this.indexingStartedEmitter=new c.Emitter,this.indexingEndedEmitter=new c.Emitter}get indexingStartedEvent(){return this.indexingStartedEmitter.event}get indexingEndedEvent(){return this.indexingEndedEmitter.event}get progress(){return this.queue.total<1?1:(this.queue.total-this.queue.length)/this.queue.total}isIndexing(){return void 0!==this.indexingCancellationSource}indexWorkspace(e){return i(this,void 0,void 0,function*(){if(this.indexingCancellationSource)throw new Error("Invalid Operation");const t={timestamp:this.intelephense.indexTimestamp,indexedDocuments:new Set(this.intelephense.getIndexedDocuments())};let n,i=0;for(let r=0,s=e.folders.length;r<s;++r)n=e.folders[r],i+=(yield this.indexFolder(n,t));for(let e of t.indexedDocuments)this.forgetFile(e),++i;return i})}cancel(){this.isIndexing()&&this.indexingCancellationSource.cancel()}indexFolder(e,t){return i(this,void 0,void 0,function*(){const n=t?t.timestamp:0,i=e.getVendorUri();let r=e.flags;const s=yield e.findFiles();let a,c=0,d=0;for(let e=0,l=s.length;e<l;++e){if(a=s[e],c=i&&0===a.uri.indexOf(i)?2:0,!t||!t.indexedDocuments.has(a.uri)||a.modified>n){if(a.size>this.maxFileSize){o.Log.warn(`${a.uri} is over the maximum file size of ${this.maxFileSize} bytes.`);continue}this.indexFile(a.uri,r|c),++d}t&&t.indexedDocuments.delete(a.uri)}return d})}indexFile(e,t){this.queue.push({uri:e,kind:1,flags:t}),this.isIndexing()||this.startIndexingWithDelay()}forgetFile(e){this.queue.push({uri:e,kind:2}),this.isIndexing()||this.startIndexingWithDelay()}forgetFolder(e){this.queue.push({uri:e,kind:3}),this.isIndexing()||this.startIndexingWithDelay()}startIndexingWithDelay(){this.indexingCancellationSource=new c.CancellationTokenSource;const e=this.indexingCancellationSource.token;this.indexingStartedEmitter.fire();const t=this.queue,n=this.intelephense;let r=0,s=this;setTimeout(()=>i(this,void 0,void 0,function*(){let i;for(;(i=t.pop())&&!e.isCancellationRequested;){switch(i.kind){case 1:yield n.indexDocument(i.uri,i.flags);break;case 2:n.forgetDocument(i.uri);break;case 3:n.forgetFolder(i.uri)}++r}t.clear(),s.indexingCancellationSource.dispose(),s.indexingCancellationSource=void 0,s.indexingEndedEmitter.fire(r)}),m.INDEX_DELAY)}}m.INDEX_DELAY=100,t.Indexer=m;class g{constructor(){this.index=0,this._total=0,this.items=[]}get length(){return this.items.length-this.index}get total(){return this._total}push(e){++this._total,this.items.push(e)}pop(){let e;return this.index<this.items.length&&(e=this.items[this.index++]),this.index>g.SLICE_AFTER_POP_COUNT&&(this.items=this.items.slice(this.index),this.index=0),e}clear(){this.items=[],this.index=0,this._total=0}}g.SLICE_AFTER_POP_COUNT=1e4},function(e,t){e.exports=require("fast-glob")},function(e,t){e.exports=require("micromatch")},function(e,t){e.exports=require("vscode-jsonrpc")},function(e,t){e.exports=require("vscode-uri")},function(e,t,n){"use strict";var i=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,s){function o(e){try{c(i.next(e))}catch(e){s(e)}}function a(e){try{c(i.throw(e))}catch(e){s(e)}}function c(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(o,a)}c((i=i.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0});const r=n(22),s=n(23),o=n(14);class a{constructor(e){this.dir=e}get directory(){return this.dir}putStream(e){const t=this.pathFromKey(e);return r.createWriteStream(t)}getStream(e){const t=this.pathFromKey(e);return r.createReadStream(t)}put(e,t){const n=this.pathFromKey(e);return r.writeFile(n,t)}get(e){const t=this.pathFromKey(e);return r.readFile(t)}del(e){return r.unlink(this.pathFromKey(e))}destroy(){return r.remove(this.dir)}pathFromKey(e){return s.join(this.dir,e)}static create(e){return i(this,void 0,void 0,function*(){try{return yield r.ensureDir(e),new a(e)}catch(e){return void(e&&o.Log.warn(e.toString()))}})}}t.Cache=a},function(e,t){e.exports=require("os")}]);