/*
 * Wallaby.js - v1.0.654
 * https://wallabyjs.com
 * Copyright (c) 2014-2019 Wallaby.js - All Rights Reserved.
 *
 * This source code file is a part of Wallaby.js and is a proprietary (closed source) software.

 * IMPORTANT:
 * Wallaby.js is a tool made by software developers for software developers with passion and love for what we do.
 * Pirating the tool is not only illegal and just morally wrong,
 * it is also unfair to other fellow programmers who are using it legally,
 * and very harmful for the tool and its future.
 */
!function e(t,n,i){function o(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(r)return r(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var p=n[a]={exports:{}};t[a][0].call(p.exports,function(e){var n=t[a][1][e];return o(n?n:e)},p,p.exports,e,t,n,i)}return n[a].exports}var r="function"==typeof require&&require;module.exports=o(i[0])}({1:[function(e,t,n){global.wallabyCoreClient=!0,e("./lib/global"),delete global.wallabyCoreClient;var i=e("child_process"),o=e("path"),r=e("http"),a=e("ws"),s=0,l=/^win/.test(process.platform),c=function(){this._killed=!1,this._callbacks=Object.create(null)};c.prototype=_.extend(Object.create(EventEmitter.prototype),{start:function(t){var n=this;this._openedFiles=Object.create(null),this._killed=!1,this._forceKillProcessTimeout=t.forceKillProcessTimeout||1e3,this._nodePath=(process.env.WALLABY_NODE||"node").replace(/^~(?=$|\/|\\)/,process.env.HOME),this._useWsl="true"===process.env.WALLABY_USE_WSL&&l;var r=process.env.PATH||process.env.Path,a=_.extend({},process.env,{PATH:(r?r+o.delimiter:"")+(l?"":"/usr/local/bin")});delete a.NODE_ENV,delete a.NODE_PATH,n._withFreePort(function(r){if(!n._killed){var s=o.join(__dirname,"server.js"),l=t.projectPath,c=t.configPath,p=t.lkp,d=t.fileName||"",u=t.editorTypeScript,h=e("os").homedir(),m=n._nodePath,f=[];if(n._useWsl){var S=process.env.systemRoot+"\\system32\\wsl",w=function(e){if(!e)return e;e=e.replace(/\\/g,"/");var t=i.execSync(S+' wslpath -a "'+e+'"');return _.rtrim(t.toString(),"\n")};s=w(s),l=w(l),c=w(c),p=w(p),u=w(u),h=w(h),f.push(process.env.WALLABY_NODE||"node"),m=S}f=f.concat(["--harmony",s,"extended-core-ws","--projectCachePath="+l,"--configPath="+c,"--lkp="+p,"--client="+t.client,"--phantomjs="+t.phantomPath,"--editorTypeScript="+u,"--port="+r,"--quokka="+d,"--homeDir="+h,"--cv="+t.cv]),n._process=i.spawn(m,f,{env:a,cwd:n._normalizeDriveLetter(t.configPath&&!t.fileName?o.dirname(t.configPath):t.localRoot||t.quokkaFolder)}),n._process.on("error",function(e){e&&e.message&&~e.message.indexOf("spawn "+n._nodePath+" ENOENT")?(n.emit("notification",{type:"error",text:"Can not start node.js process ("+n._nodePath+'), make sure your system has <a href="http://wallabyjs.com/docs/intro/install.html#node-js">node.js installed</a>.'}),n.emit("stopped",{})):n.emit("consoleError",e.stack||e.message)}),n._bufferStream(n._process.stderr,function(e){n.emit("consoleError",e)}),n._bufferStream(n._process.stdout,function(e){e&&(~e.indexOf("wallaby.js started")||~e.indexOf("quokka.js started"))?n._connectToServer(r):n.emit("consoleLog",e)})}})},stop:function(){var e,t=this;try{e=this._process.pid;try{this._send({type:"stop"}),this._ws.close(),this._ws.removeAllListeners("close"),this._ws.removeAllListeners("error")}finally{try{this._process.disconnect()}catch(n){}setTimeout(function(){try{t._isProcessRunning(e)&&process.kill(e)}catch(n){}},t._forceKillProcessTimeout)}}catch(n){}finally{this._killed=!0,this._callbacks=Object.create(null),this._openedFiles=Object.create(null)}},_normalizeDriveLetter:function(e){return"win32"===process.platform&&e&&":"===e[1]?e.charAt(0).toUpperCase()+e.slice(1):e},_isProcessRunning:function(e){try{return process.kill(e,0)}catch(t){return"EPERM"===t.code}},_connectToServer:function(e,t){var n=this;t=t||"localhost",n._ws=new a("ws://"+t+":"+e),n._ws.on("message",function(e){var t=JSON.parse(e),i=n["_"+t.type];i&&i.call(n,t)}),n._ws.on("close",function(e,t){console.log("Disconnected from wallaby core: "+e+(t?", "+t:""))}),n._ws.on("error",function(){n._connectToServer(e,"127.0.0.1")})},_withFreePort:function(e){var t=r.createServer();t.listen(0),t.on("listening",function(){var n=t.address().port;t.once("close",function(){e(n)}),t.close()}),process.nextTick(function(){})},isDisposed:function(){return this._killed},fileChangedInEditor:function(e,t,n,i){this._send({type:"fileChangedInEditor",path:e,content:t,changeFrame:n,transientChange:i})},fileOpenedInEditor:function(e){this._openedFiles[e]=(this._openedFiles[e]||0)+1,this._send({type:"fileOpenedInEditor",path:e})},fileClosedInEditor:function(e){var t=(this._openedFiles[e]||0)-1;this._openedFiles[e]=t,t<0&&console.log("Negative opened editor count for "+e),0===t&&(delete this._openedFiles[e],this._send({type:"fileClosedInAllEditors",path:e}))},expressionsToEvaluate:function(e){this._send({type:"expressionsToEvaluate",request:{expressionsToEvaluate:e}})},copyToClipboard:function(e){this._send({type:"copyToClipboard",request:{data:e}})},muteNotification:function(e){this._send({type:"muteNotification",request:e})},runTests:function(e){this._send({type:"runTests",request:e})},getFileMessages:function(e){this._send({type:"getFileMessages",request:e})},continueTrial:function(){this._send({type:"continueTrial"})},requestUncoveredRegions:function(e,t){this._requestWithCorrelationId("uncoveredRegions",e,t)},requestLineReport:function(e,t){this._requestWithCorrelationId("lineReport",e,t)},requestLocation:function(e,t){this._requestWithCorrelationId("location",e,t)},requestInstrumentedFile:function(e,t){this._requestWithCorrelationId("instrumentedFile",e,t)},requestError:function(e,t){this._requestWithCorrelationId("error",e,t)},_requestWithCorrelationId:function(e,t,n){var i=this,o=++s,r=this._callbacks[o]={done:n};this._send({type:e,request:t,id:o}),r.timeout=setTimeout(function(){delete i._callbacks[o]},5e3)},_responseWithCorrelationId:function(e){var t=this._callbacks[e.id];delete this._callbacks[e.id],t&&(clearTimeout(t.timeout),t.done(e.data))},_bufferStream:function(e,t){var n=this,i="";e.setEncoding("utf8"),e.on("data",function(e){if(!n._killed){i+=e;var o=i.lastIndexOf("\n");~o&&(t(i.substring(0,o+1)),i=i.substring(o+1))}}),e.on("close",function(){n._killed||i.length&&t(i)})},_send:function(e){this._ws&&this._ws.send(JSON.stringify(e))},_started:function(e){this.emit("started",e)},_stopped:function(e){this.emit("stopped",e)},_configChanged:function(e){this.emit("configChanged",e)},_expiredLicense:function(e){this.emit("expiredLicense",e)},_documentUpdates:function(e){this.emit("documentUpdates",e.updates)},_navigationRequested:function(e){this.emit("navigationRequested",e)},_stats:function(e){this.emit("stats",e.data)},_filesToTrack:function(e){this.emit("filesToTrack",e.files)},_fileMessages:function(e){this.emit("fileMessages",e)},_live:function(e){this.emit("live",e)},_projectConfigured:function(e){this.emit("projectConfigured",e)},_notification:function(e){this.emit("notification",e.notification)},_consoleOutput:function(e){this.emit("consoleOutput",e.messages)},_busy:function(){this.emit("busy")},_location:function(e){this._responseWithCorrelationId(e)},_error:function(e){this._responseWithCorrelationId(e)},_uncoveredRegions:function(e){this._responseWithCorrelationId(e)},_lineReport:function(e){this._responseWithCorrelationId(e)},_instrumentedFile:function(e){this._responseWithCorrelationId(e)}}),t.exports={Session:c,enums:e("./lib/extension/shared/enums"),utils:e("./lib/extension/shared/utils"),reportBuilder:e("./lib/extension/client/reportBuilder"),dmp:new(e("./lib/diffMatchPatch"))}},{"./lib/diffMatchPatch":4,"./lib/extension/client/reportBuilder":6,"./lib/extension/shared/enums":7,"./lib/extension/shared/utils":8,"./lib/global":10,child_process:void 0,http:void 0,os:void 0,path:void 0,ws:void 0}],2:[function(e,t,n){var i,o=e("path"),r=e("graceful-fs"),a=e("express"),s=e("compression"),l=r.readFileSync(o.join(__dirname,"runners","browser","sandbox.html")).toString(),c="__wallaby__",p=e("./fileCacheMiddleware"),d=function(t,n){var r=this;i=e("debug")("wallaby:browserRunner"),r._project=t,r._workerPool=n,r._baseDir=r._project._instrumentedRoot+o.sep,r._initializer=t.settings().bootstrap,r._reportUnhandledPromises=!!t.settings().reportUnhandledPromises,r._sandboxHtml={},r._report404AsError=t.settings().env.report404AsError,r._lruCache=r._project._lruCache,r._wallabyFileIdPrefix=r._workerPool.wallabyFileIdPrefix(),r._app=a(),r._app.use(s({filter:function(e){return~e.url.indexOf("____wallaby-bundle")}})),r._app.use("/wallaby_sandbox:id.html",function(e,t){t.send(r._sandboxHtml[e.params.id])}),t.settings().testFramework.path&&r._app.use("/"+c+"/"+t.settings().testFramework.version+"/framework.js",p.create(o.join(t._localRoot,t.settings().testFramework.path))),r._app.use("/"+c+"/tracer.js",p.create(o.join(__dirname,"tracer.js"))),r._app.use("/"+c,p.create(o.join(__dirname,"runners","browser"))),t.settings().middleware(r._app,a),r._app.use(p.create(r._baseDir,r._lruCache,r._report404AsError))};d.prototype={prepareSandbox:function(e,t,n){var o=this;e.allFilesHash=_.reduce(e.allFiles.concat(e.allTestFiles),function(e,t){return e[t.normalizedRelativePath]={ts:t.ts,id:t.tmp&&t.originalId?t.originalId:t.id},e},{});var r=e.allFiles.concat(e.allTestFiles),a=e.filesToLoad.concat(e.testFilesToLoad),s=_.reduce(e.testFilesToLoad,function(e,t){return e[t.id]=t,e},{});i("Total files to load in sandbox: "+a.length);var p=o._workerPool.receiverPort();o._anyIncludedEsm=!1,o._sandboxHtml[n]=l.replace("<inject/>",function(){return _.reduce(r,function(e,t){return e+(_.isNumber(t.id)?"file = window.$_$coverage["+t.id+"]=[]; for(i=0, len="+t.rangesLength+"; i < len; i++) file[i] = {};":"")},"<script>(function() {window.$_$receiverPort = "+p+';window.$_$session="'+t+'";window.$_$baseDir='+JSON.stringify(o._baseDir)+";window.$_$initialSpecId="+1e5*(n+1)+";window.$_$reportUnhanledPromises="+o._reportUnhandledPromises+";window.$_$coverage=[]; var file, i, len;")+"window.$_$slow="+o._project.settings().slowTestThreshold+";window.$_$expressionsToEvaluate="+JSON.stringify(e.expressionsToEvaluate)+";window.$_$files="+JSON.stringify(e.allFilesHash)+";window.$_$tests="+(e.tests?JSON.stringify(e.tests):"null")+";window.$_$testFiles="+JSON.stringify(_.chain(e.allTestFiles).filter(function(e){return!e.shadowed}).map(function(t){return{path:t.relativePath,loaded:t.include&&!!s[t.id],id:(e.allFilesHash[t.normalizedRelativePath]||{}).id}}).value())+';})();</script><script src="'+c+'/tracer.js"></script><script src="'+c+"/"+e.framework.version+'/framework.js"></script><script src="'+c+"/"+e.framework.configurator+'/configurator.js"></script><script src="'+c+"/"+e.framework.reporter+'/reporter.js"></script>'+_.reduce(a,function(e,t){o._anyIncludedEsm=o._anyIncludedEsm||t.esm;var n=t.tmp,r=t.ts+(n?t.originalId?o._wallabyFileIdPrefix+t.originalId:"":o._wallabyFileIdPrefix+t.id);switch(t.type){case"js":case"mjs":case"jsx":case"es6":case"es7":return e+"<script "+(t.esm?'type="module"':"")+' src="'+t.normalizedRelativePath+"?"+r+'"></script>';case"html":case"htm":return e+'<link href="'+t.normalizedRelativePath+"?"+t.ts+'" rel="import">';case"css":return e+'<link rel="stylesheet" type="text/css" href="'+t.normalizedRelativePath+"?"+r+'"></link>';default:return i("File type "+t.type+" can not be included via script/link tag into sandbox"),e}},"")+(o._initializer?"<script>("+o._initializer+")(window.wallaby);</script>":"")+"<script "+(o._anyIncludedEsm?'type="module"':"")+' src="'+c+"/"+e.framework.starter+'/starter.js"></script>'});var d=o.sandboxRootUrl()+"wallaby_sandbox"+n+".html";return i("Sandbox is generated [%s]: %s",o.sandboxName(n,t),d),Q.when(d)},doesSandboxContainESModules:function(){return this._anyIncludedEsm},sandboxRootUrl:function(){return this._sandboxRootUrl?this._sandboxRootUrl:(this._sandboxRootUrl="http://localhost:"+this._workerPool.receiverPort()+"/",this._sandboxRootUrl)},webApp:function(){return this._app},sandboxName:function(e,t){return"worker #"+e+", session #"+t}},t.exports=d},{"./fileCacheMiddleware":9,compression:void 0,debug:void 0,express:void 0,"graceful-fs":void 0,path:void 0}],3:[function(e,t,n){var i,o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function a(e){try{l(i.next(e))}catch(t){r(t)}}function s(e){try{l(i["throw"](e))}catch(t){r(t)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}l((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,r&&(a=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(r,n[1])).done)return a;switch(r=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,r=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){l.label=n[1];break}if(6===n[0]&&l.label<a[1]){l.label=a[1],a=n;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(n);break}a[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(i){n=[6,i],r=0}finally{o=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,r,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},a=e("chrome-launcher"),s=e("chrome-remote-interface"),l=e("./runWorkerPool"),c=e("./browserEnvironment"),p=function(){function t(t){i=e("debug")("wallaby:chromeRunner"),this._screenShotReady=Promise.resolve(),this._project=t;var n=t.settings().env;this._path=n.runner,n.params&&n.params.runner&&(this._flags=n.params.runner.split(" ")),this._chromePromise=this._launchChromeInstance(),this._workerPool=new l(this._project,{create:_.bind(this._create,this),recycle:_.bind(this._recycle,this),healthy:function(){return!0},prepare:_.bind(this._prepareTab,this)}),this._browserEnvironment=new c(t,this._workerPool)}return t.prototype.run=function(e){return this._workerPool.run(e)},t.prototype.cancel=function(e){return this._workerPool.cancel(e)},t.prototype.start=function(){return o(this,void 0,void 0,function(){var e;return r(this,function(t){switch(t.label){case 0:return[4,this._workerPool.start(this._browserEnvironment.webApp())];case 1:return e=t.sent(),this._workerPool.setFileRoot(this._browserEnvironment.sandboxRootUrl()),[2,e]}})})},t.prototype.stop=function(){if(this._workerPool.stop(),this._chrome)try{process.kill(this._chrome.pid)}catch(e){}},t.prototype._create=function(e,t){return o(this,void 0,void 0,function(){return r(this,function(n){switch(n.label){case 0:return[4,this._chromePromise];case 1:return n.sent(),t({workerId:e}),[2]}})})},t.prototype._recycle=function(e){this._closeTab(e)},t.prototype._prepareTab=function(e,t){return o(this,void 0,void 0,function(){var n,o,a,s,l;return r(this,function(r){switch(r.label){case 0:return n=this,o=_.randomId(),a=this._browserEnvironment.sandboxName(t,o),i("Starting sandbox [%s]",a),[4,this._workerPool.getWorker(t)];case 1:return s=r.sent(),this._checkCancelled(),i("Preparing sandbox [%s]",a),[4,this._browserEnvironment.prepareSandbox(e,o,t)];case 2:return l=r.sent(),this._checkCancelled(),i("Prepared sandbox [%s]",a),[2,{name:a,sessionId:o,workerId:t,instance:{resume:function(){n._evaluateOnTab(s.client,function(){$_$tracer.resume()})},ping:function(e){n._evaluateOnTab(s.client,function(){},e)},close:function(){n._closeTab(s)},closing:function(){},start:function(e){n._openTab(s,l,function(t){e(t.status)&&n._evaluateOnTab(s.client,function(){$_$tracer.start()})})}}}]}})})},t.prototype._checkCancelled=function(){if(this._workerPool.cancelled())throw{runCancelled:!0}},t.prototype._connectionOptions=function(e){return void 0===e&&(e={}),_.extend({port:this._chrome.port,host:"127.0.0.1"},e)},t.prototype._evaluateOnTab=function(e,t,n){return void 0===n&&(n=_.noop),o(this,void 0,void 0,function(){var o;return r(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),e.Runtime?[4,e.Runtime.evaluate({expression:"("+t.toString()+")()"})]:[2];case 1:return r.sent(),n(),[3,3];case 2:return o=r.sent(),i("Failed to evaluate code on Chrome Tab: "+o.message),[3,3];case 3:return[2]}})})},t.prototype._openTab=function(e,t,n){return void 0===n&&(n=_.noop),o(this,void 0,void 0,function(){var i,o,a,l,c,p,d,u,h,m,_=this;return r(this,function(r){switch(r.label){case 0:if(r.trys.push([0,18,,19]),!this._chrome)throw new Error("Chrome is not running");return[4,s.New(this._connectionOptions({url:t}))];case 1:return i=r.sent(),e.client={target:{id:i.id}},this._checkCancelled(),[4,s({tab:i})];case 2:o=r.sent(),e.client=o,this._checkCancelled(),a=o.Page,l=o.Network,r.label=3;case 3:return r.trys.push([3,16,,17]),c=!!this._browserEnvironment.doesSandboxContainESModules(),p=[a.enable()],c&&p.push(l.enable()),[4,Promise.all(p)];case 4:if(r.sent(),this._checkCancelled(),!c)return[3,13];l.requestIntercepted(function(e){var t=e.interceptionId,n=e.request;return l.continueInterceptedRequest({interceptionId:t,url:_._updateTrackedFileUrlIfRequired(n.url)})["catch"](function(e){})}),r.label=5;case 5:return r.trys.push([5,7,,12]),[4,o.send("Network.setRequestInterception",{patterns:[{urlPattern:"*"}]})];case 6:return r.sent(),[3,12];case 7:d=r.sent(),r.label=8;case 8:return r.trys.push([8,10,,11]),[4,l.setRequestInterceptionEnabled({enabled:!0})];case 9:return r.sent(),[3,11];case 10:return u=r.sent(),console.warn("Unable to configure network request interception in Chrome"),[3,11];case 11:return[3,12];case 12:this._checkCancelled(),r.label=13;case 13:return[4,a.navigate({url:t})];case 14:return r.sent(),this._checkCancelled(),[4,a.loadEventFired()];case 15:return r.sent(),this._checkCancelled(),n({status:"success"}),[3,17];case 16:return h=r.sent(),this._closeTab(e),n({status:"failed: "+(h.message||"unknown")}),[3,17];case 17:return[3,19];case 18:return m=r.sent(),n({status:"failed: "+(m.message||"unknown")}),[3,19];case 19:return[2]}})})},t.prototype._closeTab=function(e){return o(this,void 0,void 0,function(){var t,n;return r(this,function(o){switch(o.label){case 0:if(!e||!e.client)return[3,5];t=e.client,delete e.client,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,s.Close(this._connectionOptions({id:t.target.id}))];case 2:return o.sent(),[3,4];case 3:return n=o.sent(),i("Failed to close Chrome Tab: "+n.message),[3,4];case 4:try{t.close()}catch(r){i("Failed to close Chrome Tab client: "+r.message)}o.label=5;case 5:return[2]}})})},t.prototype._launchChromeInstance=function(){return o(this,void 0,void 0,function(){var t,n,i,o;return r(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),t=["--headless","--disable-gpu","--deterministic-fetch"],n=e("os"),"Linux"===n.type()&&(t.push("--no-sandbox"),t.push("--disable-setuid-sandbox")),i=this,[4,a.launch({chromeFlags:this._flags||t,chromePath:this._path,logLevel:"silent"})];case 1:return i._chrome=r.sent(),[3,3];case 2:return o=r.sent(),this._handleHostError(o),[3,3];case 3:return[2]}})})},t.prototype._updateTrackedFileUrlIfRequired=function(e){if(!e||~e.indexOf("wallabyFileId")||~e.indexOf("__wallaby__"))return e;var t=e;if(t=t.replace(this._browserEnvironment.sandboxRootUrl(),""),t===e)return e;var n=t.lastIndexOf("?");n>=0&&(t=t.substring(0,n));var i=t&&this._project.getFileMetadataByPath(t);return i?e+(~n?"&":"?")+i.changeTs+"&wallabyFileId="+i.id:e},t.prototype._handleHostError=function(e){e=e||{},this._project._cleanStack(e);var t="Chrome runner error: "+(e.message||"unknown"),n=e.stack||t;console.error(n),this._project._emitTestRunError(t)},t}();t.exports=p},{"./browserEnvironment":2,"./runWorkerPool":14,"chrome-launcher":void 0,"chrome-remote-interface":void 0,debug:void 0,os:void 0}],4:[function(e,t,n){function i(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}var o=-1,r=1,a=0;i.Diff,i.prototype.diff_main=function(e,t,n,i){"undefined"==typeof i&&(i=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout);var o=i;if(null==e||null==t)throw new Error("Null input. (diff_main)");if(e==t)return e?[[a,e]]:[];"undefined"==typeof n&&(n=!0);var r=n,s=this.diff_commonPrefix(e,t),l=e.substring(0,s);e=e.substring(s),t=t.substring(s),s=this.diff_commonSuffix(e,t);var c=e.substring(e.length-s);e=e.substring(0,e.length-s),t=t.substring(0,t.length-s);var p=this.diff_compute_(e,t,r,o);return l&&p.unshift([a,l]),c&&p.push([a,c]),this.diff_cleanupMerge(p),p},i.prototype.diff_compute_=function(e,t,n,i){var s;if(!e)return[[r,t]];if(!t)return[[o,e]];var l=e.length>t.length?e:t,c=e.length>t.length?t:e,p=l.indexOf(c);if(p!=-1)return s=[[r,l.substring(0,p)],[a,c],[r,l.substring(p+c.length)]],e.length>t.length&&(s[0][0]=s[2][0]=o),s;if(1==c.length)return[[o,e],[r,t]];var d=this.diff_halfMatch_(e,t);if(d){var u=d[0],h=d[1],m=d[2],_=d[3],f=d[4],S=this.diff_main(u,m,n,i),w=this.diff_main(h,_,n,i);return S.concat([[a,f]],w)}return n&&e.length>100&&t.length>100?this.diff_lineMode_(e,t,i):this.diff_bisect_(e,t,i)},i.prototype.diff_lineMode_=function(e,t,n){var i=this.diff_linesToChars_(e,t);e=i.chars1,t=i.chars2;var s=i.lineArray,l=this.diff_main(e,t,!1,n);this.diff_charsToLines_(l,s),this.diff_cleanupSemantic(l),l.push([a,""]);for(var c=0,p=0,d=0,u="",h="";c<l.length;){switch(l[c][0]){case r:d++,h+=l[c][1];break;case o:p++,u+=l[c][1];break;case a:if(p>=1&&d>=1){l.splice(c-p-d,p+d),c=c-p-d;for(var i=this.diff_main(u,h,!1,n),m=i.length-1;m>=0;m--)l.splice(c,0,i[m]);c+=i.length}d=0,p=0,u="",h=""}c++}return l.pop(),l},i.prototype.diff_bisect_=function(e,t,n){for(var i=e.length,a=t.length,s=Math.ceil((i+a)/2),l=s,c=2*s,p=new Array(c),d=new Array(c),u=0;u<c;u++)p[u]=-1,d[u]=-1;p[l+1]=0,d[l+1]=0;for(var h=i-a,m=h%2!=0,_=0,f=0,S=0,w=0,v=0;v<s&&!((new Date).getTime()>n);v++){for(var g=-v+_;g<=v-f;g+=2){var y,V=l+g;y=g==-v||g!=v&&p[V-1]<p[V+1]?p[V+1]:p[V-1]+1;for(var D=y-g;y<i&&D<a&&e.charAt(y)==t.charAt(D);)y++,D++;if(p[V]=y,y>i)f+=2;else if(D>a)_+=2;else if(m){var b=l+h-g;if(b>=0&&b<c&&d[b]!=-1){var T=i-d[b];if(y>=T)return this.diff_bisectSplit_(e,t,y,D,n)}}}for(var R=-v+S;R<=v-w;R+=2){var T,b=l+R;T=R==-v||R!=v&&d[b-1]<d[b+1]?d[b+1]:d[b-1]+1;for(var k=T-R;T<i&&k<a&&e.charAt(i-T-1)==t.charAt(a-k-1);)T++,k++;if(d[b]=T,T>i)w+=2;else if(k>a)S+=2;else if(!m){var V=l+h-R;if(V>=0&&V<c&&p[V]!=-1){var y=p[V],D=l+y-V;if(T=i-T,y>=T)return this.diff_bisectSplit_(e,t,y,D,n)}}}}return[[o,e],[r,t]]},i.prototype.diff_bisectSplit_=function(e,t,n,i,o){var r=e.substring(0,n),a=t.substring(0,i),s=e.substring(n),l=t.substring(i),c=this.diff_main(r,a,!1,o),p=this.diff_main(s,l,!1,o);return c.concat(p)},i.prototype.diff_linesToChars_=function(e,t){function n(e){for(var t="",n=0,r=-1,a=i.length;r<e.length-1;){r=e.indexOf("\n",n),r==-1&&(r=e.length-1);var s=e.substring(n,r+1);n=r+1,(o.hasOwnProperty?o.hasOwnProperty(s):void 0!==o[s])?t+=String.fromCharCode(o[s]):(t+=String.fromCharCode(a),o[s]=a,i[a++]=s)}return t}var i=[],o={};i[0]="";var r=n(e),a=n(t);return{chars1:r,chars2:a,lineArray:i}},i.prototype.diff_wordMode=function(e,t){var n=this.diff_linesToWords_(e,t),i=n.chars1,o=n.chars2,r=n.lineArray,a=this.diff_main(i,o,!1);return this.diff_charsToLines_(a,r),a},i.prototype.diff_linesToWords_=function(e,t){function n(e){for(var t=e.split(/(\s+|\b)/),n=0;n<t.length-1;n++)!t[n+1]&&t[n+2]&&a.test(t[n])&&a.test(t[n+2])&&(t[n]+=t[n+2],t.splice(n+1,2),n--);return t}function i(e){for(var t="",i=n(e),a=o.length,s=0,l=i.length;s<l;s++){var c=i[s];(r.hasOwnProperty?r.hasOwnProperty(c):void 0!==r[c])?t+=String.fromCharCode(r[c]):(t+=String.fromCharCode(a),r[c]=a,o[a++]=c)}return t}var o=[],r={};o[0]="";var a=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,s=i(e),l=i(t);return{chars1:s,chars2:l,lineArray:o}},i.prototype.diff_charsToLines_=function(e,t){for(var n=0;n<e.length;n++){for(var i=e[n][1],o=[],r=0;r<i.length;r++)o[r]=t[i.charCodeAt(r)];e[n][1]=o.join("")}},i.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var n=0,i=Math.min(e.length,t.length),o=i,r=0;n<o;)e.substring(r,o)==t.substring(r,o)?(n=o,r=n):i=o,o=Math.floor((i-n)/2+n);return o},i.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var n=0,i=Math.min(e.length,t.length),o=i,r=0;n<o;)e.substring(e.length-o,e.length-r)==t.substring(t.length-o,t.length-r)?(n=o,r=n):i=o,o=Math.floor((i-n)/2+n);return o},i.prototype.diff_commonOverlap_=function(e,t){var n=e.length,i=t.length;if(0==n||0==i)return 0;n>i?e=e.substring(n-i):n<i&&(t=t.substring(0,n));var o=Math.min(n,i);if(e==t)return o;for(var r=0,a=1;;){var s=e.substring(o-a),l=t.indexOf(s);if(l==-1)return r;a+=l,0!=l&&e.substring(o-a)!=t.substring(0,a)||(r=a,a++)}},i.prototype.diff_halfMatch_=function(e,t){function n(e,t,n){for(var i,o,r,s,l=e.substring(n,n+Math.floor(e.length/4)),c=-1,p="";(c=t.indexOf(l,c+1))!=-1;){var d=a.diff_commonPrefix(e.substring(n),t.substring(c)),u=a.diff_commonSuffix(e.substring(0,n),t.substring(0,c));p.length<u+d&&(p=t.substring(c-u,c)+t.substring(c,c+d),i=e.substring(0,n-u),o=e.substring(n+d),r=t.substring(0,c-u),s=t.substring(c+d))}return 2*p.length>=e.length?[i,o,r,s,p]:null}if(this.Diff_Timeout<=0)return null;var i=e.length>t.length?e:t,o=e.length>t.length?t:e;if(i.length<4||2*o.length<i.length)return null;var r,a=this,s=n(i,o,Math.ceil(i.length/4)),l=n(i,o,Math.ceil(i.length/2));if(!s&&!l)return null;r=l?s&&s[4].length>l[4].length?s:l:s;var c,p,d,u;e.length>t.length?(c=r[0],p=r[1],d=r[2],u=r[3]):(d=r[0],u=r[1],c=r[2],p=r[3]);var h=r[4];return[c,p,d,u,h]},i.prototype.diff_cleanupSemantic=function(e){for(var t=!1,n=[],i=0,s=null,l=0,c=0,p=0,d=0,u=0;l<e.length;)e[l][0]==a?(n[i++]=l,c=d,p=u,d=0,u=0,s=e[l][1]):(e[l][0]==r?d+=e[l][1].length:u+=e[l][1].length,s&&s.length<=Math.max(c,p)&&s.length<=Math.max(d,u)&&(e.splice(n[i-1],0,[o,s]),e[n[i-1]+1][0]=r,i--,i--,l=i>0?n[i-1]:-1,c=0,p=0,d=0,u=0,s=null,t=!0)),l++;for(t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),l=1;l<e.length;){if(e[l-1][0]==o&&e[l][0]==r){var h=e[l-1][1],m=e[l][1],_=this.diff_commonOverlap_(h,m),f=this.diff_commonOverlap_(m,h);_>=f?(_>=h.length/2||_>=m.length/2)&&(e.splice(l,0,[a,m.substring(0,_)]),e[l-1][1]=h.substring(0,h.length-_),e[l+1][1]=m.substring(_),l++):(f>=h.length/2||f>=m.length/2)&&(e.splice(l,0,[a,h.substring(0,f)]),e[l-1][0]=r,e[l-1][1]=m.substring(0,m.length-f),e[l+1][0]=o,e[l+1][1]=h.substring(f),l++),l++}l++}},i.prototype.diff_cleanupSemanticLossless=function(e){function t(e,t){if(!e||!t)return 6;var n=e.charAt(e.length-1),o=t.charAt(0),r=n.match(i.nonAlphaNumericRegex_),a=o.match(i.nonAlphaNumericRegex_),s=r&&n.match(i.whitespaceRegex_),l=a&&o.match(i.whitespaceRegex_),c=s&&n.match(i.linebreakRegex_),p=l&&o.match(i.linebreakRegex_),d=c&&e.match(i.blanklineEndRegex_),u=p&&t.match(i.blanklineStartRegex_);return d||u?5:c||p?4:r&&!s&&l?3:s||l?2:r||a?1:0}for(var n=1;n<e.length-1;){if(e[n-1][0]==a&&e[n+1][0]==a){var o=e[n-1][1],r=e[n][1],s=e[n+1][1],l=this.diff_commonSuffix(o,r);if(l){var c=r.substring(r.length-l);o=o.substring(0,o.length-l),r=c+r.substring(0,r.length-l),s=c+s}for(var p=o,d=r,u=s,h=t(o,r)+t(r,s);r.charAt(0)===s.charAt(0);){o+=r.charAt(0),r=r.substring(1)+s.charAt(0),s=s.substring(1);var m=t(o,r)+t(r,s);m>=h&&(h=m,p=o,d=r,u=s)}e[n-1][1]!=p&&(p?e[n-1][1]=p:(e.splice(n-1,1),n--),e[n][1]=d,u?e[n+1][1]=u:(e.splice(n+1,1),n--))}n++}},i.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,i.whitespaceRegex_=/\s/,i.linebreakRegex_=/[\r\n]/,i.blanklineEndRegex_=/\n\r?\n$/,i.blanklineStartRegex_=/^\r?\n\r?\n/,i.prototype.diff_cleanupEfficiency=function(e){for(var t=!1,n=[],i=0,s=null,l=0,c=!1,p=!1,d=!1,u=!1;l<e.length;)e[l][0]==a?(e[l][1].length<this.Diff_EditCost&&(d||u)?(n[i++]=l,c=d,p=u,s=e[l][1]):(i=0,s=null),d=u=!1):(e[l][0]==o?u=!0:d=!0,s&&(c&&p&&d&&u||s.length<this.Diff_EditCost/2&&c+p+d+u==3)&&(e.splice(n[i-1],0,[o,s]),e[n[i-1]+1][0]=r,i--,s=null,c&&p?(d=u=!0,i=0):(i--,l=i>0?n[i-1]:-1,d=u=!1),t=!0)),l++;t&&this.diff_cleanupMerge(e)},i.prototype.diff_cleanupMerge=function(e){e.push([a,""]);for(var t,n=0,i=0,s=0,l="",c="";n<e.length;)switch(e[n][0]){case r:s++,c+=e[n][1],n++;break;case o:i++,l+=e[n][1],n++;break;case a:i+s>1?(0!==i&&0!==s&&(t=this.diff_commonPrefix(c,l),0!==t&&(n-i-s>0&&e[n-i-s-1][0]==a?e[n-i-s-1][1]+=c.substring(0,t):(e.splice(0,0,[a,c.substring(0,t)]),n++),c=c.substring(t),l=l.substring(t)),t=this.diff_commonSuffix(c,l),0!==t&&(e[n][1]=c.substring(c.length-t)+e[n][1],c=c.substring(0,c.length-t),l=l.substring(0,l.length-t))),0===i?e.splice(n-s,i+s,[r,c]):0===s?e.splice(n-i,i+s,[o,l]):e.splice(n-i-s,i+s,[o,l],[r,c]),n=n-i-s+(i?1:0)+(s?1:0)+1):0!==n&&e[n-1][0]==a?(e[n-1][1]+=e[n][1],e.splice(n,1)):n++,s=0,i=0,l="",c=""}""===e[e.length-1][1]&&e.pop();var p=!1;for(n=1;n<e.length-1;)e[n-1][0]==a&&e[n+1][0]==a&&(e[n][1].substring(e[n][1].length-e[n-1][1].length)==e[n-1][1]?(e[n][1]=e[n-1][1]+e[n][1].substring(0,e[n][1].length-e[n-1][1].length),e[n+1][1]=e[n-1][1]+e[n+1][1],e.splice(n-1,1),p=!0):e[n][1].substring(0,e[n+1][1].length)==e[n+1][1]&&(e[n-1][1]+=e[n+1][1],e[n][1]=e[n][1].substring(e[n+1][1].length)+e[n+1][1],e.splice(n+1,1),p=!0)),n++;p&&this.diff_cleanupMerge(e)},i.prototype.diff_xIndex=function(e,t){var n,i=0,a=0,s=0,l=0;for(n=0;n<e.length&&(e[n][0]!==r&&(i+=e[n][1].length),e[n][0]!==o&&(a+=e[n][1].length),!(i>t));n++)s=i,l=a;return e.length!=n&&e[n][0]===o?l:l+(t-s)},i.prototype.diff_prettyHtml=function(e){for(var t=[],n=/&/g,i=/</g,s=/>/g,l=/\n/g,c=0;c<e.length;c++){var p=e[c][0],d=e[c][1],u=d.replace(n,"&amp;").replace(i,"&lt;").replace(s,"&gt;").replace(l,"&para;<br>");switch(p){case r:t[c]='<ins style="background:#e6ffe6;">'+u+"</ins>";break;case o:t[c]='<del style="background:#ffe6e6;">'+u+"</del>";break;case a:t[c]="<span>"+u+"</span>"}}return t.join("")},i.prototype.diff_prettyCompactHtml=function(e){for(var t=[],n=0;n<e.length;n++){var i=0===n,s=n===e.length-1,l=e[n][0],c=e[n][1];switch(l){case r:t[n]='<ins style="background:#e6ffe6;">'+this.prepare_text_(c)+"</ins>";break;case o:t[n]='<del style="background:#ffe6e6;">'+this.prepare_text_(c)+"</del>";break;case a:t[n]="<span>"+this.truncate_context_(c,i,s)+"</span>"}}return t.join("")},i.prototype.prepare_text_=function(e){var t=/&/g,n=/</g,i=/>/g,o=/\n/g;return e.replace(t,"&amp;").replace(n,"&lt;").replace(i,"&gt;").replace(o,"&para;<br>")},i.prototype.truncate_context_=function(e,t,n){var i=e.split(/\r\n|\r|\n/),o='<span class="dots">...</span>',r=i.length,a=4;return r<=a?this.prepare_text_(e):!t&&!n&&r<=2*a?this.prepare_text_(e):t?o+this.prepare_text_("\n"+i.slice(-a).join("\n")):n?this.prepare_text_(i.slice(0,a).join("\n")+"\n")+o:this.prepare_text_(i.slice(0,a).join("\n")+"\n")+o+this.prepare_text_("\n"+i.slice(-a).join("\n"))},i.prototype.diff_text1=function(e){for(var t=[],n=0;n<e.length;n++)e[n][0]!==r&&(t[n]=e[n][1]);return t.join("")},i.prototype.diff_text2=function(e){for(var t=[],n=0;n<e.length;n++)e[n][0]!==o&&(t[n]=e[n][1]);return t.join("")},i.prototype.diff_levenshtein=function(e){for(var t=0,n=0,i=0,s=0;s<e.length;s++){var l=e[s][0],c=e[s][1];switch(l){case r:n+=c.length;break;case o:i+=c.length;break;case a:t+=Math.max(n,i),n=0,i=0}}return t+=Math.max(n,i)},i.prototype.diff_toDelta=function(e){for(var t=[],n=0;n<e.length;n++)switch(e[n][0]){case r:t[n]="+"+encodeURI(e[n][1]);break;case o:t[n]="-"+e[n][1].length;break;case a:t[n]="="+e[n][1].length}return t.join("\t").replace(/%20/g," ")},i.prototype.diff_fromDelta=function(e,t){for(var n=[],i=0,s=0,l=t.split(/\t/g),c=0;c<l.length;c++){var p=l[c].substring(1);switch(l[c].charAt(0)){case"+":try{n[i++]=[r,decodeURI(p)]}catch(d){throw new Error("Illegal escape in diff_fromDelta: "+p)}break;case"-":case"=":var u=parseInt(p,10);if(isNaN(u)||u<0)throw new Error("Invalid number in diff_fromDelta: "+p);var h=e.substring(s,s+=u);"="==l[c].charAt(0)?n[i++]=[a,h]:n[i++]=[o,h];break;default:if(l[c])throw new Error("Invalid diff operation in diff_fromDelta: "+l[c])}}if(s!=e.length)throw new Error("Delta length ("+s+") does not equal source text length ("+e.length+").");return n},i.prototype.match_main=function(e,t,n){if(null==e||null==t||null==n)throw new Error("Null input. (match_main)");return n=Math.max(0,Math.min(n,e.length)),
e==t?0:e.length?e.substring(n,n+t.length)==t?n:this.match_bitap_(e,t,n):-1},i.prototype.match_bitap_=function(e,t,n){function i(e,i){var o=e/t.length,a=Math.abs(n-i);return r.Match_Distance?o+a/r.Match_Distance:a?1:o}if(t.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var o=this.match_alphabet_(t),r=this,a=this.Match_Threshold,s=e.indexOf(t,n);s!=-1&&(a=Math.min(i(0,s),a),s=e.lastIndexOf(t,n+t.length),s!=-1&&(a=Math.min(i(0,s),a)));var l=1<<t.length-1;s=-1;for(var c,p,d,u=t.length+e.length,h=0;h<t.length;h++){for(c=0,p=u;c<p;)i(h,n+p)<=a?c=p:u=p,p=Math.floor((u-c)/2+c);u=p;var m=Math.max(1,n-p+1),_=Math.min(n+p,e.length)+t.length,f=Array(_+2);f[_+1]=(1<<h)-1;for(var S=_;S>=m;S--){var w=o[e.charAt(S-1)];if(0===h?f[S]=(f[S+1]<<1|1)&w:f[S]=(f[S+1]<<1|1)&w|((d[S+1]|d[S])<<1|1)|d[S+1],f[S]&l){var v=i(h,S-1);if(v<=a){if(a=v,s=S-1,!(s>n))break;m=Math.max(1,2*n-s)}}}if(i(h+1,n)>a)break;d=f}return s},i.prototype.match_alphabet_=function(e){for(var t={},n=0;n<e.length;n++)t[e.charAt(n)]=0;for(var n=0;n<e.length;n++)t[e.charAt(n)]|=1<<e.length-n-1;return t},i.prototype.patch_addContext_=function(e,t){if(0!=t.length){for(var n=t.substring(e.start2,e.start2+e.length1),i=0;t.indexOf(n)!=t.lastIndexOf(n)&&n.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)i+=this.Patch_Margin,n=t.substring(e.start2-i,e.start2+e.length1+i);i+=this.Patch_Margin;var o=t.substring(e.start2-i,e.start2);o&&e.diffs.unshift([a,o]);var r=t.substring(e.start2+e.length1,e.start2+e.length1+i);r&&e.diffs.push([a,r]),e.start1-=o.length,e.start2-=o.length,e.length1+=o.length+r.length,e.length2+=o.length+r.length}},i.prototype.patch_make=function(e,t,n){var s,l;if("string"==typeof e&&"string"==typeof t&&"undefined"==typeof n)s=e,l=this.diff_main(s,t,!0),l.length>2&&(this.diff_cleanupSemantic(l),this.diff_cleanupEfficiency(l));else if(e&&"object"==typeof e&&"undefined"==typeof t&&"undefined"==typeof n)l=e,s=this.diff_text1(l);else if("string"==typeof e&&t&&"object"==typeof t&&"undefined"==typeof n)s=e,l=t;else{if("string"!=typeof e||"string"!=typeof t||!n||"object"!=typeof n)throw new Error("Unknown call format to patch_make.");s=e,l=n}if(0===l.length)return[];for(var c=[],p=new i.patch_obj,d=0,u=0,h=0,m=s,_=s,f=0;f<l.length;f++){var S=l[f][0],w=l[f][1];switch(d||S===a||(p.start1=u,p.start2=h),S){case r:p.diffs[d++]=l[f],p.length2+=w.length,_=_.substring(0,h)+w+_.substring(h);break;case o:p.length1+=w.length,p.diffs[d++]=l[f],_=_.substring(0,h)+_.substring(h+w.length);break;case a:w.length<=2*this.Patch_Margin&&d&&l.length!=f+1?(p.diffs[d++]=l[f],p.length1+=w.length,p.length2+=w.length):w.length>=2*this.Patch_Margin&&d&&(this.patch_addContext_(p,m),c.push(p),p=new i.patch_obj,d=0,m=_,u=h)}S!==r&&(u+=w.length),S!==o&&(h+=w.length)}return d&&(this.patch_addContext_(p,m),c.push(p)),c},i.prototype.patch_deepCopy=function(e){for(var t=[],n=0;n<e.length;n++){var o=e[n],r=new i.patch_obj;r.diffs=[];for(var a=0;a<o.diffs.length;a++)r.diffs[a]=o.diffs[a].slice();r.start1=o.start1,r.start2=o.start2,r.length1=o.length1,r.length2=o.length2,t[n]=r}return t},i.prototype.patch_apply=function(e,t){if(0==e.length)return[t,[]];e=this.patch_deepCopy(e);var n=this.patch_addPadding(e);t=n+t+n,this.patch_splitMax(e);for(var i=0,s=[],l=0;l<e.length;l++){var c,p=e[l].start2+i,d=this.diff_text1(e[l].diffs),u=-1;if(d.length>this.Match_MaxBits?(c=this.match_main(t,d.substring(0,this.Match_MaxBits),p),c!=-1&&(u=this.match_main(t,d.substring(d.length-this.Match_MaxBits),p+d.length-this.Match_MaxBits),(u==-1||c>=u)&&(c=-1))):c=this.match_main(t,d,p),c==-1)s[l]=!1,i-=e[l].length2-e[l].length1;else{s[l]=!0,i=c-p;var h;if(h=u==-1?t.substring(c,c+d.length):t.substring(c,u+this.Match_MaxBits),d==h)t=t.substring(0,c)+this.diff_text2(e[l].diffs)+t.substring(c+d.length);else{var m=this.diff_main(d,h,!1);if(d.length>this.Match_MaxBits&&this.diff_levenshtein(m)/d.length>this.Patch_DeleteThreshold)s[l]=!1;else{this.diff_cleanupSemanticLossless(m);for(var _,f=0,S=0;S<e[l].diffs.length;S++){var w=e[l].diffs[S];w[0]!==a&&(_=this.diff_xIndex(m,f)),w[0]===r?t=t.substring(0,c+_)+w[1]+t.substring(c+_):w[0]===o&&(t=t.substring(0,c+_)+t.substring(c+this.diff_xIndex(m,f+w[1].length))),w[0]!==o&&(f+=w[1].length)}}}}}return t=t.substring(n.length,t.length-n.length),[t,s]},i.prototype.patch_addPadding=function(e){for(var t=this.Patch_Margin,n="",i=1;i<=t;i++)n+=String.fromCharCode(i);for(var i=0;i<e.length;i++)e[i].start1+=t,e[i].start2+=t;var o=e[0],r=o.diffs;if(0==r.length||r[0][0]!=a)r.unshift([a,n]),o.start1-=t,o.start2-=t,o.length1+=t,o.length2+=t;else if(t>r[0][1].length){var s=t-r[0][1].length;r[0][1]=n.substring(r[0][1].length)+r[0][1],o.start1-=s,o.start2-=s,o.length1+=s,o.length2+=s}if(o=e[e.length-1],r=o.diffs,0==r.length||r[r.length-1][0]!=a)r.push([a,n]),o.length1+=t,o.length2+=t;else if(t>r[r.length-1][1].length){var s=t-r[r.length-1][1].length;r[r.length-1][1]+=n.substring(0,s),o.length1+=s,o.length2+=s}return n},i.prototype.patch_splitMax=function(e){for(var t=this.Match_MaxBits,n=0;n<e.length;n++)if(!(e[n].length1<=t)){var s=e[n];e.splice(n--,1);for(var l=s.start1,c=s.start2,p="";0!==s.diffs.length;){var d=new i.patch_obj,u=!0;for(d.start1=l-p.length,d.start2=c-p.length,""!==p&&(d.length1=d.length2=p.length,d.diffs.push([a,p]));0!==s.diffs.length&&d.length1<t-this.Patch_Margin;){var h=s.diffs[0][0],m=s.diffs[0][1];h===r?(d.length2+=m.length,c+=m.length,d.diffs.push(s.diffs.shift()),u=!1):h===o&&1==d.diffs.length&&d.diffs[0][0]==a&&m.length>2*t?(d.length1+=m.length,l+=m.length,u=!1,d.diffs.push([h,m]),s.diffs.shift()):(m=m.substring(0,t-d.length1-this.Patch_Margin),d.length1+=m.length,l+=m.length,h===a?(d.length2+=m.length,c+=m.length):u=!1,d.diffs.push([h,m]),m==s.diffs[0][1]?s.diffs.shift():s.diffs[0][1]=s.diffs[0][1].substring(m.length))}p=this.diff_text2(d.diffs),p=p.substring(p.length-this.Patch_Margin);var _=this.diff_text1(s.diffs).substring(0,this.Patch_Margin);""!==_&&(d.length1+=_.length,d.length2+=_.length,0!==d.diffs.length&&d.diffs[d.diffs.length-1][0]===a?d.diffs[d.diffs.length-1][1]+=_:d.diffs.push([a,_])),u||e.splice(++n,0,d)}}},i.prototype.patch_toText=function(e){for(var t=[],n=0;n<e.length;n++)t[n]=e[n];return t.join("")},i.prototype.patch_fromText=function(e){var t=[];if(!e)return t;for(var n=e.split("\n"),s=0,l=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;s<n.length;){var c=n[s].match(l);if(!c)throw new Error("Invalid patch string: "+n[s]);var p=new i.patch_obj;for(t.push(p),p.start1=parseInt(c[1],10),""===c[2]?(p.start1--,p.length1=1):"0"==c[2]?p.length1=0:(p.start1--,p.length1=parseInt(c[2],10)),p.start2=parseInt(c[3],10),""===c[4]?(p.start2--,p.length2=1):"0"==c[4]?p.length2=0:(p.start2--,p.length2=parseInt(c[4],10)),s++;s<n.length;){var d=n[s].charAt(0);try{var u=decodeURI(n[s].substring(1))}catch(h){throw new Error("Illegal escape in patch_fromText: "+u)}if("-"==d)p.diffs.push([o,u]);else if("+"==d)p.diffs.push([r,u]);else if(" "==d)p.diffs.push([a,u]);else{if("@"==d)break;if(""!==d)throw new Error('Invalid patch mode "'+d+'" in: '+u)}s++}}return t},i.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},i.patch_obj.prototype.toString=function(){var e,t;e=0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1,t=0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2;for(var n,i=["@@ -"+e+" +"+t+" @@\n"],s=0;s<this.diffs.length;s++){switch(this.diffs[s][0]){case r:n="+";break;case o:n="-";break;case a:n=" "}i[s+1]=n+encodeURI(this.diffs[s][1])+"\n"}return i.join("").replace(/%20/g," ")},t.exports=i},{}],5:[function(e,t,n){var i,o=e("path"),r=e("child_process"),a=e("./runWorkerPool"),s=e("./browserEnvironment"),l=0,c=function(t){var n=this;i=e("debug")("wallaby:electronRunner"),n._project=t,n._screenShotReady=Q.when(!0),n._params=t.settings().env.params,n._runner=t.settings().env.runner,n._envOptions=t.settings().env.options,n._clearMemoryCache=t.settings().env.clearMemoryCache,n._host=void 0,n._callbacks=Object.create(null),n._hostPromise=Q.promise(function(e,t){try{var i=_.extend({},process.env,n._params.env?_.reduce(n._params.env.split(";"),function(e,t){var n=t.split("=");return e[n[0]]=n[1],e},{}):{});delete i.ATOM_SHELL_INTERNAL_RUN_AS_NODE,delete i.ELECTRON_RUN_AS_NODE,i.ELECTRON_DISABLE_SECURITY_WARNINGS=!0,n._host=r.fork(o.join(__dirname,"runners","browser","electronHost.js"),[],{execPath:n._runner,env:i,execArgv:n._params.runner?n._params.runner.split(" "):[]}),n._host.on("error",function(e){n._handleHostError(e)}),n._host.on("message",function(t){try{t.id?n._responseWithCorrelationId(t):"ready"===t.type?e(n._host):"error"===t.type&&n._handleHostError(t.error)}catch(i){n._handleHostError(i)}})}catch(a){t(a)}})["catch"](function(e){n._handleHostError(e)}),n._workerPool=new a(n._project,{create:_.bind(n._create,n),recycle:_.bind(n._recycle,n),healthy:function(){return!0},prepare:_.bind(n._prepare,n)}),n._browserEnvironment=new s(t,n._workerPool)};c.prototype={run:function(e){var t=this;return t._workerPool.run(e)},_handleHostError:function(e){var t=this;e=e||{},t._project._cleanStack(e);var n="Electron runner error: "+(e.message||"unknown"),i=e.stack||n;console.error(i),t._project._emitTestRunError(n)},_create:function(e,t){var n=this;n._hostPromise.then(function(){t({pageId:e})})},_recycle:function(e){var t=this;t._host&&t._host.send({type:"closePage",pageId:e.pageId})},_evaluateOnPage:function(e,t,n){var i=this,o={type:"evaluateOnPage",pageId:e,action:"("+t.toString()+")()"};i._requestWithCorrelationId(o,n||_.noop)},_openPage:function(e,t,n,i){var o=this,r={type:"openPage",pageId:e,url:t,options:n};o._requestWithCorrelationId(r,i||_.noop)},_closePage:function(e){var t=this;t._host.send({type:"closePage",pageId:e})},_capturePage:function(e,t){var n=this,i=Q.defer();try{n._requestWithCorrelationId({type:"capturePage",file:t,pageId:e},function(){i.resolve()}),n._screenShotReady=i.promise}catch(o){i.reject(new Error("Failed to render test run screen shot")),console.error("Failed to render test run screen shot",o.message)}},_prepare:function(e,t){var n=this,o=_.randomId(),r=n._browserEnvironment.sandboxName(t,o);return i("Starting sandbox [%s]",r),n._workerPool.getWorker(t).then(function(){return n._workerPool.cancelled()?Q.reject({runCancelled:!0}):(i("Preparing sandbox [%s]",r),n._browserEnvironment.prepareSandbox(e,o,t))}).then(function(e){return n._workerPool.cancelled()?Q.reject({runCancelled:!0}):(i("Prepared sandbox [%s]",r),Q.when({instance:{resume:function(){n._evaluateOnPage(t,function(){$_$tracer.resume()})},ping:function(e){n._evaluateOnPage(t,function(){},e)},close:function(){n._closePage(t)},closing:function(){n._screenShotReady=Q.when()},start:function(i){n._openPage(t,e,n._envOptions,function(e){i(e.status)&&n._evaluateOnPage(t,function(){$_$tracer.start()})})}},name:r,sessionId:o,workerId:t}))})},cancel:function(e){var t=this;return t._workerPool.cancel(e)},start:function(){var e=this;return e._workerPool.start(e._browserEnvironment.webApp()).then(function(t){return e._workerPool.setFileRoot(e._browserEnvironment.sandboxRootUrl()),Q.when(t)})},stop:function(){var e=this;e._host&&(e._host.send({type:"stop"}),e._host.disconnect(),delete e._callbacks,delete e._host),e._workerPool.stop()},_requestWithCorrelationId:function(e,t){var n=this,i=++l,o=n._callbacks[i]={done:t};e.id=i,n._host.send(e),o.timeout=setTimeout(function(){delete n._callbacks[i]},12e5)},_responseWithCorrelationId:function(e){var t=this._callbacks[e.id];delete this._callbacks[e.id],t&&(clearTimeout(t.timeout),t.done(e))}},t.exports=c},{"./browserEnvironment":2,"./runWorkerPool":14,child_process:void 0,debug:void 0,path:void 0}],6:[function(e,t,n){var i=new(e("../../diffMatchPatch"));t.exports={tests:function(e,t){var n=this,i="";return _.isString(e)?i+=t?n._error(e):n._escapeAndConvertToHtml(e):(_.each(e.errors,function(e){i+=n._error(e.message,e.stack,e.expected,e.actual)}),_.each(e.tests,function(e){i+=n._test(e)})),i},_error:function(e,t,n,i){var o=this,r="";return(n||i)&&(r=o._diff(n,i)+"<br/>"),'<section class="error">'+r+'<section class="header">'+o._escapeAndConvertToHtml(e)+"</section>"+_.reduce(t,function(e,t){return e+=o._line(t)},"")+"</section>"},_line:function(e){var t=this._escape(e.file),n=e.context&&this._escape(e.context)||"";return t?'<section class="line">at '+(n?n+" ":"")+'<a class="loc" data-file="'+t+'" data-loc="'+e.loc+'">'+t+":"+e.loc+"</a></section>":""},_test:function(e){var t=this,n=e.path&&_.last(e.path)||"",i=_.initial(e.path||[]).join(" ");n=n&&" "+t._escape(n),i=i&&" "+t._escape(i);var o=_.isNumber(e.time)?" "+e.time+" ms":"",r=t._escape(e.file);return'<section class="test'+(e.failing?" failing":"")+'"><section class="header"><a class="'+(e.loc?"loc":"text")+'" data-file="'+r+'" data-loc="'+e.loc+'">'+e.file+'</a><span class="suite">'+i+'</span><span class="name">'+n+"</span>"+(o?'<span class="time">'+o+"</span>":"")+"</section>"+_.reduce(e.errors,function(e,n){return e+=t._error(n.message,n.stack,n.expected,n.actual)},"")+(e.messages&&e.messages.length?_.reduce(e.messages,function(e,n){return e+='<section class="message '+n.type+'"><span class="text">'+t._escapeAndConvertToHtml(n.text)+"&nbsp;</span>"+t._line(n)+"</section>"},'<section class="console"><section class="header">From console:</section>')+"</section>":"")+"</section>"},_diff:function(e,t){try{return'<section class="diff" style="white-space: pre;">'+i[i.diff_prettyCompactHtml?"diff_prettyCompactHtml":"diff_prettyHtml"](i.diff_wordMode(e||"",t||"")).replace(/&para;<br>/g,"<br>").replace(/style="background:#e6ffe6;"/g,'class="status-added"').replace(/style="background:#ffe6e6;"/g,'class="status-removed"')+"</section>"}catch(n){return""}},_escape:function(e){return(e||"").toString().replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},_escapeAndConvertToHtml:function(e){return this._escape(e).replace(/(?:\r\n|\r|\n)/g,"<br/>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;").replace(/\s/g,"&nbsp;")}}},{"../../diffMatchPatch":4}],7:[function(e,t,n){t.exports={lineState:{notCovered:1,fullyCovered:2,partiallyCovered:3,errorSource:4,errorPath:5}}},{}],8:[function(e,t,n){var i=function(e){return e&&e.replace(/^\s+|\s+$/gm,"")},o=["January","February","March","April","May","June","July","August","September","October","November","December"];t.exports={normalizePath:function(e){return"win32"===process.platform&&e?e.replace(/\\/g,"/"):e},parseKey:function(e){var t={};if(e){var n=e.split(":");2===n.length&&(e=i(n[1]))}var r=new Buffer(e,"base64").toString().split("\n");t.licenseeName=r[0],t.licenseTags=r[1];var a=t.licenseTags.split(",");a.length>=1&&(t.licenseeEmail=a[0]),a.length>=2&&(t.licensedProduct=a[1]),t.expirationDateString=r[2],t.licenseSignature=r[3];try{var s=t.expirationDateString.split("/");t.expirationDateStringFormatted=s[0]+" "+o[parseInt(s[1],10)-1]+" "+s[2]}catch(l){t.expirationDateStringFormatted=t.expirationDateString}return t},format:function(e,t){return e.replace(/\{([0-9a-zA-Z_]+)\}/g,function(n,i,o){var r;return"{"===e[o-1]&&"}"===e[o+n.length]?i:(r=t.hasOwnProperty(i)?t[i]:null,null===r||void 0===r?"":r)})},validPackageName:function(e){if(e&&!e.match(/^\./)&&!e.match(/^_/)&&!(e.length>214||e.toLowerCase()!==e||/[~'!()*]/.test(e.split("/").slice(-1)[0]))){if(encodeURIComponent(e)===e)return e;var t=e.match(/^(?:@([^\/]+?)[\/])?([^\/]+?)$/);if(t){var n=t[1],i=t[2];if(encodeURIComponent(n)===n&&encodeURIComponent(i)===i)return e}}}}},{}],9:[function(e,t,n){var i=e("parseurl"),o=e("mime"),r=e("path"),a=e("graceful-fs"),s={_data:{},set:function(e,t){this._data[e]=t},get:function(e){return this._data[e]}};t.exports={create:function(t,n,l){var c=e("debug")("wallaby:middleware"),p=!n;return function(e,d){var u=i(e).pathname;"/"===u&&(u=""),c("Preparing to serve "+(u||t));var h=r.normalize(r.join(t,u)),m=p?s:n,f=m.get(h),S=function(e){d.set({"Cache-Control":"public, max-age=86400",Expires:new Date(Date.now()+864e5).toUTCString()}),d.type(o.lookup(h,"text/plain")),d.status(200).end(e)};_.isString(f)||f instanceof Buffer?(c("Serving "+(u||t)+" from cache"),S(f)):(c("Serving "+(u||t)+" from disk"),a.readFile(h,function(e,t){return e?(c("Error when reading file "+h+", "+e&&e.message),l&&console.error("Trying to access missing resource or API: "+u),void d.status(404).end()):(m.set(h,t),void S(t))}))}}}},{debug:void 0,"graceful-fs":void 0,mime:void 0,parseurl:void 0,path:void 0}],10:[function(e,t,n){if(global._=e("lodash"),global.Q=e("q"),global.EventEmitter=e("events").EventEmitter,Q.longStackSupport=!1,global.Promise||(global.Promise=Q.Promise),_.extend(_,e("./utils")),_.str=e("underscore.string"),_.mixin(_.str.exports()),!global.wallabyCoreClient){var i=e("module").Module.prototype,o=i._compile,r="wq_sen",a="r.js",s=r+"de"+a;i._compile=function(){return _.endsWith(arguments[1],s)&&(arguments[0]=new Buffer(arguments[0].substr(arguments[0].lastIndexOf("//# sourceMappingURL=data:application/json;base64,")+50),"base64").toString()),o.apply(this,arguments)}}},{"./utils":15,events:void 0,lodash:void 0,module:void 0,q:void 0,"underscore.string":void 0}],11:[function(e,t,n){var i,o=(e("fs"),e("path")),r=e("child_process").spawn,a=e("./runWorkerPool"),s=e("./utils"),l="###wpm###",c=function(t){var n=this;i=e("debug")("wallaby:nodeRunner"),n._project=t,n._nodePath=t.settings().env.runner,n._initializer=t.settings().bootstrap,n._teardown=t.settings().teardown,n._slowTestThreshold=t.settings().slowTestThreshold,n._nodeModules=o.join(t._localRoot,"node_modules");try{n._regeneratorRuntime=o.join(o.dirname(s.resolveModulePathFrom(n._nodeModules,"regenerator-runtime")),"runtime.js")}catch(r){}n._params=t.settings().env.params,n._recycle=t.settings().workers.recycle,n._testFramework=t.settings().testFramework,n._cwd=process.env.quokka?process.cwd():t._instrumentedRoot,n._localProjectDir=t._localProjectDir,n._reportUnhandledPromises=!!t.settings().reportUnhandledPromises,n._workerPool=new a(n._project,{create:_.bind(n._createNodeInstance,n),recycle:_.bind(n._recycleNodeInstance,n),healthy:_.bind(n._isNodeInstanceHealthy,n),prepare:_.bind(n._prepare,n)}),n._workerPool.setFileRoot(t._instrumentedRoot)};c.prototype={run:function(e){var t=this;return t._workerPool.run(e)},cancel:function(e){var t=this;return t._workerPool.cancel(e)},start:function(){var e=this;return e._workerPool.start()},stop:function(){var e=this;e._workerPool.stop()},_createNodeInstance:function(e,t){var n=this;setImmediate(function(){try{process.env.quokka&&(n._params=n._project.settings().env.params,n._recycle=n._project.settings().workers.recycle);var o=(n._params.runner?_.map(n._params.runner.replace(/"([^"]+)"/g,function(e){return e.replace(/\s/g,"_space_token_")}).split(" "),function(e){return _.trim(e.replace(/_space_token_/g," "),'"')}):[]).concat([process.mainModule.filename,"runner",e,n._workerPool.receiverPort(),n._testFramework.version,n._testFramework.path||"",n._nodeModules,process.env.BABEL_ENV&&n._regeneratorRuntime||""]),a=_.extend({},process.env,n._params.env?_.reduce(n._params.env.split(";"),function(e,t){var n=t.split("="),i=_.trimLeft(n[0]);return e[i]=t.substring(n[0].length+1),e},{}):{});delete a.ATOM_SHELL_INTERNAL_RUN_AS_NODE,delete a.ELECTRON_RUN_AS_NODE;var s={process:r(n._nodePath,o,{cwd:n._cwd,env:a}),onConnected:function(e){_.isFunction(e)?this._onConnected=e:this._onConnected&&(this._onConnected(e),delete this._onConnected,delete this.onConnected)}};s.process.stderr.on("data",function(e){var t=e.toString("utf8");i("Error in worker: %s",t),console.error(t)}),t(s)}catch(l){i("Error while creating worker #%s: %s",e,l&&(l.stack||l.message)),t()}})},_recycleNodeInstance:function(e){try{e.process.stdout.removeAllListeners("data"),e.process.stderr.removeAllListeners("data")}finally{e.process.kill()}},_isNodeInstanceHealthy:function(e){return e.process&&e.process.pid&&!e.process.killed&&!e.process.signal&&null===e.process.exitCode},_prepare:function(e,t){var n=this,o=_.randomId(),r=n._sandboxName(t,o);return i("Starting sandbox [%s]",r),Q.when().then(function(){return n._workerPool.cancelled()?Q.reject({runCancelled:!0}):(i("Preparing sandbox [%s]",r),n._workerPool.getWorker(t))}).then(function(a){return i("Prepared sandbox [%s]",r),Q.when({instance:{resume:function(){a.channel.send(JSON.stringify({type:"in:tracer.resume",data:{}}))},ping:function(e){var t=_.uniqueId(),n=function(i){var o;try{o=JSON.parse(i)}catch(r){return}"pong"===o.type&&o.data===t&&(a.channel.removeListener("message",n),e())};a.channel.on("message",n),a.channel.send(JSON.stringify({type:"in:ping",data:t}))},close:function(){n._recycle?(n._workerPool.recycleWorker(t),n._workerPool.getWorker(t).then(_.noop)):a.channel.send(JSON.stringify({type:"in:stop",data:{}}))},closing:_.noop,start:function(t,r){if(t("success")){try{a.process.stdout.removeAllListeners("data"),a.process.stdout.on("data",function(e){try{e=e&&e.toString("utf8"),~e.indexOf(l)&&(e=e.split("\n"),_.each(e,function(e){if(~e.indexOf(l))try{JSON.parse(e);a.channel.emit("message",e)}catch(t){i("Error while processing STDOUT message: "+t.message)}}))}catch(t){i("Error while processing STDOUT message: "+t.message)}})}catch(s){i("Error while subscribing to process STDOUT: "+s.message)}a.process.stderr.removeAllListeners("data"),a.process.stderr.on("data",function(e){if(e=e&&e.toString("utf8"),!e||0!==e.indexOf("Debugger listening on port")){var t="";if(~e.indexOf(l)){var n;e=e.split("\n"),_.each(e,function(e){if(~e.indexOf(l))try{n=JSON.parse(e)}catch(t){i("Error while processing STDERR message: "+t.message)}}),n&&r(n.message,n.stack,n.actual,n.expected)}else{if(e){var o=e.split("\n"),a=[];_.each(o,function(e){return!_.startsWith(_.trimLeft(e),"at")&&void a.push(e)}),t=a.join("\n")}r(t,e)}}});var c={sessionId:o,tests:e.tests,files:_.map(e.allFiles.concat(e.allTestFiles),function(e){return{id:e.id,rangesLength:e.rangesLength}}),testFiles:_.map(e.testFilesToLoad,function(e){var t;if(0===n._testFramework.version.indexOf("jest")){var i=n._project._getFileMetadataById(e.id);t=i&&i.getFileLineMap()}return{path:e.path,id:e.originalId||e.id,type:e.type,originalType:e.originalType,content:process.env.quokka?e.content:void 0,lineMap:t}}),root:n._cwd,localProjectDir:n._localProjectDir,flushCache:!1,initializer:n._initializer,teardown:n._teardown,slowTestThreshold:n._slowTestThreshold,manualTestRun:e.manualRun,reportUnhandledPromises:n._reportUnhandledPromises,expressionsToEvaluate:e.expressionsToEvaluate};a.channel.send(JSON.stringify({type:"in:run",data:c}))}}},name:r,sessionId:o,workerId:t})})},_sandboxName:function(e,t){return"worker #"+e+", session #"+t}},t.exports=c},{"./runWorkerPool":14,"./utils":15,child_process:void 0,debug:void 0,fs:void 0,path:void 0}],12:[function(e,t,n){var i,o=e("phantom"),r=e("./runWorkerPool"),a=e("./browserEnvironment"),s=!1,l=function(t){var n=this;i=e("debug")("wallaby:phantomRunner"),n._project=t,n._screenShotReady=Q.when(!0),n._params=t.settings().env.params,n._viewportSize=t.settings().env.viewportSize,n._clearMemoryCache=t.settings().env.clearMemoryCache,n._phantomjsPath=t.settings().env.runner||n._project._phantomjs,n._workerPool=new r(n._project,{create:_.bind(n._createPhantomInstance,n),recycle:_.bind(n._recyclePhantomInstance,n),healthy:_.bind(n._isPhantomInstanceHealthy,n),prepare:_.bind(n._prepare,n)}),n._browserEnvironment=new a(t,n._workerPool)};l.prototype={run:function(e){var t=this;return t._workerPool.run(e)},_createPhantomInstance:function(e,t){var n=this;try{var r={dnodeOpts:{weak:!1}};n._phantomjsPath&&(r.binary=n._phantomjsPath),r.onExit=function(t,n){return"SIGSEGV"!==n||s||(console.error("Looks like the PhantomJs version being used is not supported on your OS.\nTry using a different PhantomJs version (https://wallabyjs.com/docs/integration/phantomjs2.html)\nor Chromium/V8 via Electron runner (https://wallabyjs.com/docs/integration/electron.html)"),s=!0),i("Signal killed phantomjs #%s: %s, exit code: %s",e,n,t)};var a=["--disk-cache=yes","--web-security=false"];n._params.runner&&(a=a.concat(_.filter(n._params.runner.split(" "),function(e){return e&&!(~e.indexOf("--disk-cache=")||~e.indexOf("--web-security="))})));var l=!1;a.push(function(o){if(!l){if(!o)return l=!0,i("Additional attempt to create phantom instance #%s",e),n._createPhantomInstance(e,t);o.set("onError",function(t){i("PhantomJs failure: %s, recycling phantom instance #%s",t,e),n._workerPool.recycleWorker(e)}),l=!0,t(o)}}),a.push(r),o.create.apply(o,a)}catch(c){i("Error while creating worker #%s: %s",e,c&&(c.stack||c.message)),t()}},_recyclePhantomInstance:function(e){e.exit(),e.process.kill()},_isPhantomInstanceHealthy:function(e){return e.process&&e.process.pid&&!e.process.killed&&!e.process.signal&&null===e.process.exitCode},_prepare:function(t,n){var o=this,r=_.randomId(),a=o._browserEnvironment.sandboxName(n,r);return i("Starting sandbox [%s]",a),Q.when().then(function(){return o._workerPool.cancelled()?Q.reject({runCancelled:!0}):(i("Preparing sandbox [%s]",a),Q.all([o._getPage(n),o._browserEnvironment.prepareSandbox(t,r,n)]))}).then(function(s){i("Prepared sandbox [%s]",a);var l=s[0],c=s[1];return Q.when({instance:{resume:function(){l.evaluate(function(){$_$tracer.resume()})},ping:function(e){l.evaluate(function(){},e)},close:function(){t=null,l.stop&&l.stop(),l.close()},closing:function(){o._captureScreenShot(t.screen,l)},start:function(n,i){o._clearMemoryCache&&l.onResourceRequested(function(t,n,i){try{var o=global._urlUtil=global._urlUtil||e("url"),r=t.url;if(!r)return;if(0===r.indexOf("data:"))return;if(~r.indexOf("wallabyFileId"))return;var a=o.parse(t.url),s="/"===a.pathname.charAt(0)?a.pathname.substr(1):a.pathname,c=s&&i[s];if(!c)return;var p=a.search&&a.search.length;n.changeUrl(r+(p?"&":"?")+c.ts+"&wallabyFileId="+c.id),l.clearMemoryCache()}catch(d){console.log(d&&d.message)}},_.noop,t.allFilesHash),l.set("onError",i),l.open(c,function(e){n(e)&&l.evaluate(function(){$_$tracer.start()})})}},name:a,sessionId:r,workerId:n})})},cancel:function(e){var t=this;return t._workerPool.cancel(e)},start:function(){var e=this;return e._workerPool.start(e._browserEnvironment.webApp())},stop:function(){var e=this;e._workerPool.stop()},_captureScreenShot:function(e,t){var n=this,i=Q.defer();try{t.render(e,function(){i.resolve()}),n._screenShotReady=i.promise}catch(o){i.reject(new Error("Failed to render test run screen shot")),console.error("Failed to render test run screen shot",o.message)}},_getPage:function(e){var t=this;return t._workerPool.getWorker(e).then(function(n){return t._workerPool.cancelled()?Q.reject({runCancelled:!0}):(i("Creating page for worker #"+e),t._createPage(n,e))})},_createPage:function(e,t){var n=this;return Q.promise(function(o,r){var a=!1,s=setTimeout(function(){a||(l(),n._workerPool.recycleWorker(t),i("Phantom page is not created in time, recycling it"),r({runCancelled:!0,rerun:!0}))},400),l=function(){a=!0,clearTimeout(s)};try{e.createPage(function(e){a||(l(),i("Phantom page created"),e.set("viewportSize",n._viewportSize||{width:800,height:600}),o(e))})}catch(c){l(),r(c)}})}},t.exports=l},{"./browserEnvironment":2,"./runWorkerPool":14,debug:void 0,phantom:void 0,url:void 0}],13:[function(e,t,n){function i(e){this.process=r.fork(e,["worker"]),this.pid=this.process.pid,this.status=WorkerState.STARTING,this.process.once("message",this.onReady.bind(this)),a.EventEmitter.call(this)}function o(e,t){function n(){var t=new i(e);t.on("ready",o._run.bind(o)),t.process.on("exit",function(e){if(0!==e){for(var i=0;i<o.workers.length;i++)o.workers[i].pid===t.pid&&o.workers.splice(i,1);n()}}),o.workers.push(t)}this.workers=[],this.queue=[];var o=this;t=t||s.cpus().length;for(var r=0;r<t;r++)n()}var r=e("child_process"),a=e("events"),s=e("os"),l=e("util");WorkerState={STARTING:"STARTING",READY:"READY",BUSY:"BUSY"},l.inherits(i,a.EventEmitter),i.prototype.onReady=function(){this.status===WorkerState.STARTING&&(this.status=WorkerState.READY,this.emit("ready",this))},i.prototype.onMessage=function(e,t){e(t),this.status=WorkerState.READY,this.emit("ready",this)},i.prototype.send=function(e,t){this.status=WorkerState.BUSY,this.emit("busy"),this.process.once("message",this.onMessage.bind(this,t)),this.process.send(e)},o.prototype.enqueue=function(e,t){this.queue.push({task:e,callback:t}),process.nextTick(this._run.bind(this))},o.prototype.stop=function(){_.each(this.workers,function(e){e.process.send({type:"exit"})})},o.prototype._run=function(e){if(0!==this.queue.length){if(!e)for(var t=0;t<this.workers.length;t++)if(this.workers[t].status===WorkerState.READY){e=this.workers[t];break}if(e){var n=this.queue.shift();e.send(n.task,n.callback)}}},t.exports={_queue:void 0,start:function(e){this._queue||(this._queue=new o(e))},started:function(){return!!this._queue},run:function(e){var t=this;return t._queue?Q.promise(function(n,i){try{t._queue.enqueue(e,function(e){n(e)})}catch(o){i(o)}}):Q.reject(new Error("Processor pool is not started"))},stop:function(){this._queue&&(this._queue.stop(),delete this._queue)}}},{child_process:void 0,events:void 0,os:void 0,util:void 0}],14:[function(e,t,n){var i,o=e("os"),r=e("path"),a=e("http"),s=e("./utils"),l=e("ws").Server,c=/^win/.test(process.platform),p=5e3,d=200,u="&wallabyFileId=",h="Wallaby.js cache is corrupted, please restart wallaby.js",m=function(t,n){var o=this;i=e("debug")("wallaby:workers"),o._project=t,o._opts=t.settings(),o._extension=n,process.env.quokka&&(o.reportConsoleOutput=function(e){var n=_.extend({},e);t.resolveLogEntryRange(n),t._emitInternal({type:"consoleOutput",data:n})},o.reportIntermediateResult=function(e){}),o._sessions={},o._executedTestNumber=0,o._workers={},o._connectingWorkers={},o._workerPendingCleanup={},o._calculateNumberOfParallelWorkers();for(var a=0;a<Math.max(o._maxWorkers,o._minWorkers);a++)o.getWorker(a);o._normalizedWallabyServerPath=this._project.normalizePath(r.dirname(process.mainModule.filename)),o._normalizedLocalRoot=this._project.normalizePath(this._project._localRoot)};m.prototype={start:function(e){var t=this,n=t._httpServer=e?a.createServer(e):a.createServer();return n.listen(0),Q.promise(function(e,o){n.on("listening",function(){try{t._receiverPort=n.address().port,i("Web server is listening at "+t._receiverPort),t._wss=new l({server:n,verifyClient:function(e){return _.verifyLocalOrigin(e.origin)}}),t._wss.on("connection",function(e){e.on("message",function(n){var o;try{o=JSON.parse(n)}catch(r){return void console.error("Failed to deserialize message from worker: "+n+", "+(r&&r.message))}if(o.worker){var a=t._workers[o.worker];if(!a)return;if(a.onConnected)a.onConnected(e);else if(process.env.quokka&&a.instance){if(a.instance.channel)try{a.instance.channel.close(),a.instance.channel.removeAllListeners()}catch(r){}a.instance.channel=e}try{e.send(JSON.stringify({type:"in:connected"}))}catch(r){console.error('Failed to send the "connected" message to worker. '+r.message)}}else if(o.session){var s=t._sessions[o.session],l=!s||s._disposing||t._cancelled;if("console"===o.type&&o.data){if("debugLog"===o.data.type)return void i(o.data.text);(o.data.spec||process.env.quokka)&&!l||"autoLog"===o.data.type||console.log("console."+o.data.type+": "+o.data.text)}if(l)return;try{s[o.type](o.data)}catch(r){console.error("Failed to process message "+o.type+" from worker, "+(r&&r.message)),s.reject(r)}}})}),e()}catch(r){o(r)}})})},wallabyFileIdPrefix:function(){return u},receiverPort:function(){return this._receiverPort},setFileRoot:function(e){this._fileRoot=this._project.normalizePath(e)},run:function(e){var t=this;return t._cancelled=!1,t._executedTestNumber=0,t._runPriority=e.priority,e.recycleBeforeRun&&_.each(t._workers,function(e,n){t.recycleWorker(n)}),i("Starting test run, priority: "+t._runPriority),(e.fullRun&&t._maxWorkers>1&&e.testFilesToLoad.length>1?t._runInParallel(e,t._maxWorkers):t._minWorkers>1&&e.testFilesToLoad.length>1&&!(e.fullRun&&t._maxWorkers<t._minWorkers)?t._runInParallel(e,t._minWorkers):t._extension.prepare(e,0).then(function(e){
return t._runTests(e)})).then(function(e){return t._executedTestNumber&&console.log("Finished executing "+t._executedTestNumber+" affected test(s)"),Q.when(e)})},_handleError:function(e,t,n,o,r,a,s){var l=this;a===s&&(a=s=void 0),i("Sandbox (%s) [%s] error: %s",e.active()?"active":"inactive",t,n);var c=l._reportableError(n,o),p="SyntaxError: Parse error"===n&&_.isEmpty(o);if(l._corruptedCache(c))return l._project.invalidateCache(),e.reject(new Error(h)),void e.recycleWorker();if(process.env.quokka?i("Runtime error: "+c):console.error("Runtime error: "+c),e.active()){if(e.scheduleCompleteIfNotActiveFor(100),!o)return void e.reject(new Error(n));if(!p)try{var d={message:n,stack:_.isString(o)?o:_.reduce(o,function(e,t){return e+t.file+":"+t.line+"\n"},""),external:!0,actual:a,expected:s},u=[d];l._processTestLog(u),d.stack&&d.stack.length||(~d.message.indexOf("Cannot find module")||(d.message=c),d.stack=[]),!r&&e._executingTest?e.addToTestLog(d):e._globalErrors.push(d)}catch(m){e.reject(new Error(n+", "+(m&&m.message)))}}},_runTests:function(e){var t=this;if(t.cancelled())return Q.reject({runCancelled:!0});i("[%s] Running tests in sandbox",e.name);var n=e.sessionId,o=e.workerId;return Q.promise(function(r,a){t.cancelled()&&a({runCancelled:!0});try{var s=function(){var i=t._createSession(n,o,e.instance,r,a);e.instance.start(function(e){return t.cancelled()?(i.reject({runCancelled:!0}),!1):"success"===e||(i.reject(new Error("Sandbox load failed, status: "+e)),!1)},function(e,o,r,a){t._handleError(i,n,e,o,!1,r,a)})},l=t._workerPendingCleanup[o];l?(i("[%s] Sandbox is waiting for worker cleanup",n),l.onDone=function(e){return t.cancelled()?(i("[%s] Sandbox run is canceled while it was waiting for worker cleanup",n),a({runCancelled:!0})):e?(i("[%s] Sandbox worker requires recycling",n),a({runCancelled:!0,rerun:!0})):void s()}):s()}catch(c){a(c)}}).then(function(e){if(e.session){var n=e.session,i=t._createRunResult(n,e.time);return _.each(_.keys(n),function(e){e&&"_"===e[0]&&!_.isFunction(n[e])&&"_disposing"!==e&&delete n[e]}),delete e.session,Q.when(i)}return Q.when(e)})},_createRunResult:function(e,t){var n=this,i=e._coverage,o=e._loadingSequence,r=e._tests,a=e._log,s=e._globalErrors.concat(e._executingTestLog);return _.each(s,function(e){return n._removeAnsi(e)}),s.length||(s=void 0),{coverage:i,tests:r,log:a,globalErrors:s,loadingSequence:o,time:t}},_removeAnsi:function(e){return!s.hasAnsi(e.message)||s.hasAnsi(e.actual)||s.hasAnsi(e.expected)||(e.message=s.removeAnsi(e.message)),e},_reportableError:function(e,t){var n=this;if(_.isString(t)){var i={stack:t};return n._project._cleanStack(i),t=i.stack}return e},cancel:function(e){var t=this;if(!_.isEmpty(t._sessions))return e>=t._runPriority&&(_.each(t._sessions,function(e){e.reject({runCancelled:!0})}),t._cancelled=!0,i("Cancelling test run, cancel requester priority: %s, current run priority: %s",e,t._runPriority),!0)},cancelled:function(){return this._cancelled},_createSession:function(e,t,n,o,r){var a=this;return a._sessions[e]={_coverage:{},_tests:[],_loadingSequence:{},_log:[],_executingTestLog:[],_globalErrors:[],_total:0,_skipped:0,_disposing:!1,_exceededMaxTestAllowedLogLimit:!1,_onFinished:n.closing,_messagesPerTest:{},_closeByErrorTimeout:0,_longRunningWarningTimeout:0,_longRunningPingTimeout:0,_executingFiles:{},_executingTest:void 0,started:function(t){var n=this;i("[%s] Loaded %s test(s)",e,t.total),this._total=t.total,_.each(t.loadingSequence,function(e){e.length>1&&(n._loadingSequence[e[0]]=e.slice(1))})},active:function(){return!this._disposing&&!a._cancelled},scheduleCompleteIfNotActiveFor:function(e){var t=this;clearTimeout(t._closeByErrorTimeout),t._closeByErrorTimeout=setTimeout(function(){t.complete()},e)},addToTestLog:function(e){var t=this._executingTestLog[this._executingTestLog.length-1];t&&this._areLogEntryMessagesEqual(t.message||void 0,e.message||void 0)&&t.stack&&e.stack&&t.stack.length>0&&e.stack.length>0&&_.isEqual(e.stack[0],t.stack[0])?e.stack.length>t.stack.length&&(t.stack=e.stack):this._executingTestLog.push(e)},_areLogEntryMessagesEqual:function(e,t){return void 0===e&&(e=""),void 0===t&&(t=""),e===t||(a._opts.testFramework&&a._opts.testFramework.version&&0===a._opts.testFramework.version.indexOf("mocha")?e.indexOf(":")>0&&_.contains(e,t)||t.indexOf(":")>0&&_.contains(t,e):void 0)},intermediateComplete:function(){a.reportIntermediateResult&&a.reportIntermediateResult(a._createRunResult(this))},complete:function(t){var n=this;clearTimeout(this._closeByErrorTimeout),clearTimeout(this._longRunningWarningTimeout),clearTimeout(this._longRunningPingTimeout),n._onFinished(),this._dispose(function(){a._cancelled?r({runCancelled:!0}):o({session:n,time:t&&t.time})}),i("[%s] Run %s test(s), skipped %s test(s)",e,this._tests.length-this._skipped,this._skipped)},globalError:function(t){a._handleError(this,e,t.message,t.stack,t.declaration,t.actual,t.expected)},programScopeStart:function(e){this._executingFiles[e]=1,this._setTimeoutForLongRunningOperation()},programScopeEnd:function(e){delete this._executingFiles[e],_.isEmpty(this._executingFiles)&&!this._executingTest&&(clearTimeout(this._longRunningWarningTimeout),clearTimeout(this._longRunningPingTimeout))},preTest:function(e){this._setTimeoutForLongRunningOperation(),this._executingTest=e},postTest:function(){delete this._executingTest},_setTimeoutForLongRunningOperation:function(){if(!process.env.quokka){var e=this;clearTimeout(this._longRunningWarningTimeout),clearTimeout(this._longRunningPingTimeout),this._longRunningWarningTimeout=setTimeout(function(){var t="Some long running code has been detected: ",i=e._executingTest,o=!_.isEmpty(e._executingFiles);if(t+=(i?'test "'+i+'"':"one of your "+(o?"files":"tests"))+" is taking more than "+p+"ms to execute.",o&&(t+="\nExecution of the following files has started but has not finished:",_.each(e._executingFiles,function(e,n){var i=a._project._getFileMetadataById(n);t+="\n- "+(i?i.path:"unknown")})),e._log.length&&(t+="\nThe last recorded console.log: "+_.last(e._log).text),i||o){t+="\nTry commenting out the test or excluding the test file from the `tests` list in your wallaby config,\nand restarting wallaby to make sure that it is this test/file causing the issue and not something else.",i&&(t+="\nAlso review your recent changes to the code that the test covers, as well as its `before` and `after` hooks."),t+="\nPinging test runner sandbox...";try{n.ping(function(){clearTimeout(e._longRunningPingTimeout),e.active()&&console.warn("Sandbox is responsive. The issue may have the asynchronous nature, like a missing callback.")}),e._longRunningPingTimeout=setTimeout(function(){console.warn("The sandbox is not responsive. Check for possibly recently introduced infinite loops.")},d)}catch(r){t+="\nThe sandbox ping failed: "+r.message}}console.warn(t)},p)}},module:function(e){a._project._emitInternal({type:"moduleLoaded",path:e.path,session:this})},test:function(t){var n=this;return delete this._executingTest,clearTimeout(this._closeByErrorTimeout),this._setTimeoutForLongRunningOperation(),t.hook&&t.log?(a._processTestLog(t.log),_.isString(t.hook)&&_.each(t.log,function(e){e.message=t.hook+(e.message?": ":"")+e.message}),void(this._globalErrors=this._globalErrors.concat(t.log))):(t.skipped?(this._skipped++,a._processTestLog(t.log)):(i("[%s] Test executed: "+t.name,e),a._processTestLog(t.log),t.log&&_.each(t.log,function(e){return n.addToTestLog(e)}),this._executingTestLog.length&&(t.log=this._executingTestLog.slice()),_.isUndefined(t.slow)&&(t.slow=t.time>a._opts.slowTestThreshold),t.slow=t.slow||void 0,this._executingTestLog.length=0,++a._executedTestNumber%50||console.log("Execution progress: "+a._executedTestNumber+" tests")),void this._tests.push(t))},coverage:function(e){this._coverage[e.id]=e.ranges},console:function(e){var t=a._opts.maxConsoleMessagesPerTest,n=this._messagesPerTest[e.spec]=(this._messagesPerTest[e.spec]||0)+1;n===t+1?console.warn("Number of console messages per test exceeded maximum allowed value ("+t+"), current test console messages recording stopped.\nYou may increase the limit by adding `maxConsoleMessagesPerTest` setting to your config file."):n<=t&&this._log.push(e),a.reportConsoleOutput(e)},resume:function(){i("Sandbox requested early screen shot capture"),this._onFinished(),this._onFinished=_.noop,n.resume()},reject:function(e){this._disposing||this._dispose(function(){r(a._cancelled?{runCancelled:!0}:e)})},recycleWorker:function(){a.recycleWorker(t)},_dispose:function(o){this._disposing=!0,clearTimeout(this._closeByErrorTimeout),clearTimeout(this._longRunningWarningTimeout),clearTimeout(this._longRunningPingTimeout);var r=a._workerPendingCleanup[t]={},s=!1,l=!1,c=function(n){l=!0,s&&clearTimeout(s),delete a._sessions[e],r.onDone&&r.onDone(n),delete a._workerPendingCleanup[t],o()},p=function(){l||(i("[%s] Sandbox is not responsive, recycling worker instance",e),a._tryClosingSandbox(n.close,e),a.recycleWorker(t),c(!0))};try{n.ping(function(){l||(i("[%s] Sandbox is responsive, closing it",e),a._tryClosingSandbox(n.close,e),c())})}catch(d){return i("[%s] Sandbox can not be pinged: %s",e,d&&d.message),void p()}s=setTimeout(function(){p()},1e3)}}},_tryClosingSandbox:function(e,t){try{e()}catch(n){i("[%s] Sandbox closing error, %s",t,n.message)}},_corruptedCache:function(e){return e&&e.match(/evaluating '[a-z]\.\$_\$coverage\[/)},_processTestLog:function(e){var t=this,n=u.length;_.each(e,function(e){var o=e.message&&e.message.indexOf(" in file:///")||-1;if(~o&&(e.message=e.message.substring(0,o)),t._corruptedCache(e.message)&&(t._project.invalidateCache(),e.message=h),t._removeAnsi(e),e.stack&&_.isString(e.stack)){var r,a,l=[],c={},p=e.stack.split("\n");p&&t._corruptedCache(p[0])&&(t._project.invalidateCache(),e.message=h),_.each(p,function(e){var i=e.lastIndexOf(u);if(~i){var o=e.substr(i+n).split(":");o.length>=2&&(r=t._project.stackEntryByFileId(parseInt(o[0],10)||o[0],parseInt(o[1],10)),r&&r.line&&(a=t._extractBrowserStackLineContext(e),a&&(c[l.length]=a),l.push([r.file,r.line])))}else if(process.env.quokka){if(process.env.quokka)if(e=t._project.normalizePath(e),_.contains(e,t._normalizedWallabyServerPath)){if(_.contains(e,"quokkaStackTraceMarker"))return!1}else{var p,d,h=e;e=e.replace(t._normalizedLocalRoot,".");var m=h!==e?h.lastIndexOf(t._normalizedLocalRoot):e.lastIndexOf("(")+1;if(w=h!==e?e.substr(m).split(":"):e.substring(m,e.lastIndexOf(")")-1).split(":"),3===w.length){a=t._extractNodeStackLineContext(e,m);var f=parseInt(w[1],10);r=t._project.stackEntryByFilePath(t._project.normalizePath(s.isLevelUpRelativePath(w[0])?w[0]:_.ltrim(w[0],"./")),f),r&&r.line?(p=r.file,d=r.line):(p=w[0],d=f),a&&(c[l.length]=a),l.push([p,d])}}}else{e=t._project.normalizePath(e);var S=t._fileRoot?e.lastIndexOf(t._fileRoot):-1;if(~S){var w=_.rtrim(e.substr(S+t._fileRoot.length),")").split(":");3!==w.length&&2!==w.length||(r=t._project.stackEntryByFilePath(t._project.normalizePath(_.ltrim(w[0],"/")),parseInt(w[1],10)),r&&r.line&&(a=t._extractNodeStackLineContext(e,S),a&&(c[l.length]=a),l.push([r.file,r.line])))}}}),l.length||i("Failed to map the stack to user code, entry message: %s, stack: %s",e.message&&e.message.substring(0,1024),e.stack.substring(0,1024)),e.message=t._project._cleanMessage(e.message),"node"===t._project.settings().env.type&&~e.message.indexOf("Cannot find module")&&(e.message=t._project._cleanMessage(e.message,t._project._root)),e.stack=l,_.isEmpty(c)||(e.context=c)}process.env.quokka&&e.message&&(e.message=e.message.replace(t._normalizedLocalRoot,".").replace(t._project._localRoot,"."))})},_extractNodeStackLineContext:function(e,t){if(t>4&&"("===e[t-1]){var n=e.substr(0,t-2)||"";return n.split("at ")[1]}},_extractBrowserStackLineContext:function(e){var t=e.split(" (http");return t.length>=2?(t[0]||"").split("at ")[1]:(t=e.split("@http"),t.length>=2?t[0]:void 0)},_runInParallel:function(e,t){var n=this,o=e.testFilesToLoad,r={};i("Distributing tests between %s workers",t);for(var a=0;a<t;a++){var s=_.omit(e,"testFiles");s.testFilesToLoad=[],r[a]={opts:s,workerId:a,ranges:0}}return _.each(o,function(e){var t=_.sortBy(r,function(e){return e.ranges})[0];t.opts.testFilesToLoad.push(e),t.ranges+=e.rangesLength}),i("Running tests in parallel"),Q.all(_.chain(r).filter(function(e){return e.ranges}).map(function(e){return n._extension.prepare(e.opts,e.workerId).then(function(e){return n._runTests(e)})}).value()).then(function(e){i("Merging parallel test run results");var t=_.reduce(e,function(e,t){e.runCancelled=t.runCancelled||e.runCancelled,e.tests=e.tests.concat(t.tests||[]),e.log=e.log.concat(t.log||[]),e.globalErrors=e.globalErrors.concat(t.globalErrors||[]),e.error=t instanceof Error||e.error,e.loadingSequence=_.extend(e.loadingSequence,t.loadingSequence||{});var n=e.coverage;return _.isEmpty(n)?(e.coverage=t.coverage,e):(_.each(t.coverage,function(e,t){var i=n[t];return i?void _.each(e,function(e,t){var n=i[t];return n?void _.extend(n,e):void(i[t]=e)}):void(n[t]=e)}),e)},{coverage:{},tests:[],log:[],globalErrors:[],loadingSequence:{}});return t.runCancelled?Q.reject(t):t.error?Q.reject(t.error):Q.when(t)})},getWorker:function(e){var t=this,n=t._workers[e];return n||(n=t._workers[e]={id:e,promise:Q.promise(function(n,o){var r=t._workers[e];if(r)if(r.instance){if(t._extension.healthy(r.instance))return void n(r);i("Found inactive run worker instance #%s, recycling",e),t.recycleWorker(e)}else if(r.promise)return r.promise;i("Starting run worker instance #"+e);try{t._extension.create(e,function(r){if(!r)return void o(new Error("Failed to create worker instance"));var a=t._workers[e]=t._workers[e]||{id:e};if(r.onConnected){a.onConnected=_.bind(r.onConnected,a),delete r.onConnected;var s,l;a.promise=Q.promise(function(e,t){s=e,l=t});var c=!1,p=setTimeout(function(){if(!c){d();var n=t._workers[e];n&&n._connected?t._extension.recycle(r):t.recycleWorker(e),i("Worker is not created in time, recycling it"),l&&l({runCancelled:!0,rerun:!0}),o({runCancelled:!0,rerun:!0})}},1e4),d=function(){c=!0,clearTimeout(p)},u=t._connectingWorkers[e];u&&t._extension.recycle(u),t._connectingWorkers[e]=r,a.onConnected(function(o){delete t._connectingWorkers[e],c||(d(),i("Started run worker instance (delayed) #"+e),a.instance=r,a._connected=!0,r.channel=o,a.promise=Q.when(r),s&&s(r),n(r))})}else i("Started run worker instance (immediate) #"+e),a.instance=r,a.promise=Q.when(r),n(r)})}catch(a){o(a)}})}),n.promise},reportConsoleOutput:function(e){},recycleWorker:function(e){var t=this;try{var n=t._workers[e];n&&n.instance&&t._extension.recycle(n.instance)}catch(o){i("Error while recycling run worker instance #%s: %s",e,o&&(o.stack||o.message))}finally{delete t._workers[e],delete t._workerPendingCleanup[e]}},stop:function(){var e=this;_.each(e._workers,function(t,n){e.recycleWorker(n)});try{e._wss&&e._wss.close()}catch(t){}try{e._httpServer&&e._httpServer.close()}catch(t){}},_calculateNumberOfParallelWorkers:function(){var e=this;e._maxWorkers=Math.max(1,e._opts.workers.initial||Math.max(o.cpus().length-2,2)),c&&!e._opts.workers.initial&&"phantomjs"===e._opts.env.kind&&(e._maxWorkers=Math.min(16,e._maxWorkers)),e._minWorkers=Math.max(1,e._opts.workers.regular||Math.max(Math.floor(e._maxWorkers/2),2)),i("Parallelism for initial run: %s, for regular run: %s",e._maxWorkers,e._minWorkers)}},t.exports=m},{"./utils":15,debug:void 0,http:void 0,os:void 0,path:void 0,ws:void 0}],15:[function(e,t,n){var i=e("path"),o=/^\s*(\/\*\*?(.|\r?\n)*?\*\/)/,r=/^\s*/,a=/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-PRZcf-nqry=><]/g;t.exports={randomId:function(){return Math.random().toString(36).substr(2,5)},noopTrue:function(){return!0},noopTruePromise:function(){return Q.fcall(this.noopTrue)},isPatch:function(e){return e&&e.length>2&&"@"===e[0]&&"@"===e[1]},isLevelUpRelativePath:function(e){return e&&"."===e[0]&&"."===e[1]},docBlockComment:function(e){var t=e.match(o);return t?t[0].replace(r,"")||"":""},textIndexPosition:function(e,t){var n=this.textLines(e,t);return{line:n.length,column:n[n.length-1].length}},textLines:function(e,t){return e=_.isUndefined(t)?e:e.substr(0,t),e.split(/\r\n|\r|\n/)},verifyLocalOrigin:function(t,n){if(!t)return!0;var i=!1;try{var o=e("url").parse(t).hostname;i="localhost"===o||"0.0.0.0"===o||"127.0.0.1"===o||"::1"===o}catch(r){}return i||n||console.error("wallaby.js refused to accept connection from "+t),i},patchModule:function(t,n){var i=e("module").Module.prototype,o=i.require;i.require=function(e){return e===t?n(o.bind(this)):o.call(this,e)}},requireModuleFrom:function(t,n){try{return e(i.join(t,"node_modules",n))}catch(o){var r=e("module"),a=new r(".",null);return a.filename=i.join(t,"wallaby.js"),a.paths=r._nodeModulePaths(t),r._load(n,a,!1)}},resolveModulePathFrom:function(t,n){var o=e("module"),r=new o(".",null);return r.filename=i.join(t,"wallaby.js"),r.paths=o._nodeModulePaths(t),o._resolveFilename(n,r,!1)},nodeModulesLookup:function(t,n){var i=e("module").Module,o=i.prototype,r=i._nodeModulePaths,a=o.require;i._nodeModulePaths=function(e){var n=r.call(this,e);return t(n,e,r,this),n},n&&(o.require=function(e){return a.call(this,n(e))})},nodeModulePaths:function(t){var n=e("module");return n._nodeModulePaths(t)},patchBabelResolve:function(e){var t=this.nodeModulePaths(e);this.patchModule("resolve",function(e){var n=e("resolve"),i=n.sync;return n.sync=function(e,n){return~e.indexOf("babel")&&n&&(arguments[1].paths=(n.paths||[]).concat(t)),i.apply(this,arguments)},n})},hasAnsi:function(e){return e&&"string"==typeof e&&e.match(a)},removeAnsi:function(e){return e&&"string"==typeof e?e.replace(a,""):e},copyToClipboard:function(t){var n=function(e){return e&&console.warn("Failed to copy to clipboard. "+(e&&e.message))};try{e("copy-paste").copy(t,n)}catch(i){n(i)}},initServerOptions:function(t){var n=e("graceful-fs"),i=e("fs-extra");t.runnerResolver=function(t,n){return e("browser"===t?"electron"===n?"./electronRunner.js":"chrome"===n?"./chromeRunner.js":"./phantomRunner.js":"./nodeRunner.js")},t.processorPool=e("./processPool"),t.fileStructureCachePromise=function(e){return Q.nfcall(n.readFile,e).then(function(e){return Q.when(JSON.parse(e))})},t.fileStatPromise=function(e){return Q.nfcall(n.stat,e)},t.readFilePromise=function(e){return Q.nfcall(n.readFile,e)},t.writeFilePromise=function(e,t){return Q.nfcall(n.writeFile,e,t)},t.unlinkFilePromise=function(e){return Q.nfcall(n.unlink,e)},t.unlinkFileSync=function(e){return n.unlinkSync(e)},t.writeFileSync=function(e,t){return n.writeFileSync(e,t)},t.readFileSync=function(e){return n.readFileSync(e).toString("utf8")},t.fileExistsSync=function(e){return n.existsSync(e)},t.realpathSync=function(e){return n.realpathSync(e)},t.dirRemovePromise=function(e){return Q.nfcall(i.remove,e)},t.dirRemoveSync=function(e){return i.removeSync(e)},t.dirEnsurePromise=function(e){return Q.nfcall(i.ensureDir,e)},t.dirEnsureSync=function(e){return i.ensureDirSync(e)},t.nodeModulesLookup=this.nodeModulesLookup}}},{"./chromeRunner.js":3,"./electronRunner.js":5,"./nodeRunner.js":11,"./phantomRunner.js":12,"./processPool":13,"copy-paste":void 0,"fs-extra":void 0,"graceful-fs":void 0,module:void 0,path:void 0,url:void 0}]},{},[1]);