/*
 * Wallaby.js - v1.0.654
 * https://wallabyjs.com
 * Copyright (c) 2014-2019 Wallaby.js - All Rights Reserved.
 *
 * This source code file is a part of Wallaby.js and is a proprietary (closed source) software.

 * IMPORTANT:
 * Wallaby.js is a tool made by software developers for software developers with passion and love for what we do.
 * Pirating the tool is not only illegal and just morally wrong,
 * it is also unfair to other fellow programmers who are using it legally,
 * and very harmful for the tool and its future.
 */
!function e(t,n,i){function o(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(r)return r(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var p=n[a]={exports:{}};t[a][0].call(p.exports,function(e){var n=t[a][1][e];return o(n?n:e)},p,p.exports,e,t,n,i)}return n[a].exports}for(var r="function"==typeof require&&require,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();t.exports=function(e){return function(t){function n(e){var t=e.input;c.lastIndex=e.pos;var n=c.exec(t)[0];return e.input[e.pos+n.length]}function o(e){var t=e.startNode(),n=e.start,i=e.startLoc,o=e.startNode(),r=e.parseExprAtom();e.expect(l.parenL),o.arguments=[e.parseMaybeAssign()],o.callee=r,e.finishNode(o,"CallExpression"),e.expect(l.parenR);var a=e.parseSubscripts(o,n,i);return e.parseExpressionStatement(t,a)}function r(e){var t=e.startNode(),n=e.parseMaybeAssign();return e.parseExpressionStatement(t,n)}function a(e){var t=e.startNode();return e.expect(l._import),e.finishNode(t,"Import")}function s(e){var t=e.startNode();return t.meta=e.parseIdent(!0),e.expect(l.dot),t.property=e.parseIdent(!0),"meta"!==t.property.name&&e.raise(t.property.start,"The only valid meta property for 'import' is 'import.meta'"),e.finishNode(t,"MetaProperty")}var l=e.tokTypes,c=/(?:\s|\/\*[^]*?\*\/|\/\/.*)*/g;return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.parseStatement=function(){if(this.type===l._import){var t=n(this);if(t===l.dot.label)return r(this);if(t===l.parenL.label)return o(this)}return e.prototype.parseStatement.apply(this,arguments)},t.prototype.parseExprAtom=function(){if(this.type===l._import){var t=n(this);if(t===l.dot.label)return s(this);if(t===l.parenL.label)return a(this);this.unexpected()}return e.prototype.parseExprAtom.apply(this,arguments)},t}(t)}}},{}],2:[function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();t.exports=function(e){return function(t){var n=e.tokTypes;return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.checkLVal=function(t,n,i){switch(t.type){case"ObjectPattern":for(var o=0;o<t.properties.length;o++){var r=t.properties[o];"Property"===r.type&&(r=r.value),"SpreadProperty"!==r.type&&this.checkLVal(r,n,i)}break;case"RestProperty":this.checkLVal(t.argument,n,i);break;default:e.prototype.checkLVal.call(this,t,n,i)}},t.prototype.parseObj=function(e,t){var i=this.startNode(),o=!0,r={};for(i.properties=[],this.next();!this.eat(n.braceR);){if(o)o=!1;else if(this.expect(n.comma),this.afterTrailingComma(n.braceR))break;var a,s,l,c,p=this.startNode();if(this.options.ecmaVersion>=6){if(this.type===n.ellipsis){p=this.parseSpread(),p.type=e?"RestProperty":"SpreadProperty",i.properties.push(p);continue}p.method=!1,p.shorthand=!1,(e||t)&&(l=this.start,c=this.startLoc),e||(a=this.eat(n.star))}this.parsePropertyName(p),e||!(this.options.ecmaVersion>=8)||a||p.computed||"Identifier"!==p.key.type||"async"!==p.key.name||this.type===n.parenL||this.type===n.colon||this.canInsertSemicolon()?s=!1:(s=!0,this.parsePropertyName(p,t)),this.parsePropertyValue(p,e,a,s,l,c,t),this.checkPropClash(p,r),i.properties.push(this.finishNode(p,"Property"))}return this.finishNode(i,e?"ObjectPattern":"ObjectExpression")},t.prototype.toAssignable=function(t,n){if(this.options.ecmaVersion>=6&&t)switch(t.type){case"AssignmentPattern":break;case"Property":this.toAssignable(t.value,n);break;case"SpreadProperty":t.type="RestProperty";break;case"ObjectExpression":t.type="ObjectPattern";for(var i=0;i<t.properties.length;i++){var o=t.properties[i];"SpreadProperty"!==o.type&&("init"!==o.kind&&this.raise(o.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(o.value,n))}break;default:e.prototype.toAssignable.call(this,t,n)}return t},t}(t)}}},{}],3:[function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();t.exports=function(e){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.isDirectiveCandidate=function(){return!1},t.prototype.strictDirective=function(){return!1},t.prototype.canDeclareLexicalName=function(){return!0},t.prototype.canDeclareVarName=function(){return!0},t.prototype.isSimpleParamList=function(){return!0},t.prototype.adaptDirectivePrologue=function(){},t.prototype.checkParams=function(){},t.prototype.checkPatternErrors=function(){},t.prototype.checkPatternExport=function(){},t.prototype.checkPropClash=function(){},t.prototype.checkVariableExport=function(){},t.prototype.checkYieldAwaitInDefaultParams=function(){},t.prototype.declareLexicalName=function(){},t.prototype.declareVarName=function(){},t.prototype.enterFunctionScope=function(){},t.prototype.enterLexicalScope=function(){},t.prototype.exitFunctionScope=function(){},t.prototype.exitLexicalScope=function(){},t.prototype.invalidStringToken=function(){},t}(e)}},{}],4:[function(e,t,n){"use strict";var i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();t.exports=function(e){return function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.parseMaybeUnary=function(){return this.isContextual("await")?this.parseAwait():e.prototype.parseMaybeUnary.apply(this,arguments)},t}(e)}},{}],5:[function(e,t,n){e("./global"),process.on("uncaughtException",function(t){if(!(t&&"spawn"===t.syscall&&"OK"===t.code||(t&&t.message&&_.isString(t.message)&&0===t.message.indexOf("payload cannot exceed")&&(t.stack="One of the files specified in your `files`/`tests` list is too large, "+t.stack),t&&t.message&&_.isString(t.message)&&~t.message.indexOf("EADDRINUSE")&&~t.message.indexOf("51245")))){try{if(t instanceof Error){var n=e("path").dirname(process.mainModule.filename);t.stack=_.filter(t.stack.split("\n"),function(e,t){return!t||!_.contains(e,n)}).join("\n")}}catch(i){}console.error(t instanceof Error?t.stack:util.inspect(t))}}),t.exports={start:function(t){t.onConnected=function(n){t.Project=e("./project"),t.diffMatchPatch=new(e("./diffMatchPatch"));var i=new t.Receiver(t),o=process.exit,r=function(){i.stop(),console.log("wallaby.js stopped"),o.apply(process,arguments)},a=process.exit=function(){r.apply(null,arguments)};return process.on("SIGINT",function(){a.apply(null,arguments)}),i.on("message",function(e){!e._internal&&n.send(e)}),n.receive=function(e){var t="unknown";try{if(t=e.type,!("string"==typeof t&&t.length>0&&"_"!==t[0]))throw new Error("Incorrect incoming message format");var n=i[t](e);n&&n["catch"]&&n["catch"](function(e){e.noDetails?console.error(e.message):console.error("Failed to execute "+t+" operation, "+e.stack)})}catch(o){console.error("Failed to start "+t+" operation, "+o.stack)}},i.configure(),i}}}},{"./diffMatchPatch":11,"./global":14,"./project":22,path:void 0}],6:[function(e,t,n){"use strict";var i,o,r=e("path"),a=e("semver"),s=e("./utils"),l="5.0.9",c="7.0.0-beta.0",p=!0,d="babel",u="babel-core",h="@babel/core",m=function(){function e(e,t,n){var r=this;_.isEmpty(e)||e.babelrc||(e.babelrc=!1),this._opts=_.extend({filename:t},e||{}),!this._opts.filename&&t&&(this._opts.filename=t),this._opts.filenameRelative||delete this._opts.filenameRelative,this._opts.sourceMaps=this._opts.sourceMap=!0,a.valid(i.version)&&a.gte(i.version,c)&&delete this._opts.sourceMap,this._opts.retainLines=this._opts.retainLines||!1,this._opts.compact=this._opts.compact||!1,this._opts.comments=this._opts.comments!==!1,_.isString(this._opts.plugins)&&(this._opts.plugins=[this._opts.plugins]),this._opts.plugins=(this._opts.plugins||[]).slice(),this._opts.plugins.unshift(new o("wallaby.js",{Statement:function(e){switch(e.type){case"DoWhileStatement":case"WhileStatement":case"IfStatement":case"ForStatement":e.test&&r._pushRange(e.test.loc);break;case"ForOfStatement":case"ForInStatement":e.right&&r._pushRange(e.right.loc);break;case"SwitchStatement":r._pushRange(e.discriminant.loc);break;case"BreakStatement":case"ContinueStatement":case"ThrowStatement":case"VariableDeclaration":case"ExpressionStatement":case"ReturnStatement":r._pushRange(e.loc)}},ArrowFunctionExpression:function(e){e.body&&"BlockStatement"!==e.body.type&&r._pushRange(e.body.loc)},LogicalExpression:function(e){r._pushRange(e.left.loc),r._pushRange(e.right.loc)},ConditionalExpression:function(e){r._pushRange(e.consequent.loc),r._pushRange(e.alternate.loc)}})),n&&(this._opts.presets=(this._opts.presets||[]).slice(),this._opts.presets.push(n))}return e.prototype._pushRange=function(e){e&&this._ranges.push([e.start.line,e.start.column,e.end.line,e.end.column])},e.prototype.run=function(e){this._ranges=[];var t=i.transform(e.content,this._opts);return"ts"!==e.type&&"tsx"!==e.type||!p||e.changeExt("js"),{map:t.map,code:t.code,ranges:this._ranges}},e}();t.exports=function(t){return function(n){if(n=n||{},process.env.BABEL_ENV&&"undefined"!==process.env.BABEL_ENV||(process.env.BABEL_ENV="test"),s.patchModule("test-exclude",function(){return function(){return{shouldInstrument:_.noop}}}),n.babel)i=n.babel;else{var c=function(){throw new Error("babel, babel-core or @babel/core must be installed locally or babel instance must be passed in opts.babel, for example `wallaby.compilers.babel({ babel: require('@babel/core') })`")};try{var f=e(r.join(t,"package.json")),S=_.find([h,u,"babel-cli",d],function(e){return f.devDependencies[e]||f.dependencies[e]});"babel-cli"===S?i=s.requireModuleFrom(r.join(t,"node_modules/babel-cli"),u):S&&(i=s.requireModuleFrom(t,S))}catch(w){}if(!i)try{i=s.requireModuleFrom(t,h)}catch(v){try{i=s.requireModuleFrom(t,u)}catch(g){try{i=s.requireModuleFrom(t,d)}catch(y){c()}}}}return a.valid(i.version)&&a.lt(i.version,l)?void console.error("Babel version for compiler must be >= "+l):(o=i.Transformer||function(e,t){return _.each(t,function(e,n){t[n]=function(t){return e(t.node)}}),{visitor:{Program:function(e){e.traverse(t)}}}},p=n.renameTypeScriptFiles!==!1,delete n.babel,delete n.renameTypeScriptFiles,function(e){var t=e.additionalPreset;return delete e.additionalPreset,new m(n,e.path,t).run(e)})}}},{"./utils":31,path:void 0,semver:void 0}],7:[function(e,t,n){var i,o=e("path"),r=e("graceful-fs"),a=e("express"),s=e("compression"),l=r.readFileSync(o.join(__dirname,"runners","browser","sandbox.html")).toString(),c="__wallaby__",p=e("./fileCacheMiddleware"),d=function(t,n){var r=this;i=e("debug")("wallaby:browserRunner"),r._project=t,r._workerPool=n,r._baseDir=r._project._instrumentedRoot+o.sep,r._initializer=t.settings().bootstrap,r._reportUnhandledPromises=!!t.settings().reportUnhandledPromises,r._sandboxHtml={},r._report404AsError=t.settings().env.report404AsError,r._lruCache=r._project._lruCache,r._wallabyFileIdPrefix=r._workerPool.wallabyFileIdPrefix(),r._app=a(),r._app.use(s({filter:function(e){return~e.url.indexOf("____wallaby-bundle")}})),r._app.use("/wallaby_sandbox:id.html",function(e,t){t.send(r._sandboxHtml[e.params.id])}),t.settings().testFramework.path&&r._app.use("/"+c+"/"+t.settings().testFramework.version+"/framework.js",p.create(o.join(t._localRoot,t.settings().testFramework.path))),r._app.use("/"+c+"/tracer.js",p.create(o.join(__dirname,"tracer.js"))),r._app.use("/"+c,p.create(o.join(__dirname,"runners","browser"))),t.settings().middleware(r._app,a),r._app.use(p.create(r._baseDir,r._lruCache,r._report404AsError))};d.prototype={prepareSandbox:function(e,t,n){var o=this;e.allFilesHash=_.reduce(e.allFiles.concat(e.allTestFiles),function(e,t){return e[t.normalizedRelativePath]={ts:t.ts,id:t.tmp&&t.originalId?t.originalId:t.id},e},{});var r=e.allFiles.concat(e.allTestFiles),a=e.filesToLoad.concat(e.testFilesToLoad),s=_.reduce(e.testFilesToLoad,function(e,t){return e[t.id]=t,e},{});i("Total files to load in sandbox: "+a.length);var p=o._workerPool.receiverPort();o._anyIncludedEsm=!1,o._sandboxHtml[n]=l.replace("<inject/>",function(){return _.reduce(r,function(e,t){return e+(_.isNumber(t.id)?"file = window.$_$coverage["+t.id+"]=[]; for(i=0, len="+t.rangesLength+"; i < len; i++) file[i] = {};":"")},"<script>(function() {window.$_$receiverPort = "+p+';window.$_$session="'+t+'";window.$_$baseDir='+JSON.stringify(o._baseDir)+";window.$_$initialSpecId="+1e5*(n+1)+";window.$_$reportUnhanledPromises="+o._reportUnhandledPromises+";window.$_$coverage=[]; var file, i, len;")+"window.$_$slow="+o._project.settings().slowTestThreshold+";window.$_$expressionsToEvaluate="+JSON.stringify(e.expressionsToEvaluate)+";window.$_$files="+JSON.stringify(e.allFilesHash)+";window.$_$tests="+(e.tests?JSON.stringify(e.tests):"null")+";window.$_$testFiles="+JSON.stringify(_.chain(e.allTestFiles).filter(function(e){return!e.shadowed}).map(function(t){return{path:t.relativePath,loaded:t.include&&!!s[t.id],id:(e.allFilesHash[t.normalizedRelativePath]||{}).id}}).value())+';})();</script><script src="'+c+'/tracer.js"></script><script src="'+c+"/"+e.framework.version+'/framework.js"></script><script src="'+c+"/"+e.framework.configurator+'/configurator.js"></script><script src="'+c+"/"+e.framework.reporter+'/reporter.js"></script>'+_.reduce(a,function(e,t){o._anyIncludedEsm=o._anyIncludedEsm||t.esm;var n=t.tmp,r=t.ts+(n?t.originalId?o._wallabyFileIdPrefix+t.originalId:"":o._wallabyFileIdPrefix+t.id);switch(t.type){case"js":case"mjs":case"jsx":case"es6":case"es7":return e+"<script "+(t.esm?'type="module"':"")+' src="'+t.normalizedRelativePath+"?"+r+'"></script>';case"html":case"htm":return e+'<link href="'+t.normalizedRelativePath+"?"+t.ts+'" rel="import">';case"css":return e+'<link rel="stylesheet" type="text/css" href="'+t.normalizedRelativePath+"?"+r+'"></link>';default:return i("File type "+t.type+" can not be included via script/link tag into sandbox"),e}},"")+(o._initializer?"<script>("+o._initializer+")(window.wallaby);</script>":"")+"<script "+(o._anyIncludedEsm?'type="module"':"")+' src="'+c+"/"+e.framework.starter+'/starter.js"></script>'});var d=o.sandboxRootUrl()+"wallaby_sandbox"+n+".html";return i("Sandbox is generated [%s]: %s",o.sandboxName(n,t),d),Q.when(d)},doesSandboxContainESModules:function(){return this._anyIncludedEsm},sandboxRootUrl:function(){return this._sandboxRootUrl?this._sandboxRootUrl:(this._sandboxRootUrl="http://localhost:"+this._workerPool.receiverPort()+"/",this._sandboxRootUrl)},webApp:function(){return this._app},sandboxName:function(e,t){return"worker #"+e+", session #"+t}},t.exports=d},{"./fileCacheMiddleware":13,compression:void 0,debug:void 0,express:void 0,"graceful-fs":void 0,path:void 0}],8:[function(e,t,n){var i,o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,r){function a(e){try{l(i.next(e))}catch(t){r(t)}}function s(e){try{l(i["throw"](e))}catch(t){r(t)}}function l(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}l((i=i.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){function n(e){return function(t){return i([e,t])}}function i(n){if(o)throw new TypeError("Generator is already executing.");for(;l;)try{if(o=1,r&&(a=r[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(r,n[1])).done)return a;switch(r=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,r=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){l.label=n[1];break}if(6===n[0]&&l.label<a[1]){l.label=a[1],a=n;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(n);break}a[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(i){n=[6,i],r=0}finally{o=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,r,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},a=e("chrome-launcher"),s=e("chrome-remote-interface"),l=e("./runWorkerPool"),c=e("./browserEnvironment"),p=function(){function t(t){i=e("debug")("wallaby:chromeRunner"),this._screenShotReady=Promise.resolve(),this._project=t;var n=t.settings().env;this._path=n.runner,n.params&&n.params.runner&&(this._flags=n.params.runner.split(" ")),this._chromePromise=this._launchChromeInstance(),this._workerPool=new l(this._project,{create:_.bind(this._create,this),recycle:_.bind(this._recycle,this),healthy:function(){return!0},prepare:_.bind(this._prepareTab,this)}),this._browserEnvironment=new c(t,this._workerPool)}return t.prototype.run=function(e){return this._workerPool.run(e)},t.prototype.cancel=function(e){return this._workerPool.cancel(e)},t.prototype.start=function(){return o(this,void 0,void 0,function(){var e;return r(this,function(t){switch(t.label){case 0:return[4,this._workerPool.start(this._browserEnvironment.webApp())];case 1:return e=t.sent(),this._workerPool.setFileRoot(this._browserEnvironment.sandboxRootUrl()),[2,e]}})})},t.prototype.stop=function(){if(this._workerPool.stop(),this._chrome)try{process.kill(this._chrome.pid)}catch(e){}},t.prototype._create=function(e,t){return o(this,void 0,void 0,function(){return r(this,function(n){switch(n.label){case 0:return[4,this._chromePromise];case 1:return n.sent(),t({workerId:e}),[2]}})})},t.prototype._recycle=function(e){this._closeTab(e)},t.prototype._prepareTab=function(e,t){return o(this,void 0,void 0,function(){var n,o,a,s,l;return r(this,function(r){switch(r.label){case 0:return n=this,o=_.randomId(),a=this._browserEnvironment.sandboxName(t,o),i("Starting sandbox [%s]",a),[4,this._workerPool.getWorker(t)];case 1:return s=r.sent(),this._checkCancelled(),i("Preparing sandbox [%s]",a),[4,this._browserEnvironment.prepareSandbox(e,o,t)];case 2:return l=r.sent(),this._checkCancelled(),i("Prepared sandbox [%s]",a),[2,{name:a,sessionId:o,workerId:t,instance:{resume:function(){n._evaluateOnTab(s.client,function(){$_$tracer.resume()})},ping:function(e){n._evaluateOnTab(s.client,function(){},e)},close:function(){n._closeTab(s)},closing:function(){},start:function(e){n._openTab(s,l,function(t){e(t.status)&&n._evaluateOnTab(s.client,function(){$_$tracer.start()})})}}}]}})})},t.prototype._checkCancelled=function(){if(this._workerPool.cancelled())throw{runCancelled:!0}},t.prototype._connectionOptions=function(e){return void 0===e&&(e={}),_.extend({port:this._chrome.port,host:"127.0.0.1"},e)},t.prototype._evaluateOnTab=function(e,t,n){return void 0===n&&(n=_.noop),o(this,void 0,void 0,function(){var o;return r(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),e.Runtime?[4,e.Runtime.evaluate({expression:"("+t.toString()+")()"})]:[2];case 1:return r.sent(),n(),[3,3];case 2:return o=r.sent(),i("Failed to evaluate code on Chrome Tab: "+o.message),[3,3];case 3:return[2]}})})},t.prototype._openTab=function(e,t,n){return void 0===n&&(n=_.noop),o(this,void 0,void 0,function(){var i,o,a,l,c,p,d,u,h,m,_=this;return r(this,function(r){switch(r.label){case 0:if(r.trys.push([0,18,,19]),!this._chrome)throw new Error("Chrome is not running");return[4,s.New(this._connectionOptions({url:t}))];case 1:return i=r.sent(),e.client={target:{id:i.id}},this._checkCancelled(),[4,s({tab:i})];case 2:o=r.sent(),e.client=o,this._checkCancelled(),a=o.Page,l=o.Network,r.label=3;case 3:return r.trys.push([3,16,,17]),c=!!this._browserEnvironment.doesSandboxContainESModules(),p=[a.enable()],c&&p.push(l.enable()),[4,Promise.all(p)];case 4:if(r.sent(),this._checkCancelled(),!c)return[3,13];l.requestIntercepted(function(e){var t=e.interceptionId,n=e.request;return l.continueInterceptedRequest({interceptionId:t,url:_._updateTrackedFileUrlIfRequired(n.url)})["catch"](function(e){})}),r.label=5;case 5:return r.trys.push([5,7,,12]),[4,o.send("Network.setRequestInterception",{patterns:[{urlPattern:"*"}]})];case 6:return r.sent(),[3,12];case 7:d=r.sent(),r.label=8;case 8:return r.trys.push([8,10,,11]),[4,l.setRequestInterceptionEnabled({enabled:!0})];case 9:return r.sent(),[3,11];case 10:return u=r.sent(),console.warn("Unable to configure network request interception in Chrome"),[3,11];case 11:return[3,12];case 12:this._checkCancelled(),r.label=13;case 13:return[4,a.navigate({url:t})];case 14:return r.sent(),this._checkCancelled(),[4,a.loadEventFired()];case 15:return r.sent(),this._checkCancelled(),n({status:"success"}),[3,17];case 16:return h=r.sent(),this._closeTab(e),n({status:"failed: "+(h.message||"unknown")}),[3,17];case 17:return[3,19];case 18:return m=r.sent(),n({status:"failed: "+(m.message||"unknown")}),[3,19];case 19:return[2]}})})},t.prototype._closeTab=function(e){return o(this,void 0,void 0,function(){var t,n;return r(this,function(o){switch(o.label){case 0:if(!e||!e.client)return[3,5];t=e.client,delete e.client,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,s.Close(this._connectionOptions({id:t.target.id}))];case 2:return o.sent(),[3,4];case 3:return n=o.sent(),i("Failed to close Chrome Tab: "+n.message),[3,4];case 4:try{t.close()}catch(r){i("Failed to close Chrome Tab client: "+r.message)}o.label=5;case 5:return[2]}})})},t.prototype._launchChromeInstance=function(){return o(this,void 0,void 0,function(){var t,n,i,o;return r(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),t=["--headless","--disable-gpu","--deterministic-fetch"],n=e("os"),"Linux"===n.type()&&(t.push("--no-sandbox"),t.push("--disable-setuid-sandbox")),i=this,[4,a.launch({chromeFlags:this._flags||t,chromePath:this._path,logLevel:"silent"})];case 1:return i._chrome=r.sent(),[3,3];case 2:return o=r.sent(),this._handleHostError(o),[3,3];case 3:return[2]}})})},t.prototype._updateTrackedFileUrlIfRequired=function(e){if(!e||~e.indexOf("wallabyFileId")||~e.indexOf("__wallaby__"))return e;var t=e;if(t=t.replace(this._browserEnvironment.sandboxRootUrl(),""),t===e)return e;var n=t.lastIndexOf("?");n>=0&&(t=t.substring(0,n));var i=t&&this._project.getFileMetadataByPath(t);return i?e+(~n?"&":"?")+i.changeTs+"&wallabyFileId="+i.id:e},t.prototype._handleHostError=function(e){e=e||{},this._project._cleanStack(e);var t="Chrome runner error: "+(e.message||"unknown"),n=e.stack||t;console.error(n),this._project._emitTestRunError(t)},t}();t.exports=p},{"./browserEnvironment":7,"./runWorkerPool":23,"chrome-launcher":void 0,"chrome-remote-interface":void 0,debug:void 0,os:void 0}],9:[function(e,t,n){"use strict";var i,o,r,a=e("path"),s={},l={},c=function(){function e(e){var t=this;this._opts=_.extend({},e||{}),this._noRename=this._opts.noFileRename,delete this._opts.noFileRename,this._nodeVisitor("Block",function(e){_.each(e.expressions,function(e){e.expression?t._pushRange(e.expression):t._pushRange(e)})}),this._nodeVisitor("Op",function(e){"&&"!==e.operator&&"||"!==e.operator&&"?"!==e.operator||(t._pushRange(e.first),t._pushRange(e.second))})}return e.prototype._nodeVisitor=function(e,t){if(l[e]=t,!s[e]){var n=i[e].prototype.compileNode;i[e].prototype.compileNode=function(){return l[e](this),n.apply(this,arguments)},s[e]=!0}},e.prototype._pushRange=function(e){if(e){var t=e.locationData;t?this._ranges.push([t.first_line+1,t.first_column,t.last_line+1,t.last_column+1]):e.args&&e.args.length&&this._pushRange(e.args[0])}},e.prototype.run=function(e){this._ranges=[];var t=o.compile(e.content,_.extend({},this._opts,{filename:e.path,sourceMap:!0,literate:r.isLiterate(e.path)}));return this._noRename||e.changeExt("js"),{map:t.v3SourceMap,code:t.js,ranges:this._ranges}},e}(),p=function(t,n){try{i=e(a.join(t,n)),o=e(t)}catch(r){return!1}return!0};t.exports=function(e){var t=Error.prepareStackTrace;return p(a.join(e,"node_modules","coffeescript"),"lib/coffee-script/nodes")||p(a.join(e,"node_modules","coffee-script"),"lib/coffee-script/nodes")||p(a.join(e,"node_modules","coffeescript"),"lib/coffeescript/nodes")||p("coffee-script","lib/coffee-script/nodes"),Error.prepareStackTrace=t,r=o.helpers,function(e){return function(t){return new c(e).run(t)}}}},{path:void 0}],10:[function(e,t,n){"use strict";var i,o=e("path"),r=e("minimatch"),a=e("./utils"),s={node:{"mocha@2.1.0":{},"jest@0.4.3":{},"jasmine@2.3.4":{},"ava@0.3.0":{jsPreprocessor:function(e){return e.replace(/import test from ["|']ava["|']/,'var test = require("ava")')}},"tape@4.2.2":{jsPreprocessor:function(e){return e.replace(/import test from ["|']tape["|']/,'var test = require("tape")')}}},browser:{"jasmine@1.3.1":{},"jasmine@2.1.3":{},"jasmine@2.2.1":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@2.3.4":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@2.4.1":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@2.5.1":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@2.5.2":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@2.6.3":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@2.8.0":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"jasmine@3.2.1":{configurator:"jasmine@2.1.3",reporter:"jasmine@2.1.3",starter:"jasmine@2.1.3"},"mocha@2.0.1":{},"mocha@2.2.4":{configurator:"mocha@2.0.1",reporter:"mocha@2.0.1",starter:"mocha@2.0.1"},"mocha@3.2.0":{configurator:"mocha@2.0.1",reporter:"mocha@2.0.1",starter:"mocha@2.0.1"},"qunit@1.16.0":{},"qunit@1.18.0":{configurator:"qunit@1.16.0",reporter:"qunit@1.16.0",starter:"qunit@1.16.0"},"qunit@2.4.0":{configurator:"qunit@1.16.0",reporter:"qunit@2.4.0",starter:"qunit@1.16.0"}}},l={typeScript:"**/*.ts?(x)",coffeeScript:"**/*.?(lit)coffee?(.md)"},c={files:{ignore:!1,instrument:!0,trigger:!0,load:!0},tests:{ignore:!1,instrument:!0,trigger:!0,load:!0}},p=function(){function t(t,n){var i=o.dirname(t);this._configFile=t,this._root=n,this._builtinCompilers={coffeeScript:e("./coffeeScriptCompiler")(i),babel:e("./babelCompiler")(i),typeScript:function(t){return t&&t.isolatedModules?e("./typeScriptCompiler")(i)(t):{replaceWithPostprocessor:!0,localProjectDir:i,opts:t}}},this._builtinPostprocessors={typeScript:e("./typeScriptPostprocessor")(i)}}return t.prototype.load=function(){var t=this,n=this;if(n._settings)return Q.when(n._settings);var i={localProjectDir:o.dirname(n._configFile)+o.sep,projectCacheDir:n._root,compilers:n._builtinCompilers,postprocessors:n._builtinPostprocessors,defaults:{files:_.extend({},c.files),tests:_.extend({},c.tests)}};return Q.promise(function(t,o){try{var r=e(n._configFile);r&&r.__esModule&&r["default"]&&(r=r["default"]),_.isFunction(r)?2===r.length?r(i,function(e){return t(e)}):t(r(i)):t(r)}catch(a){o(a)}}).then(function(o){if(n._settings=o,!_.isArray(o.files)||!o.files.length)throw new Error("Files property must be non-empty array of files/file patterns");if(!_.isArray(o.tests)||!o.tests.length)throw new Error("Tests property must be non-empty array of test files/file patterns");if(o.filesWithNoCoverageCalculated=o.filesWithNoCoverageCalculated||[],o.runAllTestsInAffectedTestFile=o.runAllTestsInAffectedTestFile||!1,o.compilers=o.compilers||{},!_.isObject(o.compilers))throw new Error("If defined, compilers property must be an object.");if(o.compilers[l.coffeeScript]||(o.compilers[l.coffeeScript]=n._builtinCompilers.coffeeScript()),o.compilers[l.typeScript]||_.find(_.keys(o.compilers),function(e){return r("a.ts",e)})||o.noDefaultTypeScriptCompiler||(o.compilers[l.typeScript]=n._builtinCompilers.typeScript()),o.preprocessors=o.preprocessors||{},!_.isObject(o.preprocessors))throw new Error("If defined, preprocessors property must be an object.");if(o.postprocessor&&!_.isFunction(o.postprocessor))throw new Error("Postprocessor must be a function if set");if(n._adjustTypeScriptCompilers(o),_.isFunction(o.middleware)||(o.middleware=_.noop),o.maxConsoleMessagesPerTest=o.maxConsoleMessagesPerTest||100,o.telemetry=o.telemetry!==!1,o.autoConsoleLog=o.autoConsoleLog!==!1,o.delays=o.delays||{},o.delays.run=o.delays.run||0,o.delays.run?o.delays.edit=0:o.delays.edit=o.delays.edit||100,o.delays.update=o.delays.update||0,o.workers=o.workers||{},o.workers.initial=o.workers.initial||0,o.workers.regular=o.workers.regular||0,_.isBoolean(o.workers.restart)?o.workers.recycle=o.workers.restart:o.workers.recycle=!!o.workers.recycle,o.bootstrap&&o.setup)throw new Error("The `setup` and `bootstrap` functions are alias of the same setting, so only one of them is allowed in the config.");var s=o.bootstrap||o.setup;if(o.bootstrap=s&&s.toString(),delete o.setup,o.teardown=o.teardown&&o.teardown.toString(),n._normalizeFunction(o,"bootstrap"),n._normalizeFunction(o,"teardown"),o.hints=o.hints||{},o.hints.ignoreCoverage=t._serializeHintRegExp(o.hints.ignoreCoverage||""),o.hints.ignoreCoverageForFile=t._serializeHintRegExp(o.hints.ignoreCoverageForFile||""),o.hints.commentAutoLog=o.hints.commentAutoLog||"?",o.hints.testFileSelection=o.hints.testFileSelection||{},o.hints.testFileSelection.include=t._serializeHintRegExp(o.hints.testFileSelection.include||/file\.only/),o.hints.testFileSelection.exclude=t._serializeHintRegExp(o.hints.testFileSelection.exclude||/file\.skip/),o.automaticTestFileSelection=o.automaticTestFileSelection!==!1,o.runSelectedTestsOnly=o.runSelectedTestsOnly===!0,o.extensions=o.extensions||{},o.env=o.env||{type:"browser",kind:"phantomjs"},!_.isObject(o.env))throw new Error("Environment is not specified correctly");if(o.env.type=o.env.type||"browser",o.env.params=o.env.params||{},"browser"===o.env.type&&(o.env.kind=o.env.kind||"phantomjs"),o.env.kind&&"phantomjs"!==o.env.kind&&"electron"!==o.env.kind&&"chrome"!==o.env.kind)throw new Error('Specified browser environment kind "'+o.env.kind+'" is not supported');if("node"!==o.env.type||o.env.runner||(o.env.runner=process.execPath),"electron"===o.env.kind&&!o.env.runner)try{try{o.env.runner=a.requireModuleFrom(i.localProjectDir,"electron")}catch(p){o.env.runner=a.requireModuleFrom(i.localProjectDir,"electron-prebuilt")}}catch(d){throw new Error("Electron runner path is not specified and `electron` module was not found.\nEither specify a path in `env.runner` or install the electron module by running `npm install electron --save-dev`")}if(o.reportUnhandledPromises="node"===o.env.type?o.reportUnhandledPromises!==!1:o.reportUnhandledPromises===!0,o.env.viewportSize=_.extend({width:800,height:600},o.env.viewportSize||{}),o.env.options=_.extend({},o.env.viewportSize,o.env.options||{}),o.env.bundle!==!1&&(o.env.bundle=!0),o.testFramework=o.testFramework||("browser"===o.env.type?"jasmine@3.2.1":"mocha@2.1.0"),o.testFramework=n._normalizeTestFramework(o),o.files=_.map(o.files,n._normalizeFileObject.bind(n,i.defaults&&i.defaults.files||_.extend({},c.files))),o.tests=_.map(o.tests,n._normalizeFileObject.bind(n,i.defaults&&i.defaults.tests||_.extend({},c.tests))),o.slowTestThreshold=o.slowTestThreshold||75,o.lowCoverageThreshold=o.lowCoverageThreshold||80,0===o.testFramework.version.indexOf("jest")){if(_.find(o.files,function(e){
return e&&_.endsWith(e.pattern,".snap")})||_.each(o.tests,function(e){e&&e.pattern&&o.files.push(n._normalizeFileObject({ignore:e.ignore,instrument:!1,trigger:!0,load:!0},e.pattern+".snap"))}),_.find(o.files,function(e){return e&&"package.json"===e.pattern})||o.files.push(n._normalizeFileObject({ignore:!1,instrument:!1,trigger:!0,load:!0},"package.json")),!_.isEmpty(o.preprocessors)){var u=e("module").Module.prototype,h=u._compile;u._compile=function(e,t){if(t&&~t.indexOf("babel-plugin-jest-hoist")&&e){var n=e.replace("if (!expr.isCallExpression())",'if(expr.isSequenceExpression()){const expressions = expr.get("expressions");if (!expressions || expressions.length !== 2) return false;expr = expressions[1];}if (!expr.isCallExpression())');n===e&&console.warn("Initialization of babel-plugin-jest-hoist preset has failed."),arguments[0]=n}return h.apply(this,arguments)},global.$_$w||(global.$_$w=global.$_$wf=global.$_$wv=global.$_$tracer=!0)}o.preprocessors&&!o.preprocessors["package.json"]&&(o.preprocessors["package.json"]=function(e){var t=JSON.parse(e.content);return delete t.babel,JSON.stringify(t)})}return Q.when(o)})},t.prototype._serializeHintRegExp=function(e){if(_.isRegExp(e))return"__REGEXP "+e.toString();if(_.isString(e))return e;throw new Error("Hints must be strings or regular expressions")},t.prototype._normalizeFunction=function(e,t){if(e[t]&&0!==e[t].indexOf("function")){e[t]="function "+e[t];var n=e[t].split("\n")[0],i=n.indexOf("=>"),o=n.indexOf("{");if(i>0&&(o===-1||i<o)&&(e[t]=e[t].replace("=>","{")+"}"),i>0&&n.indexOf("(")<0){n=e[t].split("\n")[0];var r=n.indexOf("{"),a=n.substring("function ".length,r);e[t]=e[t].replace(a,"("+a+")")}}},t.prototype._normalizeTestFramework=function(e){var t=this,n=s[e.env.type];if(!n)throw new Error("Environment ["+e.env.type+"] is not supported");var i=t._resolveTestFrameworkVersion(e,n),o=_.extend({version:i,configurator:i,reporter:i,starter:i},n[i]);return e.testFramework.path&&(o.path=e.testFramework.path),o},t.prototype._resolveTestFrameworkVersion=function(e,t){var n=_.isString(e.testFramework)?e.testFramework:e.testFramework.type;if(~n.indexOf("@")){if(!t[n])throw new Error("Test framework ["+n+"] is not supported");return n}var i={};_.each(t,function(e,t){var n=t.substr(0,t.indexOf("@"));i[n]=t});var o=i[n];if(!o)throw new Error("Test framework ["+n+"] is not supported");return o},t.prototype._adjustTypeScriptCompilers=function(e){var t=!!e.postprocessor,n={files:{}};if(_.each(e.compilers,function(i,o){i&&i.replaceWithPostprocessor&&(n.postprocessor=i.postprocessor,delete e.compilers[o],t&&(i.opts=i.opts||{}),n.files[o]=i.opts,i.opts&&i.opts.typescript&&(n.typescript=i.opts.typescript,delete i.opts.typescript))}),!_.isEmpty(n.files)){var i=n.postprocessor||this._builtinPostprocessors.typeScript(n);t?e.postprocessor=[i,e.postprocessor]:e.postprocessor=i}},t.prototype._normalizeFileObject=function(e,t){if(_.isString(t))t={pattern:t};else if(!t.pattern)throw new Error("File/test entry must either be a string or an object that contains pattern property");var n=_.defaults(t,e);return"!"===n.pattern[0]&&(n.ignore=!n.ignore,n.pattern=n.pattern.substring(1)),"/"===n.pattern[0]&&(n.pattern=n.pattern.substring(1)),"."===n.pattern[0]&&"/"===n.pattern[1]&&(n.pattern=n.pattern.substring(2)),n},t}();t.exports=function(e,t,n){return i&&!n?i.load():(i=new p(e,t),i.load())}},{"./babelCompiler":6,"./coffeeScriptCompiler":9,"./typeScriptCompiler":27,"./typeScriptPostprocessor":28,"./utils":31,minimatch:void 0,module:void 0,path:void 0}],11:[function(e,t,n){function i(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}var o=-1,r=1,a=0;i.Diff,i.prototype.diff_main=function(e,t,n,i){"undefined"==typeof i&&(i=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout);var o=i;if(null==e||null==t)throw new Error("Null input. (diff_main)");if(e==t)return e?[[a,e]]:[];"undefined"==typeof n&&(n=!0);var r=n,s=this.diff_commonPrefix(e,t),l=e.substring(0,s);e=e.substring(s),t=t.substring(s),s=this.diff_commonSuffix(e,t);var c=e.substring(e.length-s);e=e.substring(0,e.length-s),t=t.substring(0,t.length-s);var p=this.diff_compute_(e,t,r,o);return l&&p.unshift([a,l]),c&&p.push([a,c]),this.diff_cleanupMerge(p),p},i.prototype.diff_compute_=function(e,t,n,i){var s;if(!e)return[[r,t]];if(!t)return[[o,e]];var l=e.length>t.length?e:t,c=e.length>t.length?t:e,p=l.indexOf(c);if(p!=-1)return s=[[r,l.substring(0,p)],[a,c],[r,l.substring(p+c.length)]],e.length>t.length&&(s[0][0]=s[2][0]=o),s;if(1==c.length)return[[o,e],[r,t]];var d=this.diff_halfMatch_(e,t);if(d){var u=d[0],h=d[1],m=d[2],_=d[3],f=d[4],S=this.diff_main(u,m,n,i),w=this.diff_main(h,_,n,i);return S.concat([[a,f]],w)}return n&&e.length>100&&t.length>100?this.diff_lineMode_(e,t,i):this.diff_bisect_(e,t,i)},i.prototype.diff_lineMode_=function(e,t,n){var i=this.diff_linesToChars_(e,t);e=i.chars1,t=i.chars2;var s=i.lineArray,l=this.diff_main(e,t,!1,n);this.diff_charsToLines_(l,s),this.diff_cleanupSemantic(l),l.push([a,""]);for(var c=0,p=0,d=0,u="",h="";c<l.length;){switch(l[c][0]){case r:d++,h+=l[c][1];break;case o:p++,u+=l[c][1];break;case a:if(p>=1&&d>=1){l.splice(c-p-d,p+d),c=c-p-d;for(var i=this.diff_main(u,h,!1,n),m=i.length-1;m>=0;m--)l.splice(c,0,i[m]);c+=i.length}d=0,p=0,u="",h=""}c++}return l.pop(),l},i.prototype.diff_bisect_=function(e,t,n){for(var i=e.length,a=t.length,s=Math.ceil((i+a)/2),l=s,c=2*s,p=new Array(c),d=new Array(c),u=0;u<c;u++)p[u]=-1,d[u]=-1;p[l+1]=0,d[l+1]=0;for(var h=i-a,m=h%2!=0,_=0,f=0,S=0,w=0,v=0;v<s&&!((new Date).getTime()>n);v++){for(var g=-v+_;g<=v-f;g+=2){var y,V=l+g;y=g==-v||g!=v&&p[V-1]<p[V+1]?p[V+1]:p[V-1]+1;for(var D=y-g;y<i&&D<a&&e.charAt(y)==t.charAt(D);)y++,D++;if(p[V]=y,y>i)f+=2;else if(D>a)_+=2;else if(m){var b=l+h-g;if(b>=0&&b<c&&d[b]!=-1){var T=i-d[b];if(y>=T)return this.diff_bisectSplit_(e,t,y,D,n)}}}for(var R=-v+S;R<=v-w;R+=2){var T,b=l+R;T=R==-v||R!=v&&d[b-1]<d[b+1]?d[b+1]:d[b-1]+1;for(var k=T-R;T<i&&k<a&&e.charAt(i-T-1)==t.charAt(a-k-1);)T++,k++;if(d[b]=T,T>i)w+=2;else if(k>a)S+=2;else if(!m){var V=l+h-R;if(V>=0&&V<c&&p[V]!=-1){var y=p[V],D=l+y-V;if(T=i-T,y>=T)return this.diff_bisectSplit_(e,t,y,D,n)}}}}return[[o,e],[r,t]]},i.prototype.diff_bisectSplit_=function(e,t,n,i,o){var r=e.substring(0,n),a=t.substring(0,i),s=e.substring(n),l=t.substring(i),c=this.diff_main(r,a,!1,o),p=this.diff_main(s,l,!1,o);return c.concat(p)},i.prototype.diff_linesToChars_=function(e,t){function n(e){for(var t="",n=0,r=-1,a=i.length;r<e.length-1;){r=e.indexOf("\n",n),r==-1&&(r=e.length-1);var s=e.substring(n,r+1);n=r+1,(o.hasOwnProperty?o.hasOwnProperty(s):void 0!==o[s])?t+=String.fromCharCode(o[s]):(t+=String.fromCharCode(a),o[s]=a,i[a++]=s)}return t}var i=[],o={};i[0]="";var r=n(e),a=n(t);return{chars1:r,chars2:a,lineArray:i}},i.prototype.diff_wordMode=function(e,t){var n=this.diff_linesToWords_(e,t),i=n.chars1,o=n.chars2,r=n.lineArray,a=this.diff_main(i,o,!1);return this.diff_charsToLines_(a,r),a},i.prototype.diff_linesToWords_=function(e,t){function n(e){for(var t=e.split(/(\s+|\b)/),n=0;n<t.length-1;n++)!t[n+1]&&t[n+2]&&a.test(t[n])&&a.test(t[n+2])&&(t[n]+=t[n+2],t.splice(n+1,2),n--);return t}function i(e){for(var t="",i=n(e),a=o.length,s=0,l=i.length;s<l;s++){var c=i[s];(r.hasOwnProperty?r.hasOwnProperty(c):void 0!==r[c])?t+=String.fromCharCode(r[c]):(t+=String.fromCharCode(a),r[c]=a,o[a++]=c)}return t}var o=[],r={};o[0]="";var a=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,s=i(e),l=i(t);return{chars1:s,chars2:l,lineArray:o}},i.prototype.diff_charsToLines_=function(e,t){for(var n=0;n<e.length;n++){for(var i=e[n][1],o=[],r=0;r<i.length;r++)o[r]=t[i.charCodeAt(r)];e[n][1]=o.join("")}},i.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var n=0,i=Math.min(e.length,t.length),o=i,r=0;n<o;)e.substring(r,o)==t.substring(r,o)?(n=o,r=n):i=o,o=Math.floor((i-n)/2+n);return o},i.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var n=0,i=Math.min(e.length,t.length),o=i,r=0;n<o;)e.substring(e.length-o,e.length-r)==t.substring(t.length-o,t.length-r)?(n=o,r=n):i=o,o=Math.floor((i-n)/2+n);return o},i.prototype.diff_commonOverlap_=function(e,t){var n=e.length,i=t.length;if(0==n||0==i)return 0;n>i?e=e.substring(n-i):n<i&&(t=t.substring(0,n));var o=Math.min(n,i);if(e==t)return o;for(var r=0,a=1;;){var s=e.substring(o-a),l=t.indexOf(s);if(l==-1)return r;a+=l,0!=l&&e.substring(o-a)!=t.substring(0,a)||(r=a,a++)}},i.prototype.diff_halfMatch_=function(e,t){function n(e,t,n){for(var i,o,r,s,l=e.substring(n,n+Math.floor(e.length/4)),c=-1,p="";(c=t.indexOf(l,c+1))!=-1;){var d=a.diff_commonPrefix(e.substring(n),t.substring(c)),u=a.diff_commonSuffix(e.substring(0,n),t.substring(0,c));p.length<u+d&&(p=t.substring(c-u,c)+t.substring(c,c+d),i=e.substring(0,n-u),o=e.substring(n+d),r=t.substring(0,c-u),s=t.substring(c+d))}return 2*p.length>=e.length?[i,o,r,s,p]:null}if(this.Diff_Timeout<=0)return null;var i=e.length>t.length?e:t,o=e.length>t.length?t:e;if(i.length<4||2*o.length<i.length)return null;var r,a=this,s=n(i,o,Math.ceil(i.length/4)),l=n(i,o,Math.ceil(i.length/2));if(!s&&!l)return null;r=l?s&&s[4].length>l[4].length?s:l:s;var c,p,d,u;e.length>t.length?(c=r[0],p=r[1],d=r[2],u=r[3]):(d=r[0],u=r[1],c=r[2],p=r[3]);var h=r[4];return[c,p,d,u,h]},i.prototype.diff_cleanupSemantic=function(e){for(var t=!1,n=[],i=0,s=null,l=0,c=0,p=0,d=0,u=0;l<e.length;)e[l][0]==a?(n[i++]=l,c=d,p=u,d=0,u=0,s=e[l][1]):(e[l][0]==r?d+=e[l][1].length:u+=e[l][1].length,s&&s.length<=Math.max(c,p)&&s.length<=Math.max(d,u)&&(e.splice(n[i-1],0,[o,s]),e[n[i-1]+1][0]=r,i--,i--,l=i>0?n[i-1]:-1,c=0,p=0,d=0,u=0,s=null,t=!0)),l++;for(t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),l=1;l<e.length;){if(e[l-1][0]==o&&e[l][0]==r){var h=e[l-1][1],m=e[l][1],_=this.diff_commonOverlap_(h,m),f=this.diff_commonOverlap_(m,h);_>=f?(_>=h.length/2||_>=m.length/2)&&(e.splice(l,0,[a,m.substring(0,_)]),e[l-1][1]=h.substring(0,h.length-_),e[l+1][1]=m.substring(_),l++):(f>=h.length/2||f>=m.length/2)&&(e.splice(l,0,[a,h.substring(0,f)]),e[l-1][0]=r,e[l-1][1]=m.substring(0,m.length-f),e[l+1][0]=o,e[l+1][1]=h.substring(f),l++),l++}l++}},i.prototype.diff_cleanupSemanticLossless=function(e){function t(e,t){if(!e||!t)return 6;var n=e.charAt(e.length-1),o=t.charAt(0),r=n.match(i.nonAlphaNumericRegex_),a=o.match(i.nonAlphaNumericRegex_),s=r&&n.match(i.whitespaceRegex_),l=a&&o.match(i.whitespaceRegex_),c=s&&n.match(i.linebreakRegex_),p=l&&o.match(i.linebreakRegex_),d=c&&e.match(i.blanklineEndRegex_),u=p&&t.match(i.blanklineStartRegex_);return d||u?5:c||p?4:r&&!s&&l?3:s||l?2:r||a?1:0}for(var n=1;n<e.length-1;){if(e[n-1][0]==a&&e[n+1][0]==a){var o=e[n-1][1],r=e[n][1],s=e[n+1][1],l=this.diff_commonSuffix(o,r);if(l){var c=r.substring(r.length-l);o=o.substring(0,o.length-l),r=c+r.substring(0,r.length-l),s=c+s}for(var p=o,d=r,u=s,h=t(o,r)+t(r,s);r.charAt(0)===s.charAt(0);){o+=r.charAt(0),r=r.substring(1)+s.charAt(0),s=s.substring(1);var m=t(o,r)+t(r,s);m>=h&&(h=m,p=o,d=r,u=s)}e[n-1][1]!=p&&(p?e[n-1][1]=p:(e.splice(n-1,1),n--),e[n][1]=d,u?e[n+1][1]=u:(e.splice(n+1,1),n--))}n++}},i.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,i.whitespaceRegex_=/\s/,i.linebreakRegex_=/[\r\n]/,i.blanklineEndRegex_=/\n\r?\n$/,i.blanklineStartRegex_=/^\r?\n\r?\n/,i.prototype.diff_cleanupEfficiency=function(e){for(var t=!1,n=[],i=0,s=null,l=0,c=!1,p=!1,d=!1,u=!1;l<e.length;)e[l][0]==a?(e[l][1].length<this.Diff_EditCost&&(d||u)?(n[i++]=l,c=d,p=u,s=e[l][1]):(i=0,s=null),d=u=!1):(e[l][0]==o?u=!0:d=!0,s&&(c&&p&&d&&u||s.length<this.Diff_EditCost/2&&c+p+d+u==3)&&(e.splice(n[i-1],0,[o,s]),e[n[i-1]+1][0]=r,i--,s=null,c&&p?(d=u=!0,i=0):(i--,l=i>0?n[i-1]:-1,d=u=!1),t=!0)),l++;t&&this.diff_cleanupMerge(e)},i.prototype.diff_cleanupMerge=function(e){e.push([a,""]);for(var t,n=0,i=0,s=0,l="",c="";n<e.length;)switch(e[n][0]){case r:s++,c+=e[n][1],n++;break;case o:i++,l+=e[n][1],n++;break;case a:i+s>1?(0!==i&&0!==s&&(t=this.diff_commonPrefix(c,l),0!==t&&(n-i-s>0&&e[n-i-s-1][0]==a?e[n-i-s-1][1]+=c.substring(0,t):(e.splice(0,0,[a,c.substring(0,t)]),n++),c=c.substring(t),l=l.substring(t)),t=this.diff_commonSuffix(c,l),0!==t&&(e[n][1]=c.substring(c.length-t)+e[n][1],c=c.substring(0,c.length-t),l=l.substring(0,l.length-t))),0===i?e.splice(n-s,i+s,[r,c]):0===s?e.splice(n-i,i+s,[o,l]):e.splice(n-i-s,i+s,[o,l],[r,c]),n=n-i-s+(i?1:0)+(s?1:0)+1):0!==n&&e[n-1][0]==a?(e[n-1][1]+=e[n][1],e.splice(n,1)):n++,s=0,i=0,l="",c=""}""===e[e.length-1][1]&&e.pop();var p=!1;for(n=1;n<e.length-1;)e[n-1][0]==a&&e[n+1][0]==a&&(e[n][1].substring(e[n][1].length-e[n-1][1].length)==e[n-1][1]?(e[n][1]=e[n-1][1]+e[n][1].substring(0,e[n][1].length-e[n-1][1].length),e[n+1][1]=e[n-1][1]+e[n+1][1],e.splice(n-1,1),p=!0):e[n][1].substring(0,e[n+1][1].length)==e[n+1][1]&&(e[n-1][1]+=e[n+1][1],e[n][1]=e[n][1].substring(e[n+1][1].length)+e[n+1][1],e.splice(n+1,1),p=!0)),n++;p&&this.diff_cleanupMerge(e)},i.prototype.diff_xIndex=function(e,t){var n,i=0,a=0,s=0,l=0;for(n=0;n<e.length&&(e[n][0]!==r&&(i+=e[n][1].length),e[n][0]!==o&&(a+=e[n][1].length),!(i>t));n++)s=i,l=a;return e.length!=n&&e[n][0]===o?l:l+(t-s)},i.prototype.diff_prettyHtml=function(e){for(var t=[],n=/&/g,i=/</g,s=/>/g,l=/\n/g,c=0;c<e.length;c++){var p=e[c][0],d=e[c][1],u=d.replace(n,"&amp;").replace(i,"&lt;").replace(s,"&gt;").replace(l,"&para;<br>");switch(p){case r:t[c]='<ins style="background:#e6ffe6;">'+u+"</ins>";break;case o:t[c]='<del style="background:#ffe6e6;">'+u+"</del>";break;case a:t[c]="<span>"+u+"</span>"}}return t.join("")},i.prototype.diff_prettyCompactHtml=function(e){for(var t=[],n=0;n<e.length;n++){var i=0===n,s=n===e.length-1,l=e[n][0],c=e[n][1];switch(l){case r:t[n]='<ins style="background:#e6ffe6;">'+this.prepare_text_(c)+"</ins>";break;case o:t[n]='<del style="background:#ffe6e6;">'+this.prepare_text_(c)+"</del>";break;case a:t[n]="<span>"+this.truncate_context_(c,i,s)+"</span>"}}return t.join("")},i.prototype.prepare_text_=function(e){var t=/&/g,n=/</g,i=/>/g,o=/\n/g;return e.replace(t,"&amp;").replace(n,"&lt;").replace(i,"&gt;").replace(o,"&para;<br>")},i.prototype.truncate_context_=function(e,t,n){var i=e.split(/\r\n|\r|\n/),o='<span class="dots">...</span>',r=i.length,a=4;return r<=a?this.prepare_text_(e):!t&&!n&&r<=2*a?this.prepare_text_(e):t?o+this.prepare_text_("\n"+i.slice(-a).join("\n")):n?this.prepare_text_(i.slice(0,a).join("\n")+"\n")+o:this.prepare_text_(i.slice(0,a).join("\n")+"\n")+o+this.prepare_text_("\n"+i.slice(-a).join("\n"))},i.prototype.diff_text1=function(e){for(var t=[],n=0;n<e.length;n++)e[n][0]!==r&&(t[n]=e[n][1]);return t.join("")},i.prototype.diff_text2=function(e){for(var t=[],n=0;n<e.length;n++)e[n][0]!==o&&(t[n]=e[n][1]);return t.join("")},i.prototype.diff_levenshtein=function(e){for(var t=0,n=0,i=0,s=0;s<e.length;s++){var l=e[s][0],c=e[s][1];switch(l){case r:n+=c.length;break;case o:i+=c.length;break;case a:t+=Math.max(n,i),n=0,i=0}}return t+=Math.max(n,i)},i.prototype.diff_toDelta=function(e){for(var t=[],n=0;n<e.length;n++)switch(e[n][0]){case r:t[n]="+"+encodeURI(e[n][1]);break;case o:t[n]="-"+e[n][1].length;break;case a:t[n]="="+e[n][1].length}return t.join("\t").replace(/%20/g," ")},i.prototype.diff_fromDelta=function(e,t){for(var n=[],i=0,s=0,l=t.split(/\t/g),c=0;c<l.length;c++){var p=l[c].substring(1);switch(l[c].charAt(0)){case"+":try{n[i++]=[r,decodeURI(p)]}catch(d){throw new Error("Illegal escape in diff_fromDelta: "+p)}break;case"-":case"=":var u=parseInt(p,10);if(isNaN(u)||u<0)throw new Error("Invalid number in diff_fromDelta: "+p);var h=e.substring(s,s+=u);"="==l[c].charAt(0)?n[i++]=[a,h]:n[i++]=[o,h];break;default:if(l[c])throw new Error("Invalid diff operation in diff_fromDelta: "+l[c])}}if(s!=e.length)throw new Error("Delta length ("+s+") does not equal source text length ("+e.length+").");return n},i.prototype.match_main=function(e,t,n){if(null==e||null==t||null==n)throw new Error("Null input. (match_main)");return n=Math.max(0,Math.min(n,e.length)),e==t?0:e.length?e.substring(n,n+t.length)==t?n:this.match_bitap_(e,t,n):-1},i.prototype.match_bitap_=function(e,t,n){function i(e,i){var o=e/t.length,a=Math.abs(n-i);return r.Match_Distance?o+a/r.Match_Distance:a?1:o}if(t.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var o=this.match_alphabet_(t),r=this,a=this.Match_Threshold,s=e.indexOf(t,n);s!=-1&&(a=Math.min(i(0,s),a),s=e.lastIndexOf(t,n+t.length),s!=-1&&(a=Math.min(i(0,s),a)));var l=1<<t.length-1;s=-1;for(var c,p,d,u=t.length+e.length,h=0;h<t.length;h++){for(c=0,p=u;c<p;)i(h,n+p)<=a?c=p:u=p,p=Math.floor((u-c)/2+c);u=p;var m=Math.max(1,n-p+1),_=Math.min(n+p,e.length)+t.length,f=Array(_+2);f[_+1]=(1<<h)-1;for(var S=_;S>=m;S--){var w=o[e.charAt(S-1)];if(0===h?f[S]=(f[S+1]<<1|1)&w:f[S]=(f[S+1]<<1|1)&w|((d[S+1]|d[S])<<1|1)|d[S+1],f[S]&l){var v=i(h,S-1);if(v<=a){if(a=v,s=S-1,!(s>n))break;m=Math.max(1,2*n-s)}}}if(i(h+1,n)>a)break;d=f}return s},i.prototype.match_alphabet_=function(e){for(var t={},n=0;n<e.length;n++)t[e.charAt(n)]=0;for(var n=0;n<e.length;n++)t[e.charAt(n)]|=1<<e.length-n-1;return t},i.prototype.patch_addContext_=function(e,t){if(0!=t.length){for(var n=t.substring(e.start2,e.start2+e.length1),i=0;t.indexOf(n)!=t.lastIndexOf(n)&&n.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)i+=this.Patch_Margin,n=t.substring(e.start2-i,e.start2+e.length1+i);i+=this.Patch_Margin;var o=t.substring(e.start2-i,e.start2);o&&e.diffs.unshift([a,o]);var r=t.substring(e.start2+e.length1,e.start2+e.length1+i);r&&e.diffs.push([a,r]),e.start1-=o.length,e.start2-=o.length,e.length1+=o.length+r.length,e.length2+=o.length+r.length}},i.prototype.patch_make=function(e,t,n){var s,l;if("string"==typeof e&&"string"==typeof t&&"undefined"==typeof n)s=e,l=this.diff_main(s,t,!0),l.length>2&&(this.diff_cleanupSemantic(l),this.diff_cleanupEfficiency(l));else if(e&&"object"==typeof e&&"undefined"==typeof t&&"undefined"==typeof n)l=e,s=this.diff_text1(l);else if("string"==typeof e&&t&&"object"==typeof t&&"undefined"==typeof n)s=e,l=t;else{if("string"!=typeof e||"string"!=typeof t||!n||"object"!=typeof n)throw new Error("Unknown call format to patch_make.");s=e,l=n}if(0===l.length)return[];for(var c=[],p=new i.patch_obj,d=0,u=0,h=0,m=s,_=s,f=0;f<l.length;f++){var S=l[f][0],w=l[f][1];switch(d||S===a||(p.start1=u,p.start2=h),S){case r:p.diffs[d++]=l[f],p.length2+=w.length,_=_.substring(0,h)+w+_.substring(h);break;case o:p.length1+=w.length,p.diffs[d++]=l[f],_=_.substring(0,h)+_.substring(h+w.length);break;case a:w.length<=2*this.Patch_Margin&&d&&l.length!=f+1?(p.diffs[d++]=l[f],p.length1+=w.length,p.length2+=w.length):w.length>=2*this.Patch_Margin&&d&&(this.patch_addContext_(p,m),c.push(p),p=new i.patch_obj,d=0,m=_,u=h)}S!==r&&(u+=w.length),S!==o&&(h+=w.length)}return d&&(this.patch_addContext_(p,m),c.push(p)),c},i.prototype.patch_deepCopy=function(e){for(var t=[],n=0;n<e.length;n++){var o=e[n],r=new i.patch_obj;r.diffs=[];for(var a=0;a<o.diffs.length;a++)r.diffs[a]=o.diffs[a].slice();r.start1=o.start1,r.start2=o.start2,r.length1=o.length1,r.length2=o.length2,t[n]=r}return t},i.prototype.patch_apply=function(e,t){if(0==e.length)return[t,[]];e=this.patch_deepCopy(e);var n=this.patch_addPadding(e);t=n+t+n,this.patch_splitMax(e);for(var i=0,s=[],l=0;l<e.length;l++){var c,p=e[l].start2+i,d=this.diff_text1(e[l].diffs),u=-1;if(d.length>this.Match_MaxBits?(c=this.match_main(t,d.substring(0,this.Match_MaxBits),p),c!=-1&&(u=this.match_main(t,d.substring(d.length-this.Match_MaxBits),p+d.length-this.Match_MaxBits),(u==-1||c>=u)&&(c=-1))):c=this.match_main(t,d,p),c==-1)s[l]=!1,i-=e[l].length2-e[l].length1;else{s[l]=!0,i=c-p;var h;if(h=u==-1?t.substring(c,c+d.length):t.substring(c,u+this.Match_MaxBits),d==h)t=t.substring(0,c)+this.diff_text2(e[l].diffs)+t.substring(c+d.length);else{var m=this.diff_main(d,h,!1);if(d.length>this.Match_MaxBits&&this.diff_levenshtein(m)/d.length>this.Patch_DeleteThreshold)s[l]=!1;else{this.diff_cleanupSemanticLossless(m);for(var _,f=0,S=0;S<e[l].diffs.length;S++){var w=e[l].diffs[S];w[0]!==a&&(_=this.diff_xIndex(m,f)),w[0]===r?t=t.substring(0,c+_)+w[1]+t.substring(c+_):w[0]===o&&(t=t.substring(0,c+_)+t.substring(c+this.diff_xIndex(m,f+w[1].length))),w[0]!==o&&(f+=w[1].length)}}}}}return t=t.substring(n.length,t.length-n.length),[t,s]},i.prototype.patch_addPadding=function(e){for(var t=this.Patch_Margin,n="",i=1;i<=t;i++)n+=String.fromCharCode(i);for(var i=0;i<e.length;i++)e[i].start1+=t,e[i].start2+=t;var o=e[0],r=o.diffs;if(0==r.length||r[0][0]!=a)r.unshift([a,n]),o.start1-=t,o.start2-=t,o.length1+=t,o.length2+=t;else if(t>r[0][1].length){var s=t-r[0][1].length;r[0][1]=n.substring(r[0][1].length)+r[0][1],o.start1-=s,o.start2-=s,o.length1+=s,o.length2+=s}if(o=e[e.length-1],r=o.diffs,0==r.length||r[r.length-1][0]!=a)r.push([a,n]),o.length1+=t,o.length2+=t;else if(t>r[r.length-1][1].length){var s=t-r[r.length-1][1].length;r[r.length-1][1]+=n.substring(0,s),o.length1+=s,o.length2+=s}return n},i.prototype.patch_splitMax=function(e){for(var t=this.Match_MaxBits,n=0;n<e.length;n++)if(!(e[n].length1<=t)){var s=e[n];e.splice(n--,1);for(var l=s.start1,c=s.start2,p="";0!==s.diffs.length;){var d=new i.patch_obj,u=!0;for(d.start1=l-p.length,d.start2=c-p.length,""!==p&&(d.length1=d.length2=p.length,d.diffs.push([a,p]));0!==s.diffs.length&&d.length1<t-this.Patch_Margin;){var h=s.diffs[0][0],m=s.diffs[0][1];h===r?(d.length2+=m.length,c+=m.length,d.diffs.push(s.diffs.shift()),u=!1):h===o&&1==d.diffs.length&&d.diffs[0][0]==a&&m.length>2*t?(d.length1+=m.length,l+=m.length,u=!1,d.diffs.push([h,m]),s.diffs.shift()):(m=m.substring(0,t-d.length1-this.Patch_Margin),d.length1+=m.length,l+=m.length,h===a?(d.length2+=m.length,c+=m.length):u=!1,d.diffs.push([h,m]),m==s.diffs[0][1]?s.diffs.shift():s.diffs[0][1]=s.diffs[0][1].substring(m.length))}p=this.diff_text2(d.diffs),p=p.substring(p.length-this.Patch_Margin);var _=this.diff_text1(s.diffs).substring(0,this.Patch_Margin);""!==_&&(d.length1+=_.length,d.length2+=_.length,0!==d.diffs.length&&d.diffs[d.diffs.length-1][0]===a?d.diffs[d.diffs.length-1][1]+=_:d.diffs.push([a,_])),u||e.splice(++n,0,d)}}},i.prototype.patch_toText=function(e){for(var t=[],n=0;n<e.length;n++)t[n]=e[n];return t.join("")},i.prototype.patch_fromText=function(e){var t=[];if(!e)return t;for(var n=e.split("\n"),s=0,l=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;s<n.length;){var c=n[s].match(l);if(!c)throw new Error("Invalid patch string: "+n[s]);var p=new i.patch_obj;for(t.push(p),p.start1=parseInt(c[1],10),""===c[2]?(p.start1--,p.length1=1):"0"==c[2]?p.length1=0:(p.start1--,p.length1=parseInt(c[2],10)),p.start2=parseInt(c[3],10),""===c[4]?(p.start2--,p.length2=1):"0"==c[4]?p.length2=0:(p.start2--,p.length2=parseInt(c[4],10)),s++;s<n.length;){var d=n[s].charAt(0);try{var u=decodeURI(n[s].substring(1))}catch(h){throw new Error("Illegal escape in patch_fromText: "+u)}if("-"==d)p.diffs.push([o,u]);else if("+"==d)p.diffs.push([r,u]);else if(" "==d)p.diffs.push([a,u]);else{if("@"==d)break;if(""!==d)throw new Error('Invalid patch mode "'+d+'" in: '+u)}s++}}return t},i.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},i.patch_obj.prototype.toString=function(){var e,t;e=0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1,t=0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2;for(var n,i=["@@ -"+e+" +"+t+" @@\n"],s=0;s<this.diffs.length;s++){switch(this.diffs[s][0]){case r:n="+";break;case o:n="-";break;case a:n=" "}i[s+1]=n+encodeURI(this.diffs[s][1])+"\n"}return i.join("").replace(/%20/g," ")},t.exports=i},{}],12:[function(e,t,n){var i,o=e("path"),r=e("child_process"),a=e("./runWorkerPool"),s=e("./browserEnvironment"),l=0,c=function(t){var n=this;i=e("debug")("wallaby:electronRunner"),n._project=t,n._screenShotReady=Q.when(!0),n._params=t.settings().env.params,n._runner=t.settings().env.runner,n._envOptions=t.settings().env.options,n._clearMemoryCache=t.settings().env.clearMemoryCache,n._host=void 0,n._callbacks=Object.create(null),n._hostPromise=Q.promise(function(e,t){try{var i=_.extend({},process.env,n._params.env?_.reduce(n._params.env.split(";"),function(e,t){var n=t.split("=");return e[n[0]]=n[1],e},{}):{});delete i.ATOM_SHELL_INTERNAL_RUN_AS_NODE,delete i.ELECTRON_RUN_AS_NODE,i.ELECTRON_DISABLE_SECURITY_WARNINGS=!0,n._host=r.fork(o.join(__dirname,"runners","browser","electronHost.js"),[],{execPath:n._runner,env:i,execArgv:n._params.runner?n._params.runner.split(" "):[]}),n._host.on("error",function(e){n._handleHostError(e)}),n._host.on("message",function(t){try{t.id?n._responseWithCorrelationId(t):"ready"===t.type?e(n._host):"error"===t.type&&n._handleHostError(t.error)}catch(i){n._handleHostError(i)}})}catch(a){t(a)}})["catch"](function(e){n._handleHostError(e)}),n._workerPool=new a(n._project,{create:_.bind(n._create,n),recycle:_.bind(n._recycle,n),healthy:function(){return!0},prepare:_.bind(n._prepare,n)}),n._browserEnvironment=new s(t,n._workerPool)};c.prototype={run:function(e){var t=this;return t._workerPool.run(e)},_handleHostError:function(e){var t=this;e=e||{},t._project._cleanStack(e);var n="Electron runner error: "+(e.message||"unknown"),i=e.stack||n;console.error(i),t._project._emitTestRunError(n)},_create:function(e,t){var n=this;n._hostPromise.then(function(){t({pageId:e})})},_recycle:function(e){var t=this;t._host&&t._host.send({type:"closePage",pageId:e.pageId})},_evaluateOnPage:function(e,t,n){var i=this,o={type:"evaluateOnPage",pageId:e,action:"("+t.toString()+")()"};i._requestWithCorrelationId(o,n||_.noop)},_openPage:function(e,t,n,i){var o=this,r={type:"openPage",pageId:e,url:t,options:n};o._requestWithCorrelationId(r,i||_.noop)},_closePage:function(e){var t=this;t._host.send({type:"closePage",pageId:e})},_capturePage:function(e,t){var n=this,i=Q.defer();try{n._requestWithCorrelationId({type:"capturePage",file:t,pageId:e},function(){i.resolve()}),n._screenShotReady=i.promise}catch(o){i.reject(new Error("Failed to render test run screen shot")),console.error("Failed to render test run screen shot",o.message)}},_prepare:function(e,t){var n=this,o=_.randomId(),r=n._browserEnvironment.sandboxName(t,o);return i("Starting sandbox [%s]",r),n._workerPool.getWorker(t).then(function(){return n._workerPool.cancelled()?Q.reject({runCancelled:!0}):(i("Preparing sandbox [%s]",r),n._browserEnvironment.prepareSandbox(e,o,t))}).then(function(e){return n._workerPool.cancelled()?Q.reject({runCancelled:!0}):(i("Prepared sandbox [%s]",r),Q.when({instance:{resume:function(){n._evaluateOnPage(t,function(){$_$tracer.resume()})},ping:function(e){n._evaluateOnPage(t,function(){},e)},close:function(){n._closePage(t)},closing:function(){n._screenShotReady=Q.when()},start:function(i){n._openPage(t,e,n._envOptions,function(e){i(e.status)&&n._evaluateOnPage(t,function(){$_$tracer.start()})})}},name:r,sessionId:o,workerId:t}))})},cancel:function(e){var t=this;return t._workerPool.cancel(e)},start:function(){var e=this;return e._workerPool.start(e._browserEnvironment.webApp()).then(function(t){return e._workerPool.setFileRoot(e._browserEnvironment.sandboxRootUrl()),Q.when(t)})},stop:function(){var e=this;e._host&&(e._host.send({type:"stop"}),e._host.disconnect(),delete e._callbacks,delete e._host),e._workerPool.stop()},_requestWithCorrelationId:function(e,t){var n=this,i=++l,o=n._callbacks[i]={done:t};e.id=i,n._host.send(e),o.timeout=setTimeout(function(){delete n._callbacks[i]},12e5)},_responseWithCorrelationId:function(e){var t=this._callbacks[e.id];delete this._callbacks[e.id],t&&(clearTimeout(t.timeout),t.done(e))}},t.exports=c},{"./browserEnvironment":7,"./runWorkerPool":23,child_process:void 0,debug:void 0,path:void 0}],13:[function(e,t,n){var i=e("parseurl"),o=e("mime"),r=e("path"),a=e("graceful-fs"),s={_data:{},set:function(e,t){this._data[e]=t},get:function(e){return this._data[e]}};t.exports={create:function(t,n,l){var c=e("debug")("wallaby:middleware"),p=!n;return function(e,d){var u=i(e).pathname;"/"===u&&(u=""),c("Preparing to serve "+(u||t));var h=r.normalize(r.join(t,u)),m=p?s:n,f=m.get(h),S=function(e){d.set({"Cache-Control":"public, max-age=86400",Expires:new Date(Date.now()+864e5).toUTCString()}),d.type(o.lookup(h,"text/plain")),d.status(200).end(e)};_.isString(f)||f instanceof Buffer?(c("Serving "+(u||t)+" from cache"),S(f)):(c("Serving "+(u||t)+" from disk"),a.readFile(h,function(e,t){return e?(c("Error when reading file "+h+", "+e&&e.message),l&&console.error("Trying to access missing resource or API: "+u),void d.status(404).end()):(m.set(h,t),void S(t))}))}}}},{debug:void 0,"graceful-fs":void 0,mime:void 0,parseurl:void 0,path:void 0}],14:[function(e,t,n){if(global._=e("lodash"),global.Q=e("q"),global.EventEmitter=e("events").EventEmitter,Q.longStackSupport=!1,global.Promise||(global.Promise=Q.Promise),_.extend(_,e("./utils")),_.str=e("underscore.string"),_.mixin(_.str.exports()),!global.wallabyCoreClient){var i=e("module").Module.prototype,o=i._compile,r="wq_sen",a="r.js",s=r+"de"+a;i._compile=function(){return _.endsWith(arguments[1],s)&&(arguments[0]=new Buffer(arguments[0].substr(arguments[0].lastIndexOf("//# sourceMappingURL=data:application/json;base64,")+50),"base64").toString()),o.apply(this,arguments)}}},{"./utils":31,events:void 0,lodash:void 0,module:void 0,q:void 0,"underscore.string":void 0}],15:[function(e,t,n){var i=e("acorn");i=i.Parser.extend(e("./acornTolerancePlugin"),e("./acornTopLevelAwaitPlugin"),e("./acornDynamicImportPlugin")(i),e("./acornObjectSpreadPlugin")(i),e("acorn-jsx")());var o=e("escodegen-wallaby"),r=40,a=function(e){if(0===e.indexOf("__REGEXP ")){var t=e.split("__REGEXP ")[1].match(/\/(.*)\/(.*)?/);return new RegExp(t[1],t[2]||"")}return e},s=function(e){var t=this;this._commentAutoLogHints={},this._ignoreCoverageHints=[],this._ignoreFileCoverage=!1,this._ignoreCoverageHints.lastHintPosition=-1,e.hints&&(e.hints.ignoreCoverage&&(this._hintRegExp=a(e.hints.ignoreCoverage)),e.hints.ignoreCoverageForFile&&(this._hintFileRegExp=a(e.hints.ignoreCoverageForFile)),e.hints.commentAutoLog&&(_.isString(e.hints.commentAutoLog)?this._commentAutoLog=e.hints.commentAutoLog:(this._commentAutoLog=e.hints.commentAutoLog.value,this._commentAutoLogExp=e.hints.commentAutoLog.exp)),e.hints.testFileSelection&&(e.hints.testFileSelection.include&&(this._includeTestFileRegExp=a(e.hints.testFileSelection.include)),e.hints.testFileSelection.exclude&&(this._excludeTestFileRegExp=a(e.hints.testFileSelection.exclude)))),this._opts=_.defaults(e||{},{}),this._opts.recordValues||(this._wrapExpressionStatementExpressionIntoVisitor=function(e){return e}),t._opts.testFileChangeStart?t._containsChangePosition=t._opts.testFileChangeStart&&t._opts.testFileChangeStart.line?function(e){return e&&e.loc.start.line<=t._opts.testFileChangeStart.line&&e.loc.end.line>=t._opts.testFileChangeStart.line&&(t._opts.testFileChangeStart.line>e.loc.start.line||t._opts.testFileChangeStart.column>e.loc.start.column)&&(t._opts.testFileChangeStart.line<e.loc.end.line||t._opts.testFileChangeStart.column<e.loc.end.column)}:function(e){return e&&e.start<t._opts.testFileChangeStart&&e.end>t._opts.testFileChangeStart}:t._containsChangePosition=function(){return!1},t._visitor=this._createVisitor(),t._opts.sequenceExpressionToDiff||(t._replaceSequenceWithDiff=function(){}),t._opts.automaticTestFileSelection&&t._visitor.CallExpression.add(function(e){e.arguments&&e.arguments[0]&&"Literal"===e.arguments[0].type&&(e.callee&&"Identifier"===e.callee.type&&"fit"===e.callee.name&&2===e.arguments.length?t._includedTestFile=!0:e.callee&&"MemberExpression"===e.callee.type&&e.callee.property&&"Identifier"===e.callee.property.type&&"only"===e.callee.property.name&&(2===e.arguments.length||3===e.arguments.length)&&(t._includedTestFile=!0))}),t._visitor.IfStatement.add(function(e){e.consequent&&"BlockStatement"!==e.consequent.type&&(e.consequent=t._wrapInBlock([e.consequent])),
e.alternate&&"BlockStatement"!==e.alternate.type&&"IfStatement"!==e.alternate.type&&(e.alternate=t._wrapInBlock([e.alternate]))}),t._visitor.add([this._visitor.DoWhileStatement,this._visitor.WhileStatement,this._visitor.IfStatement,this._visitor.ForStatement],function(e,n){if(e.test&&(e.test=t._instructionValueSequence([t._instruction(e.test,n,"TST"),e.test],n,void 0,!0)),e.update){var i=t._wrapIfCommentedForAutoLog(e.update,n);i&&(e.update=i)}}),t._visitor.add([this._visitor.ForOfStatement,this._visitor.ForInStatement],function(e,n){e.right&&(e.right=t._instructionValueSequence([t._instruction(e.right,n,"FR"),e.right],n))}),t._visitor.SwitchStatement.add(function(e,n){e.discriminant=t._instructionValueSequence([t._instruction(e.discriminant,n,"SWT"),e.discriminant],n)}),t._visitor.SwitchCase.add(function(e){e.consequent&&e.consequent.length>0&&(1!=e.consequent.length||"BlockStatement"!==e.consequent[0].type)&&(e.consequent=[t._wrapInBlock(e.consequent)])}),t._visitor.add([t._visitor.DoWhileStatement,t._visitor.ForInStatement,t._visitor.ForStatement,t._visitor.ForOfStatement,t._visitor.LabeledStatement,t._visitor.WhileStatement,t._visitor.WithStatement],function(e){e.body&&"BlockStatement"!==e.body.type&&("LabeledStatement"!==e.type||"DoWhileStatement"!==e.body.type&&"ForInStatement"!==e.body.type&&"ForStatement"!==e.body.type&&"WhileStatement"!==e.body.type)&&"ForOfStatement"!==e.body.type&&(e.body=t._wrapInBlock([e.body]))}),t._visitor.add([t._visitor.BreakStatement,t._visitor.ContinueStatement,t._visitor.ThrowStatement],function(e,n){if(!n.parentNode||"ForStatement"!==n.parentNode.type&&"ForInStatement"!==n.parentNode.type&&"ForOfStatement"!==n.parentNode.type&&"ExportDeclaration"!==n.parentNode.type){var i=[t._instructionStatement(e,n,"S"),e];n.replacement=t._wrapInBlock(i)}}),t._visitor.VariableDeclaration.add(function(e,n){if((!n.parentNode||"ForStatement"!==n.parentNode.type&&"ForInStatement"!==n.parentNode.type&&"ForOfStatement"!==n.parentNode.type&&"ExportDeclaration"!==n.parentNode.type&&"ExportNamedDeclaration"!==n.parentNode.type)&&e.declarations&&e.declarations.length&&"VariableDeclarator"===e.declarations[0].type){var i=e.declarations[0],o=t._instruction(e,n,"S");!i.init||"FunctionExpression"!==i.init.type&&"ArrowFunctionExpression"!==i.init.type&&"ClassExpression"!==i.init.type?i.init=i.init?t._instructionValueSequence([o,i.init],n,e):"var"===e.kind?{type:"LogicalExpression",operator:"||",left:{type:"Identifier",name:i.id.name},right:o}:o:"Literal"!==o.type&&e.declarations.unshift({type:"VariableDeclarator",id:{type:"Identifier",name:"$_$wvd"+t._ranges.length},init:o})}}),t._visitor.ExpressionStatement.add(function(e,n){if(t._replaceConsoleLog(e.expression,n),t._replaceSequenceWithDiff(e),!e._systemJsRegisterCall){var i=n.hinted?e.expression:t._wrapExpressionStatementExpressionIntoVisitor(e.expression,e);e.expression=t._instructionValueSequence([t._instruction(e,n,"S"),i],n,i===e.expression&&e)}}),t._visitor.ReturnStatement.add(function(e,n){t._replaceConsoleLog(e.argument,n),e.argument=e.argument?t._instructionValueSequence([t._instruction(e,n,"R"),e.argument],n,e):t._instruction(e,n,"R")}),t._visitor.ConditionalExpression.add(function(e,n){e.consequent=t._instructionValueSequence([t._instruction(e.consequent,n,"CDC"),e.consequent],n),e.alternate=t._instructionValueSequence([t._instruction(e.alternate,n,"CDA"),e.alternate],n)}),t._visitor.LogicalExpression.add(function(e,n){e.left=t._instructionValueSequence([t._instruction(e.left,n,"LGL"),e.left],n),e.right=t._instructionValueSequence([t._instruction(e.right,n,"LGR"),e.right],n)}),t._visitor.Program.add(function(e,n){_.isEmpty(t._commentAutoLogHints)&&t._visitor.removeVisitorsAddedForAutoLogCommentsOnly(),e.body=e.body||[];var i=e.body[0],o=1===e.body.length&&t._isSystemJsModule(i),r=t._instructionStatement(e,n,"P");t._needsToStayFirst(i)?e.body.splice(0,1,t._firstNode(i),r):o&&o.length?(i._systemJsRegisterCall=!0,o[0]=t._sequence([t._instruction(e,n,"P"),t._instruction(e.body[0],n,"S"),o[0]])):e.body.unshift(r),e.body.push(t._instructionStatement(e,n,"PE"))}),t._visitor.add([t._visitor.FunctionDeclaration,t._visitor.FunctionExpression,t._visitor.ArrowFunctionExpression],function(e,n){t._numberOfFunctions++,t._tryFindTestName(e,n),"ArrowFunctionExpression"===e.type&&e.expression&&(e.body=t._wrapInBlock([t._return(t._instructionValueSequence([t._instruction(e.body,n,"R"),e.body],n))]),e.expression=!1);var i=t._instructionStatement(e,n,"F"),o=e.body.body[0],r=t._needsToStayFirst(o),a=t._isSuperCall(o);r?e.body.body.splice(0,1,t._firstNode(o),i):a?t._handleSuperCall(e.body.body,n):e.body.body.unshift(i)}),t._visitor.ImportBatchSpecifier.add(function(e){e.type="ImportNamespaceSpecifier",e.id=e.name,delete e.name}),t._visitor.ImportSpecifier.add(function(e){e["default"]&&(e.type="ImportDefaultSpecifier")}),t._visitor.AssignmentPattern.add(function(e){"="===e.operator&&(e.type="AssignmentExpression")}),t._visitor.add([t._visitor.ExportNamedDeclaration,t._visitor.ExportDefaultDeclaration,t._visitor.ExportAllDeclaration,t._visitor.ImportDeclaration],function(){t._esm=!0}),t._visitor.Property.addForAutoLogCommentsOnly(function(e,n){if(!e.computed&&e.value){var i=t._wrapIfCommentedForAutoLog(e.value,n);i&&(e.value=i)}}),t._visitor.MemberExpression.addForAutoLogCommentsOnly(function(e,n){if(!e.computed&&e.object){var i=t._wrapIfCommentedForAutoLog(e.object,n);i&&(e.object=i)}}),t._visitor.BinaryExpression.addForAutoLogCommentsOnly(function(e,n){if(e.left){var i=t._wrapIfCommentedForAutoLog(e.left,n);i&&(e.left=i)}if(e.right){var o=t._wrapIfCommentedForAutoLog(e.right,n);o&&(e.right=o)}}),t._visitor.CallExpression.addForAutoLogCommentsOnly(function(e,n){if(e.arguments&&e.arguments.length)for(var i=0,o=e.arguments.length;i<o;i++){var r=t._wrapIfCommentedForAutoLog(e.arguments[i],n);r&&(e.arguments[i]=r)}}),t._visitor.ArrayExpression.addForAutoLogCommentsOnly(function(e,n){if(e.elements&&e.elements.length)for(var i=0,o=e.elements.length;i<o;i++){var r=t._wrapIfCommentedForAutoLog(e.elements[i],n);r&&(e.elements[i]=r)}}),t._visitor.AwaitExpression.addForAutoLogCommentsOnly(function(e,n){if(e.argument){var i=t._wrapIfCommentedForAutoLog(e.argument,n);i&&(e.argument=i)}})};s.prototype={instrument:function(e){var t=this;t._ranges=[],t._code=e,t._numberOfFunctions=0;var n=t._parse(e);t._ignoreCoverageHints.length||(t._nextHint=function(){});var i=t._generate(t._change(n,t._visitor));delete t._code;var o;return t._opts.fullMap?o=i.map.toString():(o={},_.each(i.map._mappings._array,function(e){e.generatedLine&&e.originalLine&&(o[e.generatedLine]&&!e.name||(o[e.generatedLine]=e.originalLine))})),{code:i.code,map:o,ranges:t._ranges,numberOfFunctions:t._numberOfFunctions,testName:t._testName,esm:t._esm,includedTestFile:t._includedTestFile,excludedTestFile:t._excludedTestFile}},_tryFindTestName:function(e,t){var n=this;if(n._containsChangePosition(e.body)&&t.parentContext&&!n._saveTestNameIfTestFunctionCall(t,e,t.parentNode)&&!n._tryFindTestNameFromWrappedFunction(e,t)&&t.parentContext.parentContext){var i=t.parentNode;if(_.isArray(i)&&(i[0]===e||i[1]===e)){var o=t.parentContext,r=o.parentNode;r&&"CallExpression"===r.type&&o.parentContext&&n._tryFindTestNameFromWrappedFunction(t.parentContext.parentNode,t.parentContext.parentContext)}}},_tryFindTestNameFromWrappedFunction:function(e,t){var n=this,i=t.parentNode;if(_.isArray(i)&&(i[0]===e||i[1]===e)){var o=t.parentContext,r=o.parentNode;if(r&&"CallExpression"===r.type&&o.parentContext)return n._saveTestNameIfTestFunctionCall(o.parentContext,r,o.parentContext.parentNode)}},_createVisitor:function(){var e=[],t={removeVisitorsAddedForAutoLogCommentsOnly:function(){_.each(e,function(e){t[e].clearAutoLogCommentsActions()})}};return t.add=function(e,t){for(var n=0,i=e.length;n<i;n++)e[n].add(t)},_.each(["AssignmentExpression","AssignmentPattern","ArrayExpression","ArrayPattern","ArrowFunctionExpression","AwaitExpression","BlockStatement","BinaryExpression","BreakStatement","CallExpression","CatchClause","ClassBody","ClassDeclaration","ClassExpression","ComprehensionBlock","ComprehensionExpression","ConditionalExpression","ContinueStatement","DoWhileStatement","DebuggerStatement","EmptyStatement","ExportBatchSpecifier","ExportDeclaration","ExportSpecifier","ExportNamedDeclaration","ExportDefaultDeclaration","ExportAllDeclaration","ExpressionStatement","ForOfStatement","ForStatement","ForInStatement","FunctionDeclaration","FunctionExpression","GeneratorExpression","Identifier","IfStatement","ImportBatchSpecifier","ImportDeclaration","ImportSpecifier","Literal","LabeledStatement","LogicalExpression","MemberExpression","MethodDefinition","ModuleDeclaration","NewExpression","ObjectExpression","ObjectPattern","Program","Property","ReturnStatement","SequenceExpression","SpreadElement","SwitchStatement","SwitchCase","Super","TaggedTemplateExpression","TemplateElement","TemplateLiteral","ThisExpression","ThrowStatement","TryStatement","UnaryExpression","UpdateExpression","VariableDeclaration","VariableDeclarator","WhileStatement","WithStatement","YieldExpression","JSXIdentifier","JSXNamespacedName","JSXMemberExpression","JSXElement","JSXOpeningElement","JSXClosingElement","JSXEmptyExpression","JSXExpressionContainer","JSXSpreadAttribute","JSXAttribute"],function(n){var i=[];t[n]=function(e,t){for(var n=0,o=i.length;n<o;n++)i[n](e,t)};var o=t[n];o.add=function(e){i.push(e)},o.addForAutoLogCommentsOnly=function(t){t.removeIfNoAutoLogComments=!0,e.push(n),i.push(t)},o.clearAutoLogCommentsActions=function(){i=_.filter(i,function(e){return!e.removeIfNoAutoLogComments})},o.clear=function(){i.length=0}}),t},_change:function(e,t,n){var i,o,r=this;if(n||(n={}),e.type&&e.loc){var a=t[e.type];if(a){if(n.hinted||(n.hinted=r._nextHint(e)),n.hinted)return e;t[e.type](e,n)}if("Identifier"===e.type||"Literal"===e.type||"ThisExpression"===e.type||"DebuggerStatement"===e.type||"EmptyStatement"===e.type||"BreakStatement"===e.type||"ContinueStatement"===e.type)return}for(var s in e)e.hasOwnProperty(s)&&"loc"!==s&&"type"!==s&&"start"!==s&&"end"!==s&&"name"!==s&&(i=e[s],i&&_.isObject(i)&&(o={parentContext:n,parentNode:e,hinted:n.hinted},r._change(i,t,o),o.replacement&&(e[s]=o.replacement)));return e},_parse:function(e){var t=this,n={locations:!0,ecmaVersion:10,allowReturnOutsideFunction:!0,allowImportExportEverywhere:!0,plugins:{jsx:!0,objectSpread:!0,dynamicImport:!0,topLevelAwait:!0,tolerance:!0}},r=[];if(t._hintRegExp&&r.push(function(e,n,i,o){n&&n.match(t._hintRegExp)&&t._ignoreCoverageHints.push(o)}),t._hintFileRegExp&&r.push(function(e,n){!t._ignoreFileCoverage&&n&&n.match(t._hintFileRegExp)&&(t._ignoreFileCoverage=!0,t._wrapExpressionStatementExpressionIntoVisitor=function(e){return e},t._commentAutoLogHints={})}),t._includeTestFileRegExp&&r.push(function(e,n,i,o){!t._includedTestFile&&n&&n.match(t._includeTestFileRegExp)&&(t._includedTestFile=!0)}),t._excludeTestFileRegExp&&r.push(function(e,n,i,o){!t._excludedTestFile&&n&&n.match(t._excludeTestFileRegExp)&&(t._excludedTestFile=!0)}),t._commentAutoLog&&r.push(function(n,i,o,r){if(i&&!t._ignoreFileCoverage){var a=i.indexOf(t._commentAutoLog);if(0===a||1===a&&" "===i[0]){var s=i.substr(t._commentAutoLog.length+a).trim(),l=t._commentAutoLogHints[o]={exp:s},c=function(n,i,o,r){for(var a,s=n;s>=0;s--)if(a=e[s],!o.test(a)){s++;break}return s<i&&!t._commentAutoLogHints[s]&&(t._commentAutoLogHints[s]=l,r&&r(s)),s};c(c(o-1,o,/\s/)-1,o,/[\s,)]/,function(e){l.bracelessIndex=e})}}}),t._opts.preserveComments){n.ranges=!0,n.onComment=[],n.onToken=[];var a=i.parse(e,n);return _.each(n.onComment,function(e){_.each(r,function(t){t("Block"===e.type,e.value,e.start,e.end)})}),o.attachComments(a,n.onComment,n.onToken)}r.length&&(n.onComment=function(e,t,n,i){_.each(r,function(o){o(e,t,n,i)})});var a=i.parse(e,n);return a},_nextHint:function(e,t){var n=this,i=e.start,o=e.end;!t&&_.isNumber(n._ignoreCoverageHints.prevLastHintPosition)&&(n._ignoreCoverageHints.lastHintPosition=n._ignoreCoverageHints.prevLastHintPosition,delete n._ignoreCoverageHints.prevLastHintPosition);for(var r=n._ignoreCoverageHints.lastHintPosition,a=n._ignoreCoverageHints.lastHintPosition+1,s=!1,l=!1,c=!1;a<n._ignoreCoverageHints.length;){var p=n._ignoreCoverageHints[a];if(p<=i||c&&p<o)s=!0,n._ignoreCoverageHints.lastHintPosition=a,a++,c=!0;else{if(!(t&&p<o))break;l=!0,n._ignoreCoverageHints.lastHintPosition=a,a++}}return l&&(n._ignoreCoverageHints.prevLastHintPosition=r),s},_generate:function(e){var t={sourceMap:"original",sourceMapWithCode:!0};return this._opts.preserveComments&&(t.comment=!0),o.generate(e,t)},_wrapInBlock:function(e){return{type:"BlockStatement",body:e}},_instructionValueSequence:function(e,t,n,i){var o=e[1],r=this._wrapIfCommentedForAutoLog(o,t,!0,n,i);return r&&(e[1]=r),_.isEmpty(this._commentAutoLogHints)&&(this._instructionValueSequence=_.bind(this._sequence,this)),this._sequence(e)},_wrapIfCommentedForAutoLog:function(e,t,n,i,o){if(e&&!t.hinted){var r=this._getLiveCommentHint(e,o);if(!r&&i&&(r=this._getLiveCommentHint(i)),r)return n?this._wrapIntoVisitor(e,this._generateNodeContext(e),!0,r.exp):this._sequence([this._instruction(e,t,"U"),this._wrapIntoVisitor(e,this._generateNodeContext(e),!0,r.exp)])}},_getLiveCommentHint:function(e,t){var n=e.end+(t?1:0),i=this._commentAutoLogHints[n];return i?(i.bracelessIndex&&delete this._commentAutoLogHints[i.bracelessIndex],i):t?this._getLiveCommentHint(e):void 0},_sequence:function(e){return{type:"SequenceExpression",expressions:e}},_literal:function(e){return{type:"Literal",value:e}},_return:function(e){return{type:"ReturnStatement",argument:e}},_firstNode:function(e){return{type:"ExpressionStatement",expression:{type:"Literal",value:e&&e.expression&&e.expression.value||""}}},_handleSuperCall:function(e,t){var n=this,i=e[0],o=n._instruction(i,t,"F"),r=n._instruction(i,t,"S");delete i.loc,delete i.expression.loc,i.expression.arguments=i.expression.arguments||[];var a=i.expression.arguments[0];a?"SpreadElement"===a.type&&a.argument?a.argument=n._sequence([o,r,a.argument]):i.expression.arguments[0]=n._sequence([o,r,a]):e.splice(1,0,{type:"ExpressionStatement",expression:n._sequence([o,r])})},_replaceConsoleLog:function(e,t){var n=this;e&&!t.hinted&&("CallExpression"===e.type&&e.callee&&"MemberExpression"===e.callee.type&&e.callee.object&&"Identifier"===e.callee.object.type&&"console"===e.callee.object.name&&e.callee.property&&"Identifier"===e.callee.property.type&&"log"===e.callee.property.name?(e.callee.object.name="$_$tracer",e.arguments||(e.arguments=[]),e.arguments.push(n._literal(n._generateNodeContext(e.arguments[0]))),e.arguments.push(n._literal(n._opts.file)),e.arguments.push(n._literal(n._ranges.length))):e.arguments&&e.arguments.length&&n._replaceConsoleLog(e.arguments[0],t))},_generateNodeContext:function(e){if(e&&"Literal"!==e.type)try{return _.truncate(o.generate(e,{}),r).toString().replace("$_$tracer.log","console.log")}catch(t){}return""},_replaceSequenceWithDiff:function(e){var t=this,n=e;if(e=n.expression,e&&"SequenceExpression"===e.type&&e.expressions&&2===e.expressions.length){var i=e.expressions[0],a=e.expressions[1],s="";if(i&&"Literal"!==i.type)try{s=_.truncate(o.generate(i,{}),r).toString()+" vs "+_.truncate(o.generate(a,{}),r).toString()}catch(l){}n.expression={type:"CallExpression",callee:{type:"MemberExpression",object:{type:"Identifier",name:"$_$tracer"},property:{type:"Identifier",name:"diff"}},arguments:[i,a,t._literal(s),t._literal(t._opts.file),t._literal(t._ranges.length)]}}},_needsToStayFirst:function(e){return e&&"ExpressionStatement"===e.type&&e.expression&&"Literal"===e.expression.type&&("use strict"===e.expression.value||"use babel"===e.expression.value||"ngInject"===e.expression.value)},_isSystemJsModule:function(e){return e&&"ExpressionStatement"===e.type&&e.expression&&"CallExpression"===e.expression.type&&e.expression.callee&&"MemberExpression"===e.expression.callee.type&&e.expression.callee.object&&e.expression.callee.property&&"Identifier"===e.expression.callee.object.type&&"Identifier"===e.expression.callee.property.type&&"System"===e.expression.callee.object.name&&"register"===e.expression.callee.property.name&&e.expression.arguments},_isSuperCall:function(e){return e&&"ExpressionStatement"===e.type&&e.expression&&"CallExpression"===e.expression.type&&e.expression.callee&&"Super"===e.expression.callee.type},_instruction:function(e,t,n){var i=e.loc,o="",r=[];switch(n){case"F":case"P":case"PE":r=[this._literal(this._opts.file)];case"FE":o=n.toLowerCase();break;default:if(this._ignoreFileCoverage||t.hinted||this._nextHint(e,!0))return{type:"Literal",value:1};o="",r=[this._literal(this._opts.file),this._literal(this._ranges.length)];var a=[i.start.line,i.start.column,i.end.line,i.end.column];if(this._opts.fullMap&&"R"===n){var s=1;e.argument&&"CallExpression"===e.argument.type&&e.argument.callee&&("Identifier"===e.argument.callee.type?s=e.argument.callee.name:"MemberExpression"===e.argument.callee.type&&e.argument.callee.property&&"Identifier"===e.argument.callee.property.type&&"createElement"===e.argument.callee.property.name&&e.argument.callee.object&&(this._isReactObject(e.argument.callee.object)||"MemberExpression"===e.argument.callee.object.type&&this._isReactObject(e.argument.callee.object.object))&&(s="React.createElement")),a.push(s)}this._ranges.push(a)}return this._instructionCallExpression(o,r)},_isReactObject:function(e){return e&&"Identifier"===e.type&&e.name&&~e.name.toLowerCase().indexOf("react")},_wrapExpressionStatementExpressionIntoVisitor:function(e,t){if(!e||"Identifier"!==e.type)return e;var n=this._getLiveCommentHint(t),i=n||{exp:""};return this._wrapIntoVisitor(e,void 0,!1,i.exp,n)},_wrapIntoVisitor:function(e,t,n,i,o){var a=this,s=a._ranges.length-(n?1:0),l=a._commentAutoLogExp&&n||a._commentAutoLogExp&&!n&&o;l&&(i="");var c=i&&("."===i[0]||".+"===i.substr(0,2)||"+."===i.substr(0,2)),p=i&&("+"===i[0]||".+"===i.substr(0,2)||"+."===i.substr(0,2));c&&(i=i.substr(1).trim()),p&&(i=i.substr(1).trim());var d=[a._literal(a._opts.file),a._literal(s),a._literal(a._opts.file+","+s)];return c&&!i?(d.push(a._literal(t||e.name||"")),d.push(a._tracerMethodCall("_time")),d.push(e),d.push(a._tracerMethodCall("_time")),this._tracerMethodCall("_logTime",d)):(d.push(a._literal(i?_.truncate(i,r):t||e.name||"")),d.push(c?a._wrapIntoVisitor(e,t,n,"."):e),l?d.push(a._evalExpressionNode(a._commentAutoLogExp)):d.push(i?a._evalExpressionNode(i):a._literal("$_$ne")),d.push(a._literal(n?0:1)),d.push(a._literal(p?1:0)),this._instructionCallExpression("v",d))},_tracerMethodCall:function(e,t){return{type:"CallExpression",callee:{type:"MemberExpression",computed:!1,object:{type:"Identifier",name:"$_$tracer"},property:{type:"Identifier",name:e}},arguments:t||[]}},_evalExpressionNode:function(e){return{type:"FunctionExpression",id:null,params:[{type:"Identifier",name:"$"}],body:{type:"BlockStatement",body:[{type:"TryStatement",block:{type:"BlockStatement",body:[{type:"ReturnStatement",argument:{type:"CallExpression",callee:{type:"Identifier",name:"eval"},arguments:[{type:"Literal",value:e}]}}]},handler:{type:"CatchClause",param:{type:"Identifier",name:"__e"},body:{type:"BlockStatement",body:[{type:"ReturnStatement",argument:{type:"Literal",value:"✗"}}]}},finalizer:null}]},generator:!1,expression:!1}},_instructionCallExpression:function(e,t){return{type:"CallExpression",callee:{type:"Identifier",name:"$_$w"+e},arguments:t}},_instructionStatement:function(e,t,n){return{type:"ExpressionStatement",expression:this._instruction(e,t,n)}},_saveTestNameIfTestFunctionCall:function(e,t,n){var i=this;if(_.isArray(n)&&n.length>=2&&n[1]===t&&n[0]&&"Literal"===n[0].type){var o=e.parentContext.parentNode;if(o&&"CallExpression"===o.type){var r=o.callee;if("SequenceExpression"===r.type&&r.expressions&&(r=r.expressions[r.expressions.length-1]),r&&("it"===r.name||"test"===r.name||"asyncTest"===r.name||r.property&&"Identifier"===r.property.type&&("it"===r.property.name||"test"===r.property.name||"asyncTest"===r.property.name)))return i._testName=n[0].value,!0}}}},t.exports=function(e,t){return new s(t).instrument(e)}},{"./acornDynamicImportPlugin":1,"./acornObjectSpreadPlugin":2,"./acornTolerancePlugin":3,"./acornTopLevelAwaitPlugin":4,acorn:void 0,"acorn-jsx":void 0,"escodegen-wallaby":void 0}],16:[function(e,t,n){var i,o=(e("fs"),e("path")),r=e("child_process").spawn,a=e("./runWorkerPool"),s=e("./utils"),l="###wpm###",c=function(t){var n=this;i=e("debug")("wallaby:nodeRunner"),n._project=t,n._nodePath=t.settings().env.runner,n._initializer=t.settings().bootstrap,n._teardown=t.settings().teardown,n._slowTestThreshold=t.settings().slowTestThreshold,n._nodeModules=o.join(t._localRoot,"node_modules");try{n._regeneratorRuntime=o.join(o.dirname(s.resolveModulePathFrom(n._nodeModules,"regenerator-runtime")),"runtime.js")}catch(r){}n._params=t.settings().env.params,n._recycle=t.settings().workers.recycle,n._testFramework=t.settings().testFramework,n._cwd=process.env.quokka?process.cwd():t._instrumentedRoot,n._localProjectDir=t._localProjectDir,n._reportUnhandledPromises=!!t.settings().reportUnhandledPromises,n._workerPool=new a(n._project,{create:_.bind(n._createNodeInstance,n),recycle:_.bind(n._recycleNodeInstance,n),healthy:_.bind(n._isNodeInstanceHealthy,n),prepare:_.bind(n._prepare,n)}),n._workerPool.setFileRoot(t._instrumentedRoot)};c.prototype={run:function(e){var t=this;return t._workerPool.run(e)},cancel:function(e){var t=this;return t._workerPool.cancel(e)},start:function(){var e=this;return e._workerPool.start()},stop:function(){var e=this;e._workerPool.stop()},_createNodeInstance:function(e,t){var n=this;setImmediate(function(){try{process.env.quokka&&(n._params=n._project.settings().env.params,n._recycle=n._project.settings().workers.recycle);var o=(n._params.runner?_.map(n._params.runner.replace(/"([^"]+)"/g,function(e){return e.replace(/\s/g,"_space_token_")}).split(" "),function(e){return _.trim(e.replace(/_space_token_/g," "),'"')}):[]).concat([process.mainModule.filename,"runner",e,n._workerPool.receiverPort(),n._testFramework.version,n._testFramework.path||"",n._nodeModules,process.env.BABEL_ENV&&n._regeneratorRuntime||""]),a=_.extend({},process.env,n._params.env?_.reduce(n._params.env.split(";"),function(e,t){var n=t.split("="),i=_.trimLeft(n[0]);return e[i]=t.substring(n[0].length+1),e},{}):{});delete a.ATOM_SHELL_INTERNAL_RUN_AS_NODE,delete a.ELECTRON_RUN_AS_NODE;var s={process:r(n._nodePath,o,{cwd:n._cwd,env:a}),onConnected:function(e){_.isFunction(e)?this._onConnected=e:this._onConnected&&(this._onConnected(e),delete this._onConnected,delete this.onConnected)}};s.process.stderr.on("data",function(e){var t=e.toString("utf8");i("Error in worker: %s",t),console.error(t)}),t(s)}catch(l){i("Error while creating worker #%s: %s",e,l&&(l.stack||l.message)),t()}})},_recycleNodeInstance:function(e){try{e.process.stdout.removeAllListeners("data"),e.process.stderr.removeAllListeners("data")}finally{e.process.kill()}},_isNodeInstanceHealthy:function(e){return e.process&&e.process.pid&&!e.process.killed&&!e.process.signal&&null===e.process.exitCode},_prepare:function(e,t){var n=this,o=_.randomId(),r=n._sandboxName(t,o);return i("Starting sandbox [%s]",r),Q.when().then(function(){return n._workerPool.cancelled()?Q.reject({runCancelled:!0}):(i("Preparing sandbox [%s]",r),n._workerPool.getWorker(t))}).then(function(a){return i("Prepared sandbox [%s]",r),Q.when({instance:{resume:function(){a.channel.send(JSON.stringify({type:"in:tracer.resume",data:{}}))},ping:function(e){var t=_.uniqueId(),n=function(i){var o;try{o=JSON.parse(i)}catch(r){return}"pong"===o.type&&o.data===t&&(a.channel.removeListener("message",n),e())};a.channel.on("message",n),a.channel.send(JSON.stringify({type:"in:ping",data:t}))},close:function(){n._recycle?(n._workerPool.recycleWorker(t),n._workerPool.getWorker(t).then(_.noop)):a.channel.send(JSON.stringify({type:"in:stop",data:{}}))},closing:_.noop,start:function(t,r){if(t("success")){try{a.process.stdout.removeAllListeners("data"),a.process.stdout.on("data",function(e){try{e=e&&e.toString("utf8"),~e.indexOf(l)&&(e=e.split("\n"),_.each(e,function(e){if(~e.indexOf(l))try{JSON.parse(e);a.channel.emit("message",e)}catch(t){i("Error while processing STDOUT message: "+t.message)}}))}catch(t){i("Error while processing STDOUT message: "+t.message)}})}catch(s){i("Error while subscribing to process STDOUT: "+s.message)}a.process.stderr.removeAllListeners("data"),a.process.stderr.on("data",function(e){if(e=e&&e.toString("utf8"),!e||0!==e.indexOf("Debugger listening on port")){var t="";if(~e.indexOf(l)){var n;e=e.split("\n"),_.each(e,function(e){if(~e.indexOf(l))try{n=JSON.parse(e)}catch(t){i("Error while processing STDERR message: "+t.message)}}),n&&r(n.message,n.stack,n.actual,n.expected)}else{if(e){var o=e.split("\n"),a=[];_.each(o,function(e){return!_.startsWith(_.trimLeft(e),"at")&&void a.push(e)}),t=a.join("\n")}r(t,e)}}});var c={sessionId:o,tests:e.tests,files:_.map(e.allFiles.concat(e.allTestFiles),function(e){return{id:e.id,rangesLength:e.rangesLength}}),testFiles:_.map(e.testFilesToLoad,function(e){var t;if(0===n._testFramework.version.indexOf("jest")){var i=n._project._getFileMetadataById(e.id);t=i&&i.getFileLineMap()}return{path:e.path,id:e.originalId||e.id,type:e.type,originalType:e.originalType,content:process.env.quokka?e.content:void 0,lineMap:t}}),root:n._cwd,localProjectDir:n._localProjectDir,flushCache:!1,initializer:n._initializer,teardown:n._teardown,slowTestThreshold:n._slowTestThreshold,manualTestRun:e.manualRun,reportUnhandledPromises:n._reportUnhandledPromises,expressionsToEvaluate:e.expressionsToEvaluate};a.channel.send(JSON.stringify({type:"in:run",data:c}))}}},name:r,sessionId:o,workerId:t})})},_sandboxName:function(e,t){return"worker #"+e+", session #"+t}},t.exports=c},{"./runWorkerPool":23,"./utils":31,child_process:void 0,debug:void 0,fs:void 0,path:void 0}],17:[function(e,t,n){var i=e("path"),o=e("util"),r=e("ws"),a=e("./utils"),s=JSON.stringify,l=JSON.parse,c=process.stderr.write.bind(process.stderr),p=function(e){e||(e="");var t="";"string"!=typeof e?(t=e.stack||e.message||e.toString&&e.toString()||"",e.message&&!~t.indexOf(e.message)&&(t=e.message+"\n"+t)):t=e,c(t)},d=process.stdout.write.bind(process.stdout),u={send:function(e){d(e)}};process.exit=function(){};var h=e("module").Module,m=h._cache,_=process.cwd(),f=[],S=e("timers").setTimeout,w=process.nextTick;e("timers").setTimeout=global.setTimeout=function(){var e=S.apply(this,arguments);return f.push(e),e};try{o.promisify.custom&&o.promisify.custom&&(global.setTimeout[o.promisify.custom]=S[o.promisify.custom])}catch(v){}var g=function(){f.forEach(function(e){clearTimeout(e)}),f.length=0},y=function(e){if("string"==typeof e)p(e);else{var t="";e||p("");try{global.$_$tracer&&(e.stack||e.message)&&(t=JSON.stringify(global.$_$tracer.setAssertionData({actual:e.actual,expected:e.expected,showDiff:!0},{message:e.message,stack:e.stack,_p:"###wpm###"})))}catch(n){}p(t||e&&(e.stack||e.message||e.toString())||"")}};process.on("uncaughtException",function(e){y(e),process.env.quokka&&process.emit("beforeExit")});var V=function(){process.on("unhandledRejection",function(e){throw e})},D=function(t,n,i,r,s,l){var c=this;c._port=n,c._id=parseInt(t,10),c._connect(function(){global.$_$reuseableTracer=!0,e("./tracer"),global.$_$tracer._utils=a,global.wallaby._frameworks={chai:{},sinon:{},quibble:{}},global.wallaby._localNodeModules=s,global.wallaby._testFrameworkPath=r,global.wallaby._fileExtensionsAdded=!1,global.wallaby._regeneratorRuntime=l,process.stderr.write=function(e){console.error(e)},c._testFrameworkInitializer=e("./runners/node/"+i+"/initializer.js")}),global.$_$tracer._highPriorityReceiver=u,global.$_$tracer.disconnect=function(){c._channel.close(),delete c._channel,global.$_$tracer._receiver=void 0},global.$_$tracer.reconnect=function(e){c._onConnected=function(){global.$_$tracer._receiver=c._channel,e()},c._connect()},global.$_$tracer._nodeUtil=o,c._patchFrameworks()};D.prototype={send:function(e){var t=this;t._channel.send(s(e))},_connect:function(e){var t=this;t._channel=new r("ws://127.0.0.1:"+t._port),global.$_$receiver=t._channel,e&&e(),t._channel.on("open",function(){t.send({worker:t._id.toString()})}),t._channel.on("message",function(e){e=l(e),t[e.type](e.data)})},"in:connected":function(){this._onConnected&&this._onConnected(),delete this._onConnected},"in:run":function(t){var n=this;t.reportUnhandledPromises&&V&&(V(),V=void 0),global.$_$coverage=[],Object.keys(m).forEach(function(e){var n=m[e];(n.filename&&~n.filename.indexOf(t.root)||t.flushCache)&&delete m[e]});for(var o=0,r=t.files.length;o<r;o++)for(var a=t.files[o],s=global.$_$coverage[a.id]=[],l=0;l<a.rangesLength;l++)s[l]={};global.$_$baseDir=t.root+i.sep,global.$_$slow=t.slowTestThreshold,global.$_$tests=t.tests;var c=(t.testFiles||[]).map(function(e){return e.path});global.$_$testFiles=t.testFiles,global.wallaby.tests=c,global.$_$session=t.sessionId,global.$_$initialSpecId=1e5*(n._id+1)||1,global.$_$tracer._shouldReportProgramScope=!0,global.$_$tracer.initLoadingPhase();try{global.wallaby.testFramework=n._testFrameworkInitializer.init(c)}catch(d){y(d)}global.$_$tracer.reportGlobalError=p,global.wallaby.localProjectDir=t.localProjectDir,global.wallaby.projectCacheDir=_,global.wallaby.sessionId=t.sessionId,global.wallaby.workerId=n._id,global.$_$tracer._manualTestRun=t.manualTestRun,global.$_$tracer._expressionsToEvaluate=t.expressionsToEvaluate||{};try{e("./runners/node/bootstrap")(t.initializer),global.$_$tracer.start(),n._teardown=t.teardown}catch(d){y(d)}},"in:stop":function(){try{process.nextTick!==w&&(process.nextTick=w),global.$_$tracer.reset(),global.$_$tracer.resetEnvGlobal(),e("./runners/node/teardown")(this._teardown),delete this._teardown}catch(t){y(t)}g(),delete global.$_$coverage,delete global.$_$tests,delete global.$_$session,delete global.$_$initialSpecId},"in:ping":function(e){this.send({type:"pong",data:e})},"in:tracer.resume":function(){global.$_$tracer.resume()},_patchFrameworks:function(){a.patchModule("resolve",function(e){var t=e("resolve"),n=t.sync;return t.sync=function(){var e=arguments[1]=arguments[1]||{};return e.paths=e.paths||[],e.paths=e.paths.concat([global.wallaby._localNodeModules]).concat(process.env.NODE_PATH?process.env.NODE_PATH.split(i.delimiter):[]),n.apply(this,arguments)},t}),a.patchModule("./util/core/wrap-method",function(e){var t=e("./util/core/wrap-method");return t&&t.toString&&~t.toString().indexOf("sinon")?function(e){var n=t.apply(this,arguments);return wallaby._frameworks.sinon.stubs.push(n),n}:t})}},t.exports=function(e,t,n,i,o,r){new D(e,t,n,i,o,r)}},{"./tracer":25,"./utils":31,module:void 0,path:void 0,timers:void 0,util:void 0,ws:void 0}],18:[function(e,t,n){var i,o=e("phantom"),r=e("./runWorkerPool"),a=e("./browserEnvironment"),s=!1,l=function(t){var n=this;i=e("debug")("wallaby:phantomRunner"),n._project=t,n._screenShotReady=Q.when(!0),n._params=t.settings().env.params,n._viewportSize=t.settings().env.viewportSize,n._clearMemoryCache=t.settings().env.clearMemoryCache,n._phantomjsPath=t.settings().env.runner||n._project._phantomjs,n._workerPool=new r(n._project,{create:_.bind(n._createPhantomInstance,n),recycle:_.bind(n._recyclePhantomInstance,n),healthy:_.bind(n._isPhantomInstanceHealthy,n),prepare:_.bind(n._prepare,n)}),n._browserEnvironment=new a(t,n._workerPool)};l.prototype={run:function(e){var t=this;return t._workerPool.run(e)},_createPhantomInstance:function(e,t){var n=this;try{var r={dnodeOpts:{weak:!1}};n._phantomjsPath&&(r.binary=n._phantomjsPath),r.onExit=function(t,n){return"SIGSEGV"!==n||s||(console.error("Looks like the PhantomJs version being used is not supported on your OS.\nTry using a different PhantomJs version (https://wallabyjs.com/docs/integration/phantomjs2.html)\nor Chromium/V8 via Electron runner (https://wallabyjs.com/docs/integration/electron.html)"),s=!0),i("Signal killed phantomjs #%s: %s, exit code: %s",e,n,t);
};var a=["--disk-cache=yes","--web-security=false"];n._params.runner&&(a=a.concat(_.filter(n._params.runner.split(" "),function(e){return e&&!(~e.indexOf("--disk-cache=")||~e.indexOf("--web-security="))})));var l=!1;a.push(function(o){if(!l){if(!o)return l=!0,i("Additional attempt to create phantom instance #%s",e),n._createPhantomInstance(e,t);o.set("onError",function(t){i("PhantomJs failure: %s, recycling phantom instance #%s",t,e),n._workerPool.recycleWorker(e)}),l=!0,t(o)}}),a.push(r),o.create.apply(o,a)}catch(c){i("Error while creating worker #%s: %s",e,c&&(c.stack||c.message)),t()}},_recyclePhantomInstance:function(e){e.exit(),e.process.kill()},_isPhantomInstanceHealthy:function(e){return e.process&&e.process.pid&&!e.process.killed&&!e.process.signal&&null===e.process.exitCode},_prepare:function(t,n){var o=this,r=_.randomId(),a=o._browserEnvironment.sandboxName(n,r);return i("Starting sandbox [%s]",a),Q.when().then(function(){return o._workerPool.cancelled()?Q.reject({runCancelled:!0}):(i("Preparing sandbox [%s]",a),Q.all([o._getPage(n),o._browserEnvironment.prepareSandbox(t,r,n)]))}).then(function(s){i("Prepared sandbox [%s]",a);var l=s[0],c=s[1];return Q.when({instance:{resume:function(){l.evaluate(function(){$_$tracer.resume()})},ping:function(e){l.evaluate(function(){},e)},close:function(){t=null,l.stop&&l.stop(),l.close()},closing:function(){o._captureScreenShot(t.screen,l)},start:function(n,i){o._clearMemoryCache&&l.onResourceRequested(function(t,n,i){try{var o=global._urlUtil=global._urlUtil||e("url"),r=t.url;if(!r)return;if(0===r.indexOf("data:"))return;if(~r.indexOf("wallabyFileId"))return;var a=o.parse(t.url),s="/"===a.pathname.charAt(0)?a.pathname.substr(1):a.pathname,c=s&&i[s];if(!c)return;var p=a.search&&a.search.length;n.changeUrl(r+(p?"&":"?")+c.ts+"&wallabyFileId="+c.id),l.clearMemoryCache()}catch(d){console.log(d&&d.message)}},_.noop,t.allFilesHash),l.set("onError",i),l.open(c,function(e){n(e)&&l.evaluate(function(){$_$tracer.start()})})}},name:a,sessionId:r,workerId:n})})},cancel:function(e){var t=this;return t._workerPool.cancel(e)},start:function(){var e=this;return e._workerPool.start(e._browserEnvironment.webApp())},stop:function(){var e=this;e._workerPool.stop()},_captureScreenShot:function(e,t){var n=this,i=Q.defer();try{t.render(e,function(){i.resolve()}),n._screenShotReady=i.promise}catch(o){i.reject(new Error("Failed to render test run screen shot")),console.error("Failed to render test run screen shot",o.message)}},_getPage:function(e){var t=this;return t._workerPool.getWorker(e).then(function(n){return t._workerPool.cancelled()?Q.reject({runCancelled:!0}):(i("Creating page for worker #"+e),t._createPage(n,e))})},_createPage:function(e,t){var n=this;return Q.promise(function(o,r){var a=!1,s=setTimeout(function(){a||(l(),n._workerPool.recycleWorker(t),i("Phantom page is not created in time, recycling it"),r({runCancelled:!0,rerun:!0}))},400),l=function(){a=!0,clearTimeout(s)};try{e.createPage(function(e){a||(l(),i("Phantom page created"),e.set("viewportSize",n._viewportSize||{width:800,height:600}),o(e))})}catch(c){l(),r(c)}})}},t.exports=l},{"./browserEnvironment":7,"./runWorkerPool":23,debug:void 0,phantom:void 0,url:void 0}],19:[function(e,t,n){"use strict";var i=function(){function e(e,t,n){this.type=e.type,this.path=e.path,this.content=t,this.maps=[],this.config=n}return e.prototype.rename=function(e){return this.newPath=e,this},e.prototype.changeExt=function(e){var t=this.newPath||this.path;return this.newPath=t.substr(0,t.lastIndexOf(".")+1)+e,this},e}();t.exports=i},{}],20:[function(e,t,n){function i(e){this.process=r.fork(e,["worker"]),this.pid=this.process.pid,this.status=WorkerState.STARTING,this.process.once("message",this.onReady.bind(this)),a.EventEmitter.call(this)}function o(e,t){function n(){var t=new i(e);t.on("ready",o._run.bind(o)),t.process.on("exit",function(e){if(0!==e){for(var i=0;i<o.workers.length;i++)o.workers[i].pid===t.pid&&o.workers.splice(i,1);n()}}),o.workers.push(t)}this.workers=[],this.queue=[];var o=this;t=t||s.cpus().length;for(var r=0;r<t;r++)n()}var r=e("child_process"),a=e("events"),s=e("os"),l=e("util");WorkerState={STARTING:"STARTING",READY:"READY",BUSY:"BUSY"},l.inherits(i,a.EventEmitter),i.prototype.onReady=function(){this.status===WorkerState.STARTING&&(this.status=WorkerState.READY,this.emit("ready",this))},i.prototype.onMessage=function(e,t){e(t),this.status=WorkerState.READY,this.emit("ready",this)},i.prototype.send=function(e,t){this.status=WorkerState.BUSY,this.emit("busy"),this.process.once("message",this.onMessage.bind(this,t)),this.process.send(e)},o.prototype.enqueue=function(e,t){this.queue.push({task:e,callback:t}),process.nextTick(this._run.bind(this))},o.prototype.stop=function(){_.each(this.workers,function(e){e.process.send({type:"exit"})})},o.prototype._run=function(e){if(0!==this.queue.length){if(!e)for(var t=0;t<this.workers.length;t++)if(this.workers[t].status===WorkerState.READY){e=this.workers[t];break}if(e){var n=this.queue.shift();e.send(n.task,n.callback)}}},t.exports={_queue:void 0,start:function(e){this._queue||(this._queue=new o(e))},started:function(){return!!this._queue},run:function(e){var t=this;return t._queue?Q.promise(function(n,i){try{t._queue.enqueue(e,function(e){n(e)})}catch(o){i(o)}}):Q.reject(new Error("Processor pool is not started"))},stop:function(){this._queue&&(this._queue.stop(),delete this._queue)}}},{child_process:void 0,events:void 0,os:void 0,util:void 0}],21:[function(e,t,n){"use strict";var i,o,r=e("path"),a=e("minimatch"),s=e("./config"),l=e("./utils"),c=e("./preprocessedFile"),p=!1,d="Processor must pass a string, an object with code property or an error to done function.",u="Processor must be an async function with two params, where last param is done callback, or sync function with one param and returning the result.",h=function(){function t(t,n){this._config=t,this._settingsAreReady=_.isObject(this._config),this._root=n,this._localRoot=this._settingsAreReady?process.cwd():r.dirname(t),i=e("debug")("wallaby:processor")}return t.prototype.run=function(e,t,n){var o=this,r=this;return(this._settingsAreReady?Q.when(this._config):s(this._config,this._root)).then(function(a){var s=r._processors(a,t,n);if(!s.length)return i("No %s found for %s",n?"compilers":"preprocessors",t.path),Q.when({content:e,noProcessors:!0});n&&(s=[s[0]]);var l=new c(t,e,a);l.additionalPreset=o._additionalPreset(a);var p=Q.when(l);return i("Running %s processor(s) for %s",s.length,t.path),s.forEach(function(e){p=p.then(function(n){return Q.promise(function(o,r){try{var a=function(e){i("Finished running one processor for %s",t.path);var a;if(e instanceof Error)return void r(e);if(_.isObject(e)){if(!_.isString(e.code))return void r(new Error(d));a=e.code;var s=e.map||e.sourceMap;s&&(!s.version&&s._mappings&&s.toString&&(s=s.toString()),n.maps.push(s)),e.ranges&&(n.ranges=e.ranges),e.scriptRange&&(n.scriptRange=e.scriptRange),e.noScript&&(n.noScript=e.noScript)}else{if(!_.isString(e))return void r(new Error(d));a=e}n.content=a,o(n)};if(1===e.length){var s=void 0;try{s=e(n)}catch(l){s=l}finally{a(s)}}else 2===e.length?e(n,a):r(new Error(u))}catch(c){r(c)}})})}),p})},t.prototype._additionalPreset=function(e){if(!p){if(e.testFramework&&e.testFramework.version&&0===e.testFramework.version.indexOf("jest"))try{o=l.requireModuleFrom(this._localRoot,"babel-preset-jest")}catch(t){try{o=l.requireModuleFrom(this._localRoot,"react-scripts/node_modules/babel-preset-jest")}catch(n){i("WARNING: could not find and load babel-preset-jest preset, it is required for correct jest.mock(...) calls hoisting")}}p=!0}return o},t.prototype._processors=function(e,t,n){var i=[],o=n?e.compilers:e.preprocessors;return _.each(o,function(n,o){if(!_.isString(o))throw new Error("Processor patterns object keys must be strings.");if(!_.isArray(n)&&!_.isFunction(n))throw new Error('Processor(s) for "'+o+'" is specified incorrectly, must be an array of functions or a function.');_.isFunction(n)&&(n=[n]),a(t.path,o,{dot:e.dot})&&(i=i.concat(_.map(n,function(e){if(!_.isFunction(e))throw new Error('Processor for "'+o+'" is specified incorrectly, must be an array of functions or a function.');return e})))}),i},t}();t.exports=function(e){return new h(e.config,e.root).run(e.content,e.file,"compiler"===e.type)}},{"./config":10,"./preprocessedFile":19,"./utils":31,debug:void 0,minimatch:void 0,path:void 0}],22:[function(require,module,exports){var path=require("path"),Module=require("module").Module,configure=require("./config"),utils=require("./utils"),instrument=require("./instrumentor"),processor=require("./processor"),TestTask=require("./testTask").TestTask,Tracker=require("./tracking"),runPriority=require("./testTask").runPriority,minimatch=require("minimatch"),SourceMapConsumer=require("source-map").SourceMapConsumer,debug,cp=require("child_process"),spawn=cp.spawn,spawnedProcesses={};cp.spawn=function(){"cmd"===arguments[0]&&arguments[1]&&arguments[1].length>=3&&"/d"===arguments[1][0]&&"/c"===arguments[1][1]&&(arguments[0]=arguments[1][2],arguments[1].splice(0,3));var e=spawn.apply(this,arguments);try{var t=e.pid;e.on("exit",function(){t&&delete spawnedProcesses[t]}),spawnedProcesses[t]=e}catch(n){}return e};var testPathSeparator="^#^",runAlways=1,runOneTime=2,bundleFileId="bundle",Project=function(e){var t=this;t._structureFileFormatVersion=16,t._wallabyEmail="wallabyjs@gmail.com",t._diffMatchPatch=e.diffMatchPatch,t._processorPool=e.processorPool,t._runnerResolver=e.runnerResolver,t._fileStructureCachePromise=e.fileStructureCachePromise,t._fileStatPromise=e.fileStatPromise,t._readFilePromise=e.readFilePromise,t._writeFilePromise=e.writeFilePromise,t._unlinkFilePromise=e.unlinkFilePromise,t._unlinkFileSync=e.unlinkFileSync,t._readFileSync=e.readFileSync,t._writeFileSync=e.writeFileSync,t._fileExistsSync=e.fileExistsSync,t._dirRemovePromise=e.dirRemovePromise,t._dirRemoveSync=e.dirRemoveSync,t._dirEnsurePromise=e.dirEnsurePromise,t._dirEnsureSync=e.dirEnsureSync,t._lruCache=require("lru-cache")({max:52428800,length:function(e){return e.length}});var n,i;if(t._configFile=e.configPath,t._phantomjs=e.phantomjs,t._structureFile="structure.json",process.env.quokka){t._quokkaGlobalSettingsDir=path.join(e.homeDir,".quokka"),t._quokkaTempDir=path.join(t._quokkaGlobalSettingsDir,"data",utils.randomId()),t._quokkaGlobalSettingsFile=path.join(t._quokkaGlobalSettingsDir,"config.json"),t._quokkaNotificationSettingsFile=path.join(t._quokkaGlobalSettingsDir,"notifications.json"),t._quokkaGlobalPackageFile=path.join(t._quokkaGlobalSettingsDir,"package.json"),t._root="quokka_fake_path",t._localRoot=process.cwd(),t._quokkaLocalSettingsFile=path.join(t._localRoot,".quokka"),t._originalRoot=path.join("quokka_fake_path","original"),t._instrumentedRoot=path.join("quokka_fake_path","instrumented"),t._phantomjs=path.join("quokka_fake_path","phantomjs"),t._editorTypeScript=e.editorTypeScript,e.useMemoryFs(t._root),e.useMemoryFs(t._originalRoot),e.useMemoryFs(t._instrumentedRoot),e.useMemoryFs(path.join(t._root,t._structureFile)),t._quokkaFileName=e.quokka;var o=path.join(t._localRoot,t._quokkaFileName),r=path.join(t._originalRoot,t._quokkaFileName);e.useMemoryFs(o),e.useMemoryFs(r),t._writeFileSync(o," "),t._writeFileSync(r," "),t._fullInstrumentedPathForTestRunner=function(e){return utils.isLevelUpRelativePath(t._quokkaFileName)?path.relative(t._localRoot,t._quokkaFileName):e.instrumentedPath.replace(t._instrumentedRoot,t._localRoot)}}else t._root=e.projectCachePath,t._configFile=e.configPath,t._localRoot=path.dirname(t._configFile),t._phantomjs=e.phantomjs,t._originalRoot=path.join(t._root,"original"),t._instrumentedRoot=path.join(t._root,"instrumented");if(n=path.join(t._localRoot,"node_modules"),t._nodeModules=t._fileExistsSync(n)?n:void 0,t._packageJson=path.join(t._localRoot,"package.json"),t._babelrc=path.join(t._localRoot,".babelrc"),t._babelrcjs=path.join(t._localRoot,".babelrc.js"),t._localProjectDir=t._localRoot+path.sep,i=path.join(t._instrumentedRoot,"node_modules"),t._screenPath=path.join(t._instrumentedRoot,"screen.png"),!process.env.quokka&&t._nodeModules&&e.nodeModulesLookup(function(e){e.push(n)},function(e){return e.replace(i,n)}),process.env.quokka){var a=path.join(t._quokkaGlobalSettingsDir,"node_modules");e.dirEnsureSync(t._quokkaGlobalSettingsDir),e.dirEnsureSync(t._quokkaTempDir),t._writeFileSync(path.join(t._quokkaTempDir,"package.json"),"{}"),e.dirEnsureSync(path.join(t._quokkaTempDir,"node_modules")),e.cidFile=path.join(t._quokkaGlobalSettingsDir,".qid"),e.lkp=path.join(t._quokkaGlobalSettingsDir,".qlc"),t._fileExistsSync(t._quokkaGlobalSettingsFile)||t._writeFileSync(t._quokkaGlobalSettingsFile,"{}"),t._fileExistsSync(t._quokkaGlobalPackageFile)||t._writeFileSync(t._quokkaGlobalPackageFile,"{}"),t._fileExistsSync(t._quokkaNotificationSettingsFile)||t._writeFileSync(t._quokkaNotificationSettingsFile,"{}"),t._loadQuokkaSettings(),e.edition=t._quokkaSettings.quokka.edition||"",e.nodeModulesLookup(function(e){e.push(a)})}t._live=!1,t._sourceFileCache={},t._changeQueue={},t._testTask=new TestTask(t),t._tracker=new Tracker(e,process.env.quokka?path.dirname(process.mainModule.filename):t._root),t._init=e._init,t._coreVersion=e.coreVersion};Project.prototype=_.extend(Object.create(EventEmitter.prototype),{configure:function(){var e=this;return(process.env.quokka?Q.when(e._quokkaSettings):configure(e._configFile,e._instrumentedRoot,e._forceConfigUpdate)).then(function(t){if(e._settings=t,e._settings&&e._settings.debug&&(process.env.DEBUG="wallaby:.*",process.env.DEBUG_FD=1),debug=require("debug")("wallaby:project"),!process.env.quokka){debug("Wallaby config: %s",e._configFile);var n=t.postprocessor;_.isArray(t.postprocessor)&&(n=t.postprocessor[0],t.postprocessor=e._configureComplexPostprocessor(t.postprocessor)),n&&n.ts&&n.filePatterns&&_.filter(n.filePatterns,function(e){return e&&!_.endsWith(e,"*.ts?(x)")&&!_.endsWith(e,"*.ts")}).length>0&&(e._overrideFileTypesIncludedInTypeScriptCompiler=!0,e._overrideFileType=function(t,i,o){if("ts"!==t&&"tsx"!==t&&e._overrideFileTypesIncludedInTypeScriptCompiler&&i!==o)return n.filePatterns&&_.find(n.filePatterns,function(t){return minimatch(i,t,{dot:e._settings.dot})})?"ts":void 0}),t.configCode=e._readFileSync(e._configFile)}t.telemetry&&e._tracker.start(t),t.extensions&&t.extensions.javascript&&t.extensions.javascript.length||(e._isJavaScriptWithCustomExtension=function(){return!1});var i=t.files.length;e._emit({type:"projectConfigured",name:t.name,browser:"browser"===t.env.type,editDelay:t.delays.edit,files:_.map(t.files.concat(t.tests),function(e,t){return t>=i&&(e.test=!0),e})})})["catch"](function(t){e._cleanStack(t,e._configFile),console.error("Failed to load configuration file: ",t&&(t.stack||t.message)),e._emitTestRunError(t&&(t.stack||t.message))})},reloadQuokkaSettings:function(){this._loadQuokkaSettings((this._settings||{})._currentInlineQuokkaConfig),this._settings=this._quokkaSettings,this._recycleRunner=!0},_loadQuokkaSettings:function(e){var t=this;try{var n={globalConfigFile:this._quokkaGlobalSettingsFile,tempDir:this._quokkaTempDir};try{_.merge(n,JSON.parse(this._readFileSync(this._quokkaGlobalSettingsFile)))}catch(i){}try{_.merge(n,JSON.parse(this._readFileSync(this._packageJson)).quokka)}catch(i){}try{_.merge(n,JSON.parse(this._readFileSync(this._quokkaLocalSettingsFile)))}catch(i){}if(e&&_.merge(n,e),this._quokkaSettings={quokka:{globalSettingsDir:this._quokkaGlobalSettingsDir,globalSettingsFile:this._quokkaGlobalSettingsFile,edition:n.pro?"pro":"",installPackage:{command:n.installPackageCommand||"npm install {packageName}",dir:n.tempDir,allowToInstallImportedModules:!0},ignoreExternalFileChanges:n.ignoreExternalFileChanges},files:[],tests:[{pattern:this._quokkaFileName,ignore:!1,instrument:!0,trigger:!0,load:!0}],env:{type:"node",runner:process.execPath,params:n.env&&n.env.params||{}},compilers:{},preprocessors:{},testFramework:{version:"quokka@1.0.0",configurator:"",reporter:"",starter:""},delays:{run:n.delay||0,edit:0},workers:{recycle:!!n.recycle,regular:1,initial:1},maxConsoleMessagesPerTest:1/0,autoConsoleLog:!0,debug:n.debug,reportConsoleErrorAsError:!0,telemetry:!0,hints:{ignoreCoverage:"ignore coverage"},dot:!0},"string"==typeof this._quokkaSettings.env.params.env&&_.each(this._quokkaSettings.env.params.env.split(";"),function(e){var t=e.split("="),n=t[0];process.env[n]=e.substring(n.length+1)}),_.endsWith(this._quokkaFileName,".ts")||_.endsWith(this._quokkaFileName,".tsx"))delete n.babel,n.ts=n.ts||{};else if(n.babel){_.isObject(n.babel)||(n.babel={}),process.env.BABEL_ENV||(process.env.BABEL_ENV=n.babel.env||"test");var o;try{var r=[path.join(this._localRoot,"node_modules","@babel/core"),path.join(this._localRoot,"node_modules","babel-core"),path.join(this._quokkaGlobalSettingsDir,"node_modules","@babel/core"),path.join(this._quokkaGlobalSettingsDir,"node_modules","babel-core")];n.babel.path&&path.resolve(n.babel.path)&&r.unshift(path.resolve(n.babel.path));var a=_.find(r,function(e){return t._fileExistsSync(e)});if(!a)throw new Error("Babel core is not found");~a.indexOf("@babel")&&utils.patchBabelResolve(a),o=require(a),n.babel.path=a}catch(i){return void(this._quokkaSettings.error="Configured to use babel, but can not find babel-core or @babel/core module\n"+i.message+"\n\nTried to search for babel core in these folders:\n"+_.map(r,function(e){return"  "+e}).join("\n"))}this._quokkaSettings.compilers[this._quokkaFileName]=require("./babelCompiler")(this._localRoot)(_.extend({babel:o},_.omit(n.babel,"env","path","polyfill","ignore"))),n.babel.version=o.version}else n.stdEsm!==!1&&(n.stdEsm=n.stdEsm||!0,this._quokkaSettings.env.params.runner=this._quokkaSettings.env.params.runner?this._quokkaSettings.env.params.runner+" ":"",this._quokkaSettings.env.params.runner+='-r "'+path.join(path.dirname(process.mainModule.filename),"node_modules/esm")+'"');if(n.ts){_.isObject(n.ts)||(n.ts={});var s,l=n.ts.compilerOptions||null;if(null===l){l={};for(var c=path.join(this._localRoot,this._quokkaFileName),p=!0;p&&c!==path.dirname(c);){c=path.dirname(c);var d=path.join(c,"tsconfig.json");if(this._fileExistsSync(d)){try{l=require("./typeScriptUtils").getCompilerOptions(require("typescript"),d)}catch(i){throw new Error("Error while loading "+d+":\n"+i.message)}p=!1}c===process.cwd()&&(p=!1)}}var u=n.ts.path;if(u){u=path.resolve(u);try{s=require(u),n.ts.path=u}catch(i){return void(this._quokkaSettings.error='Configured to use "'+u+'" as TypeScript path, but can not find the `typescript` module')}}if(!s)try{u=path.join(this._localRoot,"node_modules","typescript"),s=require(u)}catch(h){try{u=path.join(this._quokkaGlobalSettingsDir,"node_modules","typescript"),s=require(u)}catch(m){try{u=path.resolve(this._editorTypeScript),s=require(u)}catch(f){s=require("typescript"),u=path.join(path.dirname(process.mainModule.filename),"node_modules/typescript")}}}l.module="commonjs",l.noEmit=!1,delete l.removeComments,process.env.TS_NODE_COMPILER=u,process.env.TS_NODE_COMPILER_OPTIONS=JSON.stringify(_.extend(n.ts.compilerOptions||{},{module:"commonjs"}));var S={typescript:s,files:{"**/*.ts?(x)":l}};this._quokkaSettings.postprocessor=require("./typeScriptPostprocessor")(this._localRoot)(S),n.ts.path=u,n.ts.version=s.version;var w=path.join(this._quokkaGlobalSettingsDir,"node_modules","ts-node"),v=path.join(this._localRoot,"node_modules","ts-node");if(this._quokkaGlobalSettingsDir!==this._localRoot||this._fileExistsSync(w)){var g=w;this._fileExistsSync(g)||(g=v,this._fileExistsSync(g)||(n.ts.tsNode=!1,g=!1)),g&&(n.ts.tsNode={path:g})}else n.ts.tsNode=!1}n.plugins&&n.plugins.length&&(n.plugins=_.uniq(n.plugins)),process.env.quokka=JSON.stringify(n)}catch(i){this._quokkaSettings=this._quokkaSettings||{},this._quokkaSettings.error=i.message}this._emitInternal(_.extend({type:"configChanged",settings:this._quokkaSettings},n,{nodeVersion:process.version}))},_configureComplexPostprocessor:function(e){var t=this;if(2!=e.length)throw new Error("Only TypeScript postprocessor chaining is supported");var n=e[0],i=e[1];return function(e){return _.each(e.affectedFiles,function(e){var n=t._structure.filesById[e.id];n&&!t._isOriginallyVue(n)&&t._deleteDependantFilesMetadata(n)}),n(e).then(function(n){if(n.removePostprocessor)t._settings.postprocessor=i,debug("TypeScript postprocessor is removed as requested by itself"),t._overrideFileTypesIncludedInTypeScriptCompiler=!1;else{var o=function(e){var n=t._createPostProcessorInputFile(e);return e.originalId&&(n.id=e.originalId,n.originalType=e.originalType),n},r=function(e){return e&&(_.isEmpty(e.dependant)&&(!e.tmp||e.originalId&&!t._isOriginallyVue(t._structure.filesById[e.originalId]))||t._isOriginallyVue(e))},a=function(e){var n=t._structure.filesById[e.id];return!n||_.isEmpty(n.dependant)||t._isOriginallyVue(n)?n:_.values(n.dependant)[0]};t._updateFileOrder();var s=_.chain(t._structure.testFilesInOrder).filter(r).map(o).value(),l=_.chain(t._structure.sourceFilesInOrder).filter(r).map(o).value().concat(s),c=_.chain(e.affectedFiles).map(a).filter(r).map(o).value(),p=_.chain(e.affectedTestFiles).map(a).filter(r).map(o).value();e=_.extend(e,{allTestFiles:s,allFiles:l,affectedFiles:c,affectedTestFiles:p})}return i(e)})}},configFilePath:function(){return this._configFile},coreVersion:function(){return this._coreVersion},projectName:function(){return this._settings.name||path.basename(this._localRoot)},start:function(e){var t=this,n=t._init(e,t);return t._emitInternal({type:"starting",files:e.files}),n.then(function(){return t._live&&t.stop(),Q.when(!0)}).then(function(){return debug("File cache: %s",t._root),t._live=!1,Q.all([t._dirEnsurePromise(t._originalRoot),t._dirEnsurePromise(t._instrumentedRoot)])})["catch"](function(e){return t._cleanStack(e),t._emitTestRunError(e.stack||e.message),Q.reject({error:e})}).then(function(){return t._fileStructureCachePromise(path.join(t._root,t._structureFile))})["catch"](function(e){return e&&e.error?Q.reject(e.error):Q.when({})}).then(function(e){var n=function(){return t._dirRemovePromise(t._instrumentedRoot).then(function(){return t._dirEnsurePromise(t._instrumentedRoot)})};return Q.all([t._fileStatPromise(t._packageJson).then(function(e){return Q.when(e.mtime.getTime())})["catch"](function(){return Q.when(0)}),t._fileStatPromise(t._babelrc).then(function(e){return Q.when(e.mtime.getTime())})["catch"](function(){return Q.when(0)}),t._fileStatPromise(t._babelrcjs).then(function(e){return Q.when(e.mtime.getTime())})["catch"](function(){return Q.when(0)})]).then(function(i){var o=i[0],r=i[1],a=i[2];return e.invalidateCache?(debug("Invalidating local cache as requested"),n().then(function(){return Q.when({packageJsonTimestamp:o,babelrcTimestamp:r,babelrcJsTimestamp:a})})):o!==e.packageJsonTimestamp?(debug("package.json file change detected, invalidating local cache"),n().then(function(){return Q.when({packageJsonTimestamp:o,babelrcTimestamp:r,babelrcJsTimestamp:a})})):r!==e.babelrcTimestamp?(debug(".babelrc file change detected, invalidating local cache"),n().then(function(){return Q.when({packageJsonTimestamp:o,babelrcTimestamp:r,babelrcJsTimestamp:a})})):a!==e.babelrcJsTimestamp?(debug(".babelrc.js file change detected, invalidating local cache"),n().then(function(){return Q.when({packageJsonTimestamp:o,babelrcTimestamp:r,babelrcJsTimestamp:a})})):e.configCode!==t._settings.configCode||t._structureFileFormatVersion!==e.version?(debug("Config file change detected, invalidating local cache"),n().then(function(){return Q.when({packageJsonTimestamp:o,babelrcTimestamp:r,babelrcJsTimestamp:a})})):(e.packageJsonTimestamp=o,e.babelrcTimestamp=r,e.babelrcJsTimestamp=a,Q.when(e))})}).then(function(n){t._structure=_.extend({filesByPath:{},filesRenamed:{},filesById:{},testFilesById:{},testFileSelectionById:{included:{},excluded:{}},awaitingFiles:[],configCode:t._settings.configCode},n),t._structure.awaitingFiles=[],t._structure.sourceFilesInOrder=[],t._structure.testFilesInOrder=[],t._structure.notifiedAboutWallabyApp||(process.env.quokka||console.log("Wallaby App (realtime reports) is available at: http://localhost:51245"),t._structure.notifiedAboutWallabyApp=!0);var i=_.reduce(e.files,function(e,t){return e[t.path]=!0,e},{});_.each(t._structure.filesByPath,function(e){if(!i[e.path]){var n=t._deleteFileMetadata(e);n&&(t._unlinkFilePromise(n.originalPath),t._unlinkFilePromise(n.instrumentedPath))}});var o=[],r=!!process.env.quokka;_.each(e.files,function(e){var n=e.path;if(e.test||_.find(t._settings.tests,function(n){return n.ignore&&minimatch(e.path,n.pattern,{dot:t._settings.dot})}))r=!0;else{var i=_.find(t._settings.tests,function(n){return!n.ignore&&minimatch(e.path,n.pattern,{dot:t._settings.dot})});i&&console.error("File/pattern "+e.path+" is specified in the files list but also found in the tests list: "+i.pattern+".\r\n\tIf it's a test, make sure to exclude it from the files list, for example by adding { pattern: '"+i.pattern+"', ignore: true } to the files list.\r\n\tIf it's not a test, remove it from the tests list.")}var a=t._structure.filesByPath[n],s=a&&a.id===e.id,l=!1;a?(a=t._createFileMetadata(a,e.id),e.order&&(a.order=e.order),a.ts!==e.ts&&(t._structure.awaitingFiles.push(e.id),l=!0)):(a=t._createFileMetadata(e,e.id),t._structure.awaitingFiles.push(e.id),l=!0),l||o.push(t._readFilePromise(a.originalPath)["catch"](function(){return debug("No cached file "+e.path+", requesting it from IDE"),t._structure.awaitingFiles.push(e.id),Q.when(!1)}).then(function(n){return n===!1?Q.when(!1):(n=n?a.binary?n.toString("base64"):n.toString():"",s?t._readFilePromise(a.instrumentedPath)["catch"](function(){return debug("No instrumented file "+e.path+", re-instrumenting original file"),t._processFile(a,n,void 0,!0,!1)}):(debug("Re-instrumenting original file because its ID has changed"),t._processFile(a,n,void 0,!0,!1)))}))}),r||console.error("No files with tests found, check your tests list patterns."),t._fileOrderUpdatePending=!0;var a=t._runnerResolver(t._settings.env.type,t._settings.env.kind);return t._testRunner=new a(t),Q.all(o.concat([t._testRunner.start()]))})["catch"](function(e){return t._signalIfBecameLive(),t._emitTestRunError(e.message),t._cleanStack(e),Q.reject(e)}).then(function(){t._signalIfBecameLive()?(debug("File cache is up-to-date, starting full test run"),t._queueTestRunFromFileChanges(null,!0),t._scheduleTestRun()):(debug("File cache requires some updates, waiting required files from IDE"),t._emit({type:"filesRequired",files:t._structure.awaitingFiles}))})},file:function(e){var t=this;return t._emitInternal({type:"file",file:e.file,"delete":e["delete"]}),process.env.quokka&&!e.inEditor?void t._filesAreUpToDate([e.file.id]):Q.promise(function(n,i){try{t._tryCancelActiveTestRun(runPriority.fileChangePriority),t._queueFileChange(e),t._scheduleChangedQueueProcessing(),n()}catch(o){i(o)}})},runTests:function(e){var t=this,n=t.settings().quokka;n&&n.ignoreExternalFileChanges&&e.externalFileChange||(t._tryCancelActiveTestRun(e.notManualRun?runPriority.fileChangePriority:runPriority.testRunPriority),e.tests?t._queueRequestedTestRun(e.tests):t._queueFullTestRun(),e.notManualRun&&t._testTask.setEditorRequestedRun(),t._scheduleTestRun())},screen:function(e){var t=this;return t._settings&&"browser"===t._settings.env.type?t._testRunner._screenShotReady.then(function(){return t._readFilePromise(t._screenPath)})["catch"](function(){return debug("Unable to load test run screen shot"),Q.when(!1)}).then(function(n){n&&t._emit({type:"screen",screen:new Buffer(n).toString("base64")},e)}):Q.when(!1)},expressionsToEvaluate:function(e){this._emitInternal({type:"expressionsToEvaluateReceived",expressionsToEvaluate:e.expressionsToEvaluate}),this._expressionsToEvaluate=e.expressionsToEvaluate},stop:function(){var e=this;if(e._live=!1,e._tracker.dispose(),e._quokkaTempDir)try{e._dirRemoveSync(e._quokkaTempDir)}catch(t){}(debug=debug||_.noop)("Stopping wallaby.js");try{e._unlinkFileSync(path.join(e._root,e._structureFile))}catch(t){}if(debug("Killing %s spawned process(es)",_.keys(spawnedProcesses).length),_.each(spawnedProcesses,function(e){try{e.kill()}catch(t){}}),e._multicaster&&e._multicaster.stop(),e._flushSourceFileCacheSync(),e._uiService&&e._uiService.stop(),debug("Stopping test runner"),e._testRunner&&e._testRunner.stop(),e._structure){var n={version:e._structureFileFormatVersion,filesByPath:e._structure.filesByPath,configCode:e._structure.configCode,packageJsonTimestamp:e._structure.packageJsonTimestamp,babelrcTimestamp:e._structure.babelrcTimestamp,babelrcJsTimestamp:e._structure.babelrcJsTimestamp,invalidateCache:e._invalidateCache,notifiedAboutWallabyApp:e._structure.notifiedAboutWallabyApp};_.each(n.filesByPath,function(t,i){delete t.changeTs,delete t.changeStart,delete t.changePosition,delete t.numberOfFunctionsChanged,delete t.lastChangeIsComplex,delete t.relatedFilesWithTests,delete t.lastSingleChangeTest,delete t.dependant,delete t.tmpLineMap,delete t.compiledTmpLineMap,delete t.noCompilers,delete t.noPreprocessors,delete t.sourceMap,delete t.testFilesLoadedFrom,delete t.hadTransientChange,delete t.tests,t.tmp&&!t.notStored&&(delete n.filesByPath[i],e._unlinkFileSync(t.instrumentedPath))});var i=JSON.stringify(n);debug("Saving file structure"),e._writeFileSync(path.join(e._root,e._structureFile),i)}},idByPath:function(e){var t=this._structure.filesByPath[e];if(t)return t.id},invalidateCache:function(){this._invalidateCache=!0},settings:function(){return this._settings},_cleanStack:function(e,t){if(e){var n;if(t){if(e.stack&&_.isString(e.stack)){var i=path.basename(t),o=e.stack.toString().match(new RegExp("[\\s\\S]*"+i.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")+"[^\\)]*\\)","i"));o&&o[0]?(n=o[0],e.message&&!~n.indexOf(e.message)&&(n=e.message+"\n"+n)):n=""}}else if(e.stack&&_.isString(e.stack)){var r=path.dirname(process.mainModule.filename),a=!1;n=this._cleanMessage(_.filter(e.stack.split("\n"),function(e,t){return a||(a=_.contains(e,"quokkaStackTraceMarker")),!(a||t&&(_.contains(e,r)||_.contains(e,"From previous event:")))}).join("\n"))}else n="";if(!_.isUndefined(n)){e.stack=n;try{Object.defineProperty(e,"stack",{value:n})}catch(s){}}return e}},_cleanMessage:function(e,t){return e&&_.isString(e)?e.split(t||this._instrumentedRoot).join("."):e},_startProcessorPool:function(){var e=this;debug("Starting processor pool (if not yet started)"),e._processorPool.start(process.mainModule.filename)},_tryCancelActiveTestRun:function(e){var t=this;process.env.quokka&&(e=runPriority.fileChangePriority),t._runCancelRequester=e;var n=t._testRunner&&t._testRunner.cancel(e);n?debug("Test run was cancelled"):n===!1&&debug("Test run is not cancelled because cancel requester does not have enough priority to cancel the run")},_originalLineByFileId:function(e,t){var n=this,i=n._structure.filesById[e];return i&&i.getFileLineMap()?i.getFileLineMap()[t]:t},_originalLineByFilePath:function(e,t){var n=this,i=n._structure.filesByPath[e];return i&&i.getFileLineMap()?i.getFileLineMap()[t]:t},stackEntryByFileId:function(e,t){var n=this;if(e===bundleFileId){var i=n._structure.filesById[bundleFileId];if(!i)return;var o=i.fileAndLineByLine(t);if(!o||!_.isNumber(o[0])||!n._structure.filesById[o[0]])return;e=o[0],t=o[1]}var r={file:e};return r.line=n._originalLineByFileId(r.file,t),r},stackEntryByFilePath:function(e,t){var n=this,i=n._structure.filesByPath[e]||n._structure.filesByPath[n._structure.filesRenamed[e]||""];if(i&&(!i.tmp||(i=n._structure.filesById[i.originalId]))){e=i.path;var o={file:i.id};return o.line=n._originalLineByFilePath(e,t),o}},copyToClipboard:function(e){if("string"==typeof e.data)return utils.copyToClipboard(e.data);var t=this._buildObject(e.data),n=require("util");utils.copyToClipboard(n.formatWithOptions?n.formatWithOptions({depth:null},t):n.format(t))},_buildObject:function(e){var t,n=this,i=e.type.toLowerCase();switch(i){case"date":return new Date(e.value).toJSON();case"regexp":return new RegExp(e.value.replace(/^\//,"").replace(/\/$/,""));
case"symbol":case"boolean":case"string":case"number":return e.capped?e.capped+"...":e.nan?NaN:e.positiveInfinity?1/0:e.negativeInfinity?-(1/0):e.value;case"null":return null;case"undefined":return;case"array":t=[];break;default:t={}}return _.each(e.props,function(e){return n._handleProperty(e,t)}),t},_handleProperty:function(e,t){var n=this;return e.rangeNode||e.functionsNode?_.each(e.props,function(e){return n._handleProperty(e,t)}):void(e.getter||e.type&&"function"!==e.type&&("symbol"===e.type||e.symbol||(t[e.name]=this._buildObject(e))))},isNotificationMuted:function(e){return!!JSON.parse(this._readFileSync(this._quokkaNotificationSettingsFile))[e]},muteNotification:function(e){var t=JSON.parse(this._readFileSync(this._quokkaNotificationSettingsFile));t[e]={},this._writeFileSync(this._quokkaNotificationSettingsFile,JSON.stringify(t))},_emit:function(e,t){t&&t.id&&(e.id=t.id),this.emit("message",e)},_emitInternal:function(e,t){e._internal=!0,this._emit(e,t)},_isJavaScript:function(e){var t=this;return this._isOriginallyJavaScript(e)||"js"===e.instrumentedType||"jsx"===e.instrumentedType||"es6"===e.instrumentedType||"es7"===e.instrumentedType||"mjs"===e.instrumentedType||this._isJavaScriptWithCustomExtension(e.instrumentedType)||_.find(e.dependant,function(e){return t._isJavaScript(e)})},_isOriginallyJavaScript:function(e){return"js"===e.type||"jsx"===e.type||"es6"===e.type||"es7"===e.type||"mjs"===e.type||this._isJavaScriptWithCustomExtension(e.type)},_isJavaScriptWithCustomExtension:function(e){return _.find((this._settings.extensions||{}).javascript||[],function(t){return t===e})},_isOriginallyVue:function(e){return e&&"vue"===e.type},_isOriginallyCoffeeScript:function(e){return"coffee"===e.type||/\.(litcoffee|coffee\.md)$/.test(e.originalPath)},_isOriginallyTypeScript:function(e){return"ts"===e.type||"tsx"===e.type},_runTests:function(e){var t=this,n=e.isFullRun(),i=e.isManualRun(),o=e.isFileChangedRun(),r=e.files(),a=e.testData(),s=this._expressionsToEvaluate,l=a&&a.files,c=a&&a.names,p=e.getPriority();if(n&&debug("Running all tests"),o&&l&&_.isEmpty(l)&&!_.find(r,function(e){return t._isJavaScript(e)}))return Q.when({queueAgain:!0});t._updateFileOrder();var d=t._structure.sourceFilesInOrder,u=l?t._orderFilesByConfig(t._expandDependantFiles(l)):t._structure.testFilesInOrder,h=_.find(d.concat(u),function(e){return t._isJavaScript(e)&&!e.validSyntax&&e.coverable});if(h)return Q.when({queueAgain:!0,file:h.path});var m=t._selectRunnerFiles(u),f=t._selectRunnerFiles(d);if(!m.length&&r){var S=_.map(r,function(e){return e.id});_.isEqual(S,t._lastChangedFileIds)||(t._lastChangedFileIds=S),t._settings.loose||t.hasSomeSelectedTestFiles()?console.log("Can't determine tests to run for the change."):(console.log("Can't determine tests to run for the change, re-running all tests.\nTo prevent the full test run when can not determine tests to run, use `loose: true` configuration option."),m=t._selectRunnerFiles(t._structure.testFilesInOrder),c=void 0,n=!0,p=e.getFullRunPriority(),debug("Test task priority upgraded to full run"))}else delete t._lastChangedFileIds;var w;process.env.quokka&&t._recycleRunner&&(delete t._recycleRunner,w=!0);var v=this.selectedTestFiles();return this.settings().runSelectedTestsOnly&&!v.hasSomeIncludedTestFiles&&(f.length=0,m.length=0),t._testRunner.run({framework:t._settings.testFramework,fullRun:n,screen:t._screenPath,filesToLoad:_.filter(f,function(e){return e.include}),allFiles:f,testFilesToLoad:_.filter(m,function(e){return e.include}),allTestFiles:m,tests:c,priority:p,manualRun:i,recycleBeforeRun:w,expressionsToEvaluate:s}).then(function(e){return e.globalErrors&&e.globalErrors.length||_.each(r,function(e){delete e.testFilesLoadedFrom}),e.testFiles=_.filter(m,function(e){return!e.tmp}),Q.when(e)})},_expandDependantFiles:function(e){return _.each(e,function(t){_.extend(e,t.dependant||{})}),e},_fullInstrumentedPathForTestRunner:function(e){return e.instrumentedPath},_selectRunnerFiles:function(e){var t=this;return _.map(e,function(e){var n=path.relative(t._instrumentedRoot,e.instrumentedPath);return{path:t._fullInstrumentedPathForTestRunner(e),relativePath:n,normalizedRelativePath:t.normalizePath(n),ts:e.changeTs,id:e.id,tmp:e.tmp,originalId:e.originalId,originalType:e.originalType||e.type,include:e.include,esm:e.esm,type:e.instrumentedType||e.type,rangesLength:e.ranges&&e.ranges.length||0,shadowed:!_.isEmpty(e.dependant),content:process.env.quokka?t._getInstrumentedFileContent(e):void 0}})},_queueFileChange:function(e){var t=this;if(!e.file)throw new Error("File is missing");var n=e.file.id;if(!n)throw new Error("File id is missing");var i=t._changeQueue[n]=t._changeQueue[n]||[];i.push(e)},_emitBusy:function(){this._emit({type:"busy"}),this._tracker.busy()},_scheduleChangedQueueProcessing:function(){var e=this;e._emitBusy(),e._changedQueueTimeout&&clearTimeout(e._changedQueueTimeout),e._changedQueueTimeout=setTimeout(function(){if(e._fileChangesInProcess||e._testRunInProgress||!e._structure)return void e._scheduleChangedQueueProcessing();e._emitBusy(),delete e._changedQueueTimeout,e._fileChangesInProcess=!0;var t=!e._live;e._processChangedQueue().then(function(n){e._fileChangesInProcess=!1,n.length&&_.find(n,function(e){return e.file.triggersTests})?(e._queueTestRunFromFileChanges(n,t&&e._live),!e._pendingChanges()&&e._live&&e._scheduleTestRun()):debug("Changes did not trigger any tests")})["catch"](function(t){debug("Test queueing failure: "+t&&(t.stack||t.message)),e._cleanStack(t),e._emitTestRunError(t&&t.message)})},e._settings.delays.update)},_pendingChanges:function(){return!_.isEmpty(this._changeQueue)},_queueTestRunFromFileChanges:function(e,t){var n=this;if(t)n._queueFullTestRun();else if(!n._testTask.isFullRun()){n._testTask.setFileChangeRunPriority();var i=!1,o=!1;_.each(e,function(e){i=i||e.added,o=o||e.deleted;var t=e.file;e.deleted?n._testTask.addTests(e.tests):n._testTask.addChangedFile(t,e.tests)}),i&&n._testTask.filesAdded(),o&&n._testTask.filesDeleted()}},_queueRequestedTestRun:function(e){var t=this;t._testTask.addTests(e),t._testTask.setTestRunPriority()},_queueFullTestRun:function(){var e=this;e._testTask=new TestTask(e),e._testTask.setFullRunPriority()},_scheduleTestRun:function(e){var t=this;t._emitBusy(),void 0===e&&(!t._firstScheduleTestRunComplete&&process.env.quokka?(t._firstScheduleTestRunComplete=!0,e=0):e=t._settings.delays.run),t._testTask&&process.env.quokka&&t._testTask.setFileChangeRunPriority(),t._testRunTimeout&&clearTimeout(t._testRunTimeout),t._testRunTimeout=setTimeout(function(){if(t._fileChangesInProcess||t._testRunInProgress)return void t._scheduleTestRun(e);t._emitBusy(),delete t._testRunTimeout,delete t._runCancelRequester,t._testRunInProgress=!0;var n=t._testTask;t._testTask=new TestTask(t),n&&n.anyFilesAdded()&&t._removedPostprocessor&&!t._settings.postprocessor&&_.find(n.files(),function(e){return t._isOriginallyTypeScript(e)})&&(debug("TypeScript file has been added, re-activating TypeScript postprocessor"),t._settings.postprocessor=t._removedPostprocessor,t._overrideFileTypesIncludedInTypeScriptCompiler=!0,delete t._removedPostprocessor);var i={},o=[];(t._settings.postprocessor?Q.promise(function(e,i){try{if((n.isManualRun()||n.isEditorRequestedRun())&&!n.isFullRun())return void e();debug("Running postprocessor");var r=n.testData(),a=t._settings.env.bundle&&(n.anyFilesAdded()||n.anyFilesDeleted()),s=t._createPostProcessorArgument({bundleAllowed:a,affectedFiles:_.values(n.files()),affectedTestFiles:r&&r.files,anyFilesAdded:n.anyFilesAdded(),anyFilesDeleted:n.anyFilesDeleted(),logger:{error:function(e){var n={stack:e};t._cleanStack(n),o.push({message:n.stack})}},dot:t.settings().dot});!s.anyFilesAdded&&!s.anyFilesDeleted||t._settings.postprocessor.ts||t._deleteTmpFiles(),e(t._settings.postprocessor(s).then(function(e){return a&&s.bundle.length?t._buildBundle(s.bundle).then(function(){return e}):e})["catch"](function(e){return Q.reject(e)}))}catch(l){i(l)}})["catch"](function(e){return t._runCancelRequester>=n.getPriority()?Q.reject({runCancelled:!0}):(debug("Postprocessor run failure: "+e&&(e.stack||e.message)),e.postprocessor=!0,Q.reject(e))}).then(function(e){return t._runCancelRequester>=n.getPriority()?Q.reject({runCancelled:!0}):(e&&(debug("Postprocessor execution finished"),e.removePostprocessor&&(debug("Postprocessor is removed as requested by itself"),t._removedPostprocessor=t._settings.postprocessor,t._removedPostprocessor&&t._removedPostprocessor.ts&&(t._overrideFileTypesIncludedInTypeScriptCompiler=!1),delete t._settings.postprocessor),_.isEmpty(e.testDependencies)||(i=e.testDependencies)),Q.when(!0))}):Q.when(!0)).then(function(){return t._testSelectionChanged&&(delete t._testSelectionChanged,n.setFullRunPriority()),debug("Test run started; run priority: %s",n.getPriority()),t._runTests(n)})["catch"](function(e){return e.runCancelled?(debug("Test run cancelled, re-queueing run data"),Q.when({queueAgain:!0,rerun:e.rerun})):e.postprocessor?(t._emitTestRunError("Postprocessor run failure: "+(e&&e.message)),Q.when({queueAgain:!0,testErrorReported:!0})):(t._emitTestRunError((process.env.quokka?"":"Test run failure: ")+(e&&e.message)),Q.when(!1))}).then(function(r){if(debug("Test run finished"),_.isEmpty(i)||_.each(r.loadingSequence,function(e,t){r.loadingSequence[t]=_.keys(_.reduce((e||[]).concat(i[t]||[]),function(e,t){return e[t]=!0,e},{}))}),delete t._runCancelRequester,t._testRunInProgress=!1,r)if(o.length&&(r.globalErrors=(r.globalErrors||[]).concat(o)),r.queueAgain)r.file&&(debug("File has invalid syntax: "+r.file),t._emitTestRunError("Test run failure: file "+r.file+" has invalid syntax"),r.testErrorReported=!0),r.file&&!n.hasFiles()||(t._testTask.mergeTask(n),debug("Test run data re-queued"),t._emit({type:"testRunReQueued",rerunScheduled:r.rerun,testErrorReported:r.testErrorReported})),r.rerun&&t._scheduleTestRun(e);else{var a=r.globalErrors&&r.globalErrors.length,s=a||t._hadGlobalErrorsPreviousRun;t._hadGlobalErrorsPreviousRun=a,a&&r.testFiles&&(t._lastAffectedTestFileIds=_.map(r.testFiles,function(e){return e.id})),r.changed=!!n.isFullRun()||_.reduce(n.files(),function(e,t){var n=!!t.lastSingleChangeTest;return delete t.lastSingleChangeTest,e[t.id]={singleTestChange:!s&&n},e},{}),t._emit(t._processCoverageResult({time:r.time,type:"testResults",fullRun:n.isFullRun()},r)),debug("Test run result processed and sent to IDE")}})["catch"](function(e){debug("Failed to process test run results",e.stack),console.error("Failed to process test run results",e.message)})},e)},_buildBundle:function(e){var t=this,n=1/0,i="",o=[],r=1;_.each(e,function(e){e.file.include=!1,e.file.notStored=!0;var t=e.content+"\n";n=Math.min(n,e.file.order);var a=utils.textLines(t).length,s=r,l=r-1+a-1,c=[s,l];c.file=e.file.originalId,o.push(c),r=l+1,i+=t});var a={id:bundleFileId,path:"____wallaby-bundle.js",ts:+new Date,tmp:!0,type:"js",instrumentedType:"js",include:!0,order:n-.1,test:!1},s=t._createFileMetadata(a,a.id);return s.originalId=a.id,s.fileAndLineByLine=function(e){for(var t,n=0,i=o.length-1;n<=i;){t=Math.floor((i+n)/2);var r=o[t];if(e>=r[0]&&e<=r[1])return[r.file,e-r[0]+1];e>r[1]?n=t+1:i=t-1}},t._fileOrderUpdatePending=!0,t._doWriteFileWithLruCache(s.instrumentedPath,i)},hadGlobalErrorsPreviousRun:function(){return this._hadGlobalErrorsPreviousRun},_emitTestRunError:function(e){var t=this;t._emit({type:"testRunError",message:t._cleanMessage(e)})},_deleteDependantFiles:function(e,t){var n=this;return t||(t=[]),_.each(e.dependant,function(e){t.push(n._unlinkFilePromise(e.instrumentedPath)["catch"](function(){return Q.when()})),n._deleteDependantFiles(e,t)}),t},_processChangedQueue:function(){var e=this,t=[],n=[];_.each(e._changeQueue,function(i,o){o=parseInt(o,10);var r=!1,a=!1,s=e._structure.filesById[o],l=[],c=[];if(_.each(i,function(e){return e["delete"]?void(r=e):(l.push(e),c=c.concat(e.file.affectedTests||[]),void(a=e.file.test||s&&s.test))}),c.length||a&&r||(c=a?[[o]]:s&&_.map(s.tests,function(e,t){return e===runOneTime&&delete s.tests[t],t.split(testPathSeparator)})||[]),a&&(e._lastAffectedTestFileIds=r?void 0:[o]),r){var p=e._structure.filesByPath[r.file.path];if(p){if(t=t.concat(e._deleteDependantFiles(p)),e._deleteFileMetadata(r.file),a){var d=p.path;_.each(e._structure.filesById,function(e){_.each(e.tests,function(t){(t===d||_.startsWith(t,d+testPathSeparator))&&delete e.tests[t]})})}t.push(e._deleteSourceFile(p.originalPath)),t.push(e._unlinkFilePromise(p.instrumentedPath)),n.push({file:p,deleted:!0,tests:p.test?[]:c})}}else if(l.length){var u=_.last(l),h=e._getOrCreateFileMetadata(u.file);t.push(e._writeFileChanges(h,_.map(l,function(e){return e.file.content}),u.file.ts)),n.push({file:h,tests:c,added:!s})}}),e._changeQueue={};var i=function(){e._filesAreUpToDate(_.map(n,function(e){return e.file.id}))};return Q.all(t).then(function(){return i(),Q.when(n)})["catch"](function(t){return debug("File system update failure: "+t&&(t.stack||t.message)),i(),e._cleanStack(t),e._emitTestRunError(t&&t.message),Q.when([])})},normalizePath:function(e){return e?e.replace("win32"===process.platform?"file:///":"file://","").split(path.sep).join("/"):e},_createPostProcessorArgument:function(e){var t=this;e=e||{};var n=t._createPostProcessorInputFile.bind(t),i=function(e){return!e.tmp};t._updateFileOrder();var o=_.chain(t._structure.testFilesInOrder).filter(i).map(n).value(),r=_.chain(t._structure.sourceFilesInOrder).filter(i).map(n).value().concat(o),a=e.affectedFiles&&e.affectedFiles.length&&_.chain(e.affectedFiles).filter(i).map(n).value()||r,s=e.affectedTestFiles&&e.affectedTestFiles.length&&_.chain(e.affectedTestFiles).filter(i).map(n).value()||o;delete e.affectedFiles,delete e.affectedTestFiles;var l=e.bundleAllowed;return _.extend({},{bundle:[],anyFilesAdded:!0,anyFilesDeleted:!1,allFiles:r,allTestFiles:o,affectedFiles:a,affectedTestFiles:s,nodeModulesDir:t._nodeModules,baseDir:t._instrumentedRoot,tsPostprocessorOnly:t._settings.postprocessor.ts,setFileOrder:function(e){if(e.file&&e.file.id){t._fileOrderUpdatePending=!0;var n=t._getFileMetadataById(e.file.id);n&&(n.order=e.order)}return Q.when(e.order)},createFile:function(e){var n=this,i=_.ltrim(path.extname(e.path),"."),o=t.normalizePath(e.path),r=_.extend(e,{id:o,path:o,ts:e.ts||+new Date,tmp:!0,type:i,instrumentedType:i,include:e.load!==!1,order:e.order||0,test:e.test||e.test!==!1&&e.original&&e.original.test}),a=t._createFileMetadata(r,r.id);t._fileOrderUpdatePending=!0;var s=l&&!a.test&&"original"in e&&e.content&&0===e.content.indexOf("window.__moduleBundler.cache"),c=e.original&&e.original.id&&e.ranges&&e.sourceMap;if(e.original&&e.original.id){var p=t._structure.filesById[e.original.id];a.originalId=p.id,a.originalType=p.originalType||p.type,a.ranges=p.ranges,p.dependant||(p.dependant={}),delete p.dependant[a.id];var d=_.values(p.dependant)[0];d&&(d.noCompilers===!1?t._deleteFileMetadata(d):d=void 0),p.dependant[a.id]=a,e.sourceMap&&!c&&(p.tmpLineMap=t._updateFileMap(d&&(p.compiledTmpLineMap||p.tmpLineMap)||p.lineMap,[e.sourceMap])),c&&(a.noCompilers=!1,a.sourceMap=e.sourceMap,a.ranges=e.ranges,a.type="js",a.lineMap=t._updateFileMap(a.lineMap,[e.sourceMap]),a.coverable=p.coverable,a.numberOfFunctions=p.numberOfFunctions,a.changePosition=_.textIndexPosition(t._getInstrumentedFileContent(p),p.changeStart))}return(c?t._processFile(a,e.content,void 0,!1,!0,s).then(function(e){return p.tmpLineMap=a.lineMap,p.compiledTmpLineMap=a.lineMap,p.ranges=a.ranges,p.validSyntax=a.validSyntax,p.include=!1,p.numberOfFunctionsChanged=a.numberOfFunctionsChanged,p.numberOfFunctions=a.numberOfFunctions,p.lastSingleChangeTest=a.lastSingleChangeTest,delete a.lineMap,Q.when(e)}):s?Q.when(e.content):t._doWriteFileWithLruCache(a.instrumentedPath,e.content)).then(function(e){return s&&n.bundle.push({file:a,content:e}),Q.when(e)})}},e,{logger:t._createLogger("postprocessor",e.logger)})},_createLogger:function(e,t){return t=t||{},{debug:require("debug")("wallaby:"+e),error:t.error||console.error.bind(console),log:t.log||console.log.bind(console)}},_createPostProcessorInputFile:function(e){var t=this;return{path:t.normalizePath(path.relative(t._instrumentedRoot,e.instrumentedPath)),fullPath:e.instrumentedPath,binary:e.binary,ts:e.changeTs,id:e.id,type:e.instrumentedType||e.type,load:e.include,initialLoad:e.initialInclude,instrument:e.coverable,test:e.test,order:e.order,getContent:function(){var n=t._lruCache.get(e.instrumentedPath);return n?Q.when(n):t._readFilePromise(e.instrumentedPath)},getContentSync:function(){return t._getInstrumentedFileContent(e)},setOrder:function(n,i){t._fileOrderUpdatePending=!0,i&&_.each(e.dependant,function(e){e.order=n}),e.order=n}}},_getInstrumentedFileContent:function(e){var t=this,n=t._lruCache.get(e.instrumentedPath);return n||t._readFileSync(e.instrumentedPath)},getInstrumentedJavaScriptFileContentByPath:function(e){var t=this._structure.filesByPath[e],n={};return n[t.path]=t,t=_.find(this._expandDependantFiles(n),function(e){return _.isEmpty(e.dependant)&&"js"===e.type}),t&&this._getInstrumentedFileContent(t)},findTestFile:function(e){for(var t,n=this,i=e.files||[],o=0,r=i.length;o<r;o++){var a=i[o];if(t=n._structure.testFilesById[a])return t}if(e.testFile&&(t=n._structure.testFilesById[e.testFile]))return t;if(a=n._structure.filesById[i[0]]){var s=_.keys(a.testFilesLoadedFrom||{})[0];if(s)return t=n._structure.testFilesById[s],t&&debug('Test "%s" without test file id mapped to %s (%s)',e.name,t.path,JSON.stringify({log:e.log,filesInvolved:_.map(e.files,function(e){var t=n._structure.filesById[e];return t?t.path:"unknown or deleted file"})})),t}},resolveLogEntryRange:function(e){var t=this;if(("log"===e.type||"autoLog"===e.type||"diff"===e.type)&&_.isNumber(e.file)&&_.isNumber(e.range)){var n=this._getFileMetadataById(e.file),i=e.range;return n&&(e.range=n.ranges[i],e.range.length||(e.range=t._findPreviousValidRange(n.ranges,i)),e.range&&e.range.length||delete e.range),!0}return!1},_findPreviousValidRange:function(e,t){for(;t>0;){var n=e[--t];if(n&&n.length)return n}},_processCoverageResult:function(e,t){var n=this;e.ts=Date.now(),e.files=[],e.tests=[],e.log=t.log,e.globalErrors=t.globalErrors,e.additionalHeaderMessage=this._additionalHeaderMessage();var i=n._settings.reportConsoleErrorAsError&&{};e.log=_.filter(e.log,function(t){if(!n.resolveLogEntryRange(t)&&"error"===t.type&&i){var o={message:"\n"!==t.text&&t.text||"[console.error without any message]",stack:[]};if(t.spec){var r=i[t.spec]=i[t.spec]||[];r.push(o)}else e.globalErrors||(e.globalErrors=[]),e.globalErrors.push(o);return!1}return!0}),debug("Processed console.log entries"),_.each(t.loadingSequence,function(t,i){_.each(t,function(t){var o=n._structure.filesById[t];o&&!n.settings().ignoreFileLoadingDependencyTracking&&(o.testFilesLoadedFrom=o.testFilesLoadedFrom||{},o.testFilesLoadedFrom[i]=runAlways);var r=n._structure.testFilesById[t];if(i!==t&&r){var a=n._structure.testFilesById[i];a&&e.globalErrors.push({message:"Test file '"+a.path+"' is importing or is causing import of another test file '"+r.path+"'.\nThis may cause tests in the '"+r.path+"' file to be executed more than once (when the test file runs and every time it gets imported).\nIf the '"+r.path+"' test file contains some test helper code, try refactoring the reused code into a file of its own and use it by importing the new file into '"+a.path+"' and '"+r.path+"' test files."})}})}),debug("Processed loading sequences");var o={},r={},a=!1;_.each(t.tests,function(t){if(!t.skipped){if(i){var s=i[t.id];s&&(t.log=(t.log||[]).concat(s))}for(var l=e.tests,c=e,p=0,d=t.suite.length;p<d;p++){var u=t.suite[p];c=_.find(l,function(e){return e.name===u&&e.tests}),c||(c={name:u,tests:[]},l.push(c)),l=c.tests}var h=!(!t.log||!t.log.length),m=n.findTestFile(t);if(!m)return console.warn("Test without test file id, most likely the test did not run, OR the test/test body is in the file that is not in the `tests` list in the configuration file",{testFileIdCanNotBeDetermined:t.name,id:t.id,log:t.log,filesInvolved:_.map(t.files,function(e){var t=n._structure.filesById[e];return t?t.path:"unknown or deleted file"})}),void(h&&(a=!0));var f=m.id,S=t.suite.slice();S.unshift(m.path),S.push(t.name);var w=S.join(testPathSeparator);h&&n._testTask.failingTest(f,S);var v=r[w];v?(debug("Test name duplicate: "+t.name),t.name+=" #"+v,r[w]=v+1):r[w]=1;var g={name:t.name,id:t.id,fileId:f,log:t.log,time:t.time,slow:t.slow};c.tests.push(g),o[t.id]={out:g,timeRange:t.timeRange},_.each(t.files,function(e){var t=n._structure.filesById[e];t&&(t.tests[w]=runAlways)});var y=[];_.each(g.log,function(e){e.external&&e.stack&&(_.each(e.stack,function(t){var i=n._structure.filesById[t[0]];i&&(i.tests[w]=i.tests[w]||runOneTime,i.test&&i.id!==f&&(e._global=!0))}),e._global&&y.push(e),delete e.external),e.snapshot=!(!e.message||!~e.message.indexOf("expect(value).toMatchSnapshot()"))}),y.length&&(e.globalErrors=(e.globalErrors||[]).concat(y),g.log=_.filter(g.log,function(e){return!e._global}))}}),a&&(e.globalErrors||(e.globalErrors=[]),e.globalErrors.unshift({message:"Some of the failing tests can not be reported, check the wallaby console for more details"})),debug("Processed executed tests"),n._updateFileOrder(),_.each(t.changed===!0?n._structure.sourceFilesInOrder.concat(n._structure.testFilesInOrder):_.map(t.changed,function(e,t){return n._getFileMetadataById(t)}),function(e){if(e){var i=e.id;_.isNumber(i)&&!t.coverage[i]&&n._isJavaScript(e)&&(t.coverage[i]=[])}});var s={};if(_.each(t.coverage,function(i,r){r=parseInt(r,10);var a=t.changed[r],l={id:r,ranges:[],changed:t.changed===!0||!!a,singleTestChanged:!(!a||!a.singleTestChange)||void 0};s[r]=l;var c,p=n._getFileMetadataById(r),d=p.ranges,u={},h={};_.each(d,function(t,a){if(t.length){var s=t.join("."),d=!1,m=i[a],f=_.map(m,function(i,a){if(a=parseInt(a,10),!a)return null;var s=o[a];if(!s)return null;var l=s.timeRange;return l?(l[0]===i&&(p.test&&n._looksLikeTestDeclarationRange(c,t)&&e.log.push({type:"autoLog",text:_.isNumber(s.out.time)?s.out.time+"ms":"",file:r,range:c,context:""}),s.out.start=t[0],r!==s.out.fileId&&(h[s.out.fileId]=!0)),d=!0,a):a});if(c=t,l.changed||f.length||p.relatedFilesWithTests){var S={items:t,hits:f},w=u[s];w?d&&(w.hits=f):(u[s]=S,l.ranges.push(S))}}}),_.isEmpty(h)||(p.relatedFilesWithTests=h,_.each(h,function(e,t){var i=n._getFileMetadataById(t);i&&(i.relatedFilesWithTests=i.relatedFilesWithTests||{},i.relatedFilesWithTests[p.id]=!0)})),e.files.push(l)}),_.isObject(t.changed)){var l=function(e){var t=s[e];t&&(t.changed=!0,t.singleTestChanged=void 0)},c={},p=function(e){if(!c[e]){c[e]=!0;var t=n._getFileMetadataById(e);t&&t.relatedFilesWithTests&&(l(t.id),_.each(t.relatedFilesWithTests,function(e,t){l(t),p(t)}))}};_.each(t.changed,function(e,t){p(t)})}return debug("Processed code coverage"),e},_looksLikeTestDeclarationRange:function(e,t){return e&&t&&e[0]<=t[0]&&e[2]>=t[2]},_filesAreUpToDate:function(e){var t=this;return t._structure.awaitingFiles=_.without.bind(null,t._structure.awaitingFiles).apply(null,e),t._signalIfBecameLive()},_filesAreRequired:function(e){var t=this;t._structure.awaitingFiles=_.union(t._structure.awaitingFiles,e),t._structure.awaitingFiles.length&&(t._live=!0,t._emit({type:"filesRequired",files:t._structure.awaitingFiles}))},_signalIfBecameLive:function(){var e=this;if(e._structure&&!e._structure.awaitingFiles.length&&!e._live){e._live=!0;var t={type:"live"};return e._emit(t),process.env.quokka&&this._emitInternal(_.extend({type:"configChanged",settings:this._quokkaSettings},JSON.parse(process.env.quokka),{nodeVersion:process.version})),debug("Stopping process pool"),e._processorPool.stop(),!0}},_writeFileChanges:function(e,t,n){var i=this;e.changeTs=+new Date;var o,r=[];_.each(t,function(e){var t=_.isPatch(e);t?r.push(e):(o=e,r.length=0)});var a=r.length===t.length;return debug("File %s changes are patches only: %s",e.path,a),Q.all([a?i._readSourceFile(e.id,e.originalPath):Q.when(!1),i._dirEnsurePromise(path.dirname(e.originalPath)),i._dirEnsurePromise(path.dirname(e.instrumentedPath))]).then(function(t){a&&(o=t[0]);var n=void 0;return delete e.lastChangeIsComplex,_.each(r,function(t){var a=i._diffMatchPatch.patch_fromText(t),s=1===r.length&&3===t.split("@@").length;s?e.test&&_.each(a,function(e){e.diffs&&e.diffs.length&&2==e.diffs[0].length&&!e.diffs[0][0]&&(n=e.start2+e.diffs[0][1].length)}):e.lastChangeIsComplex=!0,o=i._diffMatchPatch.patch_apply(a,o)[0]}),process.env.quokka&&i._quokkaFileChanged(o),Q.all([e.binary?i._doWriteFile(e.originalPath,new Buffer(o,"base64")):i._writeSourceFile(e.originalPath,o),i._processFile(e,o,n,!i._live,!1)])}).then(function(){return e.ts=n,debug("File %s changes saved, store ts: %s, change ts: %s",e.path,e.ts,e.changeTs),Q.when(!0)})},_quokkaFileChanged:function(content){var inlineConfig,inlineConfigString;if(content){var match=/^[\s;]*(\s*\/\/.*?\r?\n)*\s*\(\s*?{/.exec(content);if(match&&match[0]){for(var braceStack=[],start=match[0].length-1,i=start,len=content.length;i<len;i++){var character=content[i];if("{"===character?braceStack.push(character):"}"===character&&braceStack.pop(),!braceStack.length)break}try{inlineConfig=eval("("+content.substring(start,i+1)+")"),inlineConfigString=JSON.stringify(inlineConfig)}catch(e){}}}if(this._settings._currentInlineQuokkaConfigString!==inlineConfigString){this._loadQuokkaSettings(inlineConfig),this._settings=this._quokkaSettings,this._settings._currentInlineQuokkaConfigString=inlineConfigString,this._settings._currentInlineQuokkaConfig=inlineConfig;var file=this._structure.filesByPath[this._quokkaFileName];delete file.noCompilers,delete file.noPreprocessors,this._recycleRunner=!0}},_processFile:function(e,t,n,i,o,r){var a=this;if(process.env.quokka&&(i=!1,a._settings.error))throw new Error(a._settings.error);if(e.changeStart=n,debug("Preparing to process %s",e.path),t=t&&t.toString()||"","node"===a.settings().env.type&&(a._isJavaScript(e)||a._isOriginallyTypeScript(e))&&((e.coverable||e.test)&&(t=t.replace(/^\#\!.*/,"")),a._isJavaScript(e)&&a._settings.testFramework.jsPreprocessor&&(t=a._settings.testFramework.jsPreprocessor(t))),a._settings.testFramework.version&&0===a._settings.testFramework.version.indexOf("jest")&&(a._isOriginallyTypeScript(e)||a._isJavaScript(e))&&(e.originalId?e.docBlockComment=(a._structure.filesById[e.originalId]||{}).docBlockComment:e.docBlockComment=utils.docBlockComment(t).replace(/\r?\n|\r/g," ")||void 0),e.originalId){var s=a._structure.filesById[e.originalId];s&&(e.includedTestFile=s.includedTestFile,e.excludedTestFile=s.excludedTestFile)}if("snap"===e.type){var l=a._structure.filesByPath[path.join(path.dirname(e.path),"..",path.basename(e.path,".snap"))];l&&(e.testFilesLoadedFrom=e.testFilesLoadedFrom||{},e.testFilesLoadedFrom[l.id]=runAlways)}i&&a._startProcessorPool(),!e.changeStart||e.noCompilers||e.binary||(e.changePosition=_.textIndexPosition(t,e.changeStart));var c=function(){return debug("File "+e.path+" is not instrumented by core"),e.ranges=[],e.validSyntax=!0,Q.when({code:t})};return(e.binary||!e.coverable&&!e.test?Q.fcall(c):(o?Q.when(t):a._runThroughProcessors(e,t,i,!0)["catch"](function(t){return a._cleanStack(t),Q.reject(new Error("Failed to run compilers on "+e.path+", "+(t&&(t.stack||t.message))))})).then(function(t){if(e.noScript)return Q.fcall(c);if(!e.noCompilers){debug("Processing compiled "+e.path),e.instrumentedType="js";var n=e.sourceMap,o=new SourceMapConsumer(n);delete e.sourceMap;var r=_.reduce(e.ranges,function(e,t){var n=e[t[0]]=e[t[0]]||[];return n.push(t),e},{});if(e.changePosition){e.changePosition.source=n.sources&&n.sources[0]||".";var s=a._findClosestRange(r,e.changePosition,!0);s&&(e.changePosition.column=s[1]),e.changePosition.bias=2,e.changeStart=o.generatedPositionFor(e.changePosition)}var l=a._isOriginallyCoffeeScript(e),p=function(t){_.each(t,function(t){var n={line:t[0],column:t[1]},i=o.originalPositionFor(n);if(5===t.length){var s="_extends"===t[4]||"React.createElement"===t[4];if(t.length=4,i.source&&!s){var c={line:t[0],column:t[1],bias:2},p=o.originalPositionFor(c);p.source&&i.line<p.line&&(i=p)}i.source||(n.column+=7,i=o.originalPositionFor(n),i.source||(l?(n.column+=7,i=o.originalPositionFor(n)):(n.column+=26,i=o.originalPositionFor(n))))}if(i.source)var d=a._findClosestRange(r,i);d?(e.lineMap[t[0]]=d[0],t[0]=d[0],t[1]=d[1],t[2]=d[2],t[3]=d[3]):t.length=0})}}if(!a._isOriginallyJavaScript(e)&&e.noCompilers)return Q.fcall(c);debug("Instrumenting "+e.path+", via process pool: "+i);var d=_.extend({},a._settings.hints);return e.test?process.env.quokka||d.allowIgnoringCoverageInTests||(d=_.omit(d,"ignoreCoverage","ignoreCoverageForFile")):d=_.omit(d,"testFileSelection"),a._instrument(e.scriptRange?t.substring(e.scriptRange.start,e.scriptRange.end):t,{file:e.tmp?e.originalId:e.id,testFileChangeStart:e.changeStart,fullMap:!e.noCompilers,hints:d,recordValues:a._settings.autoConsoleLog,preserveComments:a._settings.preserveComments||!1,automaticTestFileSelection:!process.env.quokka&&e.test&&a._settings.automaticTestFileSelection,sequenceExpressionToDiff:!!process.env.quokka},i).then(function(n){if(n.error)throw n.error;return p&&p(n.ranges),a._updateTestFileSelection(e,n),e.esm=n.esm,e.validSyntax=!0,e.ranges=n.ranges,e.lineMap=e.noCompilers?n.map:a._updateFileMap(e.lineMap,[JSON.parse(n.map)]),delete e.tmpLineMap,e.numberOfFunctionsChanged=e.numberOfFunctions!==n.numberOfFunctions,e.numberOfFunctions=n.numberOfFunctions,e.lastSingleChangeTest=e.test&&e.changeStart&&!e.numberOfFunctionsChanged&&n.testName,e.lastSingleChangeTest&&debug("Detected single test [%s] change",n.testName),e.docBlockComment&&n.code&&(debug("Re-attaching document block comment"),n.code=e.docBlockComment+n.code),e.scriptRange&&(n.code=t.substring(0,e.scriptRange.start)+n.code+t.substring(e.scriptRange.end)),Q.when(n)})["catch"](function(t){return e.validSyntax=!1,a._cleanStack(t),Q.when(new Error("Failed to parse "+e.path+", "+(t&&(t.stack||t.message))))})})).then(function(t){return t instanceof Error?Q.when(t):a._runThroughProcessors(e,t.code,i,!1).then(function(t){return r?Q.when(t):(debug("Writing to disk and caching processed file %s",e.path),e.binary?a._doWriteFile(e.instrumentedPath,new Buffer(t,"base64")):a._doWriteFileWithLruCache(e.instrumentedPath,t))})["catch"](function(t){return a._cleanStack(t),Q.when(new Error("Failed to run preprocessors on "+e.path+", "+(t&&(t.stack||t.message))))})}).then(function(e){return e instanceof Error?Q.reject(e):Q.when(e)})},_updateTestFileSelection:function(e,t){if(e){t.includedTestFile&&t.excludedTestFile&&delete t.includedTestFile;var n=e.includedTestFile,i=e.excludedTestFile;e.includedTestFile=t.includedTestFile,e.excludedTestFile=t.excludedTestFile,e.originalId||this._updateFileStructure(e),e.includedTestFile===n&&e.excludedTestFile===i||(this._testSelectionChanged=!0),e.originalId&&this._updateTestFileSelection(this._structure.filesById[e.originalId],t)}},_findClosestRange:function(e,t,n){var i=e[t.line];if(i)for(var o,r=1/0,a=0;a<i.length;a++){var s=i[a],l=Math.abs(s[1]-t.column);l<r&&(!n||s[1]<=t.column)&&(r=l,o=s)}return o},_runThroughProcessors:function(e,t,n,i){var o=this;if(!Object.keys(i?o._settings.compilers:o._settings.preprocessors).length||(i?e.noCompilers:e.noPreprocessors))return debug("No %s configured for %s",i?"compilers":"preprocessors",e.path),i?e.noCompilers=!0:e.noPreprocessors=!0,Q.when(t);var r={content:t,config:process.env.quokka?o._settings:o._configFile,file:e,root:o._instrumentedRoot,type:i?"compiler":"preprocessor"};return(n&&o._processorPool.started()?o._processorPool.run(r):processor(r)).then(function(t){if(t.error)throw t.error;return i?e.noCompilers=t.noProcessors:e.noPreprocessors=t.noProcessors,o._updateInstrumentedFile(t,e,i&&!e.noCompilers),Q.when(t.content)})},_updateInstrumentedFile:function(e,t,n){var i=this;n&&delete t.lineMap,e.maps&&e.maps.length&&(t.lineMap=i._updateFileMap(t.lineMap,e.maps)),e.newPath&&(t.instrumentedPath=path.resolve(i._instrumentedRoot,e.newPath),t.instrumentedType=_.trim(path.extname(t.instrumentedPath),"."),
i._structure.filesRenamed[e.newPath]=t.path),n&&(t.ranges=e.ranges,t.scriptRange=e.scriptRange,t.noScript=e.noScript,t.sourceMap=e.maps&&e.maps[0],t.ranges&&t.ranges.length||t.noScript||debug("Compiler did not set ranges for file [%s]",t.path),t.sourceMap||t.noScript||debug("Compiler did not set source map for file [%s]",t.path))},_updateFileMap:function(e,t){e=e||{};var n=_.extend({},e);return _.each(t,function(e){var t=new SourceMapConsumer(e),i={},o=_.isEmpty(n),r=_.extend({},n);t.eachMapping(function(e){if(e.generatedLine&&e.originalLine){var t=i[e.generatedLine],a=r[e.originalLine];if(!t||e.name){var s=a||t;s?i[e.generatedLine]=s:o&&(i[e.generatedLine]=e.originalLine),"__awaiter"===e.name&&delete i[e.generatedLine]}a&&delete n[e.originalLine]}}),n=_.extend({},n,i)}),n},_instrument:function(e,t,n){var i=this;return n&&i._processorPool.started()?i._processorPool.run({content:e,opts:t,type:"instrumentor"}):Q.fcall(function(){return instrument(e,t)})},_writeSourceFile:function(e,t){var n=this,i=n._sourceFileCache[e];return i?(i.content=t,Q.when(!0)):n._doWriteFile(e,t)},_doWriteFile:function(e,t){var n=this;return n._dirEnsurePromise(path.dirname(e)).then(function(){return n._writeFilePromise(e,t)})},_doWriteFileWithLruCache:function(e,t){var n=this;return n._dirEnsurePromise(path.dirname(e)).then(function(){return n._writeFilePromise(e,t)}).then(function(){return n._lruCache.set(e,t),Q.when(!0)})},_deleteSourceFile:function(e){var t=this;return delete t._sourceFileCache[e],t._unlinkFilePromise(e)},readSourceFile:function(e){var t=this._getFileMetadataById(e);return t&&this._readSourceFile(e,t.originalPath)},_readSourceFile:function(e,t){var n=this,i=n._sourceFileCache[t];return i?(debug("Returning previously cached file [%s] from memory",e),Q.when(i.content)):n._readFilePromise(t).then(function(i){var o=Q.when(!0),r=_.keys(n._sourceFileCache);if(r.length>=2){var a=r[0],s=n._sourceFileCache[a];delete n._sourceFileCache[a],n._structure.filesById[s.id]?(o=n._doWriteFile(a,s.content),debug("Writing previously cached file [%s] to disk",a)):debug("Previously cached file [%s] was deleted and does not need saving to disk",a)}return debug("Caching file [%s] in memory",e),n._sourceFileCache[t]={content:i,id:e},o.then(function(){return Q.when(i)})})},_flushSourceFileCacheSync:function(){var e=this;try{_.each(e._sourceFileCache,function(t,n){e._dirEnsureSync(path.dirname(n)),e._writeFileSync(n,t.content)})}catch(t){_.each(e._sourceFileCache,function(t){var n=e._structure.filesById[t.id];n&&(n.ts=0)})}},_getOrCreateFileMetadata:function(e){var t=this,n=t._structure.filesByPath[e.path];if(!n){var i=t._createFileMetadata(e,e.id);return t._fileOrderUpdatePending=!0,i}return n},_getFileMetadataById:function(e){var t=this;return t._structure.filesById[e]},getFileMetadataByPath:function(e){var t=this;return t._structure.filesByPath[e]},_overrideFileType:function(e,t,n){},_createFileMetadata:function(e,t){var n=this;if(path.resolve(e.path)===path.normalize(e.path).replace(new RegExp(path.sep+"$"),""))throw new Error("Configured file paths must be relative: "+e.path);var i=path.join(n._originalRoot,e.path),o=path.join(n._instrumentedRoot,e.path);if(e.instrumentedPath&&o!==e.instrumentedPath){o=e.instrumentedPath,e.instrumentedType=_.trim(path.extname(o),".");var r=path.relative(n._instrumentedRoot,o);r!==e.path&&(n._structure.filesRenamed[r]=e.path)}var a=e.type,s=n._overrideFileType(e.type,e.path,e.id)||e.type,l={id:t,path:e.path,type:s||"js",originalType:e.originalType||a||s,binary:e.binary||void 0,tmp:e.tmp||void 0,instrumentedType:e.instrumentedType||s||"js",order:e.order,originalPath:i,instrumentedPath:o,ts:e.ts,changeTs:e.ts,triggersTests:e.triggersTests,include:e.include,initialInclude:_.isBoolean(e.initialInclude)?e.initialInclude:e.include,esm:e.esm,includedTestFile:e.includedTestFile,excludedTestFile:e.excludedTestFile,coverable:e.coverable,test:e.test,tests:e.tests||{},ranges:e.ranges||void 0,lineMap:e.lineMap||void 0,tmpLineMap:e.tmpLineMap||void 0,validSyntax:e.validSyntax||void 0,numberOfFunctions:e.numberOfFunctions||void 0,docBlockComment:e.docBlockComment||void 0,getFileLineMap:function(){return this.tmpLineMap||this.lineMap}};return n._updateFileStructure(l),l},_deleteTmpFiles:function(){var e=this;this._deleteDependantFilesMetadata(),_.each(e._structure.filesByPath,function(t){return t.tmp&&e._deleteFileMetadata(t)}),e._fileOrderUpdatePending=!0},_deleteDependantFilesMetadata:function(e){var t=this;e?(_.each(e.dependant,function(e){return t._deleteFileMetadata(e)}),e.dependant={}):_.each(t._structure.filesByPath,function(e){return t._deleteDependantFilesMetadata(e)})},_deleteFileMetadata:function(e){var t=this,n=t._structure.filesByPath[e.path];if(n)return t._updateFileStructure(n,!0),t._fileOrderUpdatePending=!0,n},_updateFileStructure:function(e,t){var n=this;t?(n._deleteDependantFilesMetadata(e),delete n._structure.filesById[e.id],delete n._structure.testFilesById[e.id],delete n._structure.filesByPath[e.path],delete n._structure.testFileSelectionById.excluded[e.id],delete n._structure.testFileSelectionById.included[e.id]):(n._structure.filesById[e.id]=e,n._structure.filesByPath[e.path]=e,e.test&&(n._structure.testFilesById[e.id]=e,delete n._structure.testFileSelectionById.included[e.id],delete n._structure.testFileSelectionById.excluded[e.id],e.includedTestFile&&(n._structure.testFileSelectionById.included[e.id]=e),e.excludedTestFile&&(n._structure.testFileSelectionById.excluded[e.id]=e)))},selectedTestFiles:function(){var e=!_.isEmpty(this._structure.testFileSelectionById.included),t=!_.isEmpty(this._structure.testFileSelectionById.excluded);return{hasSomeIncludedTestFiles:e,hasSomeExcludedTestFiles:t}},hasSomeSelectedTestFiles:function(){var e=this.selectedTestFiles();return e.hasSomeIncludedTestFiles||e.hasSomeExcludedTestFiles},isExcludedTestFile:function(e){return!!this._structure.testFileSelectionById.excluded[e]},isIncludedTestFile:function(e){return!!this._structure.testFileSelectionById.included[e]},getIncludedTestFiles:function(){return _.values(this._structure.testFileSelectionById.included)},getNotExcludedTestFiles:function(){var e=this;return _.filter(this._structure.testFilesInOrder,function(t){return!t.originalId&&!e.isExcludedTestFile(t.id)})},_getExcludedTestFiles:function(){return _.values(this._structure.testFileSelectionById.excluded)},_additionalHeaderMessage:function(){var e=this.selectedTestFiles();if(this._settings.runSelectedTestsOnly||e.hasSomeIncludedTestFiles||e.hasSomeExcludedTestFiles){var t="";return this._settings.runSelectedTestsOnly&&!e.hasSomeIncludedTestFiles?t="no test files selected":e.hasSomeIncludedTestFiles&&(t="only executed "+_.map(this.getIncludedTestFiles(),function(e){return e.path}).join(", ")),!t&&e.hasSomeExcludedTestFiles&&(t="skipped "+_.map(this._getExcludedTestFiles(),function(e){return e.path}).join(", ")),"("+t+")"}},_updateFileOrder:function(){var e=this;e._fileOrderUpdatePending&&(e._structure.testFilesInOrder=[],e._structure.sourceFilesInOrder=[],_.each(e._orderFilesByConfig(e._structure.filesByPath),function(t){t.test?e._structure.testFilesInOrder.push(t):e._structure.sourceFilesInOrder.push(t)}),delete e._fileOrderUpdatePending)},_orderFilesByConfig:function(e){return _.chain(e).sortBy(function(e){return e.path}).sortBy(function(e){return e.order}).value()}}),module.exports=Project},{"./babelCompiler":6,"./config":10,"./instrumentor":15,"./processor":21,"./testTask":24,"./tracking":26,"./typeScriptPostprocessor":28,"./typeScriptUtils":29,"./utils":31,child_process:void 0,debug:void 0,"lru-cache":void 0,minimatch:void 0,module:void 0,path:void 0,"source-map":void 0,typescript:void 0,util:void 0}],23:[function(e,t,n){var i,o=e("os"),r=e("path"),a=e("http"),s=e("./utils"),l=e("ws").Server,c=/^win/.test(process.platform),p=5e3,d=200,u="&wallabyFileId=",h="Wallaby.js cache is corrupted, please restart wallaby.js",m=function(t,n){var o=this;i=e("debug")("wallaby:workers"),o._project=t,o._opts=t.settings(),o._extension=n,process.env.quokka&&(o.reportConsoleOutput=function(e){var n=_.extend({},e);t.resolveLogEntryRange(n),t._emitInternal({type:"consoleOutput",data:n})},o.reportIntermediateResult=function(e){}),o._sessions={},o._executedTestNumber=0,o._workers={},o._connectingWorkers={},o._workerPendingCleanup={},o._calculateNumberOfParallelWorkers();for(var a=0;a<Math.max(o._maxWorkers,o._minWorkers);a++)o.getWorker(a);o._normalizedWallabyServerPath=this._project.normalizePath(r.dirname(process.mainModule.filename)),o._normalizedLocalRoot=this._project.normalizePath(this._project._localRoot)};m.prototype={start:function(e){var t=this,n=t._httpServer=e?a.createServer(e):a.createServer();return n.listen(0),Q.promise(function(e,o){n.on("listening",function(){try{t._receiverPort=n.address().port,i("Web server is listening at "+t._receiverPort),t._wss=new l({server:n,verifyClient:function(e){return _.verifyLocalOrigin(e.origin)}}),t._wss.on("connection",function(e){e.on("message",function(n){var o;try{o=JSON.parse(n)}catch(r){return void console.error("Failed to deserialize message from worker: "+n+", "+(r&&r.message))}if(o.worker){var a=t._workers[o.worker];if(!a)return;if(a.onConnected)a.onConnected(e);else if(process.env.quokka&&a.instance){if(a.instance.channel)try{a.instance.channel.close(),a.instance.channel.removeAllListeners()}catch(r){}a.instance.channel=e}try{e.send(JSON.stringify({type:"in:connected"}))}catch(r){console.error('Failed to send the "connected" message to worker. '+r.message)}}else if(o.session){var s=t._sessions[o.session],l=!s||s._disposing||t._cancelled;if("console"===o.type&&o.data){if("debugLog"===o.data.type)return void i(o.data.text);(o.data.spec||process.env.quokka)&&!l||"autoLog"===o.data.type||console.log("console."+o.data.type+": "+o.data.text)}if(l)return;try{s[o.type](o.data)}catch(r){console.error("Failed to process message "+o.type+" from worker, "+(r&&r.message)),s.reject(r)}}})}),e()}catch(r){o(r)}})})},wallabyFileIdPrefix:function(){return u},receiverPort:function(){return this._receiverPort},setFileRoot:function(e){this._fileRoot=this._project.normalizePath(e)},run:function(e){var t=this;return t._cancelled=!1,t._executedTestNumber=0,t._runPriority=e.priority,e.recycleBeforeRun&&_.each(t._workers,function(e,n){t.recycleWorker(n)}),i("Starting test run, priority: "+t._runPriority),(e.fullRun&&t._maxWorkers>1&&e.testFilesToLoad.length>1?t._runInParallel(e,t._maxWorkers):t._minWorkers>1&&e.testFilesToLoad.length>1&&!(e.fullRun&&t._maxWorkers<t._minWorkers)?t._runInParallel(e,t._minWorkers):t._extension.prepare(e,0).then(function(e){return t._runTests(e)})).then(function(e){return t._executedTestNumber&&console.log("Finished executing "+t._executedTestNumber+" affected test(s)"),Q.when(e)})},_handleError:function(e,t,n,o,r,a,s){var l=this;a===s&&(a=s=void 0),i("Sandbox (%s) [%s] error: %s",e.active()?"active":"inactive",t,n);var c=l._reportableError(n,o),p="SyntaxError: Parse error"===n&&_.isEmpty(o);if(l._corruptedCache(c))return l._project.invalidateCache(),e.reject(new Error(h)),void e.recycleWorker();if(process.env.quokka?i("Runtime error: "+c):console.error("Runtime error: "+c),e.active()){if(e.scheduleCompleteIfNotActiveFor(100),!o)return void e.reject(new Error(n));if(!p)try{var d={message:n,stack:_.isString(o)?o:_.reduce(o,function(e,t){return e+t.file+":"+t.line+"\n"},""),external:!0,actual:a,expected:s},u=[d];l._processTestLog(u),d.stack&&d.stack.length||(~d.message.indexOf("Cannot find module")||(d.message=c),d.stack=[]),!r&&e._executingTest?e.addToTestLog(d):e._globalErrors.push(d)}catch(m){e.reject(new Error(n+", "+(m&&m.message)))}}},_runTests:function(e){var t=this;if(t.cancelled())return Q.reject({runCancelled:!0});i("[%s] Running tests in sandbox",e.name);var n=e.sessionId,o=e.workerId;return Q.promise(function(r,a){t.cancelled()&&a({runCancelled:!0});try{var s=function(){var i=t._createSession(n,o,e.instance,r,a);e.instance.start(function(e){return t.cancelled()?(i.reject({runCancelled:!0}),!1):"success"===e||(i.reject(new Error("Sandbox load failed, status: "+e)),!1)},function(e,o,r,a){t._handleError(i,n,e,o,!1,r,a)})},l=t._workerPendingCleanup[o];l?(i("[%s] Sandbox is waiting for worker cleanup",n),l.onDone=function(e){return t.cancelled()?(i("[%s] Sandbox run is canceled while it was waiting for worker cleanup",n),a({runCancelled:!0})):e?(i("[%s] Sandbox worker requires recycling",n),a({runCancelled:!0,rerun:!0})):void s()}):s()}catch(c){a(c)}}).then(function(e){if(e.session){var n=e.session,i=t._createRunResult(n,e.time);return _.each(_.keys(n),function(e){e&&"_"===e[0]&&!_.isFunction(n[e])&&"_disposing"!==e&&delete n[e]}),delete e.session,Q.when(i)}return Q.when(e)})},_createRunResult:function(e,t){var n=this,i=e._coverage,o=e._loadingSequence,r=e._tests,a=e._log,s=e._globalErrors.concat(e._executingTestLog);return _.each(s,function(e){return n._removeAnsi(e)}),s.length||(s=void 0),{coverage:i,tests:r,log:a,globalErrors:s,loadingSequence:o,time:t}},_removeAnsi:function(e){return!s.hasAnsi(e.message)||s.hasAnsi(e.actual)||s.hasAnsi(e.expected)||(e.message=s.removeAnsi(e.message)),e},_reportableError:function(e,t){var n=this;if(_.isString(t)){var i={stack:t};return n._project._cleanStack(i),t=i.stack}return e},cancel:function(e){var t=this;if(!_.isEmpty(t._sessions))return e>=t._runPriority&&(_.each(t._sessions,function(e){e.reject({runCancelled:!0})}),t._cancelled=!0,i("Cancelling test run, cancel requester priority: %s, current run priority: %s",e,t._runPriority),!0)},cancelled:function(){return this._cancelled},_createSession:function(e,t,n,o,r){var a=this;return a._sessions[e]={_coverage:{},_tests:[],_loadingSequence:{},_log:[],_executingTestLog:[],_globalErrors:[],_total:0,_skipped:0,_disposing:!1,_exceededMaxTestAllowedLogLimit:!1,_onFinished:n.closing,_messagesPerTest:{},_closeByErrorTimeout:0,_longRunningWarningTimeout:0,_longRunningPingTimeout:0,_executingFiles:{},_executingTest:void 0,started:function(t){var n=this;i("[%s] Loaded %s test(s)",e,t.total),this._total=t.total,_.each(t.loadingSequence,function(e){e.length>1&&(n._loadingSequence[e[0]]=e.slice(1))})},active:function(){return!this._disposing&&!a._cancelled},scheduleCompleteIfNotActiveFor:function(e){var t=this;clearTimeout(t._closeByErrorTimeout),t._closeByErrorTimeout=setTimeout(function(){t.complete()},e)},addToTestLog:function(e){var t=this._executingTestLog[this._executingTestLog.length-1];t&&this._areLogEntryMessagesEqual(t.message||void 0,e.message||void 0)&&t.stack&&e.stack&&t.stack.length>0&&e.stack.length>0&&_.isEqual(e.stack[0],t.stack[0])?e.stack.length>t.stack.length&&(t.stack=e.stack):this._executingTestLog.push(e)},_areLogEntryMessagesEqual:function(e,t){return void 0===e&&(e=""),void 0===t&&(t=""),e===t||(a._opts.testFramework&&a._opts.testFramework.version&&0===a._opts.testFramework.version.indexOf("mocha")?e.indexOf(":")>0&&_.contains(e,t)||t.indexOf(":")>0&&_.contains(t,e):void 0)},intermediateComplete:function(){a.reportIntermediateResult&&a.reportIntermediateResult(a._createRunResult(this))},complete:function(t){var n=this;clearTimeout(this._closeByErrorTimeout),clearTimeout(this._longRunningWarningTimeout),clearTimeout(this._longRunningPingTimeout),n._onFinished(),this._dispose(function(){a._cancelled?r({runCancelled:!0}):o({session:n,time:t&&t.time})}),i("[%s] Run %s test(s), skipped %s test(s)",e,this._tests.length-this._skipped,this._skipped)},globalError:function(t){a._handleError(this,e,t.message,t.stack,t.declaration,t.actual,t.expected)},programScopeStart:function(e){this._executingFiles[e]=1,this._setTimeoutForLongRunningOperation()},programScopeEnd:function(e){delete this._executingFiles[e],_.isEmpty(this._executingFiles)&&!this._executingTest&&(clearTimeout(this._longRunningWarningTimeout),clearTimeout(this._longRunningPingTimeout))},preTest:function(e){this._setTimeoutForLongRunningOperation(),this._executingTest=e},postTest:function(){delete this._executingTest},_setTimeoutForLongRunningOperation:function(){if(!process.env.quokka){var e=this;clearTimeout(this._longRunningWarningTimeout),clearTimeout(this._longRunningPingTimeout),this._longRunningWarningTimeout=setTimeout(function(){var t="Some long running code has been detected: ",i=e._executingTest,o=!_.isEmpty(e._executingFiles);if(t+=(i?'test "'+i+'"':"one of your "+(o?"files":"tests"))+" is taking more than "+p+"ms to execute.",o&&(t+="\nExecution of the following files has started but has not finished:",_.each(e._executingFiles,function(e,n){var i=a._project._getFileMetadataById(n);t+="\n- "+(i?i.path:"unknown")})),e._log.length&&(t+="\nThe last recorded console.log: "+_.last(e._log).text),i||o){t+="\nTry commenting out the test or excluding the test file from the `tests` list in your wallaby config,\nand restarting wallaby to make sure that it is this test/file causing the issue and not something else.",i&&(t+="\nAlso review your recent changes to the code that the test covers, as well as its `before` and `after` hooks."),t+="\nPinging test runner sandbox...";try{n.ping(function(){clearTimeout(e._longRunningPingTimeout),e.active()&&console.warn("Sandbox is responsive. The issue may have the asynchronous nature, like a missing callback.")}),e._longRunningPingTimeout=setTimeout(function(){console.warn("The sandbox is not responsive. Check for possibly recently introduced infinite loops.")},d)}catch(r){t+="\nThe sandbox ping failed: "+r.message}}console.warn(t)},p)}},module:function(e){a._project._emitInternal({type:"moduleLoaded",path:e.path,session:this})},test:function(t){var n=this;return delete this._executingTest,clearTimeout(this._closeByErrorTimeout),this._setTimeoutForLongRunningOperation(),t.hook&&t.log?(a._processTestLog(t.log),_.isString(t.hook)&&_.each(t.log,function(e){e.message=t.hook+(e.message?": ":"")+e.message}),void(this._globalErrors=this._globalErrors.concat(t.log))):(t.skipped?(this._skipped++,a._processTestLog(t.log)):(i("[%s] Test executed: "+t.name,e),a._processTestLog(t.log),t.log&&_.each(t.log,function(e){return n.addToTestLog(e)}),this._executingTestLog.length&&(t.log=this._executingTestLog.slice()),_.isUndefined(t.slow)&&(t.slow=t.time>a._opts.slowTestThreshold),t.slow=t.slow||void 0,this._executingTestLog.length=0,++a._executedTestNumber%50||console.log("Execution progress: "+a._executedTestNumber+" tests")),void this._tests.push(t))},coverage:function(e){this._coverage[e.id]=e.ranges},console:function(e){var t=a._opts.maxConsoleMessagesPerTest,n=this._messagesPerTest[e.spec]=(this._messagesPerTest[e.spec]||0)+1;n===t+1?console.warn("Number of console messages per test exceeded maximum allowed value ("+t+"), current test console messages recording stopped.\nYou may increase the limit by adding `maxConsoleMessagesPerTest` setting to your config file."):n<=t&&this._log.push(e),a.reportConsoleOutput(e)},resume:function(){i("Sandbox requested early screen shot capture"),this._onFinished(),this._onFinished=_.noop,n.resume()},reject:function(e){this._disposing||this._dispose(function(){r(a._cancelled?{runCancelled:!0}:e)})},recycleWorker:function(){a.recycleWorker(t)},_dispose:function(o){this._disposing=!0,clearTimeout(this._closeByErrorTimeout),clearTimeout(this._longRunningWarningTimeout),clearTimeout(this._longRunningPingTimeout);var r=a._workerPendingCleanup[t]={},s=!1,l=!1,c=function(n){l=!0,s&&clearTimeout(s),delete a._sessions[e],r.onDone&&r.onDone(n),delete a._workerPendingCleanup[t],o()},p=function(){l||(i("[%s] Sandbox is not responsive, recycling worker instance",e),a._tryClosingSandbox(n.close,e),a.recycleWorker(t),c(!0))};try{n.ping(function(){l||(i("[%s] Sandbox is responsive, closing it",e),a._tryClosingSandbox(n.close,e),c())})}catch(d){return i("[%s] Sandbox can not be pinged: %s",e,d&&d.message),void p()}s=setTimeout(function(){p()},1e3)}}},_tryClosingSandbox:function(e,t){try{e()}catch(n){i("[%s] Sandbox closing error, %s",t,n.message)}},_corruptedCache:function(e){return e&&e.match(/evaluating '[a-z]\.\$_\$coverage\[/)},_processTestLog:function(e){var t=this,n=u.length;_.each(e,function(e){var o=e.message&&e.message.indexOf(" in file:///")||-1;if(~o&&(e.message=e.message.substring(0,o)),t._corruptedCache(e.message)&&(t._project.invalidateCache(),e.message=h),t._removeAnsi(e),e.stack&&_.isString(e.stack)){var r,a,l=[],c={},p=e.stack.split("\n");p&&t._corruptedCache(p[0])&&(t._project.invalidateCache(),e.message=h),_.each(p,function(e){var i=e.lastIndexOf(u);if(~i){var o=e.substr(i+n).split(":");o.length>=2&&(r=t._project.stackEntryByFileId(parseInt(o[0],10)||o[0],parseInt(o[1],10)),r&&r.line&&(a=t._extractBrowserStackLineContext(e),a&&(c[l.length]=a),l.push([r.file,r.line])))}else if(process.env.quokka){if(process.env.quokka)if(e=t._project.normalizePath(e),_.contains(e,t._normalizedWallabyServerPath)){if(_.contains(e,"quokkaStackTraceMarker"))return!1}else{var p,d,h=e;e=e.replace(t._normalizedLocalRoot,".");var m=h!==e?h.lastIndexOf(t._normalizedLocalRoot):e.lastIndexOf("(")+1;if(w=h!==e?e.substr(m).split(":"):e.substring(m,e.lastIndexOf(")")-1).split(":"),3===w.length){a=t._extractNodeStackLineContext(e,m);var f=parseInt(w[1],10);r=t._project.stackEntryByFilePath(t._project.normalizePath(s.isLevelUpRelativePath(w[0])?w[0]:_.ltrim(w[0],"./")),f),r&&r.line?(p=r.file,d=r.line):(p=w[0],d=f),a&&(c[l.length]=a),l.push([p,d])}}}else{e=t._project.normalizePath(e);var S=t._fileRoot?e.lastIndexOf(t._fileRoot):-1;if(~S){var w=_.rtrim(e.substr(S+t._fileRoot.length),")").split(":");3!==w.length&&2!==w.length||(r=t._project.stackEntryByFilePath(t._project.normalizePath(_.ltrim(w[0],"/")),parseInt(w[1],10)),r&&r.line&&(a=t._extractNodeStackLineContext(e,S),a&&(c[l.length]=a),l.push([r.file,r.line])))}}}),l.length||i("Failed to map the stack to user code, entry message: %s, stack: %s",e.message&&e.message.substring(0,1024),e.stack.substring(0,1024)),e.message=t._project._cleanMessage(e.message),"node"===t._project.settings().env.type&&~e.message.indexOf("Cannot find module")&&(e.message=t._project._cleanMessage(e.message,t._project._root)),e.stack=l,_.isEmpty(c)||(e.context=c)}process.env.quokka&&e.message&&(e.message=e.message.replace(t._normalizedLocalRoot,".").replace(t._project._localRoot,"."))})},_extractNodeStackLineContext:function(e,t){if(t>4&&"("===e[t-1]){var n=e.substr(0,t-2)||"";return n.split("at ")[1]}},_extractBrowserStackLineContext:function(e){var t=e.split(" (http");return t.length>=2?(t[0]||"").split("at ")[1]:(t=e.split("@http"),t.length>=2?t[0]:void 0)},_runInParallel:function(e,t){var n=this,o=e.testFilesToLoad,r={};i("Distributing tests between %s workers",t);for(var a=0;a<t;a++){var s=_.omit(e,"testFiles");s.testFilesToLoad=[],r[a]={opts:s,workerId:a,ranges:0}}return _.each(o,function(e){var t=_.sortBy(r,function(e){return e.ranges})[0];t.opts.testFilesToLoad.push(e),t.ranges+=e.rangesLength}),i("Running tests in parallel"),Q.all(_.chain(r).filter(function(e){return e.ranges}).map(function(e){return n._extension.prepare(e.opts,e.workerId).then(function(e){return n._runTests(e)})}).value()).then(function(e){i("Merging parallel test run results");var t=_.reduce(e,function(e,t){e.runCancelled=t.runCancelled||e.runCancelled,e.tests=e.tests.concat(t.tests||[]),e.log=e.log.concat(t.log||[]),e.globalErrors=e.globalErrors.concat(t.globalErrors||[]),e.error=t instanceof Error||e.error,e.loadingSequence=_.extend(e.loadingSequence,t.loadingSequence||{});var n=e.coverage;return _.isEmpty(n)?(e.coverage=t.coverage,e):(_.each(t.coverage,function(e,t){var i=n[t];return i?void _.each(e,function(e,t){var n=i[t];return n?void _.extend(n,e):void(i[t]=e)}):void(n[t]=e)}),e)},{coverage:{},tests:[],log:[],globalErrors:[],loadingSequence:{}});return t.runCancelled?Q.reject(t):t.error?Q.reject(t.error):Q.when(t)})},getWorker:function(e){var t=this,n=t._workers[e];return n||(n=t._workers[e]={id:e,promise:Q.promise(function(n,o){var r=t._workers[e];if(r)if(r.instance){if(t._extension.healthy(r.instance))return void n(r);i("Found inactive run worker instance #%s, recycling",e),t.recycleWorker(e)}else if(r.promise)return r.promise;i("Starting run worker instance #"+e);try{t._extension.create(e,function(r){if(!r)return void o(new Error("Failed to create worker instance"));var a=t._workers[e]=t._workers[e]||{id:e};if(r.onConnected){a.onConnected=_.bind(r.onConnected,a),delete r.onConnected;var s,l;a.promise=Q.promise(function(e,t){s=e,l=t});var c=!1,p=setTimeout(function(){if(!c){d();var n=t._workers[e];n&&n._connected?t._extension.recycle(r):t.recycleWorker(e),i("Worker is not created in time, recycling it"),l&&l({runCancelled:!0,rerun:!0}),o({runCancelled:!0,rerun:!0})}},1e4),d=function(){c=!0,clearTimeout(p)},u=t._connectingWorkers[e];u&&t._extension.recycle(u),t._connectingWorkers[e]=r,a.onConnected(function(o){delete t._connectingWorkers[e],c||(d(),i("Started run worker instance (delayed) #"+e),a.instance=r,a._connected=!0,r.channel=o,a.promise=Q.when(r),s&&s(r),n(r))})}else i("Started run worker instance (immediate) #"+e),a.instance=r,a.promise=Q.when(r),n(r)})}catch(a){o(a)}})}),n.promise},reportConsoleOutput:function(e){},recycleWorker:function(e){var t=this;try{var n=t._workers[e];n&&n.instance&&t._extension.recycle(n.instance)}catch(o){i("Error while recycling run worker instance #%s: %s",e,o&&(o.stack||o.message))}finally{delete t._workers[e],delete t._workerPendingCleanup[e]}},stop:function(){var e=this;_.each(e._workers,function(t,n){e.recycleWorker(n)});try{e._wss&&e._wss.close()}catch(t){}try{e._httpServer&&e._httpServer.close()}catch(t){}},_calculateNumberOfParallelWorkers:function(){var e=this;e._maxWorkers=Math.max(1,e._opts.workers.initial||Math.max(o.cpus().length-2,2)),c&&!e._opts.workers.initial&&"phantomjs"===e._opts.env.kind&&(e._maxWorkers=Math.min(16,e._maxWorkers)),e._minWorkers=Math.max(1,e._opts.workers.regular||Math.max(Math.floor(e._maxWorkers/2),2)),i("Parallelism for initial run: %s, for regular run: %s",e._maxWorkers,e._minWorkers)}},t.exports=m},{"./utils":31,debug:void 0,http:void 0,os:void 0,path:void 0,ws:void 0}],24:[function(e,t,n){"use strict";var i={testRunPriority:1,fileChangePriority:2,fullRunPriority:3},o=function(){function t(e){this._filesAndAffectedTests={},this._failingTests={},this._tests=[],this._priority=0,this._project=e}return t.prototype.files=function(){return _.reduce(this._filesAndAffectedTests,function(e,t){return e[t.file.id]=t.file,e},{})},t.prototype.hasFiles=function(){return _.keys(this._filesAndAffectedTests).length>1},t.prototype.addTests=function(e){this._tests=this._tests.concat(e)},t.prototype.addChangedFile=function(e,t){this._mergeAffectedTests(e.id,{file:e,tests:t,testFilesLoadedFrom:e.testFilesLoadedFrom})},t.prototype.setTestRunPriority=function(){this._priority=i.testRunPriority},t.prototype.setFileChangeRunPriority=function(){this._priority=i.fileChangePriority},t.prototype.setFullRunPriority=function(){this._priority=i.fullRunPriority},t.prototype.setEditorRequestedRun=function(){this._editorRequestedRun=!0},t.prototype.getFullRunPriority=function(){return i.fullRunPriority},t.prototype.getPriority=function(){return this._priority},t.prototype.isFullRun=function(){return this._priority===i.fullRunPriority},t.prototype.isFileChangedRun=function(){return this._priority===i.fileChangePriority},t.prototype.isManualRun=function(){return this._priority===i.testRunPriority&&!this._editorRequestedRun},t.prototype.isEditorRequestedRun=function(){return this._priority===i.testRunPriority&&this._editorRequestedRun},t.prototype.filesAdded=function(){this._anyFilesAdded=!0},t.prototype.filesDeleted=function(){this._anyFilesDeleted=!0},t.prototype.anyFilesAdded=function(){return this.isFullRun()||this._anyFilesAdded},t.prototype.anyFilesDeleted=function(){return this._anyFilesDeleted},t.prototype.mergeTask=function(e){var t=this;t._priority=Math.max(t._priority,e._priority),_.each(e._filesAndAffectedTests,function(e,n){t._mergeAffectedTests(n,e)}),t._failingTests=_.extend({},e._failingTests,t._failingTests),t._tests=t._tests.concat(e._tests),t._anyFilesAdded=t._anyFilesAdded||e._anyFilesAdded,t._anyFilesDeleted=t._anyFilesDeleted||e._anyFilesDeleted},t.prototype._mergeAffectedTests=function(e,t){var n=this,i=n._filesAndAffectedTests[e];i?(i.tests=i.tests?i.tests.concat(t.tests):t.tests,i.testFilesLoadedFrom=_.extend(i.testFilesLoadedFrom||{},t.testFilesLoadedFrom||{})):n._filesAndAffectedTests[e]=t},t.prototype.failingTest=function(e,t){var n=this._failingTests[e]=this._failingTests[e]||[];n.push(t)},t.prototype._getAllTests=function(){var t=this,n=[],i=!1,o={},r={},a=0,s=0,l=0,c=0,p=0;if(_.each(t._filesAndAffectedTests,function(e){var s=e.file;e.tests=_.map(e.tests,function(n){var i=t._getTestFileId(n);return o[i]||(o[i]=1,a++),e.testFilesLoadedFrom&&e.testFilesLoadedFrom[i]||s.numberOfFunctionsChanged||s.lastChangeIsComplex||s.relatedFilesWithTests?[n[0]]:n}),s.test&&(i=!0),s.test&&s.lastSingleChangeTest&&!s.relatedFilesWithTests&&!t._project.hadGlobalErrorsPreviousRun()&&(e.tests=[[s.id,"?",s.lastSingleChangeTest]]),n=n.concat(e.tests),_.extend(r,e.testFilesLoadedFrom||{})}),_.each(t._tests,function(e){var n=t._getTestFileId(e);o[n]||(o[n]=1,s++)}),n=n.concat(t._tests),!n.length&&t._project._lastAffectedTestFileIds&&(n=n.concat(_.map(t._project._lastAffectedTestFileIds,function(e){return o[e]||(o[e]=1,l++),[e]}))),_.each(r,function(e,t){t=parseInt(t,10),o[t]||(o[t]=1,n.push([t]),c++)}),!(i&&1===_.size(t._filesAndAffectedTests)||t.isManualRun())){var d=[],u={};_.each(n,function(e){var n=t._getTestFileId(e);if(!u[n]){var i=t._failingTests[n];i&&(d=d.concat(i),o[n]=1,u[n]=1,p++)}}),n=n.concat(d)}e("debug")("wallaby:testTask")("Test files from affected: %s, from deleted or manually requested: %s, from recently changed: %s, from loaded by: %s, from failing: %s",a,s,l,c,p),this._project.settings().runAllTestsInAffectedTestFile&&_.each(n,function(e){e&&(e.length=1)});var h=this._project.selectedTestFiles();return this._project.settings().runSelectedTestsOnly&&!h.hasSomeIncludedTestFiles?n=[]:(h.hasSomeIncludedTestFiles||h.hasSomeExcludedTestFiles)&&(n=_.filter(n,function(e){var n=t._getTestFileId(e);return(!h.hasSomeExcludedTestFiles||!t._project.isExcludedTestFile(n))&&(!h.hasSomeIncludedTestFiles||t._project.isIncludedTestFile(n))})),n},t.prototype.testData=function(){return this._getTestRunData()},t.prototype._getTestRunData=function(){var e=this;if(this.isFullRun()){var t=this._project.selectedTestFiles();if(this._project.settings().runSelectedTestsOnly&&!t.hasSomeIncludedTestFiles)return;if(t.hasSomeIncludedTestFiles)return{files:_.reduce(e._project.getIncludedTestFiles(),function(e,t){return e[t.id]=t,e},{}),names:"*"};if(t.hasSomeExcludedTestFiles)return{files:_.reduce(e._project.getNotExcludedTestFiles(),function(e,t){return e[t.id]=t,e},{}),names:"*"}}else{var n=e._getAllTests();if(n){var i={},o={};return _.each(n,function(t){var n=i,r=e._getTestFileId(t);if(r){var a=e._project._structure.testFilesById[r];if(a&&(o[a.id]=a,1===t.length&&(i="*"),"*"!==i))for(var s=1,l=t.length;s<l;s++){var c=t[s],p=n[":"+c],d=s===l-1;if(p&&!d||(p=n[":"+c]=d?"*":{}),"*"===p)break;n=p}}}),{files:o,names:i}}}},t.prototype._getTestFileId=function(e){var t=e&&e[0];if(t)return _.isNumber(t)?t:(this._project._structure.filesByPath[t]||{}).id},t}();t.exports={TestTask:o,runPriority:i}},{debug:void 0}],25:[function(e,t,n){!function(e){e.addEventListener&&(e.addEventListener("beforeunload",function(){if(!(e.$_$tracer&&e.$_$tracer._finished||e.navigator&&e.navigator.userAgent&&!/PhantomJS/.test(e.navigator.userAgent)&&!/Electron/.test(e.navigator.userAgent)&&!e.$_$tracer._startRequested))throw new Error("One of your tests is trying to unload window object.")}),e.$_$reportUnhanledPromises&&e.addEventListener("unhandledrejection",function(e){if(e&&e.reason){var t=new Error;throw e.reason.stack&&(t.stack=e.reason.stack),t.message="Unhandled promise rejection: "+(e.reason.message||e.reason),t}}));var t,n=/%[sdjc%]/g,i=/^(?!(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$)[_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*$/,o=/^(0|[1-9][0-9]*)$/,r=/'([^\\']|\\')*'/;
"function"!=typeof Function.prototype.bind&&(Function.prototype.bind=function(e){var t=Array.prototype.slice.call(arguments,1),n=this,i=function(){},o=function(){return n.apply(this instanceof i?this:e||{},t.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype||{},o.prototype=new i,o});var a=function(){var t=this;t._noOp=function(){},t._maxLogEntrySize=16384,t._evaluatedExpressionPerRangeLimit=10,t._undefined=e.undefined,t._setTimeout=e.setTimeout,t._Date=e.Date,t._Error=e.Error,t._Symbol=e.Symbol,t._JSONStringify=JSON.stringify,t._XMLHttpRequest=e.XMLHttpRequest,t._regExpToString=RegExp.prototype.toString,t._dateToString=Date.prototype.toString,t._HTMLAllCollection=e.HTMLAllCollection,t._getOwnPropertyNames=Object.getOwnPropertyNames,t._getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,t._pauseAfterSingleTestExecution=e.navigator&&e.navigator.userAgent&&/PhantomJS/.test(e.navigator.userAgent),t._replacedConsoleLog=e.console.log=function(){t._suppressConsoleLog||t._doWhenReceiverIsReady(function(e){t._log.apply(t,e)},arguments)},e.console.warn=function(){t._doWhenReceiverIsReady(function(e){t._warn.apply(t,e)},arguments)},e.console.error=function(){t._doWhenReceiverIsReady(function(e){t._error.apply(t,e)},arguments)},e.console.dir=function(){t._doWhenReceiverIsReady(function(e){t._dir.apply(t,e)},arguments)},e.console.debug=function(){t._doWhenReceiverIsReady(function(e){t._debug.apply(t,e)},arguments)},e.console.info=function(){t._doWhenReceiverIsReady(function(e){t._info.apply(t,e)},arguments)},t._receiver=e.$_$receiver||new e.WebSocket("ws://127.0.0.1:"+e.$_$receiverPort),t._onReceiverReady=[function(){t._receiverReady=!0}],t._receiver.onopen=function(){for(var e=0,n=t._onReceiverReady.length;e<n;e++)t._onReceiverReady[e]()},t._receiver.onerror=function(e){throw new Error("Sandbox receiver error: "+e.message)},t.reset()};if(a.prototype={setGlobalErrorHandler:function(){var t=this;e.$_$reuseableTracer||(e.onerror=function(){t._globalBrowserError.apply(t,arguments)})},_globalBrowserError:function(){var e=this;e._doWhenReceiverIsReady(function(t){e._sendBrowserGlobalError.apply(e,t)},arguments)},reportDeclarationError:function(){var e=this;e._doWhenReceiverIsReady(function(t){e._sendDeclarationError.apply(e,t)},arguments)},initialSpecId:function(){return e.$_$initialSpecId},start:function(t){var n=this;if(t||!(n._delayStart||n._startRequested&&!e.$_$reuseableTracer))if(n.reset(),t)this._onStart=t,this._patchFrameworks();else{if(!this._onStart)throw new Error("Missing tracer start subscription");n._startRequested=!0,this._receiverReady?this._onStart():this._onReceiverReady.push(this._onStart)}},isInitialized:function(){return!!e.$_$coverage},statement:function(n,i){e.$_$coverage[n][i][this._spec]=t++},scopeStart:function(e){this._fileEncounter[e]||(this._fileEncounterSequence.push(e),this._fileEncounter[e]=1)},programScopeStartLoading:function(e){this._testFileIds[e]&&this._resetFileData(),this.scopeStart(e)},programScopeEndLoading:function(e){this._testFileIds[e]&&(this._saveCurrentTestLoadingSequence(),this._resetFileData())},_saveCurrentTestLoadingSequence:function(){this._fileEncounterSequence.length&&this._testLoadingSequence.push(this._fileEncounterSequence.slice())},entryFile:function(){return this._fileEncounterSequence[0]},started:function(t){t=t||{},t.loadingSequence=this._testLoadingSequence.slice(),this._resetLoadingData(),this._resetFileData(),e.$_$wp=this._original_$_$wp,e.$_$wpe=this._original_$_$wpe,this._send("started",t)},specStart:function(e,t){var n=this;this._doWhenReceiverIsReady(function(){n._sendWithHighPriority("preTest","string"==typeof t?t:n._format(t))}),this._spec=e,this._resetFileData()},specSyncStart:function(){this._specRangeStart=t},specSyncEnd:function(){this._specRangeEnd=t-1},specEnd:function(){this._spec=0;var e=this._specRangeStart,n=this._specRangeEnd;return this._specRangeStart=0,this._specRangeEnd=0,[e,n||t]},needToNotifySingleTestRun:function(){if(this._paused||this._onResumed||!this.hasSpecFilter()||e.$_$reuseableTracer||!this._pauseAfterSingleTestExecution)return!1;for(var t=e.$_$tests;"*"!==t;){var n=Object.keys(t);if(1!=n.length)return!1;t=t[n[0]]}return!0},notifySingleTestAfterEach:function(t){return this._paused||this._onResumed||e.$_$reuseableTracer?void t():(this._paused=!0,this._onResumed=t,void this._send("resume"))},resume:function(){this._paused&&(this._paused=!1,this._onResumed&&(this._onResumed(),delete this._onResumed))},paused:function(){return this._paused},hasSpecFilter:function(){return!!e.$_$tests&&"*"!==e.$_$tests},specFilter:function(t){var n=e.$_$tests[":?"];if(n&&n[":"+t[t.length-1]])return!0;for(var i=e.$_$tests,o=0,r=t.length;o<r;o++){var a=t[o];if(i=i[":"+a],!i)return!1;if("*"===i)return!0}return!1},complete:function(t){e.$_$coverage&&(this._sendCoverageAndTimeMeasures(),this._send("complete",t),e.$_$reuseableTracer||(this._receiver.close(),this._finished=!0))},intermediateComplete:function(){this._sendCoverageAndTimeMeasures()},_sendCoverageAndTimeMeasures:function(){if(e.$_$coverage){var t,n;for(t=0,n=e.$_$coverage.length;t<n;t++){var i=e.$_$coverage[t];i&&i.length&&this._send("coverage",{id:t,ranges:i})}var o=Object.keys(s._autoTimeHits);for(t=0,n=o.length;t<n;t++){var r=s._autoTimeHits[o[t]];r.fileId&&this._sendLog("autoLog",r.value?this._formatTime(r.value)+"ms":"Σ "+this._formatTime(r.total)+"ms, μ "+this._formatTime(r.total/r.n)+"ms, ⋀ "+this._formatTime(r.min)+"ms, ⋁ "+this._formatTime(r.max)+"ms",r.context,r.fileId,r.rangeId)}}},_formatTime:function(e){return e.toFixed(3)},result:function(t){t.files=this._fileEncounterSequence,e.$_$reuseableTracer&&this._sendWithHighPriority("postTest"),this._send("test",t)},_patchFrameworks:function(){var t=this;if(!t._patchedFrameworks&&!e.$_$reuseableTracer){t._patchedFrameworks=!0;var n=e.requirejs&&"function"==typeof e.requirejs.load,i=e.System&&(e.System.fetch||e.System["import"]);if(t._shouldReportProgramScope=t._shouldReportProgramScope||n||i,n){var o=e.requirejs.load;e.requirejs.load=function(e,n,i){return o.call(this,e,n,t._urlWithFileData(i))}}if(i){var r=e.System.fetch;e.System.fetch=function(){var e=arguments[0]&&arguments[0].address;return e&&(arguments[0].address=t._urlWithFileData(e)),r.apply(this,arguments)};var a=e.fetch;a&&(e.fetch=function(){var e=arguments[0];return e&&(arguments[0]=t._urlWithFileData(e)),a.apply(this,arguments)});var s=e.System["import"];e.System["import"]=function(){var e=arguments[0];return e&&(arguments[0]=t._urlWithFileData(e)),s.apply(this,arguments)}}if(t._XMLHttpRequest){var l=t._XMLHttpRequest.prototype.open;t._XMLHttpRequest.prototype.open=function(e,n){arguments[1]=t._urlWithFileData(n),l.apply(this,arguments)}}t._Error&&!t._Error.captureStackTrace&&e.navigator&&e.navigator.userAgent&&/PhantomJS\/2/.test(e.navigator.userAgent)&&(t._Error.captureStackTrace=function(){})}},_urlWithFileData:function(e){var t=this;if(e&&~e.indexOf("wallabyFileId"))return e;for(var n=[],i=e.replace(/\\/g,"/").split("/"),o=0;o<i.length;o++)"."!==i[o]&&(".."===i[o]&&n.length&&".."!==n[n.length-1]?n.pop():n.push(i[o]));return e=n.join("/"),e=t._appendFileData(e)},_appendFileData:function(t){var n=this,i="/"===t.charAt(0)?t.substr(1):t,o=e.location&&e.location.host&&t.indexOf(e.location.host);o>=0&&(i=i.substr(o+e.location.host.length+1));var r=t.lastIndexOf("?");r>=0&&(i=i.substring(0,r));var a=i&&n._getFileMetadata(i);return a?t+(~r?"&":"?")+a.ts+"&wallabyFileId="+a.id:t},_getFileMetadata:function(t){return e.$_$files[t]||e.$_$files[t.split("\\").join("/")]},_doWhenReceiverIsReady:function(e,t){var n=this;n._receiverReady?e(t):n._onReceiverReady.push(function(){e(t)})},_log:function(){this._sendLog("log",this._format.apply(this,arguments))},_warn:function(){this._sendLog("warn",this._format.apply(this,arguments))},_error:function(){this._sendLog("error",this._format.apply(this,arguments))},_dir:function(e){this._sendLog("dir",this._inspect(e))},_debug:function(e){this._sendLog("debug",this._inspect(e))},_info:function(e){this._sendLog("info",this._inspect(e))},_debugLog:function(){this._sendLog("debugLog",this._format.apply(this,arguments))},_sendBrowserGlobalError:function(e,t,n){e=e&&e.toString()||"",t=t&&t.toString()||"",n=n&&n.toString()||"",this._send("globalError",{message:e,stack:e+"\nat "+t+":"+n})},_sendDeclarationError:function(e){this._send("globalError",{message:e.message,stack:e.stack,declaration:!0})},setEnvGlobal:function(e){this._envGlobal=e},resetEnvGlobal:function(){delete this._envGlobal},debugLog:function(){var e=this;e._doWhenReceiverIsReady(function(t){e._debugLog.apply(e,t)},arguments)},log:function(){var t=this,n=t._replacedConsoleLog!==e.console.log;if(n||t._envGlobal){for(var i=[],o=arguments.length-3,r=0;r<o;r++)i.push(arguments[r]);t._suppressConsoleLog=!0,t._envGlobal&&t._envGlobal.console.log.apply(t._envGlobal.console,i),n&&e.console.log.apply(console,i),t._suppressConsoleLog=!1}t._doWhenReceiverIsReady(function(e){for(var n=[],i=e.length-3,o=0;o<i;o++)n.push(e[o]);var r,a=e[i],s=e[i+1],l=e[i+2],c=s+","+l,p=t._consoleHits[c]=t._consoleHits[c]||0;p<t._evaluatedExpressionPerRangeLimit?r=t._evaluateExpressions(c+","+p,n[0],a):p===t._evaluatedExpressionPerRangeLimit&&(r=t._evaluateExpressions(c+","+p,n[0],a,new Error("Only the first "+p+" values are evaluated"))),t._consoleHits[c]=p+1,t._sendLog("log",t._format.apply(t,n)||"",a,s,l,r)},arguments)},setAssertionData:function(e,t){try{var n=Object.prototype.toString.call(e.actual);e.showDiff===!0&&n==Object.prototype.toString.call(e.expected)&&void 0!==e.expected&&"[object Boolean]"!==n&&"[object Number]"!==n&&"[object Function]"!==n&&("string"!=typeof e.actual&&(e.actual=this._inspect(e.actual,8,1e3,!0),e.expected=this._inspect(e.expected,8,1e3,!0)),t.actual=e.actual,t.expected=e.expected),"UnexpectedError"===e.name&&e.getErrorMessage&&(t.formattedDiff=e.getErrorMessage("ansi").toString()),e.actual&&e.actual.stack&&"string"==typeof e.actual.stack&&(t.stack=t.stack||"",t.stack+="\nFrom actual error object:\n"+e.actual.stack)}catch(i){}return t},diff:function(e,t,n,i,o){var r=this;r._doWhenReceiverIsReady(function(){var a=r.setAssertionData({showDiff:!0,expected:e,actual:t},{});r._sendLog("diff","",n,i,o,void 0,a.expected,a.actual)},arguments)},_sendLog:function(e,t,n,i,o,r,a,s){var l=t?t.length:0;t&&l>this._maxLogEntrySize&&(t=t.slice(0,this._maxLogEntrySize)+"...\n(truncated, total length: "+l+")"),this._send("console",{type:e,text:t||"",valueBag:r,spec:this._spec,file:i,range:o,context:n,expected:a,actual:s})},_send:function(e,t){this._receiver.send(this._JSONStringify(this._createMessage(e,t)))},_createMessage:function(t,n){return{type:t,data:n,session:e.$_$session}},_sendWithHighPriority:function(e,t){if(this._highPriorityReceiver){var n=this._createMessage(e,t);n._p="###wpm###",this._highPriorityReceiver.send(this._JSONStringify(n)+"\n")}else this._send(e,t)},_resetLoadingData:function(){this._testLoadingSequence=this._safeObject([])},_resetFileData:function(){this._fileEncounterSequence=this._safeObject([]),this._fileEncounter=this._safeObject([])},reset:function(){var e=this;t=1,e._formattingOpts={},e._consoleHits={},e._autoTimeHits={},e._spec=0,e._specRangeStart=0,e._specRangeEnd=0,e._resetFileData()},_safeObject:function(e){return e.toJSON=this._undefined,e},_format:function(e){var t,i=this._formattingOpts.depth||2,o=this._formattingOpts.maxElementsPerLevel||5e3;if("string"!=typeof e){var r=[];for(t=0;t<arguments.length;t++)r.push(this._inspect(arguments[t],i,o));return r.join(" ")}t=1;for(var a=arguments,s=a.length,l=1===s?e:String(e).replace(n,function(e){if("%%"===e)return"%";if(t>=s)return e;switch(e){case"%s":return String(a[t++]);case"%d":return Number(a[t++]);case"%j":return JSON.stringify(a[t++]);case"%c":return t++&&"";default:return e}}),c=a[t];t<s;c=a[++t])l+=null===c||"object"!=typeof c?" "+c:" "+this._inspect(c,i,o);return l},_inspect:function(t,n,i,o){var r={seen:[],showHidden:!1,hideTypes:o,depth:n||2,stylize:function(e){return e},maxElementsPerLevel:i||5e3,customInspect:e.$_$reuseableTracer&&this._nodeUtil};return this._formatValue(r,t,r.depth)},_formatValue:function(e,t,n){var i=this,o=this._formatPrimitive(e,t);if(o)return o;if(e.customInspect){var r=i._nodeUtil.inspect&&t[i._nodeUtil.inspect.custom];if(r||t.inspect===i._nodeUtil.inspect||"function"!=typeof t.inspect||(r=t.inspect),"function"==typeof r&&r!==i._nodeUtil.inspect&&(!t.constructor||t.constructor.prototype!==t)){var a=r.call(t,n,e);if(a!==t)return"string"!=typeof a?i._formatValue(e,a,n):a}}var s=Object.keys(t),l=this._arrayToHash(s);e.showHidden&&(s=Object.getOwnPropertyNames(t));var c=this._getOwnPropertySymbols(t);if(c.length&&(s=s.concat(c)),0===s.length){if("function"==typeof t){var p=t.name?": "+t.name:"";return e.stylize("[λ"+p+"]","special")}if(this._isRegExp(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(this._isDate(t))return e.stylize(Date.prototype.toString.call(t),"date");if(this._isError(t))return this._formatError(t)}var d="",u=!1,h=!1,m=!1,_=["{","}"],f=t&&t.constructor&&t.constructor.name||void 0;if(("Object"===f||e.hideTypes)&&(f=void 0),this._isArray(t)?(f=void 0,u=!0,_=["[","]"]):this._isSet(t)?h=!0:this._isMap(t)&&(m=!0),"function"==typeof t){var S=t.name?": "+t.name:"";d=" [λ"+S+"]"}if(this._isRegExp(t)&&(d=" "+RegExp.prototype.toString.call(t)),this._isDate(t)&&(d=" "+Date.prototype.toUTCString.call(t)),this._isError(t)&&(d=" "+this._formatError(t)),""===d&&f&&(_[0]=f+("String"!==f&&"Number"!==f&&"Boolean"!==f||"function"!=typeof t.valueOf?"":" "+this._formatPrimitive(e,t.valueOf()))+" "+_[0]),u||!this._isIterator(t)||m||h||(d=" [Iterator] "),!(0!==s.length||u&&0!==t.length||h||m))return _[0]+d+_[1];if(n<0)return this._isRegExp(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var w,v=!1;return s.length>e.maxElementsPerLevel&&(s.length=e.maxElementsPerLevel,u&&t&&(t=t.slice(0,e.maxElementsPerLevel)),v=!0),w=u?this._formatArray(e,t,n,l,s):h?this._formatSet(e,t,n,l,s,v):m?this._formatMap(e,t,n,l,s,v):s.map(function(o){return i._formatProperty(e,t,n,l,o,u)}),v&&w.push("..."),e.seen.pop(),this._reduceToSingleString(w,d,_)},_isArray:function(e){return Array.isArray(e)||"object"==typeof e&&"[object Array]"===this._objectToString(e)},_isSet:function(t){return!!(t&&e.Set&&"[object Set]"===this._objectToString(t)&&t.forEach)},_isMap:function(t){return!!(t&&e.Map&&"[object Map]"===this._objectToString(t)&&t.forEach)},_isIterator:function(t){return!!(t&&e.Symbol&&e.Symbol.iterator&&"function"==typeof t[e.Symbol.iterator])},_isRegExp:function(e){return"object"==typeof e&&"[object RegExp]"===this._objectToString(e)},_isDate:function(e){return"object"==typeof e&&"[object Date]"===this._objectToString(e)},_isError:function(e){return"object"==typeof e&&("[object Error]"===this._objectToString(e)||e instanceof Error)},_objectToString:function(e){return Object.prototype.toString.call(e)},_reduceToSingleString:function(e,t,n){var i=0,o=e.reduce(function(e,t){return i++,t.indexOf("\n")>=0&&i++,e+t.length+1},0);return o>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]},_formatPrimitive:function(e,t){switch(typeof t){case"undefined":return e.stylize("undefined","undefined");case"string":var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string");case"number":return e.stylize(""+t,"number");case"boolean":return e.stylize(""+t,"boolean");case"symbol":return this._Symbol&&this._Symbol.prototype.toString.call(t)}if(null===t)return e.stylize("null","null")},_formatError:function(e){return"["+Error.prototype.toString.call(e)+"]"},_formatSet:function(e,t,n,i,o,r){var a=this,s=[];t.forEach(function(t){if(!(s.length>e.maxElementsPerLevel)){var i=null===n?null:n-1,o=a._formatValue(e,t,i);s.push(o)}}),!r&&s.length>e.maxElementsPerLevel&&s.push("...");for(var l=0;l<o.length;l++)s.push(a._formatProperty(e,t,n,i,o[l],!1));return s},_formatMap:function(e,t,n,i,o,r){var a=this,s=[];t.forEach(function(t,i){if(!(s.length>e.maxElementsPerLevel)){var o=null===n?null:n-1,r=a._formatValue(e,i,o);r+=" => ",r+=a._formatValue(e,t,o),s.push(r)}}),!r&&s.length>e.maxElementsPerLevel&&s.push("...");for(var l=0;l<o.length;l++)s.push(a._formatProperty(e,t,n,i,o[l],!1));return s},_formatArray:function(e,t,n,i,o){for(var r=this,a=[],s=0,l=t.length;s<l;++s)this._hasOwnProperty(t,String(s))?a.push(this._formatProperty(e,t,n,i,String(s),!0)):a.push("");return o.forEach(function(o){o.toString().match(/^\d+$/)||a.push(r._formatProperty(e,t,n,i,o,!0))}),a},_formatProperty:function(e,t,n,i,o,r){var a,s,l;if(l=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]},l.get?s=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(s=e.stylize("[Setter]","special")),this._hasOwnProperty(i,o)||(a="["+o.toString()+"]"),s||(e.seen.indexOf(l.value)<0?(s=null===n?this._formatValue(e,l.value,null):this._formatValue(e,l.value,n-1),s.indexOf("\n")>-1&&(s=r?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n"))):s=e.stylize("[Circular]","special")),"undefined"==typeof a){if(r&&o.match(/^\d+$/))return s;a=this._propertyName(o),a=e.stylize(a,"string")}return a+": "+s},_arrayToHash:function(e){var t={};return e.forEach(function(e){t[e]=!0}),t},_hasOwnProperty:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},_getOwnPropertySymbols:function(e){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(e):[]},_propertyName:function(e){if(e.match(/^\d+$/))return e;var t=JSON.stringify(""+e);return t=t.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?t.substr(1,t.length-2):t.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'")},_evaluate:function(e,t,n,i,o){var r={};try{var a=n||{};if(a.props=a.props!==this._undefined?a.props:100,a.elements=a.elements!==this._undefined?a.elements:100,a.depth=a.depth!==this._undefined?a.depth:1,a.strLength=a.strLength!==this._undefined?a.strLength:200,a.level=0,a.expId=a.expId||i,a.rootExpression=t,a.autoExpand=a.autoExpand!==this._undefined&&a.autoExpand,a.autoExpandPreviousObjects=[],a.autoExpandPropertyCount=0,a.autoExpandLimit=a.autoExpandLimit!==this._undefined?a.autoExpandLimit:5e3,a.autoExpandMaxDepth=a.autoExpandMaxDepth!==this._undefined?a.autoExpandMaxDepth:10,a.node={current:this._undefined,parent:this._undefined,index:0},o){var s={error:o.message};this._processTreeNodeResult(s,a),r.data=s}else r.data=this._traverseObject({},e,a,a.expressionsToEvaluate||{})}catch(l){var c={error:'Error while evaluating "'+t+'": '+(l&&l.message||"")};this._processTreeNodeResult(c,a),r.data=c}return r},_addProperty:function(e,t,n,i,o,r){var a=this;return function(s){var l=o.node.current,c=o.node.index,p=o.node.parent;o.node.parent=l,o.node.index="number"==typeof i?i:s,e.push(a._property(t,n,i,o,r)),o.node.parent=p,o.node.index=c}},_addObjectProperty:function(e,t,n,i,o,r,a){var s=this;return t["_p_"+o.toString()]=!0,function(t){var l=r.node.current,c=r.node.index,p=r.node.parent;r.node.parent=l,r.node.index=t,e.push(s._property(n,i,o,r,a)),r.node.parent=p,r.node.index=c}},_traverseObject:function(e,t,n,i){var o=this,r=n.autoExpand;try{n.level++,n.autoExpand&&n.autoExpandPreviousObjects.push(t);var a,s,l,c,p,d,u,h=[],m=[],_=this._type(t),f="array"===_,S="function"===_,w=this._isPrimitiveType(_),v=this._isPrimitiveWrapperType(_),g=w||v,y={},V=0,D=!1;if(n.depth){if(f){d=t.splice(0,t.length),s=d.length;var b=i.ranges||n.ranges;if(b&&b.length===s)h=b.props,this._traverseRanges(h,function(e,t,i){for(a=t;a<=i;a++)m.push(o._addProperty(e.props,d,_,a,n))});else if(s>n.elements)l=0,c=s-1,m.push(function(e,t,n){return function(){h=h.concat(o._createRanges(e,t,n))}}(l,c,n));else for(l=0,c=s,a=l;a<c;a++)m.push(o._addProperty(h,d,_,a,n));n.autoExpandPropertyCount+=m.length}if("null"!==_&&"undefined"!==_&&!w&&"String"!==_&&"Buffer"!==_){var T=i.props||n.props;this._isSet(t)?(a=0,t.forEach(function(e){return V++,n.autoExpandPropertyCount++,V>T?void(D=!0):!n.isExpressionToEvaluate&&n.autoExpand&&n.autoExpandPropertyCount>n.autoExpandLimit?void(D=!0):void m.push(o._addProperty(h,t,"Set",a++,n,function(e){return function(){return e}}(e)))})):this._isMap(t)&&t.forEach(function(e,i){if(V++,n.autoExpandPropertyCount++,V>T)return void(D=!0);if(!n.isExpressionToEvaluate&&n.autoExpand&&n.autoExpandPropertyCount>n.autoExpandLimit)return void(D=!0);var r=o._inspect(i,2,10).replace(/\r?\n|\r/g," ").replace(/\s\s+/g," ");r.length>100&&(r=r.slice(0,100)+"..."),m.push(o._addProperty(h,t,"Map",r,n,function(e){return function(){return e}}(e)))});try{for(p in t)if(!this._blacklistedProperty(t,p)){if(V++,n.autoExpandPropertyCount++,V>T){D=!0;break}if(!n.isExpressionToEvaluate&&n.autoExpand&&n.autoExpandPropertyCount>n.autoExpandLimit){D=!0;break}m.push(o._addObjectProperty(h,y,t,_,p,n))}}catch(R){}if(y._p_length=!0,S&&(y._p_name=!0),!D){var k=this._getOwnPropertyNames(t).concat(this._getOwnPropertySymbols(t));for(a=0,s=k.length;a<s;a++)if(p=k[a],!this._blacklistedProperty(t,p)&&!y["_p_"+p.toString()]){if(V++,n.autoExpandPropertyCount++,V>T){D=!0;break}if(!n.isExpressionToEvaluate&&n.autoExpand&&n.autoExpandPropertyCount>n.autoExpandLimit){D=!0;break}m.push(o._addObjectProperty(h,y,t,_,p,n))}}}}if(e.type=_,g?(e.value=t.valueOf(),this._capIfString(_,e,n,i)):"date"===_?e.value=this._dateToString.call(t):"RegExp"===_?e.value=this._regExpToString.call(t):"symbol"===_&&this._Symbol?e.value=this._Symbol.prototype.toString.call(t):n.depth||"null"===_||"undefined"===_||(delete e.value,e.capped=!0),D&&(e.cappedProps=!0),u=n.node.current,n.node.current=e,this._treeNodePropertiesBeforeFullValue(e,n),m.length)for(a=0,s=m.length;a<s;a++)m[a](a);h.length&&(e.props=h)}catch(R){e.type="unknown",e.error=R.message,u=n.node.current,n.node.current=e,this._treeNodePropertiesBeforeFullValue(e,n)}finally{f&&n.depth&&t.splice.apply(t,[0,0].concat(d))}return this._additionalMetadata(t,e),this._treeNodePropertiesAfterFullValue(e,n),n.node.current=u,n.level--,n.autoExpand=r,n.autoExpand&&n.autoExpandPreviousObjects.pop(),e},_blacklistedProperty:function(t,n){if((t===e||t===this._envGlobal)&&"wallaby"===n||n.indexOf&&0===n.indexOf("$_$"))return!0},_createRanges:function(e,t,n,i){i=i||{index:0};for(var o=n.elements,r=t-e+1,a=[],s=Math.max(Math.ceil(r/o),o),l=e;l<t;l+=s){var c=l,p=Math.min(l+s-1,t);p+o/2>=t&&(p=t);var d=c+" - "+p,u=p-c+1,h={rangeNode:!0,name:d,props:u>2*o&&o>1?this._createRanges(c,p,n,i):[]};if(this._setNodeId(h,n),this._setNodeLabel(h,n),this._setNodeExpandableState(h,n),this._setNodePermissions(h,n),h.id+=" r "+i.index++,a.push(h),p===t)break}return a},_traverseRanges:function(e,t){for(var n=0,i=e.length;n<i;n++){var o=e[n];if(o.rangeNode=!0,o.props)if(o.props.length)this._traverseRanges(o.props,t);else if(o.props===!0){var r=o.name.split("-");o.props=[],t(o,parseInt(r[0],10),parseInt(r[1],10))}}},_capIfString:function(e,t,n,i){var o=i.strLength||n.strLength;("string"===e||"String"===e)&&t.value&&t.value.length>o&&(t.capped=t.value.substr(0,o),delete t.value)},_property:function(e,t,n,i,o){var r=this;o||(o=function(e,t){return e[t]});var a=n.toString(),s=i.expressionsToEvaluate||{},l=i.depth,c=i.isExpressionToEvaluate;try{var p=this._isMap(e),d=a;p&&"'"===d[0]&&(d=d.substr(1,d.length-2));var u=i.expressionsToEvaluate=s["_p_"+d];u&&(i.depth=i.depth+1),i.isExpressionToEvaluate=!!u;var h="symbol"==typeof n,m={name:h||p?a:this._propertyName(a)};if(h&&(m.symbol=!0),"array"!==t&&"Error"!==t){var _=this._getOwnPropertyDescriptor(e,n);if(_&&(_.set&&(m.setter=!0),_.get&&!u))return m.getter=!0,this._processTreeNodeResult(m,i),m}var f;try{f=o(e,n)}catch(S){return m={name:a,type:"unknown",error:S.message},this._processTreeNodeResult(m,i),m}var w=this._type(f),v=this._isPrimitiveType(w);if(m.type=w,v)this._processTreeNodeResult(m,i,f,function(){m.value=f.valueOf(),!u&&r._capIfString(w,m,i,{})});else{var g=i.autoExpand&&i.level<i.autoExpandMaxDepth&&i.autoExpandPreviousObjects.indexOf(f)<0&&"function"!==w&&i.autoExpandPropertyCount<i.autoExpandLimit;g||i.level<l||u?(this._traverseObject(m,f,i,u||{}),this._additionalMetadata(f,m)):this._processTreeNodeResult(m,i,f,function(){"null"!==w&&"undefined"!==w&&(delete m.value,m.capped=!0)})}return m}finally{i.expressionsToEvaluate=s,i.depth=l,i.isExpressionToEvaluate=c}},_processTreeNodeResult:function(e,t,n,i){this._treeNodePropertiesBeforeFullValue(e,t),i&&i(),this._additionalMetadata(n,e),this._treeNodePropertiesAfterFullValue(e,t)},_treeNodePropertiesBeforeFullValue:function(e,t){this._setNodeId(e,t),this._setNodeQueryPath(e,t),this._setNodeExpressionPath(e,t),this._setNodePermissions(e,t)},_treeNodePropertiesAfterFullValue:function(e,t){this._setNodeLabel(e,t),this._setNodeExpandableState(e,t),this._sortProps(e,t),this._addFunctionsNode(e,t),this._addLoadNode(e,t),this._cleanNode(e,t)},_additionalMetadata:function(e,t){try{e&&"number"==typeof e.length&&(t.length=e.length)}catch(n){}if("number"===t.type||"Number"===t.type)if(isNaN(t.value))t.nan=!0,delete t.value;else switch(t.value){case Number.POSITIVE_INFINITY:t.positiveInfinity=!0,delete t.value;break;case Number.NEGATIVE_INFINITY:t.negativeInfinity=!0,delete t.value}else"function"===t.type&&"string"==typeof e.name&&e.name&&t.name&&e.name!==t.name&&(t.funcName=e.name)},_setNodeId:function(e,t){e.id=t.node.parent?t.node.parent.id+" "+t.node.index:t.expId},_sortProps:function(e){e.props&&e.props.length&&"array"!==e.type&&"Map"!==e.type&&"Set"!==e.type&&e.props.sort(function(e,t){var n=e.name.toLowerCase(),i=t.name.toLowerCase();return n<i?-1:n>i?1:0})},_addFunctionsNode:function(e,t){if(e.props&&e.props.length){for(var n=[],i=[],o=0,r=e.props.length;o<r;o++){var a=e.props[o];"function"===a.type?n.push(a):i.push(a)}if(!i.length&&t.autoExpand&&(e.capped=!0),i.length&&!(n.length<=1)){e.props=i;var s={functionsNode:!0,props:n};t.autoExpand&&(s.capped=!0),this._setNodeId(s,t),this._setNodeLabel(s,t),this._setNodeExpandableState(s,t),this._setNodePermissions(s,t),s.id+=" f",e.props.unshift(s)}}},_addLoadNode:function(e,t){if(e.props&&e.props.length&&e.cappedProps&&"string"!==e.type){var n={loadActionNode:!0};this._setNodeId(n,t),this._setNodeQueryPath(n,t),this._setNodeLabel(n,t),this._setNodeExpandableState(n,t),this._setNodePermissions(n,t),n.id+=" l",e.props.push(n)}},_setNodeExpandableState:function(e){(e.capped||e.cappedProps||e.functionsNode||e.loadActionNode||e.rangeNode||e.getter||this._isArray(e.props))&&(e.expandable=!0)},_setNodePermissions:function(e,t){var n=t.node.parent;e._hasSymbolPropertyOnItsPath=e.symbol||n&&n._hasSymbolPropertyOnItsPath;var i=n&&n._hasSetOnItsPath,o=n&&n._hasMapOnItsPath;e._hasSetOnItsPath="Set"===e.type||i,e._hasMapOnItsPath="Map"===e.type||o;var r=!(e.functionsNode||e.loadActionNode||e.rangeNode||e.error);(!r||e._hasSymbolPropertyOnItsPath||i||o)&&(e.disallowToCopyPath=!0),r&&!e.getter&&"function"!==e.type&&"symbol"!==e.type&&"Set"!==e.type&&"Map"!==e.type||(e.disallowToCopyData=!0)},_cleanNode:function(e){delete e._hasSymbolPropertyOnItsPath,delete e._hasSetOnItsPath,delete e._hasMapOnItsPath},_setNodeExpressionPath:function(e,t){if(!t.node.parent)return void(e.expressionPath=[t.rootExpression]);var n=t.node.parent.expressionPath.slice();e.expressionPath=n.concat([this._propertyAccessor(e.name)])},_propertyAccessor:function(e){return e?e.match(o)?"["+e+"]":e.match(i)?"."+e:e.match(r)?"["+e+"]":"['"+e+"']":""},_setNodeQueryPath:function(e,t){if(!t.node.parent)return void(e.queryPath=[e.id]);if(e.loadActionNode)return void(e.queryPath=t.node.current.queryPath.slice());var n=e.name;n&&"'"===n[0]&&(n=n.substr(1,n.length-2)),e.queryPath=t.node.parent.queryPath.slice().concat(["_p_"+n])},_setNodeLabel:function(e,t){return e.label={},e.rangeNode?void(e.label.name=e.name):e.loadActionNode?void(e.label.name="..."):e.functionsNode?void(e.label.name="functions"):(e.label.name=e.name,e.label.type=this._formatNodeType(e,t),void(e.label.value=this._formatNodeValue(e,t)))},_formatNodeValue:function(e,t,n){if(e.rangeNode)return e.name;if(e.error)return e.error;if(e.getter)return"(...)";if("number"===e.type.toLowerCase()){var i=e;if(i.nan)return"NaN";if(i.positiveInfinity)return"Infinity";if(i.negativeInfinity)return"-Infinity"}if("null"===e.type||"undefined"===e.type)return e.type;if("string"===e.type.toLowerCase()){var o=e.capped?e.capped+"...":e.value;return"'"+o.replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'"+(e.capped?" (total length: "+e.length+")":"")}return(this._isUndefined(e.value)?this._formatCompactObjectView(e,t,n):e.value)+(e.funcName?":"+e.funcName:"")},_formatCompactObjectView:function(e,t,n){if("function"===e.type)return"λ";var i="array"===e.type&&0===e.length,o=["array"===e.type?"[":"{","","array"===e.type?"]":"}"];if(n||e.capped||e.ranges)o[1]=i?"":"...";else if(e.props){for(var r=5,a=[],s=[],l=0;l<e.props.length&&s.length<=r;l++){var c=e.props[l];("function"===c.type||c.getter?a:s).push("array"===e.type?this._formatNodeValue(c,t,!0):c.name+": "+this._formatNodeValue(c,t,!0))}s.length<r&&(s=s.concat(a)),o[1]=s.join(", "),e.props.length>r&&(o[1]+=", ...")}return o.join("")},_formatNodeType:function(e){if(this._isDisplayableType(e.type))return e.error?"":"date"===e.type?"Date":"array"===e.type?e.length?"Array("+e.length+")":"":e.type},_isUndefined:function(e){return e===this._undefined},_isDisplayableType:function(e){return!("boolean"===e||"Boolean"===e||"symbol"===e||"string"===e||"String"===e||"number"===e||"Number"===e||"object"===e||"Object"===e||"function"===e||"null"===e||"undefined"===e)},_type:function(e){var t=typeof e;return"object"===t?"[object Array]"===this._objectToString(e)?t="array":"[object Date]"===this._objectToString(e)?t="date":null===e?t="null":e.constructor&&(t=e.constructor.name||t):"undefined"===t&&this._HTMLAllCollection&&e instanceof this._HTMLAllCollection&&(t="HTMLAllCollection"),t},_isPrimitiveType:function(e){return"boolean"===e||"string"===e||"number"===e},_isPrimitiveWrapperType:function(e){return"Boolean"===e||"String"===e||"Number"===e},initLoadingPhase:function(){var t=this;this._resetLoadingData(),delete this._loadingSequence,this._testFileIds=this._safeObject({}),(e.$_$testFiles||[]).forEach(function(e){t._testFileIds[e.id]=1}),t._original_$_$wp=e.$_$wp,t._original_$_$wpe=e.$_$wpe,e.$_$wp=function(e){t._reportProgramScope("programScopeStart",e),t.programScopeStartLoading(e)},e.$_$wpe=function(e){t._reportProgramScope("programScopeEnd",e),t.programScopeEndLoading(e)}},_reportProgramScope:function(e,t){var n=this;this._shouldReportProgramScope&&this._doWhenReceiverIsReady(function(){n._sendWithHighPriority(e,t)})},_looksLikePromise:function(t){return t&&t.constructor&&"Promise"===t.constructor.name&&"function"==typeof t.then&&"function"==typeof t["catch"]&&(e.Promise||{}).prototype!==t},_looksLikeObservable:function(e){return e&&e.constructor&&e.constructor.name&&~e.constructor.name.indexOf("Observable")&&"function"==typeof e.forEach},_looksLikeBuffer:function(t){return t&&t.constructor&&"Buffer"===t.constructor.name&&"function"==typeof t.toString&&(e.Buffer||{}).prototype!==t},_autoLogValue:function(t,n,i,o,r,a,s,l){var c=this,p=e.$_$session;c._looksLikePromise(r)?r.then(function(r){e.$_$session===p&&c._autoLogResolvedValue(t,n,i,o,"then ",c._valueToFormat(r,a),s,l)})["catch"](function(r){e.$_$session===p&&c._autoLogResolvedValue(t,n,i,o,"catch ",(r||"<No Reason Provided>").toString(),s,l)}):c._looksLikeObservable(r)?r.forEach(function(r){e.$_$session===p&&c._autoLogResolvedValue(t,n,i,o,"",c._valueToFormat(r,a),s,l)}):c._autoLogResolvedValue(t,n,i,o,"",c._valueToFormat(c._looksLikeBuffer(r)?r.toString():r,a),s,l)},_valueToFormat:function(e,t){return"$_$ne"===t?e:t(e)},_autoLogResolvedValue:function(e,t,n,i,o,r,a,s){this._formattingOpts={maxElementsPerLevel:a?10:100};var l,c=e+","+t;n<this._evaluatedExpressionPerRangeLimit?l=this._evaluateExpressions(c+","+n,r,i,void 0,s):n===this._evaluatedExpressionPerRangeLimit&&(l=this._evaluateExpressions(c+","+n,r,i,new Error("Only the first "+n+" values are evaluated"),s)),
this._sendLog("autoLog",o+(this._format(r)||""),i,e,t,l),this._formattingOpts={}},_evaluateExpressions:function(e,t,n,i,o){var r=this._expressionsToEvaluate&&this._expressionsToEvaluate[e],a={expressionsToEvaluate:r};r||(a.depth=0),o&&(a.autoExpand=!0,a.depth=1,a.strLength=8192);var s=this._evaluate(t,n,a,e,i);return(s.data||{}).id=e,(s.data||{}).autoExpand=!!o,s}},e.$_$doNotInit)e.$_$Tracer=a;else{var s=new a;s.setGlobalErrorHandler();var l=function(e,t){return t-e};e.performance?s._time=function(){return e.performance.now()}:e.process&&e.process.hrtime?(s._time=function(){return e.process.hrtime()},l=function(e,t){return 1e3*(t[0]-e[0])+(t[1]-e[1])/1e6}):s._time=function(){return+new Date},s._logTime=function(e,t,n,i,o,r,a){var c=l(o,a),p=s._autoTimeHits[n];return p?(p.value&&(p.n=1,p.min=p.value,p.max=p.value,p.total=p.value,delete p.value),p.min=Math.min(p.min,c),p.max=Math.max(p.max,c),p.total+=c,p.n+=1):s._autoTimeHits[n]={value:c,context:i,fileId:e,rangeId:t},r},e.$_$w=function(e,t){s.statement(e,t)},e.$_$wp=function(e){s._reportProgramScope("programScopeStart",e),s.scopeStart(e)},e.$_$wpe=function(e){s._reportProgramScope("programScopeEnd",e)},e.$_$wf=function(e){s.scopeStart(e)},e.$_$wv=function(e,t,n,i,o,r,a,l){var c=s._consoleHits[n]||0;return a?s._identifierExpressionAutoLogHitLimit?c<s._identifierExpressionAutoLogHitLimit?s._doWhenReceiverIsReady(function(){s._autoLogValue(e,t,c,i,o,r,a,l)},arguments):c===s._identifierExpressionAutoLogHitLimit&&s._doWhenReceiverIsReady(function(){s._sendLog("log","Only the first "+s._identifierExpressionAutoLogHitLimit+" values are automatically logged, use console.log("+(i||"...")+") for the full output",i,e,t)},arguments):c||s._doWhenReceiverIsReady(function(){s._autoLogValue(e,t,c,i,o,r,a,l)},arguments):s._doWhenReceiverIsReady(function(){s._autoLogValue(e,t,c,i,o,r,a,l)},arguments),s._consoleHits[n]=c+1,o},e.$_$tracer=s,e.$_$coverage=e.$_$coverage||[],e.$_$reuseableTracer||(e.$_$tracer._expressionsToEvaluate=e.$_$expressionsToEvaluate||{});var c=function(e){return e.path},p=function(e){return e?e.replace(/\\/g,"/"):e},d=e.$_$testFiles&&(e.$_$testFiles||[]).map(c).map(p),u=e.$_$testFiles&&e.$_$testFiles.filter(function(e){return e.loaded}).map(c);s.initLoadingPhase(),e.wallaby={delayStart:function(){s._patchFrameworks(),s._delayStart=!0},start:function(){s._delayStart=!1,s.start()},_startWhenReceiverIsReady:function(e){s._shouldReportProgramScope=!0,s._doWhenReceiverIsReady(function(){e()})},tests:d,loadedTests:u,baseDir:e.$_$baseDir,slowTestThreshold:e.$_$slow||75}}}(function(){return this}()||global)},{}],26:[function(e,t,n){"use strict";var i=e("path"),o=e("node-uuid"),r=e("querystring"),a=e("http"),s={Atom:"AT",VSCode:"VSC",Sublime:"ST",IntelliJ:"IJ",VS:"VS"},l=function(){function e(e,t){if(e&&_.isString(t)){var n=e.client&&s[e.client];n&&e.edition&&(n=n+"-"+e.edition.toUpperCase());var r=e.cidFile;this._client=n||(~t.indexOf("wallaby-vscode")?"VSC":~t.indexOf(".wallaby")?"VS":~t.indexOf("atom-wallaby")?"AT":~t.indexOf("Sublime")?"ST":"IJ"),r||(r="VS"===this._client?i.join(t,"..","..","t.id"):"VSC"===this._client?i.join(t,"..","..","..",".wtid"):i.join(t,"..","t.id"));var a;try{a=e.readFileSync(r)}catch(l){a=o.v4();try{e.writeFileSync(r,a)}catch(c){}}this._cid=a||o.v4(),this._tid=process.env.quokka?"UA-58409118-5":"UA-58409118-3",this._coreVersion=e.coreVersion||"unknown",this._sendHeartbeat=!0}}return e.prototype.start=function(e){try{this._env=("browser"===e.env.type?e.env.kind:e.env.type)+" "+e.testFramework.version.substr(0,e.testFramework.version.indexOf("@"))}catch(t){this._env="unknown"}var n=this;this._heartbeatInterval=setInterval(function(){return n._heartbeat()},3e5),n._heartbeat()},e.prototype.dispose=function(){clearInterval(this._heartbeatInterval)},e.prototype.busy=function(){this._sendHeartbeat=!0},e.prototype._heartbeat=function(){this._sendHeartbeat&&this._event(this._env,this._coreVersion,this._client),delete this._sendHeartbeat},e.prototype._event=function(e,t,n){try{var i=r.stringify({v:1,tid:this._tid,cid:this._cid,t:"event",ec:e,ea:t,el:n}),o={hostname:"www.google-analytics.com",path:"/collect",method:"POST",headers:{"Content-Length":i.length}},s=a.request(o,function(e){e.on("data",_.noop),e.on("end",_.noop)});s.on("error",_.noop),s.write(i),s.end()}catch(l){}},e}();t.exports=l},{http:void 0,"node-uuid":void 0,path:void 0,querystring:void 0}],27:[function(e,t,n){"use strict";var i,o=e("./typeScriptVisitor"),r=e("./utils"),a=e("./typeScriptUtils"),s=e("semver"),l="2.1.5",c=function(){function e(e,t){this._useTsconfigFile=!0,this._opts=a.createOptions(i,e||{},this),this._useTsconfigFile&&(this._opts=a.mergeTsConfigOptions(i,this._opts,t)),this._opts.isolatedModules=!0,this._opts.suppressOutputPathCheck=!0,this._opts.allowNonTsExtensions=!0,this._opts.noLib=!0,this._opts.lib=void 0,this._opts.types=void 0,this._opts.noEmit=void 0,this._opts.noEmitOnError=void 0,this._opts.paths=void 0,this._opts.rootDirs=void 0,this._opts.declaration=void 0,this._opts.declarationDir=void 0,this._opts.out=void 0,this._opts.outFile=void 0,this._opts.noResolve=!0,this._visitor=new o(i)}return e.prototype.run=function(e){this._code="",this._ranges=[];var t=this._opts,n=e.path,o=i.createSourceFile(n,e.content,t.target);this._ranges=this._visitor.visit(o);var r=i.transpileModule(e.content,{fileName:n,compilerOptions:t,reportDiagnostics:!0});this._code=r.outputText;var s=r&&r.diagnostics;if(s&&s.length)throw new Error(_.reduce(s,function(e,t){var n=a.formatErrorText(i,t);return e[n]||(e[n]=n,e.message+="\n  - "+n),e},{message:"TypeScript compiler errors:"}).message);if(r.emitSkipped)return e.content;var l=r.sourceMapText&&JSON.parse(r.sourceMapText);if(!l)throw new Error("Cannot find source map for "+n);return this._noRename||e.changeExt("js"),{map:l,code:this._code,ranges:this._ranges}},e}();t.exports=function(t){return function(n){if(n.typescript)i=n.typescript;else try{i=r.requireModuleFrom(t,"typescript")}catch(o){i=e("typescript")}if(s.valid(i.version)&&s.lt(i.version,l))throw new Error("TypeScript version for compiler must be >= "+l);delete n.typescript;var a=new c(n,t);return function(e){return a.run(e)}}}},{"./typeScriptUtils":29,"./typeScriptVisitor":30,"./utils":31,semver:void 0,typescript:void 0}],28:[function(e,t,n){"use strict";var i,o=e("path"),r=e("graceful-fs"),a=e("minimatch"),s=e("semver"),l=e("./utils"),c=e("./typeScriptUtils"),p=e("./typeScriptVisitor"),d="1.5.3",u=function(){function e(e,t){var n=this,o=this;e=e||{},this._filePatterns=[],this._localProjectDir=t,this._useTsconfigFile=!0,e.files?(this._opts=!1,_.each(e.files,function(e,t){o._filePatterns.push(t),e=e||{};var r=c.createOptions(i,e,n);o._opts||(o._opts=r)})):(this._filePatterns.push("**/*.ts?(x)"),this._opts=c.createOptions(i,e,this)),this._allTrackedFiles={},this._allFiles={}}return e.prototype.createPostprocessor=function(){var e=this,t=this,n=function(n){var r=n.logger,a=t._filesToBeCompiled(n.affectedFiles,void 0,n.dot);if(!t._compiler||n.anyFilesAdded||n.anyFilesDeleted)if(t._compiler?n.tsPostprocessorOnly||r.debug("TypeScript language service is being re-created because some tracked files were added or deleted"):r.debug("New TypeScript language service is required"),t._allTrackedFiles=t._filesToBeCompiled(n.allFiles,function(e){return t._allFiles[e.fullPath]=e},n.dot),t._compiler&&n.tsPostprocessorOnly)n.anyFilesDeleted&&(n.affectedFiles||[]).length===(n.allFiles||[]).length&&(a={});else{if(a=t._allTrackedFiles,_.isEmpty(a))return r.debug("TypeScript postprocessor will be removed because in %s project files none were found by patterns: %s",n.allFiles.length,t._filePatterns),Q.when({removePostprocessor:!0});r.debug("TypeScript compiler options module (before tsconfig.json): %s",(t._opts||{}).module),t._useTsconfigFile&&(t._opts=c.mergeTsConfigOptions(i,t._opts,t._localProjectDir,r),r.debug("TypeScript compiler options module (after tsconfig.json): %s",(t._opts||{}).module)),t._compiler=t._createLanguageService(n.baseDir),t._visitor||(t._visitor=new p(i))}else _.each(a,function(e){var n=t._allTrackedFiles[e.fullPath];n&&(n.ts=e.ts)});var s=[];return _.each(a,function(a){if(t._orderFilesByReferenceComments&&t._dependencies){var l=t._dependencies.files[a.path];l&&l.hash!==t._getFileDependencies(a).hash&&delete t._dependencies}var p=t._compiler.getEmitOutput(a.fullPath),d=t._compiler.getSyntacticDiagnostics(a.fullPath);if(p.emitSkipped){var u=d.concat(t._compiler.getSemanticDiagnostics(a.fullPath));if(e._logErrors(r,u),t._opts.noEmitOnError)throw new Error(_.reduce(u.concat(t._compiler.getCompilerOptionsDiagnostics()),function(e,t){var n=c.formatErrorText(i,t);return e[n]||(e[n]=n,e.message+="\n  - "+n),e},{message:"TypeScript compiler errors:"}).message)}else d&&d.length&&e._logErrors(r,d);var h=t._visitor.visit(t._compiler.getSourceFile?t._compiler.getSourceFile(a.fullPath):t._compiler.getProgram().getSourceFile(a.fullPath)),m={};p.outputFiles.forEach(function(e){var t=o.extname(e.name);".map"===t?m.sourceMap=e.text:".js"===t||".jsx"===t?m.code=e.text:r.debug("Unexpected output file: %s",e.name)}),m.sourceMap&&s.push(n.createFile({path:_.isUndefined(t._opts.module)||t._opts.module?t._changeExtToJs(a.path):a.path+".compiled.js",original:a,content:m.code,sourceMap:JSON.parse(m.sourceMap),ranges:h,order:a.order,load:a.initialLoad}))}),t._orderFilesByReferenceComments&&!t._dependencies&&t._updateFileOrder(),Q.all(s)};return n.filePatterns=t._filePatterns,n.ts=!0,n},e.prototype._logErrors=function(e,t){t.forEach(function(t){e.error(c.formatErrorText(i,t))})},e.prototype._updateFileOrder=function(){var e=this;e._dependencies={files:{},min:Number.POSITIVE_INFINITY},_.each(e._allTrackedFiles,function(t){return e._orderFilesByReferences(t,e._dependencies,{})});var t=e._dependencies.min;_.each(e._dependencies.files,function(e){e.file.test||e.file.setOrder(t++,!0)})},e.prototype._orderFilesByReferences=function(e,t,n){var i=this;if(!n[e.path]&&(n[e.path]=!0,!t.files[e.path])){e.test||(t.min=Math.min(t.min,e.order));var o=i._getFileDependencies(e);_.each(o.items,function(e){return i._orderFilesByReferences(e,t,n)}),t.files[e.path]||(t.files[e.path]={hash:o.hash,file:e})}},e.prototype._getFileDependencies=function(e){var t,n=this,r="";try{t=i.preProcessFile(e.getContentSync()).referencedFiles}catch(a){throw new Error("Failed to get file dependencies: "+a.stack)}var s,l,c,p=_(t).map(function(t){return n._allTrackedFiles[o.join(o.dirname(e.fullPath),t.fileName)]}).filter(function(e){return!_.isUndefined(e)}).map(function(e){return r+=e.path,e}).value(),d=0;if(r.length>0)for(s=0,c=r.length;s<c;s++)l=r.charCodeAt(s),d=(d<<5)-d+l,d|=0;return{items:p,hash:d}},e.prototype._changeExtToJs=function(e){return e.substr(0,e.lastIndexOf(".")+1)+(_.endsWith(e,".js")?"jsts":"js")},e.prototype._createLanguageService=function(e){var t=this;if(!t._opts.noResolve){var n=i.resolveModuleName;i.resolveModuleName=function(o,r){var a=n.apply(this,arguments);if(a&&!a.resolvedModule){arguments[1]=r.replace(i.normalizePath&&i.normalizePath(e)||e,i.normalizePath&&i.normalizePath(t._localProjectDir)||t._localProjectDir);var s=n.apply(this,arguments);if(s&&s.resolvedModule)return s}return a}}var a={},s={};return i.createLanguageService({getScriptFileNames:function(){return Object.keys(t._allTrackedFiles)},getScriptVersion:function(e){e=o.normalize(e);var n=t._allTrackedFiles[e];return n&&n.ts.toString()},readFile:function(e){return(this.getScriptSnapshot(e)||{}).text},fileExists:function(e){if(e=o.normalize(e),t._opts.noResolve||!~e.indexOf(t._localProjectDir))return!1;var n=s[e];if(n===!1||n)return n;var i=o.dirname(e),l=a[i];return l===!1?(s[e]=!1,!1):(n=s[e]=r.existsSync(e),n?(a[i]=!0,!0):l?void 0:(a[i]=r.existsSync(i),!1))},getScriptSnapshot:function(n){n=o.normalize(n);var a=t._allFiles[n];if(a)return i.ScriptSnapshot.fromString(a.getContentSync());if(t._opts.noEmitOnError||!t._opts.noResolve)try{var s=n.replace(e,t._localProjectDir);if(r.existsSync(s))return i.ScriptSnapshot.fromString(r.readFileSync(s).toString())}catch(l){}},getCurrentDirectory:function(){return e},getCompilationSettings:function(){return t._opts},getDefaultLibFileName:function(e){return i.getDefaultLibFilePath(e)},getCustomTransformers:function(){return t._getCustomTransformers?t._getCustomTransformers(t._compiler.getProgram()):void 0}},i.createDocumentRegistry())},e.prototype._filesToBeCompiled=function(e,t,n){var i=this;return t=t||function(){},_.reduce(e,function(e,o){return _.find(i._filePatterns,function(e){return a(o.path,e,{dot:n})})&&(e[o.fullPath]=o),t(o),e},{})},e}();t.exports=function(t){return function(n){if(n.typescript)i=n.typescript;else try{i=l.requireModuleFrom(t,"typescript")}catch(o){i=e("typescript")}if(s.valid(i.version)&&s.lt(i.version,d))throw new Error("TypeScript version for compiler must be >= "+d);return delete n.typescript,new u(n,t).createPostprocessor()}}},{"./typeScriptUtils":29,"./typeScriptVisitor":30,"./utils":31,"graceful-fs":void 0,minimatch:void 0,path:void 0,semver:void 0,typescript:void 0}],29:[function(e,t,n){var i=e("path"),o=e("graceful-fs");t.exports={createOptions:function(e,t,n){t&&(n._orderFilesByReferenceComments||(n._orderFilesByReferenceComments=t.orderFilesByReferenceComments),delete t.orderFilesByReferenceComments,n._useStandardDefaults||(n._useStandardDefaults=t.useStandardDefaults),delete t.useStandardDefaults,n._getCustomTransformers||(n._getCustomTransformers=t.getCustomTransformers),delete t.getCustomTransformers,n._useTsconfigFile&&(n._useTsconfigFile=t.tsconfig!==!1),delete t.tsconfig);var i=this._normaliseOptions(e,t)||{},o={noLib:!0,noResolve:!0,declaration:!1,noEmit:!1,removeComments:!1},r={sourceMap:!0,inlineSourceMap:!1,inlineSources:!1,rootDir:void 0,mapRoot:void 0,outFile:void 0,noEmitOnError:!1};return n._useStandardDefaults&&(delete o.noLib,delete o.noResolve,delete o.declaration,delete r.noEmitOnError),_.extend(o,i,r)},getCompilerOptions:function(e,t){return this._normaliseOptions(e,e.parseJsonConfigFileContent?e.parseJsonConfigFileContent(e.parseConfigFileTextToJson(t,o.readFileSync(t).toString()).config,e.sys,e.getDirectoryPath(e.normalizePath(t)),{},t).options:e.readConfigFile(t,function(e){return o.readFileSync(e).toString()}).config.compilerOptions)},mergeTsConfigOptions:function(t,n,r,a){void 0===a&&(a={debug:function(){}});var s,l=i.join(r,"tsconfig.json");try{s=t.parseJsonConfigFileContent?t.parseJsonConfigFileContent(t.parseConfigFileTextToJson(l,o.readFileSync(l).toString()).config,_.extend(t.createCompilerHost(t.getDefaultCompilerOptions()),{readDirectory:t.sys.readDirectory}),t.getDirectoryPath(t.normalizePath(l)),{},l).options:t.readConfigFile(l,function(e){return o.readFileSync(e).toString()}).config.compilerOptions}catch(c){a.debug("Error parsing tsconfig file "+l+"\n("+c.message+")");try{s=e(l).compilerOptions}catch(p){a.debug("Error reading tsconfig file from "+l+"\n("+p.message+")")}}var d;return s?(s.allowJs&&!n.outDir&&delete n.outDir,d=_.extend({},this._normaliseOptions(t,s)||{},n)):d=n,d.allowJs||delete d.outDir,d},formatErrorText:function(e,t){var n=e.flattenDiagnosticMessageText(t.messageText,"\n");if(t.file){var i=t.file.getLineAndCharacterOfPosition(t.start);return"Error "+t.file.fileName+" ("+(i.line+1)+","+(i.character+1)+"): "+n}return"Error: "+n},_normaliseOptions:function(e,t){var n=this;if(t)return this._optionDeclarations||(this._optionDeclarations=_.reduce(e.optionDeclarations,function(e,t){return e[t.name]=t,e},{})),_.each(t,function(e,i){var o=n._optionDeclarations[i];o&&(_.isObject(o.type)&&_.isString(e)?t[i]=n._getNormalisedValue(e,o.type):"list"===o.type&&_.isArray(e)&&o.element&&_.isObject(o.element.type)&&(t[i]=_.map(e,function(e){return _.isString(e)?n._getNormalisedValue(e,o.element.type)||e:e})))}),t},_getNormalisedValue:function(e,t){return _.isFunction(t.get)?t.get(e.toLowerCase()):t[e.toLowerCase()]}}},{"graceful-fs":void 0,path:void 0}],30:[function(e,t,n){"use strict";var i=function(){function e(e){var t=this,n={};this._ts=e,n[e.SyntaxKind.DoStatement]=n[e.SyntaxKind.WhileStatement]=n[e.SyntaxKind.IfStatement]=n[e.SyntaxKind.SwitchStatement]=function(e){e.expression&&t._pushRange(e.expression)},n[e.SyntaxKind.ForStatement]=function(e){e.condition&&t._pushRange(e.condition)},n[e.SyntaxKind.ForInStatement]=n[e.SyntaxKind.ForOfStatement]=function(e){e.expression&&t._pushRange(e.expression)},n[e.SyntaxKind.BreakStatement]=n[e.SyntaxKind.ContinueStatement]=n[e.SyntaxKind.ThrowStatement]=function(e){t._pushRange(e)},n[e.SyntaxKind.VariableStatement]=function(n){(!t._parent||t._parent.kind!==e.SyntaxKind.ForStatement&&t._parent.kind!==e.SyntaxKind.ForInStatement&&t._parent.kind!==e.SyntaxKind.ExportAssignment)&&t._pushRange(n)},n[e.SyntaxKind.ExpressionStatement]=n[e.SyntaxKind.ReturnStatement]=function(e){t._pushRange(e)},n[e.SyntaxKind.ConditionalExpression]=function(e){t._pushRange(e.whenTrue),t._pushRange(e.whenFalse)},n[e.SyntaxKind.BinaryExpression]=function(e){t._pushRange(e.left),t._pushRange(e.right)},n[e.SyntaxKind.ArrowFunction]=function(e){e.body.statements||t._pushRange(e.body)},t._visit=function(i){var o=n[i.kind];o&&o(i),t._parent=i,e.forEachChild(i,t._visit)}}return e.prototype.visit=function(e){var t=this;return t._ranges=[],t._parent=null,t._sourceFile=e,t._visit(e),t._parent=null,t._sourceFile=null,t._ranges.slice()},e.prototype._pushRange=function(e){this._ranges.push(this._getRange(e))},e.prototype._getRange=function(e){var t=this._ts.getLineAndCharacterOfPosition(this._sourceFile,e.getStart(this._sourceFile)),n=this._ts.getLineAndCharacterOfPosition(this._sourceFile,e.getEnd());return[t.line+1,t.character,n.line+1,n.character]},e}();t.exports=i},{}],31:[function(e,t,n){var i=e("path"),o=/^\s*(\/\*\*?(.|\r?\n)*?\*\/)/,r=/^\s*/,a=/[\u001b\u009b][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-PRZcf-nqry=><]/g;t.exports={randomId:function(){return Math.random().toString(36).substr(2,5)},noopTrue:function(){return!0},noopTruePromise:function(){return Q.fcall(this.noopTrue)},isPatch:function(e){return e&&e.length>2&&"@"===e[0]&&"@"===e[1]},isLevelUpRelativePath:function(e){return e&&"."===e[0]&&"."===e[1]},docBlockComment:function(e){var t=e.match(o);return t?t[0].replace(r,"")||"":""},textIndexPosition:function(e,t){var n=this.textLines(e,t);return{line:n.length,column:n[n.length-1].length}},textLines:function(e,t){return e=_.isUndefined(t)?e:e.substr(0,t),e.split(/\r\n|\r|\n/)},verifyLocalOrigin:function(t,n){if(!t)return!0;var i=!1;try{var o=e("url").parse(t).hostname;i="localhost"===o||"0.0.0.0"===o||"127.0.0.1"===o||"::1"===o}catch(r){}return i||n||console.error("wallaby.js refused to accept connection from "+t),i},patchModule:function(t,n){var i=e("module").Module.prototype,o=i.require;i.require=function(e){return e===t?n(o.bind(this)):o.call(this,e)}},requireModuleFrom:function(t,n){try{return e(i.join(t,"node_modules",n))}catch(o){var r=e("module"),a=new r(".",null);return a.filename=i.join(t,"wallaby.js"),a.paths=r._nodeModulePaths(t),r._load(n,a,!1)}},resolveModulePathFrom:function(t,n){var o=e("module"),r=new o(".",null);return r.filename=i.join(t,"wallaby.js"),r.paths=o._nodeModulePaths(t),o._resolveFilename(n,r,!1)},nodeModulesLookup:function(t,n){var i=e("module").Module,o=i.prototype,r=i._nodeModulePaths,a=o.require;i._nodeModulePaths=function(e){var n=r.call(this,e);return t(n,e,r,this),n},n&&(o.require=function(e){return a.call(this,n(e))})},nodeModulePaths:function(t){var n=e("module");return n._nodeModulePaths(t)},patchBabelResolve:function(e){var t=this.nodeModulePaths(e);this.patchModule("resolve",function(e){var n=e("resolve"),i=n.sync;return n.sync=function(e,n){return~e.indexOf("babel")&&n&&(arguments[1].paths=(n.paths||[]).concat(t)),i.apply(this,arguments)},n})},hasAnsi:function(e){return e&&"string"==typeof e&&e.match(a)},removeAnsi:function(e){return e&&"string"==typeof e?e.replace(a,""):e},copyToClipboard:function(t){var n=function(e){return e&&console.warn("Failed to copy to clipboard. "+(e&&e.message))};try{e("copy-paste").copy(t,n)}catch(i){n(i)}},initServerOptions:function(t){var n=e("graceful-fs"),i=e("fs-extra");t.runnerResolver=function(t,n){return e("browser"===t?"electron"===n?"./electronRunner.js":"chrome"===n?"./chromeRunner.js":"./phantomRunner.js":"./nodeRunner.js")},t.processorPool=e("./processPool"),t.fileStructureCachePromise=function(e){return Q.nfcall(n.readFile,e).then(function(e){return Q.when(JSON.parse(e))})},t.fileStatPromise=function(e){return Q.nfcall(n.stat,e)},t.readFilePromise=function(e){return Q.nfcall(n.readFile,e)},t.writeFilePromise=function(e,t){return Q.nfcall(n.writeFile,e,t)},t.unlinkFilePromise=function(e){return Q.nfcall(n.unlink,e)},t.unlinkFileSync=function(e){return n.unlinkSync(e)},t.writeFileSync=function(e,t){return n.writeFileSync(e,t)},t.readFileSync=function(e){return n.readFileSync(e).toString("utf8")},t.fileExistsSync=function(e){return n.existsSync(e)},t.realpathSync=function(e){return n.realpathSync(e)},t.dirRemovePromise=function(e){return Q.nfcall(i.remove,e)},t.dirRemoveSync=function(e){return i.removeSync(e)},t.dirEnsurePromise=function(e){return Q.nfcall(i.ensureDir,e)},t.dirEnsureSync=function(e){return i.ensureDirSync(e)},t.nodeModulesLookup=this.nodeModulesLookup}}},{"./chromeRunner.js":8,"./electronRunner.js":12,"./nodeRunner.js":16,"./phantomRunner.js":18,"./processPool":20,"copy-paste":void 0,"fs-extra":void 0,"graceful-fs":void 0,module:void 0,path:void 0,url:void 0}],32:[function(e,t,n){t.exports={name:"Wallaby.js",version:"1.0.654",author:"Wallaby.js",license:"Proprietary",homepage:"https://wallabyjs.com",scripts:{postinstall:"node ./node_modules/grunt/bin/grunt patchNodeModules",test:"npm run test:unit","test:unit":"jest --no-cache -c=jest.unit.config.js","test:integration":"npm run test:integration:bootstrap && jest --no-cache -c=jest.integration.config.js","test:integration:bootstrap":"cd ./test/samples/integration && npm install && lerna bootstrap",build:"node ./node_modules/grunt/bin/grunt"},dependencies:{acorn:"6.0.2",esm:"3.0.8","acorn-jsx":"5.0.0",chokidar:"1.0.3","chrome-launcher":"0.8.0","chrome-remote-interface":"0.24.4","coffee-script":"1.10.0",commander:"2.5.0",compression:"1.7.2","copy-paste":"1.3.0",debug:"2.1.0","escodegen-wallaby":"1.6.23",express:"4.11.2","fs-extra":"0.12.0","graceful-fs":"4.1.3",lodash:"3.0.0","lru-cache":"2.5.0",minimatch:"3.0.4","node-uuid":"1.4.3",phantom:"0.7.2",q:"1.5.0",semver:"4.3.3","source-map":"0.4.3",typescript:"2.5.2","underscore.string":"2.3.3",ws:"1.1.1"},devDependencies:{"aws-sdk":"2.333.0","browserify-transform-tools":"1.5.0",chai:"4.2.0","chai-subset":"1.6.0",escodegen:"1.6.1","expect.js":"0.3.1",grunt:"1.0.3","grunt-browserify":"4.0.1","grunt-bump":"0.0.16","grunt-contrib-clean":"0.7.0","grunt-contrib-compress":"0.12.0","grunt-contrib-copy":"0.8.2","grunt-contrib-uglify":"0.11.0","grunt-run":"^0.8.1","grunt-ts":"6.0.0-beta.16",jest:"^23.6.0","line-column":"^1.0.2",npm:"4.1.2",removeNPMAbsolutePaths:"1.0.4","ts-node":"3.1.0"},"private":!0}},{}],33:[function(e,t,n){var i,o,r,a=e("path"),s=function(){};try{Error.stackTraceLimit=50}catch(l){}if(process.env&&process.env.NODE_MODULES_OVERRIDE&&(console.warn(" ---- Using node modules from: "+process.env.NODE_MODULES_OVERRIDE+" ---- "),e("./lib/utils").nodeModulesLookup(function(e){e.unshift(process.env.NODE_MODULES_OVERRIDE)})),"worker"!==process.argv[2]&&"runner"!==process.argv[2]){s(),process.env.PWD=process.cwd(),process.noDeprecation=!0,i=e("graceful-fs");var c=e("./lib/app"),p=e("commander"),d=!1;p.unknownOption=function(){},p.option("-p, --port <port>","specify port").option("-l, --projectCachePath <projectCachePath>","specify project cache location").option("-l, --configPath <configPath>","specify config file location").option("-r, --phantomjs <phantomjs>","specify phantomjs location").option("-k, --lkp [lkp]","specify lkp location").option("-c, --client [client]","specify client").option("-q, --quokka [quokka]","specify quokka").option("-q, --editorTypeScript [editorTypeScript]","specify editorTypeScript").option("-q, --homeDir <homeDir>","specify homeDir").option("-q, --cv <cv>","specify cv").parse(process.argv);var u={port:47878,location:a.join(__dirname,"lib","project")};if(p.port&&(u.port=p.port),p.projectCachePath&&(u.projectCachePath=p.projectCachePath),p.configPath&&(u.configPath=p.configPath),"win32"===process.platform&&(u.projectCachePath&&":"===u.projectCachePath[1]&&(u.projectCachePath=u.projectCachePath.charAt(0).toUpperCase()+u.projectCachePath.slice(1)),u.configPath&&":"===u.configPath[1]&&(u.configPath=u.configPath.charAt(0).toUpperCase()+u.configPath.slice(1))),p.phantomjs&&(u.phantomjs=p.phantomjs),p.editorTypeScript&&(u.editorTypeScript=p.editorTypeScript),p.homeDir&&(u.homeDir=p.homeDir),p.cv&&(u.cv=p.cv),d=p.quokka,d&&(process.env.quokka=!0),e("./lib/utils").initServerOptions(u),d){var h={},m={},f=function(e){return m[e]||!(!e||!~e.indexOf("quokka_fake_path")&&!~e.indexOf(a.join(process.cwd(),d.substr(0,d.lastIndexOf(".")))))};u.fileStructureCachePromise=function(e){return u.readFilePromise(e).then(function(e){return Q.when(JSON.parse(e))})};var S=u.fileStatPromise;u.fileStatPromise=function(e){return f(e)?h[e]?Q.when({}):Q.reject(new Error("File "+e+" not found")):S(e)};var w=u.readFilePromise;u.readFilePromise=function(e){if(f(e)){var t=h[e];return t?Q.when(t.content):Q.reject(new Error("File "+e+" not found"))}return w(e)};var v=u.writeFilePromise;u.writeFilePromise=function(e,t){return f(e)?(h[e]={content:t},Q.when(!0)):v(e,t)};var g=u.unlinkFilePromise;u.unlinkFilePromise=function(e){return f(e)?(delete h[e],Q.when(!0)):g(e)};var y=u.unlinkFileSync;u.unlinkFileSync=function(e){return f(e)?void delete h[e]:y(e)};var V=u.writeFileSync;u.writeFileSync=function(e,t){return f(e)?void(h[e]={content:t}):V(e,t)};var D=u.readFileSync;u.readFileSync=function(e){if(f(e)){var t=h[e];if(!t)throw new Error("File "+e+" not found");return t.content}return D(e)};var b=u.fileExistsSync;u.fileExistsSync=function(e){return f(e)?!!h[e]:b(e)};var T=u.realpathSync;u.realpathSync=function(e){return f(e)?e:T(e)};var R=u.dirRemovePromise;u.dirRemovePromise=function(e){return f(e)?Q.when(e):R(e)};var k=u.dirRemoveSync;u.dirRemoveSync=function(e){return f(e)?e:k(e)};var F=u.dirEnsurePromise;u.dirEnsurePromise=function(e){return f(e)?Q.when(e):F(e)};var W=u.dirEnsureSync;u.dirEnsureSync=function(e){return f(e)?e:W(e)},u.useMemoryFs=function(e){m[e]=!0;for(var t=e;t!==a.dirname(t);)t=a.dirname(t),m[t]=!0}}u.onStart=_.noop,u.onConnected=_.noop;var N=e("phantom/wq_sender");if(u._init=N.create,u.coreVersion=e("./package.json").version,"extended-core"===process.argv[2]||"extended-core-ws"===process.argv[2]||d)if("extended-core"!==process.argv[2]){u.quokka=d,u.client=p.client||"Sublime",u.lkp=p.lkp,u.Receiver=N.create();var I=e("ws").Server,U=new I({port:u.port,verifyClient:function(e){return _.verifyLocalOrigin(e.origin)}},function(){console.log(u.quokka?"quokka.js started":"wallaby.js started")});U.on("connection",function(t){var n={send:function(e){t.send(JSON.stringify(e))},receive:_.noop};u.onConnected(n),t.on("message",function(e){var t=JSON.parse(e);n.receive(t),"stop"===t.type&&process.exit()}),n.send({type:"started",version:e("./package.json").version})})}else{u.client=p.client||"Atom",u.lkp=p.lkp;e("util");u.Receiver=N.create(),process.nextTick(function(){var e={send:function(e){process.send(e)},receive:_.noop};process.on("message",function(t){if("connection"===t.type)u.onConnected(e);else try{e.receive(t)}finally{"stop"===t.type&&process.exit()}}),e.send({type:"started",version:u.coreVersion})})}else{u.Receiver=e("./lib/project");var E=e("ws").Server,M=new E({port:u.port,verifyClient:function(e){return _.verifyLocalOrigin(e.origin)}},function(){console.log("wallaby.js started"),console.log("core v"+u.coreVersion)});M.on("connection",function(e){var t={send:function(t){e.send(JSON.stringify(t))},receive:_.noop};u.onConnected(t),e.on("message",function(e){t.receive(JSON.parse(e))})})}c.start(u)}else if("runner"!==process.argv[2])s(),process.noDeprecation=!0,e("./lib/global"),process.on("message",function(t){if(t&&"exit"===t.type)return void process.exit(0);if("instrumentor"===t.type){var n=e("./lib/instrumentor");try{var i=n(t.content,t.opts);process.send(i)}catch(o){process.send({error:{message:o&&o.message,stack:o&&o.stack}})}}else if("preprocessor"===t.type||"compiler"===t.type){var r=e("./lib/processor");try{r(t)["catch"](function(e){process.send({error:{message:e&&e.message,stack:e&&e.stack}})}).then(function(e){process.send(e)})}catch(o){process.send({error:{message:o&&o.message,stack:o&&o.stack}})}}}),process.send("READY");else{if(o=process.argv[7],o&&!process.env.quokka){var Z=function(e,t){for(var n=[],i=0;i<t.length;i++)n.push(t[i]),e[i]&&n.push(e[i]);for(;i<e.length;i++)n.push(e[i]);return n};i=e("fs");var J=process.cwd(),x=a.dirname(o);r=a.join(J,"node_modules"),e("./lib/utils").nodeModulesLookup(function(e,t,n,i){var r=!1;e&&e[0]&&0===e[0].indexOf(J)&&(r=!0,Array.prototype.splice.apply(e,[0,e.length].concat(Z(n.call(i,t.replace(J,x)),e)))),r||e.push(o)},function(e){var t=e.replace(r,o);return t===e||i.existsSync(t)?t:e})}e("./lib/nodeTestWorker")(process.argv[3],process.argv[4],process.argv[5],process.argv[6],o,process.argv[8])}},{"./lib/app":5,"./lib/global":14,"./lib/instrumentor":15,"./lib/nodeTestWorker":17,"./lib/processor":21,"./lib/project":22,"./lib/utils":31,"./package.json":32,commander:void 0,fs:void 0,"graceful-fs":void 0,path:void 0,"phantom/wq_sender":void 0,"ts-node":void 0,util:void 0,ws:void 0}]},{},[33]);